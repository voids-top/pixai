import{j as a}from"./vendor-motion-Bl2lDopP.js";import{r as c}from"./vendor-apollo-B9XqHIAo.js";import{a9 as w,$ as d,y as v}from"./vendor-react-aria-BW9JtD2p.js";import{p as u,cm as h,T as r,k0 as N,kb as k,al as C,dD as S,mg as M,ka as g,aC as T,fG as z}from"./index-JhqgbpkX.js";import{m as I}from"./WorkflowGeneratorPage-Bs0INI1F.js";import{b as $,e as E,g as D,B as m}from"./vendor-mui-DTp04zm4.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-react-router-Bm0RsDwP.js";import"./vendor-i18next-TC5y0B3W.js";import"./vendor-firebase-BKQqa5bK.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";import"./TaskPublishDialog-C6g-yNPm.js";import"./LoraSelectContext-DhHbgVG-.js";import"./TrainLoraEvent-YJOi9HOY.js";import"./add-20-filled-BLwBa5AZ.js";import"./DropdownMenu-CzLyA4B-.js";import"./checkmark-circle-20-filled-Cc07OaOz.js";import"./useCopyToClipboard-BBBtjKLj.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},l=new e.Error().stack;l&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[l]="268ab698-7818-49d6-9f35-20ccae8ea4b6",e._sentryDebugIdIdentifier="sentry-dbid-268ab698-7818-49d6-9f35-20ccae8ea4b6")})()}catch{}(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(l){for(var s=1;s<arguments.length;s++){var i=arguments[s];if(i!=null)for(var t in i)i.hasOwnProperty(t)&&(l[t]=i[t])}return l}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const x=3;function de(e){const[l,s]=c.useState(!1),i=e.value?e.multiple?e.value.slice(0,x):[e.value]:[],t=I({hasValue:!!e.value});return a.jsxs(a.Fragment,{children:[a.jsxs(w,{className:u(t.group(),e.className),style:e.style,children:[a.jsxs(d,{className:t.button(),onPress:()=>s(!0),children:[a.jsx("div",{className:t.image({className:"grid grid-rows-1 grid-cols-1"}),children:i.map((n,o)=>a.jsx(h,{mediaId:n,thumbnail:!0,preferStill:!0,className:"row-start-1 col-start-1 size-full rounded ring-1 ring-black/80",style:{zIndex:x-o,transform:`translateX(${4*o}px)`,opacity:1-.4*o}},n))}),a.jsx("span",{children:e.value?.length&&e.multiple?a.jsx(r,{i18nKey:"workflow:parameter.inputs.media.counter",values:{count:e.value.length}}):a.jsx(r,{i18nKey:"workflow:parameter.inputs.media.label"})})]}),a.jsx(d,{className:t.dismiss(),onPress:()=>e.onChange?.(void 0),children:a.jsx(N,{className:"size-5"})})]}),a.jsx(_,{multiple:e.multiple,defaultValue:e.value,open:l,onClose:()=>s(!1),onSubmit:e.onChange})]})}function _(e){const[l,s]=k(()=>new Set);c.useEffect(()=>{e.open&&e.defaultValue?s(new Set([e.defaultValue].flat())):e.open||s(new Set)},[e.defaultValue,e.open,s]);function i(t){e.multiple?s(n=>{n.has(t)?n.delete(t):n.add(t)}):(e.onSubmit?.(t),e.onClose?.())}return a.jsxs(C,{open:e.open,onClose:e.onClose,className:"flex flex-col h-[calc(100vh-80px)]",children:[a.jsx("header",{className:"",children:a.jsx($,{className:"capitalize",children:a.jsx(r,{i18nKey:"workflow:parameter.inputs.media.dialog.title"})})}),a.jsxs(E,{className:"flex-1 flex flex-col pt-0",children:[a.jsx("section",{className:"flex-1",children:a.jsx(S,{renderItem:({content:t,mediaId:n})=>{const o=l.has(n);return a.jsxs("div",{className:u("relative transition",o&&"scale-90"),onClick:()=>i(n),children:[a.jsx("div",{className:u(o&&"opacity-50"),children:t}),o&&a.jsx(M,{className:"absolute inset-0 m-auto size-8 text-purple-600 bg-black rounded-full"})]})},className:"h-full"})}),e.multiple&&a.jsxs("section",{className:"flex-none mt-4 flex gap-2 h-12 overflow-x-auto",children:[a.jsxs("button",{className:"group sticky left-0 grid place-content-center h-full aspect-square bg-background-light rounded",onClick:()=>{s(t=>{t.clear()})},children:[a.jsx("div",{className:"contents group-hover:hidden",children:a.jsx("span",{children:l.size})}),a.jsx(g,{className:"size-6 hidden group-hover:block"})]}),Array.from(l).map(t=>a.jsxs("button",{className:"group flex-none relative h-full aspect-square overflow-hidden rounded",onClick:()=>{s(n=>{n.delete(t)})},children:[a.jsx(h,{mediaId:t,thumbnail:!0,preferStill:!0,className:"size-full"}),a.jsx("div",{className:"absolute inset-0 grid place-content-center bg-black/50 invisible group-hover:visible",children:a.jsx(g,{className:"size-6 text-white"})})]},t))]})]}),a.jsxs(D,{className:"max-mmd:mb-2",children:[a.jsx(P,{multiple:e.multiple,onComplete:t=>{for(const n of t)i(n)}}),a.jsx("span",{className:"ml-auto"}),a.jsx(m,{className:"capitalize",onClick:e.onClose,children:a.jsx(r,{i18nKey:"action:cancel"})}),e.multiple&&a.jsx(m,{variant:"contained",className:"capitalize",onClick:()=>{e.onSubmit?.(Array.from(l)),e.onClose?.()},children:a.jsx(r,{i18nKey:"action:confirm"})})]})]})}function P(e){const[l,s]=c.useState(0),[i,t]=c.useState(0);function n(){s(0),t(0)}return a.jsx(v,{acceptedFileTypes:["image/jpeg","image/png","image/webp"],allowsMultiple:e.multiple,onSelect:async o=>{if(o){s(o.length);const f=[];for(const b of o){const{mediaId:p}=await T(b,{onProgress:y=>{y===1&&t(j=>j+1)}});p&&f.push(p)}e.onComplete?.(f),n()}},children:a.jsx(m,{component:d,variant:"outlined",className:"capitalize",startIcon:l?a.jsx(z,{className:"size-5 animate-spin"}):void 0,children:l?`${i} / ${l}`:a.jsx(r,{i18nKey:"generation:image-edit.upload-image"})})})}export{de as default};
