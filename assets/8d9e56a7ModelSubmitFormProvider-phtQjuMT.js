import{i as m,C as M,t as I,e as c,u as C,g0 as _,bA as h,aP as P,a7 as T,f$ as k,j8 as j,hg as A,gb as L,j9 as G,j as O,l as N,h as F,ja as R}from"./index-BTMYyhc6.js";import{c as B}from"./camelCase-2j1YSjKF.js";import{d as H}from"./defaults-DtvpRUtA.js";import{c as q}from"./contextState-BhHzyxk5.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="26bdd247-78c0-4a0f-8ee7-b975b11a3666",e._sentryDebugIdIdentifier="sentry-dbid-26bdd247-78c0-4a0f-8ee7-b975b11a3666")}catch{}})();{var y=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};y._sentryModuleMetadata=y._sentryModuleMetadata||{},y._sentryModuleMetadata[new Error().stack]=Object.assign({},y._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}async function z(e){return await T(H(e,{title:"Delete model?",description:"Are you sure you want to delete this model?",confirmLabel:"Delete",ConfirmButtonProps:{color:"error",className:"font-bold"}})).then(()=>!0,()=>!1)}async function re(e,t){if(e=typeof e=="string"?m.getGenerationModel({id:e}).then(s=>s.generationModel):e,await z()){if(e=await e,!e)return!0;M("delete_model_click",{modelId:e.id,type:e.type});try{return await m.deleteGenerationModel({id:e.id}),I.success("Delete successfully"),!0}catch(s){return I.error(`Failed to delete. ${String(s)}`),!1}}}async function oe(e){const{upsertGenerationModel:t}=await m.upsertGenerationModel({id:e,input:{isPrivate:!1}});return t&&k(t.id,t,!1),t}async function X(e){const{importExternalModel:t}=await m.importExternalModel({url:e});return t??{}}async function $(e){const{fileUploadRecord:t}=await m.getFileUploadRecord({id:e});return t??{}}const d={Idle:"idle",Validating:"validating",Uploading:"uploading",Success:"success",Error:"error"};function K(){const[e,t]=c.useState(""),[s,n]=c.useState(),[o,i]=c.useState(d.Idle),[p,l]=c.useState();let r;const{t:g}=C(["market"]);async function u(b){f(),t(b),i(d.Validating);try{const a=await X(b);if(n(a),a.fileId)if(a.exists)i(d.Success),M("fetching_model_success",{exist:!0});else{i(d.Uploading);const{fileId:x}=a,E=r=j(async()=>{const{isFinished:w}=await $(x);w&&(E(),i(d.Success),M("fetching_model_success",{exist:!1}))},1e4)}else i(d.Idle);return a}catch(a){return console.error(a),i(d.Error),l(a),I.error(g("market:importer.messages.importing-failed",{error:a.toString()})),Promise.reject(a)}}function f(){t(""),i(d.Idle),l(void 0),r==null||r(),r=void 0}return{importModel:u,url:e,modelInfo:s,status:o,error:p,validating:o===d.Validating,uploading:o===d.Uploading,success:o===d.Success,reset:f}}const V="1544489361907720074";async function ie(e){const{generationModels:t}=await m.listGenerationModels({first:30,...e,type:h.AnyVae,authorId:V});return{data:P(t),pageInfo:t.pageInfo}}function le(e){const t=A(e)?h.Vae:L(e)?h.SdxlVae:void 0;return _(t?{first:30,type:t,authorId:V}:void 0)}function de(){const e=_({feed:"preset",type:h.AnyModel});return{modelList:P(e.data).sort((s,n)=>(n.extra.weightOffset??0)-(s.extra.weightOffset??0)),...e}}const Y=["shareImagesOnline","personalUses","commercialUses","shouldCreditAuthor"],ce=[{value:"",label:"common:visibility.all"},{value:"model",label:"generation:model.label"},{value:"lora",label:"LoRA"}],ue=[{value:"",label:"common:visibility.all"},{value:"sdv1",label:"SD 1.5"},{value:"sdxl",label:"SDXL"}],fe=[{value:"",label:"common:visibility.all"},{value:"pixai",label:"PixAI"},{value:"external",label:"common:sources.external.label"}],me=[{value:"",label:"market:search.all-time"},{value:"today",label:"market:search.today"},{value:"this-week",label:"market:search.this-week"},{value:"this-month",label:"market:search.this-month"}];function J(e,t){const{modelId:s,title:n,tags:o,type:i,category:p,uploadId:l,extra:r,isDownloadable:g,media:u,isPrivate:f,firstVersionExtra:b}=t,a=!!t.modelId;if(!n)throw new Error(e("market:submit.notice.title-needed"));if(!i)throw new Error(e("market:submit.notice.type-needed"));if(!u)throw new Error(e("market:submit.notice.media-needed"));if(!a&&!l)throw new Error(e("market:submit.notice.file-cant-be-empty"));const x={permissions:r==null?void 0:r.permissions,description:r==null?void 0:r.description,qualityTags:r==null?void 0:r.qualityTags},{name:E,...w}=b??{},U=Object.fromEntries(Object.entries(w).filter(([ee,v])=>v!=null&&v!==""));return{title:n,category:p,tags:G(o),mediaId:u==null?void 0:u.id,isDownloadable:g,extra:x,type:a?void 0:i,fileUploadId:a?void 0:l,isPrivate:a?void 0:f,firstVersion:{extra:U,name:E}}}function pe({versionVals:e,modelId:t,fileId:s,mediaId:n}){const{name:o,...i}=e;return{name:o,modelId:t,mediaId:n,fileUploadId:s,extra:i}}function Q({values:e}){var o;const{name:t,...s}=e.firstVersionExtra??{},n={version:t,...s};return{editMode:e.modelId!=null?"edit":"create",modelName:e.title,type:e.type,isPrivate:e.isPrivate,hasTag:(e.tags??[]).length>0,hasCover:!!e.media,isDownloadable:e.isDownloadable,...n,...(o=e.extra)==null?void 0:o.permissions}}function ge({values:e,versionRes:t,modelId:s,versionId:n}){var l;const{name:o,...i}=e??{},p={version:o,...i};return{editMode:n!=null?"edit":"create",modelId:s,type:(l=t==null?void 0:t.model)==null?void 0:l.type,...p}}function be(e){const{permissions:t,...s}=e??{};return{...s,permissions:Object.fromEntries(Object.entries(t??{}).map(([n,o])=>[B(n),o]).filter(([n])=>Y.includes(n)))}}const[W,ye]=q({step:0});W.displayName="ModelUploadContext";const D=c.createContext({});function Me(e){const t=K();return O.jsx(D.Provider,{value:t,children:e.children})}const S=c.createContext({loading:!1,submit:()=>{},values:{},handleChange:R(),getValues:()=>{},setValues:()=>{}});S.displayName="ModelFormSubmitContext";const he=()=>c.useContext(S),Z={extra:{permissions:{shareImagesOnline:!0,personalUses:!0,commercialUses:!1,shouldCreditAuthor:!1}}};function xe(e){const{t}=C(["market"]),s=N(e.initialValues??Z),{values:n,getValues:o,setValues:i,handleChange:p}=s,{url:l}=c.useContext(D),[r,g]=F(async()=>{const f=n,b=J(t,f),a=await m.upsertGenerationModel({id:n.modelId,input:b});return a.upsertGenerationModel&&k(a.upsertGenerationModel.id,a.upsertGenerationModel,!1),M("submit_model_success",{...Q({values:f}),url:l}),a},[l,n]),u=c.useMemo(()=>({loading:r,submit:g,...s}),[r,g,s]);return O.jsx(S.Provider,{value:u,children:e.children})}export{D as E,xe as M,me as T,be as a,ce as b,fe as c,re as d,ue as e,de as f,d as g,pe as h,ge as i,ye as j,Me as k,W as l,Y as m,le as n,ie as o,oe as p,he as u};
//# sourceMappingURL=ModelSubmitFormProvider-phtQjuMT.js.map
