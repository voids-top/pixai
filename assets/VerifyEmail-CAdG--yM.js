import{j as t}from"./vendor-motion-Bl2lDopP.js";import{r as d}from"./vendor-apollo-B9XqHIAo.js";import{a as j,b as v,e as T,t as m,U as x,u as L,c as k,r as M,L as V,N as F,d as I,f as N,g as A,h as D}from"./index-JhqgbpkX.js";import{Z as _,_ as S}from"./vendor-firebase-BKQqa5bK.js";import{u as E}from"./vendor-i18next-TC5y0B3W.js";import{u as P}from"./useRaf-D50-5myI.js";import{A as y}from"./AuthLayout-D0rtJlIT.js";import{d as R}from"./vendor-react-router-Bm0RsDwP.js";import{q as g,t as b,v as $,B as O}from"./vendor-mui-DTp04zm4.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="7fb5fb11-b9d5-4153-acc9-b0bef1905e12",e._sentryDebugIdIdentifier="sentry-dbid-7fb5fb11-b9d5-4153-acc9-b0bef1905e12")})()}catch{}(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(a){for(var s=1;s<arguments.length;s++){var n=arguments[s];if(n!=null)for(var r in n)n.hasOwnProperty(r)&&(a[r]=n[r])}return a}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();var z={restoreOnUnmount:!1};function B(e,a){a===void 0&&(a=z);var s=d.useRef(document.title);document.title!==e&&(document.title=e),d.useEffect(function(){if(a&&a.restoreOnUnmount)return function(){document.title=s.current}},[])}const G=typeof document<"u"?B:function(e){},K=({intent:e})=>{const{t:a}=E(["auth"]),[s,n]=d.useState(0),{data:r}=j(),[c,f]=v(async()=>{try{await T({input:{intent:e,approach:_.Email}}),n(Date.now()),m.success(`sent to ${r?.email}`)}catch(o){m.error(`${o?.message}`)}},[r]);P(1e10);const i=Date.now()-s,l=6e4;return t.jsxs(x,{variant:"outlined",size:"small",busy:c,disabled:i<l,onPress:f,children:[a("auth:resend-email")," ",i<l?`(${(l-i)/1e3<<0}s)`:null]})},W=({initialValues:e,onSuccess:a=()=>{},onCancel:s=()=>{}})=>{const{t:n}=E(["auth","action"]),{values:{email:r},handleChange:c,getValues:f}=N(e),[i,l]=v(async()=>{const o=await f();if(!o)return;const{email:p}=o;try{const u=await A({input:{email:p}});D(u.data?.updateUserSensitiveInfos),await T({input:{intent:S.VerifyEmail,approach:_.Email}}),a(),m.success(`Already send a verification email to ${p}.`)}catch(u){m.error(u?.message)}},[]);return t.jsxs(t.Fragment,{children:[t.jsxs(g,{variant:"standard",children:[t.jsx(b,{shrink:!0,children:n("auth:email")}),t.jsx(I,{fullWidth:!0,value:r,onChange:c("email"),autoFocus:!0,placeholder:n("auth:email"),onKeyDown:o=>{o.code==="Enter"&&l(),o.code==="Escape"&&s()}})]}),t.jsx(x,{variant:"filled",size:"large",busy:i,onPress:()=>l(),children:n("action:confirm")}),t.jsx(O,{variant:"text",size:"small",onClick:s,children:n("action:cancel")})]})},q=()=>{const{t:e}=E(["auth"]);G("Verify Email");const[{code:a,to:s="/profile/edit"}]=L(),[n,r]=d.useState(()=>a||""),[c,f]=d.useState(""),{data:i,loading:l}=j(),o=R(),[p,u]=d.useState(!1),[U,w]=v(async h=>{try{if(!i)return;await k({code:h}),M(),m.success("Email verified successfully."),setTimeout(()=>{o(s)},3e3)}catch(C){f(`Failed to verify email: ${C?.message}`)}},[i]);return d.useEffect(()=>{n&&i&&w(n)},[i]),d.useEffect(()=>{i?.emailVerified&&o("/profile/edit")},[i]),i?!i.email||p?t.jsx(y,{children:t.jsx(W,{initialValues:i,onSuccess:()=>u(!1),onCancel:()=>u(!1)})}):t.jsxs(y,{children:[t.jsxs(g,{variant:"standard",children:[t.jsx(b,{shrink:!0,htmlFor:"email-input",children:e("auth:email")}),t.jsxs("div",{className:"mt-6 min-h-[45px] flex gap-4 items-center",children:[i.email,t.jsx("div",{className:"flex-1"}),t.jsx("button",{className:"hover:underline",onClick:()=>u(!0),children:e("auth:edit")})]})]}),c?t.jsx($,{severity:"warning",children:c}):null,t.jsxs(g,{variant:"standard",children:[t.jsx(b,{shrink:!0,htmlFor:"code-input",children:e("auth:email-verification-code")}),t.jsx(I,{value:n,onChange:h=>r(h.target.value),id:"code-input",type:"text",autoComplete:"off",placeholder:e("auth:enter-email-verification-code")})]}),t.jsx(x,{variant:"filled",size:"large",busy:U,onPress:()=>w(n),children:e("auth:verify-email")}),t.jsx(K,{intent:S.VerifyEmail})]}):l?t.jsx(V,{}):t.jsx(y,{children:t.jsx(F,{})})},ye=q;export{ye as Component};
