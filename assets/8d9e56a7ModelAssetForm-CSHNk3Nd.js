import{e as E,ik as kr,bT as fn,j as s,aM as Ea,il as Aa,aP as cn,cA as ka,ap as nr,ab as mn,a0 as fe,ac as Ia,K as Ce,bn as hn,U as ht,c6 as bn,P as Yt,by as yn,im as _n,io as zt,ip as Se,i as ge,iq as Mt,ir as Lt,bA as A,u as K,is as Ba,c4 as gn,it as qa,iu as Wa,iv as Oa,fD as Fa,b8 as pn,f as za,h as Sn,t as L,C as re,B as bt,J as Ma,a8 as La,fZ as Da,bE as Na,bv as Ua,l as $a,f$ as Va,iw as Ha,a7 as Qa,H as Ga}from"./index-BTMYyhc6.js";import{u as Ya}from"./index-C-ypkS9u.js";import{a as Ka}from"./index-Cpf8OWOQ.js";import{M as ar}from"./MediaPreview-CrisSWrJ.js";import{f as Za,T as Xa,a as Ja,b as ei,S as Je,B as Ir}from"./dismiss-24-filled-DmGl87MD.js";import{U as wn}from"./UploadImage-DewQdK81.js";import{d as ti,C as ri}from"./index-qPceTsh8.js";import{g as ni}from"./cursorPagingUtils-YTUXhLAt.js";import{E as ai,g as et,h as ii,i as oi}from"./ModelSubmitFormProvider-phtQjuMT.js";import{i as Br}from"./async-DCNJOliF.js";import{C as si}from"./index-D334VmL8.js";import{f as li}from"./formatNum-CBDReyYg.js";import{f as ui}from"./add-24-filled-BdM6xnA7.js";import{i as di}from"./outline-add-photo-alternate-BAWueb6h.js";import{i as fi}from"./round-plus-RCIMN6sR.js";import{d as ci}from"./ModelEditRequest-ZSfXOuoq.js";import{M as mi}from"./ModelVersionForm-BG9Yypwf.js";import{T as hi,a as bi,b as ut,c as O,d as yi}from"./TableRow-qxF9QOyo.js";(function(){try{var e=typeof window<"u"?window:typeof Se<"u"?Se:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="ac172ec7-5cac-40d2-994e-c5e956310b0c",e._sentryDebugIdIdentifier="sentry-dbid-ac172ec7-5cac-40d2-994e-c5e956310b0c")}catch{}})();{var Xe=typeof window<"u"?window:typeof Se<"u"?Se:typeof self<"u"?self:{};Xe._sentryModuleMetadata=Xe._sentryModuleMetadata||{},Xe._sentryModuleMetadata[new Error().stack]=Object.assign({},Xe._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}function _i(e){var t=E.useState(function(){return kr(typeof e=="function"?e():e,!0)}),r=t[1];return[t[0],E.useCallback(function(n){r(typeof n=="function"?fn(n):kr(n))},[])]}const gi=e=>s.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:s.jsx("path",{fill:"currentColor",d:"M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2m3.22 6.97l-4.47 4.47l-1.97-1.97a.75.75 0 0 0-1.06 1.06l2.5 2.5a.75.75 0 0 0 1.06 0l5-5a.75.75 0 1 0-1.06-1.06"})}),ye=new Map,pi=E.forwardRef(function(t,r){const{min:n=1,max:a=1/0}=t,{me:i}=Ea(),[o,l]=E.useState(!1),{data:d,isValidating:u,setSize:c}=Aa((f,h)=>{var g;return i?{authorId:i.id,[bn(t.modelType)?"loraVersionId":"modelVersionId"]:t.modelVersionId,orderBy:"-createdAt",first:5,after:f>0?(g=h==null?void 0:h.pageInfo)==null?void 0:g.endCursor:void 0}:void 0}),m=E.useMemo(()=>{var f,h;return((h=(f=d==null?void 0:d.at(-1))==null?void 0:f.pageInfo)==null?void 0:h.hasNextPage)??!0},[d]),b=E.useMemo(()=>(d==null?void 0:d.flatMap(f=>cn(f)))??[],[d]),[R,p]=E.useState(null),C=E.useRef(null),T=ka(C,{root:R});E.useEffect(()=>{o&&(T!=null&&T.isIntersecting)&&m&&!u&&c(f=>f+1)},[m,T==null?void 0:T.isIntersecting,u,o,c]);const[S,_]=_i(()=>new Set);function x(f){var g;const h=f.id;t.multiple?S.has(h)?S.size>n&&_(w=>{w.delete(h)}):(S.size<a&&_(w=>{w.add(h)}),f.media&&!ye.has(h)&&ye.set(h,f)):(g=t.onSubmit)==null||g.call(t,h)}function j(){var f;l(!1),(f=t.onClose)==null||f.call(t),c(0),_(()=>new Set)}return E.useImperativeHandle(r,()=>({open:()=>{t.multiple&&t.value&&_(new Set(t.value)),l(!0)}}),[t.multiple,t.value,_]),i?s.jsxs(nr,{open:o,onClose:j,className:"text-sm",children:[s.jsx(mn,{children:s.jsx(fe,{i18nKey:"artwork:artwork-picker.title",values:{count:t.multiple?2:1}})}),s.jsxs(Ia,{children:[s.jsx(Ka,{data:b,context:{sentinelRef:C,havingMore:m,loading:u},style:{height:600},scrollerRef:p,components:Si,listClassName:"grid grid-cols-[repeat(auto-fill,minmax(160px,1fr))] gap-1",itemContent:(f,h)=>s.jsxs("div",{className:"relative aspect-square",children:[s.jsx(ar,{media:h.media,thumbnail:!0,className:Ce("size-full rounded-md transition ease-in-out",S.has(h.id)&&"opacity-80 scale-90"),onClick:()=>x(h)}),S.has(h.id)&&s.jsx(gi,{className:"absolute inset-0 m-auto size-6 text-purple-600 bg-white rounded-full pointer-events-none"})]})}),t.multiple&&s.jsx(wi,{selection:S,onChange:_,max:t.max})]}),s.jsxs(hn,{children:[s.jsx(ht,{onPress:j,children:s.jsx(fe,{i18nKey:"action:cancel"})}),t.multiple&&s.jsx(ht,{variant:"filled",onPress:()=>{var f;(f=t.onSubmit)==null||f.call(t,Array.from(S.keys())),j()},children:s.jsx(fe,{i18nKey:"action:confirm"})})]})]}):null}),Si={Footer:({context:e})=>s.jsx("div",{ref:e==null?void 0:e.sentinelRef,className:"mt-1 text-center text-sm text-neutral-500",children:!e||e.loading?s.jsx("div",{className:"mx-auto overflow-hidden",style:{width:42,height:14},children:s.jsx(Yt,{inline:!0})}):e.havingMore?null:s.jsx(fe,{i18nKey:"common:list-reached-the-end"})})};function wi(e){return s.jsxs("div",{className:"mt-4 flex gap-1",children:[s.jsxs("div",{className:"grid place-content-center size-12 border border-zinc-300 dark:border-zinc-600 rounded",children:[e.selection.size,Number(e.max)>0&&`/${e.max}`]}),Array.from(e.selection).map(t=>s.jsx(Ri,{artworkId:t,onRemove:()=>{var r;return(r=e.onChange)==null?void 0:r.call(e,fn(e.selection,n=>{n.delete(t)}))}},t))]})}function Ri(e){const{data:t=ye.get(e.artworkId)}=yn(ye.has(e.artworkId)?void 0:e.artworkId);return!ye.has(e.artworkId)&&t&&ye.set(e.artworkId,t),s.jsxs("div",{className:"group/item relative",children:[s.jsx(ar,{media:t==null?void 0:t.media,thumbnail:!0,className:"size-12 rounded group-hover/item:opacity-50",onClick:e.onRemove}),s.jsx(Za,{className:"absolute inset-0 m-auto size-6 text-black dark:text-white invisible group-hover/item:visible pointer-events-none"})]})}var Rn={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Kt=function(e,t){return Kt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var a in n)n.hasOwnProperty(a)&&(r[a]=n[a])},Kt(e,t)};function vi(e,t){Kt(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}var Zt=function(){return Zt=Object.assign||function(t){for(var r,n=1,a=arguments.length;n<a;n++){r=arguments[n];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},Zt.apply(this,arguments)};function Ci(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]]);return r}function xi(e,t,r,n){var a=arguments.length,i=a<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,r):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(e,t,r,n);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(i=(a<3?o(i):a>3?o(t,r,i):o(t,r))||i);return a>3&&i&&Object.defineProperty(t,r,i),i}function Pi(e,t){return function(r,n){t(r,n,e)}}function Ti(e,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(e,t)}function ji(e,t,r,n){function a(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function l(c){try{u(n.next(c))}catch(m){o(m)}}function d(c){try{u(n.throw(c))}catch(m){o(m)}}function u(c){c.done?i(c.value):a(c.value).then(l,d)}u((n=n.apply(e,t||[])).next())})}function Ei(e,t){var r={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(u){return function(c){return d([u,c])}}function d(u){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(i=u[0]&2?a.return:u[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,u[1])).done)return i;switch(a=0,i&&(u=[u[0]&2,i.value]),u[0]){case 0:case 1:i=u;break;case 4:return r.label++,{value:u[1],done:!1};case 5:r.label++,a=u[1],u=[0];continue;case 7:u=r.ops.pop(),r.trys.pop();continue;default:if(i=r.trys,!(i=i.length>0&&i[i.length-1])&&(u[0]===6||u[0]===2)){r=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){r.label=u[1];break}if(u[0]===6&&r.label<i[1]){r.label=i[1],i=u;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(u);break}i[2]&&r.ops.pop(),r.trys.pop();continue}u=t.call(e,r)}catch(c){u=[6,c],a=0}finally{n=i=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function Ai(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}function ki(e,t){for(var r in e)r!=="default"&&!t.hasOwnProperty(r)&&(t[r]=e[r])}function Xt(e){var t=typeof Symbol=="function"&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function vn(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,i=[],o;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(l){o={error:l}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(o)throw o.error}}return i}function Ii(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(vn(arguments[t]));return e}function Bi(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;for(var n=Array(e),a=0,t=0;t<r;t++)for(var i=arguments[t],o=0,l=i.length;o<l;o++,a++)n[a]=i[o];return n}function ze(e){return this instanceof ze?(this.v=e,this):new ze(e)}function qi(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(e,t||[]),a,i=[];return a={},o("next"),o("throw"),o("return"),a[Symbol.asyncIterator]=function(){return this},a;function o(b){n[b]&&(a[b]=function(R){return new Promise(function(p,C){i.push([b,R,p,C])>1||l(b,R)})})}function l(b,R){try{d(n[b](R))}catch(p){m(i[0][3],p)}}function d(b){b.value instanceof ze?Promise.resolve(b.value.v).then(u,c):m(i[0][2],b)}function u(b){l("next",b)}function c(b){l("throw",b)}function m(b,R){b(R),i.shift(),i.length&&l(i[0][0],i[0][1])}}function Wi(e){var t,r;return t={},n("next"),n("throw",function(a){throw a}),n("return"),t[Symbol.iterator]=function(){return this},t;function n(a,i){t[a]=e[a]?function(o){return(r=!r)?{value:ze(e[a](o)),done:a==="return"}:i?i(o):o}:i}}function Oi(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator],r;return t?t.call(e):(e=typeof Xt=="function"?Xt(e):e[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(i){r[i]=e[i]&&function(o){return new Promise(function(l,d){o=e[i](o),a(l,d,o.done,o.value)})}}function a(i,o,l,d){Promise.resolve(d).then(function(u){i({value:u,done:l})},o)}}function Fi(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function zi(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function Mi(e){return e&&e.__esModule?e:{default:e}}function Li(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function Di(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r}const Ni=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return Zt},__asyncDelegator:Wi,__asyncGenerator:qi,__asyncValues:Oi,__await:ze,__awaiter:ji,__classPrivateFieldGet:Li,__classPrivateFieldSet:Di,__createBinding:Ai,__decorate:xi,__exportStar:ki,__extends:vi,__generator:Ei,__importDefault:Mi,__importStar:zi,__makeTemplateObject:Fi,__metadata:Ti,__param:Pi,__read:vn,__rest:Ci,__spread:Ii,__spreadArrays:Bi,__values:Xt},Symbol.toStringTag,{value:"Module"})),Cn=_n(Ni);var Ee={},W={},qr;function xn(){return qr||(qr=1,Object.defineProperty(W,"__esModule",{value:!0}),W.MAX_HASHABLE_LENGTH=W.INIT=W.KEY=W.DIGEST_LENGTH=W.BLOCK_SIZE=void 0,W.BLOCK_SIZE=64,W.DIGEST_LENGTH=32,W.KEY=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),W.INIT=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],W.MAX_HASHABLE_LENGTH=Math.pow(2,53)-1),W}var Ae={},Wr;function Ui(){if(Wr)return Ae;Wr=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.RawSha256=void 0;var e=xn(),t=function(){function r(){this.state=Int32Array.from(e.INIT),this.temp=new Int32Array(64),this.buffer=new Uint8Array(64),this.bufferLength=0,this.bytesHashed=0,this.finished=!1}return r.prototype.update=function(n){if(this.finished)throw new Error("Attempted to update an already finished hash.");var a=0,i=n.byteLength;if(this.bytesHashed+=i,this.bytesHashed*8>e.MAX_HASHABLE_LENGTH)throw new Error("Cannot hash more than 2^53 - 1 bits");for(;i>0;)this.buffer[this.bufferLength++]=n[a++],i--,this.bufferLength===e.BLOCK_SIZE&&(this.hashBuffer(),this.bufferLength=0)},r.prototype.digest=function(){if(!this.finished){var n=this.bytesHashed*8,a=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.byteLength),i=this.bufferLength;if(a.setUint8(this.bufferLength++,128),i%e.BLOCK_SIZE>=e.BLOCK_SIZE-8){for(var o=this.bufferLength;o<e.BLOCK_SIZE;o++)a.setUint8(o,0);this.hashBuffer(),this.bufferLength=0}for(var o=this.bufferLength;o<e.BLOCK_SIZE-8;o++)a.setUint8(o,0);a.setUint32(e.BLOCK_SIZE-8,Math.floor(n/4294967296),!0),a.setUint32(e.BLOCK_SIZE-4,n),this.hashBuffer(),this.finished=!0}for(var l=new Uint8Array(e.DIGEST_LENGTH),o=0;o<8;o++)l[o*4]=this.state[o]>>>24&255,l[o*4+1]=this.state[o]>>>16&255,l[o*4+2]=this.state[o]>>>8&255,l[o*4+3]=this.state[o]>>>0&255;return l},r.prototype.hashBuffer=function(){for(var n=this,a=n.buffer,i=n.state,o=i[0],l=i[1],d=i[2],u=i[3],c=i[4],m=i[5],b=i[6],R=i[7],p=0;p<e.BLOCK_SIZE;p++){if(p<16)this.temp[p]=(a[p*4]&255)<<24|(a[p*4+1]&255)<<16|(a[p*4+2]&255)<<8|a[p*4+3]&255;else{var C=this.temp[p-2],T=(C>>>17|C<<15)^(C>>>19|C<<13)^C>>>10;C=this.temp[p-15];var S=(C>>>7|C<<25)^(C>>>18|C<<14)^C>>>3;this.temp[p]=(T+this.temp[p-7]|0)+(S+this.temp[p-16]|0)}var _=(((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+(c&m^~c&b)|0)+(R+(e.KEY[p]+this.temp[p]|0)|0)|0,x=((o>>>2|o<<30)^(o>>>13|o<<19)^(o>>>22|o<<10))+(o&l^o&d^l&d)|0;R=b,b=m,m=c,c=u+_|0,u=d,d=l,l=o,o=_+x|0}i[0]+=o,i[1]+=l,i[2]+=d,i[3]+=u,i[4]+=c,i[5]+=m,i[6]+=b,i[7]+=R},r}();return Ae.RawSha256=t,Ae}var Dt={},ke={};const $i=e=>{const t=[];for(let r=0,n=e.length;r<n;r++){const a=e.charCodeAt(r);if(a<128)t.push(a);else if(a<2048)t.push(a>>6|192,a&63|128);else if(r+1<e.length&&(a&64512)===55296&&(e.charCodeAt(r+1)&64512)===56320){const i=65536+((a&1023)<<10)+(e.charCodeAt(++r)&1023);t.push(i>>18|240,i>>12&63|128,i>>6&63|128,i&63|128)}else t.push(a>>12|224,a>>6&63|128,a&63|128)}return Uint8Array.from(t)},Vi=e=>{let t="";for(let r=0,n=e.length;r<n;r++){const a=e[r];if(a<128)t+=String.fromCharCode(a);else if(192<=a&&a<224){const i=e[++r];t+=String.fromCharCode((a&31)<<6|i&63)}else if(240<=a&&a<365){const o="%"+[a,e[++r],e[++r],e[++r]].map(l=>l.toString(16)).join("%");t+=decodeURIComponent(o)}else t+=String.fromCharCode((a&15)<<12|(e[++r]&63)<<6|e[++r]&63)}return t};function Hi(e){return new TextEncoder().encode(e)}function Qi(e){return new TextDecoder("utf-8").decode(e)}const Gi=e=>typeof TextEncoder=="function"?Hi(e):$i(e),Yi=e=>typeof TextDecoder=="function"?Qi(e):Vi(e),Ki=Object.freeze(Object.defineProperty({__proto__:null,fromUtf8:Gi,toUtf8:Yi},Symbol.toStringTag,{value:"Module"})),Zi=_n(Ki);var Or;function Xi(){if(Or)return ke;Or=1,Object.defineProperty(ke,"__esModule",{value:!0}),ke.convertToBuffer=void 0;var e=Zi,t=typeof zt<"u"&&zt.from?function(n){return zt.from(n,"utf8")}:e.fromUtf8;function r(n){return n instanceof Uint8Array?n:typeof n=="string"?t(n):ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength/Uint8Array.BYTES_PER_ELEMENT):new Uint8Array(n)}return ke.convertToBuffer=r,ke}var Ie={},Fr;function Ji(){if(Fr)return Ie;Fr=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.isEmptyData=void 0;function e(t){return typeof t=="string"?t.length===0:t.byteLength===0}return Ie.isEmptyData=e,Ie}var Be={},zr;function eo(){if(zr)return Be;zr=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.numToUint8=void 0;function e(t){return new Uint8Array([(t&4278190080)>>24,(t&16711680)>>16,(t&65280)>>8,t&255])}return Be.numToUint8=e,Be}var qe={},Mr;function to(){if(Mr)return qe;Mr=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.uint32ArrayFrom=void 0;function e(t){if(!Uint32Array.from){for(var r=new Uint32Array(t.length),n=0;n<t.length;)r[n]=t[n],n+=1;return r}return Uint32Array.from(t)}return qe.uint32ArrayFrom=e,qe}var Lr;function ro(){return Lr||(Lr=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uint32ArrayFrom=e.numToUint8=e.isEmptyData=e.convertToBuffer=void 0;var t=Xi();Object.defineProperty(e,"convertToBuffer",{enumerable:!0,get:function(){return t.convertToBuffer}});var r=Ji();Object.defineProperty(e,"isEmptyData",{enumerable:!0,get:function(){return r.isEmptyData}});var n=eo();Object.defineProperty(e,"numToUint8",{enumerable:!0,get:function(){return n.numToUint8}});var a=to();Object.defineProperty(e,"uint32ArrayFrom",{enumerable:!0,get:function(){return a.uint32ArrayFrom}})}(Dt)),Dt}var Dr;function no(){if(Dr)return Ee;Dr=1,Object.defineProperty(Ee,"__esModule",{value:!0}),Ee.Sha256=void 0;var e=Cn,t=xn(),r=Ui(),n=ro(),a=function(){function o(l){this.secret=l,this.hash=new r.RawSha256,this.reset()}return o.prototype.update=function(l){if(!((0,n.isEmptyData)(l)||this.error))try{this.hash.update((0,n.convertToBuffer)(l))}catch(d){this.error=d}},o.prototype.digestSync=function(){if(this.error)throw this.error;return this.outer?(this.outer.finished||this.outer.update(this.hash.digest()),this.outer.digest()):this.hash.digest()},o.prototype.digest=function(){return e.__awaiter(this,void 0,void 0,function(){return e.__generator(this,function(l){return[2,this.digestSync()]})})},o.prototype.reset=function(){if(this.hash=new r.RawSha256,this.secret){this.outer=new r.RawSha256;var l=i(this.secret),d=new Uint8Array(t.BLOCK_SIZE);d.set(l);for(var u=0;u<t.BLOCK_SIZE;u++)l[u]^=54,d[u]^=92;this.hash.update(l),this.outer.update(d);for(var u=0;u<l.byteLength;u++)l[u]=0}},o}();Ee.Sha256=a;function i(o){var l=(0,n.convertToBuffer)(o);if(l.byteLength>t.BLOCK_SIZE){var d=new r.RawSha256;d.update(l),l=d.digest()}var u=new Uint8Array(t.BLOCK_SIZE);return u.set(l),u}return Ee}(function(e){Object.defineProperty(e,"__esModule",{value:!0});var t=Cn;t.__exportStar(no(),e)})(Rn);const v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:e=>`Symbol(${e})`;function ir(){}function ao(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Se<"u")return Se}const yt=ao();function q(e){return typeof e=="object"&&e!==null||typeof e=="function"}const Pn=ir,or=Promise,io=Promise.prototype.then,oo=Promise.resolve.bind(or),so=Promise.reject.bind(or);function k(e){return new or(e)}function P(e){return oo(e)}function y(e){return so(e)}function Q(e,t,r){return io.call(e,t,r)}function $(e,t,r){Q(Q(e,t,r),void 0,Pn)}function Nt(e,t){$(e,t)}function sr(e,t){$(e,void 0,t)}function ce(e,t,r){return Q(e,t,r)}function Ue(e){Q(e,void 0,Pn)}const _t=(()=>{const e=yt&&yt.queueMicrotask;if(typeof e=="function")return e;const t=P(void 0);return r=>Q(t,r)})();function xt(e,t,r){if(typeof e!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function me(e,t,r){try{return P(xt(e,t,r))}catch(n){return y(n)}}const Nr=16384;class U{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(t){const r=this._back;let n=r;r._elements.length===Nr-1&&(n={_elements:[],_next:void 0}),r._elements.push(t),n!==r&&(this._back=n,r._next=n),++this._size}shift(){const t=this._front;let r=t;const n=this._cursor;let a=n+1;const i=t._elements,o=i[n];return a===Nr&&(r=t._next,a=0),--this._size,this._cursor=a,t!==r&&(this._front=r),i[n]=void 0,o}forEach(t){let r=this._cursor,n=this._front,a=n._elements;for(;(r!==a.length||n._next!==void 0)&&!(r===a.length&&(n=n._next,a=n._elements,r=0,a.length===0));)t(a[r]),++r}peek(){const t=this._front,r=this._cursor;return t._elements[r]}}function Tn(e,t){e._ownerReadableStream=t,t._reader=e,t._state==="readable"?ur(e):t._state==="closed"?lo(e):jn(e,t._storedError)}function lr(e,t){const r=e._ownerReadableStream;return N(r,t)}function G(e){e._ownerReadableStream._state==="readable"?dr(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):uo(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function we(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function ur(e){e._closedPromise=k((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r})}function jn(e,t){ur(e),dr(e,t)}function lo(e){ur(e),En(e)}function dr(e,t){e._closedPromise_reject!==void 0&&(Ue(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function uo(e,t){jn(e,t)}function En(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}const An=v("[[AbortSteps]]"),kn=v("[[ErrorSteps]]"),fr=v("[[CancelSteps]]"),cr=v("[[PullSteps]]"),Ur=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},fo=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function co(e){return typeof e=="object"||typeof e=="function"}function Z(e,t){if(e!==void 0&&!co(e))throw new TypeError(`${t} is not an object.`)}function V(e,t){if(typeof e!="function")throw new TypeError(`${t} is not a function.`)}function mo(e){return typeof e=="object"&&e!==null||typeof e=="function"}function In(e,t){if(!mo(e))throw new TypeError(`${t} is not an object.`)}function Y(e,t,r){if(e===void 0)throw new TypeError(`Parameter ${t} is required in '${r}'.`)}function Jt(e,t,r){if(e===void 0)throw new TypeError(`${t} is required in '${r}'.`)}function mr(e){return Number(e)}function Bn(e){return e===0?0:e}function ho(e){return Bn(fo(e))}function qn(e,t){const n=Number.MAX_SAFE_INTEGER;let a=Number(e);if(a=Bn(a),!Ur(a))throw new TypeError(`${t} is not a finite number`);if(a=ho(a),a<0||a>n)throw new TypeError(`${t} is outside the accepted range of 0 to ${n}, inclusive`);return!Ur(a)||a===0?0:a}function hr(e,t){if(!J(e))throw new TypeError(`${t} is not a ReadableStream.`)}function Re(e){return new $e(e)}function Wn(e,t){e._reader._readRequests.push(t)}function br(e,t,r){const a=e._reader._readRequests.shift();r?a._closeSteps():a._chunkSteps(t)}function Pt(e){return e._reader._readRequests.length}function On(e){const t=e._reader;return!(t===void 0||!ee(t))}class $e{constructor(t){if(Y(t,1,"ReadableStreamDefaultReader"),hr(t,"First parameter"),te(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Tn(this,t),this._readRequests=new U}get closed(){return ee(this)?this._closedPromise:y(tt("closed"))}cancel(t=void 0){return ee(this)?this._ownerReadableStream===void 0?y(we("cancel")):lr(this,t):y(tt("cancel"))}read(){if(!ee(this))return y(tt("read"));if(this._ownerReadableStream===void 0)return y(we("read from"));let t,r;const n=k((i,o)=>{t=i,r=o});return Ve(this,{_chunkSteps:i=>t({value:i,done:!1}),_closeSteps:()=>t({value:void 0,done:!0}),_errorSteps:i=>r(i)}),n}releaseLock(){if(!ee(this))throw tt("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");G(this)}}}Object.defineProperties($e.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty($e.prototype,v.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function ee(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_readRequests")?!1:e instanceof $e}function Ve(e,t){const r=e._ownerReadableStream;r._disturbed=!0,r._state==="closed"?t._closeSteps():r._state==="errored"?t._errorSteps(r._storedError):r._readableStreamController[cr](t)}function tt(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}const $r=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Fn{constructor(t,r){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=t,this._preventCancel=r}next(){const t=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?ce(this._ongoingPromise,t,t):t(),this._ongoingPromise}return(t){const r=()=>this._returnSteps(t);return this._ongoingPromise?ce(this._ongoingPromise,r,r):r()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const t=this._reader;if(t._ownerReadableStream===void 0)return y(we("iterate"));let r,n;const a=k((o,l)=>{r=o,n=l});return Ve(t,{_chunkSteps:o=>{this._ongoingPromise=void 0,_t(()=>r({value:o,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,G(t),r({value:void 0,done:!0})},_errorSteps:o=>{this._ongoingPromise=void 0,this._isFinished=!0,G(t),n(o)}}),a}_returnSteps(t){if(this._isFinished)return Promise.resolve({value:t,done:!0});this._isFinished=!0;const r=this._reader;if(r._ownerReadableStream===void 0)return y(we("finish iterating"));if(!this._preventCancel){const n=lr(r,t);return G(r),ce(n,()=>({value:t,done:!0}))}return G(r),P({value:t,done:!0})}}const zn={next(){return Vr(this)?this._asyncIteratorImpl.next():y(Hr("next"))},return(e){return Vr(this)?this._asyncIteratorImpl.return(e):y(Hr("return"))}};$r!==void 0&&Object.setPrototypeOf(zn,$r);function bo(e,t){const r=Re(e),n=new Fn(r,t),a=Object.create(zn);return a._asyncIteratorImpl=n,a}function Vr(e){if(!q(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof Fn}catch{return!1}}function Hr(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}const Mn=Number.isNaN||function(e){return e!==e};function Me(e){return e.slice()}function Ln(e,t,r,n,a){new Uint8Array(e).set(new Uint8Array(r,n,a),t)}function gt(e){return!1}function Dn(e,t,r){if(e.slice)return e.slice(t,r);const n=r-t,a=new ArrayBuffer(n);return Ln(a,0,e,t,n),a}function yo(e){return!(typeof e!="number"||Mn(e)||e<0)}function Qr(e){const t=Dn(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function yr(e){const t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function _r(e,t,r){if(!yo(r)||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function _o(e){return e._queue.peek().value}function ie(e){e._queue=new U,e._queueTotalSize=0}class He{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Ut(this))throw $t("view");return this._view}respond(t){if(!Ut(this))throw $t("respond");if(Y(t,1,"respond"),t=qn(t,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");gt(this._view.buffer),ct(this._associatedReadableByteStreamController,t)}respondWithNewView(t){if(!Ut(this))throw $t("respondWithNewView");if(Y(t,1,"respondWithNewView"),!ArrayBuffer.isView(t))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");gt(t.buffer),mt(this._associatedReadableByteStreamController,t)}}Object.defineProperties(He.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(He.prototype,v.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class xe{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!ue(this))throw We("byobRequest");return er(this)}get desiredSize(){if(!ue(this))throw We("desiredSize");return Yn(this)}close(){if(!ue(this))throw We("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const t=this._controlledReadableByteStream._state;if(t!=="readable")throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be closed`);Oe(this)}enqueue(t){if(!ue(this))throw We("enqueue");if(Y(t,1,"enqueue"),!ArrayBuffer.isView(t))throw new TypeError("chunk must be an array buffer view");if(t.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(t.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const r=this._controlledReadableByteStream._state;if(r!=="readable")throw new TypeError(`The stream (in ${r} state) is not in the readable state and cannot be enqueued to`);ft(this,t)}error(t=void 0){if(!ue(this))throw We("error");D(this,t)}[fr](t){Nn(this),ie(this);const r=this._cancelAlgorithm(t);return jt(this),r}[cr](t){const r=this._controlledReadableByteStream;if(this._queueTotalSize>0){const a=this._queue.shift();this._queueTotalSize-=a.byteLength,Hn(this);const i=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);t._chunkSteps(i);return}const n=this._autoAllocateChunkSize;if(n!==void 0){let a;try{a=new ArrayBuffer(n)}catch(o){t._errorSteps(o);return}const i={buffer:a,bufferByteLength:n,byteOffset:0,byteLength:n,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(i)}Wn(r,t),he(this)}}Object.defineProperties(xe.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(xe.prototype,v.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function ue(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")?!1:e instanceof xe}function Ut(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")?!1:e instanceof He}function he(e){if(!wo(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;const r=e._pullAlgorithm();$(r,()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,he(e))},n=>{D(e,n)})}function Nn(e){pr(e),e._pendingPullIntos=new U}function gr(e,t){let r=!1;e._state==="closed"&&(r=!0);const n=Un(t);t.readerType==="default"?br(e,n,r):Co(e,n,r)}function Un(e){const t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function dt(e,t,r,n){e._queue.push({buffer:t,byteOffset:r,byteLength:n}),e._queueTotalSize+=n}function $n(e,t){const r=t.elementSize,n=t.bytesFilled-t.bytesFilled%r,a=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),i=t.bytesFilled+a,o=i-i%r;let l=a,d=!1;o>n&&(l=o-t.bytesFilled,d=!0);const u=e._queue;for(;l>0;){const c=u.peek(),m=Math.min(l,c.byteLength),b=t.byteOffset+t.bytesFilled;Ln(t.buffer,b,c.buffer,c.byteOffset,m),c.byteLength===m?u.shift():(c.byteOffset+=m,c.byteLength-=m),e._queueTotalSize-=m,Vn(e,m,t),l-=m}return d}function Vn(e,t,r){r.bytesFilled+=t}function Hn(e){e._queueTotalSize===0&&e._closeRequested?(jt(e),Ke(e._controlledReadableByteStream)):he(e)}function pr(e){e._byobRequest!==null&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Qn(e){for(;e._pendingPullIntos.length>0;){if(e._queueTotalSize===0)return;const t=e._pendingPullIntos.peek();$n(e,t)&&(Tt(e),gr(e._controlledReadableByteStream,t))}}function go(e,t,r){const n=e._controlledReadableByteStream;let a=1;t.constructor!==DataView&&(a=t.constructor.BYTES_PER_ELEMENT);const i=t.constructor,o=t.buffer,l={buffer:o,bufferByteLength:o.byteLength,byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:a,viewConstructor:i,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(l),Gr(n,r);return}if(n._state==="closed"){const d=new i(l.buffer,l.byteOffset,0);r._closeSteps(d);return}if(e._queueTotalSize>0){if($n(e,l)){const d=Un(l);Hn(e),r._chunkSteps(d);return}if(e._closeRequested){const d=new TypeError("Insufficient bytes to fill elements in the given buffer");D(e,d),r._errorSteps(d);return}}e._pendingPullIntos.push(l),Gr(n,r),he(e)}function po(e,t){const r=e._controlledReadableByteStream;if(Sr(r))for(;Xn(r)>0;){const n=Tt(e);gr(r,n)}}function So(e,t,r){if(Vn(e,t,r),r.bytesFilled<r.elementSize)return;Tt(e);const n=r.bytesFilled%r.elementSize;if(n>0){const a=r.byteOffset+r.bytesFilled,i=Dn(r.buffer,a-n,a);dt(e,i,0,i.byteLength)}r.bytesFilled-=n,gr(e._controlledReadableByteStream,r),Qn(e)}function Gn(e,t){const r=e._pendingPullIntos.peek();pr(e),e._controlledReadableByteStream._state==="closed"?po(e):So(e,t,r),he(e)}function Tt(e){return e._pendingPullIntos.shift()}function wo(e){const t=e._controlledReadableByteStream;return t._state!=="readable"||e._closeRequested||!e._started?!1:!!(On(t)&&Pt(t)>0||Sr(t)&&Xn(t)>0||Yn(e)>0)}function jt(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Oe(e){const t=e._controlledReadableByteStream;if(!(e._closeRequested||t._state!=="readable")){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){const n=new TypeError("Insufficient bytes to fill elements in the given buffer");throw D(e,n),n}jt(e),Ke(t)}}function ft(e,t){const r=e._controlledReadableByteStream;if(e._closeRequested||r._state!=="readable")return;const n=t.buffer,a=t.byteOffset,i=t.byteLength,o=n;if(e._pendingPullIntos.length>0){const l=e._pendingPullIntos.peek();gt(l.buffer),l.buffer=l.buffer}if(pr(e),On(r))if(Pt(r)===0)dt(e,o,a,i);else{e._pendingPullIntos.length>0&&Tt(e);const l=new Uint8Array(o,a,i);br(r,l,!1)}else Sr(r)?(dt(e,o,a,i),Qn(e)):dt(e,o,a,i);he(e)}function D(e,t){const r=e._controlledReadableByteStream;r._state==="readable"&&(Nn(e),ie(e),jt(e),_a(r,t))}function er(e){if(e._byobRequest===null&&e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),n=Object.create(He.prototype);vo(n,e,r),e._byobRequest=n}return e._byobRequest}function Yn(e){const t=e._controlledReadableByteStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function ct(e,t){const r=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(t===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+t>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=r.buffer,Gn(e,t)}function mt(e,t){const r=e._pendingPullIntos.peek();if(e._controlledReadableByteStream._state==="closed"){if(t.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(t.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+t.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");const a=t.byteLength;r.buffer=t.buffer,Gn(e,a)}function Kn(e,t,r,n,a,i,o){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,ie(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=i,t._pullAlgorithm=n,t._cancelAlgorithm=a,t._autoAllocateChunkSize=o,t._pendingPullIntos=new U,e._readableStreamController=t;const l=r();$(P(l),()=>{t._started=!0,he(t)},d=>{D(t,d)})}function Ro(e,t,r){const n=Object.create(xe.prototype);let a=()=>{},i=()=>P(void 0),o=()=>P(void 0);t.start!==void 0&&(a=()=>t.start(n)),t.pull!==void 0&&(i=()=>t.pull(n)),t.cancel!==void 0&&(o=d=>t.cancel(d));const l=t.autoAllocateChunkSize;if(l===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Kn(e,n,a,i,o,r,l)}function vo(e,t,r){e._associatedReadableByteStreamController=t,e._view=r}function $t(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function We(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function Zn(e){return new Qe(e)}function Gr(e,t){e._reader._readIntoRequests.push(t)}function Co(e,t,r){const a=e._reader._readIntoRequests.shift();r?a._closeSteps(t):a._chunkSteps(t)}function Xn(e){return e._reader._readIntoRequests.length}function Sr(e){const t=e._reader;return!(t===void 0||!de(t))}class Qe{constructor(t){if(Y(t,1,"ReadableStreamBYOBReader"),hr(t,"First parameter"),te(t))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!ue(t._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Tn(this,t),this._readIntoRequests=new U}get closed(){return de(this)?this._closedPromise:y(rt("closed"))}cancel(t=void 0){return de(this)?this._ownerReadableStream===void 0?y(we("cancel")):lr(this,t):y(rt("cancel"))}read(t){if(!de(this))return y(rt("read"));if(!ArrayBuffer.isView(t))return y(new TypeError("view must be an array buffer view"));if(t.byteLength===0)return y(new TypeError("view must have non-zero byteLength"));if(t.buffer.byteLength===0)return y(new TypeError("view's buffer must have non-zero byteLength"));if(gt(t.buffer),this._ownerReadableStream===void 0)return y(we("read from"));let r,n;const a=k((o,l)=>{r=o,n=l});return Jn(this,t,{_chunkSteps:o=>r({value:o,done:!1}),_closeSteps:o=>r({value:o,done:!0}),_errorSteps:o=>n(o)}),a}releaseLock(){if(!de(this))throw rt("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");G(this)}}}Object.defineProperties(Qe.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Qe.prototype,v.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function de(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")?!1:e instanceof Qe}function Jn(e,t,r){const n=e._ownerReadableStream;n._disturbed=!0,n._state==="errored"?r._errorSteps(n._storedError):go(n._readableStreamController,t,r)}function rt(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function Le(e,t){const{highWaterMark:r}=e;if(r===void 0)return t;if(Mn(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function pt(e){const{size:t}=e;return t||(()=>1)}function St(e,t){Z(e,t);const r=e==null?void 0:e.highWaterMark,n=e==null?void 0:e.size;return{highWaterMark:r===void 0?void 0:mr(r),size:n===void 0?void 0:xo(n,`${t} has member 'size' that`)}}function xo(e,t){return V(e,t),r=>mr(e(r))}function Po(e,t){Z(e,t);const r=e==null?void 0:e.abort,n=e==null?void 0:e.close,a=e==null?void 0:e.start,i=e==null?void 0:e.type,o=e==null?void 0:e.write;return{abort:r===void 0?void 0:To(r,e,`${t} has member 'abort' that`),close:n===void 0?void 0:jo(n,e,`${t} has member 'close' that`),start:a===void 0?void 0:Eo(a,e,`${t} has member 'start' that`),write:o===void 0?void 0:Ao(o,e,`${t} has member 'write' that`),type:i}}function To(e,t,r){return V(e,r),n=>me(e,t,[n])}function jo(e,t,r){return V(e,r),()=>me(e,t,[])}function Eo(e,t,r){return V(e,r),n=>xt(e,t,[n])}function Ao(e,t,r){return V(e,r),(n,a)=>me(e,t,[n,a])}function ea(e,t){if(!_e(e))throw new TypeError(`${t} is not a WritableStream.`)}function ko(e){if(typeof e!="object"||e===null)return!1;try{return typeof e.aborted=="boolean"}catch{return!1}}const Io=typeof AbortController=="function";function Bo(){if(Io)return new AbortController}class Ge{constructor(t={},r={}){t===void 0?t=null:In(t,"First parameter");const n=St(r,"Second parameter"),a=Po(t,"First parameter");if(ra(this),a.type!==void 0)throw new RangeError("Invalid type is specified");const o=pt(n),l=Le(n,1);Qo(this,a,l,o)}get locked(){if(!_e(this))throw at("locked");return pe(this)}abort(t=void 0){return _e(this)?pe(this)?y(new TypeError("Cannot abort a stream that already has a writer")):wt(this,t):y(at("abort"))}close(){return _e(this)?pe(this)?y(new TypeError("Cannot close a stream that already has a writer")):H(this)?y(new TypeError("Cannot close an already-closing stream")):na(this):y(at("close"))}getWriter(){if(!_e(this))throw at("getWriter");return ta(this)}}Object.defineProperties(Ge.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Ge.prototype,v.toStringTag,{value:"WritableStream",configurable:!0});function ta(e){return new Ye(e)}function qo(e,t,r,n,a=1,i=()=>1){const o=Object.create(Ge.prototype);ra(o);const l=Object.create(Pe.prototype);return ua(o,l,e,t,r,n,a,i),o}function ra(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new U,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function _e(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")?!1:e instanceof Ge}function pe(e){return e._writer!==void 0}function wt(e,t){var r;if(e._state==="closed"||e._state==="errored")return P(void 0);e._writableStreamController._abortReason=t,(r=e._writableStreamController._abortController)===null||r===void 0||r.abort();const n=e._state;if(n==="closed"||n==="errored")return P(void 0);if(e._pendingAbortRequest!==void 0)return e._pendingAbortRequest._promise;let a=!1;n==="erroring"&&(a=!0,t=void 0);const i=k((o,l)=>{e._pendingAbortRequest={_promise:void 0,_resolve:o,_reject:l,_reason:t,_wasAlreadyErroring:a}});return e._pendingAbortRequest._promise=i,a||Rr(e,t),i}function na(e){const t=e._state;if(t==="closed"||t==="errored")return y(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));const r=k((a,i)=>{const o={_resolve:a,_reject:i};e._closeRequest=o}),n=e._writer;return n!==void 0&&e._backpressure&&t==="writable"&&jr(n),Go(e._writableStreamController),r}function Wo(e){return k((r,n)=>{const a={_resolve:r,_reject:n};e._writeRequests.push(a)})}function wr(e,t){if(e._state==="writable"){Rr(e,t);return}vr(e)}function Rr(e,t){const r=e._writableStreamController;e._state="erroring",e._storedError=t;const n=e._writer;n!==void 0&&ia(n,t),!Lo(e)&&r._started&&vr(e)}function vr(e){e._state="errored",e._writableStreamController[kn]();const t=e._storedError;if(e._writeRequests.forEach(a=>{a._reject(t)}),e._writeRequests=new U,e._pendingAbortRequest===void 0){nt(e);return}const r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring){r._reject(t),nt(e);return}const n=e._writableStreamController[An](r._reason);$(n,()=>{r._resolve(),nt(e)},a=>{r._reject(a),nt(e)})}function Oo(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Fo(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,wr(e,t)}function zo(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,e._state==="erroring"&&(e._storedError=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";const r=e._writer;r!==void 0&&ma(r)}function Mo(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,e._pendingAbortRequest!==void 0&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),wr(e,t)}function H(e){return!(e._closeRequest===void 0&&e._inFlightCloseRequest===void 0)}function Lo(e){return!(e._inFlightWriteRequest===void 0&&e._inFlightCloseRequest===void 0)}function Do(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function No(e){e._inFlightWriteRequest=e._writeRequests.shift()}function nt(e){e._closeRequest!==void 0&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);const t=e._writer;t!==void 0&&Tr(t,e._storedError)}function Cr(e,t){const r=e._writer;r!==void 0&&t!==e._backpressure&&(t?ts(r):jr(r)),e._backpressure=t}class Ye{constructor(t){if(Y(t,1,"WritableStreamDefaultWriter"),ea(t,"First parameter"),pe(t))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=t,t._writer=this;const r=t._state;if(r==="writable")!H(t)&&t._backpressure?kt(this):Yr(this),Rt(this);else if(r==="erroring")tr(this,t._storedError),Rt(this);else if(r==="closed")Yr(this),Jo(this);else{const n=t._storedError;tr(this,n),ca(this,n)}}get closed(){return oe(this)?this._closedPromise:y(se("closed"))}get desiredSize(){if(!oe(this))throw se("desiredSize");if(this._ownerWritableStream===void 0)throw Fe("desiredSize");return Ho(this)}get ready(){return oe(this)?this._readyPromise:y(se("ready"))}abort(t=void 0){return oe(this)?this._ownerWritableStream===void 0?y(Fe("abort")):Uo(this,t):y(se("abort"))}close(){if(!oe(this))return y(se("close"));const t=this._ownerWritableStream;return t===void 0?y(Fe("close")):H(t)?y(new TypeError("Cannot close an already-closing stream")):aa(this)}releaseLock(){if(!oe(this))throw se("releaseLock");this._ownerWritableStream!==void 0&&oa(this)}write(t=void 0){return oe(this)?this._ownerWritableStream===void 0?y(Fe("write to")):sa(this,t):y(se("write"))}}Object.defineProperties(Ye.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Ye.prototype,v.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function oe(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")?!1:e instanceof Ye}function Uo(e,t){const r=e._ownerWritableStream;return wt(r,t)}function aa(e){const t=e._ownerWritableStream;return na(t)}function $o(e){const t=e._ownerWritableStream,r=t._state;return H(t)||r==="closed"?P(void 0):r==="errored"?y(t._storedError):aa(e)}function Vo(e,t){e._closedPromiseState==="pending"?Tr(e,t):es(e,t)}function ia(e,t){e._readyPromiseState==="pending"?ha(e,t):rs(e,t)}function Ho(e){const t=e._ownerWritableStream,r=t._state;return r==="errored"||r==="erroring"?null:r==="closed"?0:da(t._writableStreamController)}function oa(e){const t=e._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");ia(e,r),Vo(e,r),t._writer=void 0,e._ownerWritableStream=void 0}function sa(e,t){const r=e._ownerWritableStream,n=r._writableStreamController,a=Yo(n,t);if(r!==e._ownerWritableStream)return y(Fe("write to"));const i=r._state;if(i==="errored")return y(r._storedError);if(H(r)||i==="closed")return y(new TypeError("The stream is closing or closed and cannot be written to"));if(i==="erroring")return y(r._storedError);const o=Wo(r);return Ko(n,t,a),o}const la={};class Pe{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Vt(this))throw Ht("abortReason");return this._abortReason}get signal(){if(!Vt(this))throw Ht("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(t=void 0){if(!Vt(this))throw Ht("error");this._controlledWritableStream._state==="writable"&&fa(this,t)}[An](t){const r=this._abortAlgorithm(t);return Et(this),r}[kn](){ie(this)}}Object.defineProperties(Pe.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Pe.prototype,v.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Vt(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")?!1:e instanceof Pe}function ua(e,t,r,n,a,i,o,l){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,ie(t),t._abortReason=void 0,t._abortController=Bo(),t._started=!1,t._strategySizeAlgorithm=l,t._strategyHWM=o,t._writeAlgorithm=n,t._closeAlgorithm=a,t._abortAlgorithm=i;const d=Pr(t);Cr(e,d);const u=r(),c=P(u);$(c,()=>{t._started=!0,At(t)},m=>{t._started=!0,wr(e,m)})}function Qo(e,t,r,n){const a=Object.create(Pe.prototype);let i=()=>{},o=()=>P(void 0),l=()=>P(void 0),d=()=>P(void 0);t.start!==void 0&&(i=()=>t.start(a)),t.write!==void 0&&(o=u=>t.write(u,a)),t.close!==void 0&&(l=()=>t.close()),t.abort!==void 0&&(d=u=>t.abort(u)),ua(e,a,i,o,l,d,r,n)}function Et(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Go(e){_r(e,la,0),At(e)}function Yo(e,t){try{return e._strategySizeAlgorithm(t)}catch(r){return xr(e,r),1}}function da(e){return e._strategyHWM-e._queueTotalSize}function Ko(e,t,r){try{_r(e,t,r)}catch(a){xr(e,a);return}const n=e._controlledWritableStream;if(!H(n)&&n._state==="writable"){const a=Pr(e);Cr(n,a)}At(e)}function At(e){const t=e._controlledWritableStream;if(!e._started||t._inFlightWriteRequest!==void 0)return;if(t._state==="erroring"){vr(t);return}if(e._queue.length===0)return;const n=_o(e);n===la?Zo(e):Xo(e,n)}function xr(e,t){e._controlledWritableStream._state==="writable"&&fa(e,t)}function Zo(e){const t=e._controlledWritableStream;Do(t),yr(e);const r=e._closeAlgorithm();Et(e),$(r,()=>{zo(t)},n=>{Mo(t,n)})}function Xo(e,t){const r=e._controlledWritableStream;No(r);const n=e._writeAlgorithm(t);$(n,()=>{Oo(r);const a=r._state;if(yr(e),!H(r)&&a==="writable"){const i=Pr(e);Cr(r,i)}At(e)},a=>{r._state==="writable"&&Et(e),Fo(r,a)})}function Pr(e){return da(e)<=0}function fa(e,t){const r=e._controlledWritableStream;Et(e),Rr(r,t)}function at(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function Ht(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function se(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function Fe(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function Rt(e){e._closedPromise=k((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"})}function ca(e,t){Rt(e),Tr(e,t)}function Jo(e){Rt(e),ma(e)}function Tr(e,t){e._closedPromise_reject!==void 0&&(Ue(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function es(e,t){ca(e,t)}function ma(e){e._closedPromise_resolve!==void 0&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function kt(e){e._readyPromise=k((t,r)=>{e._readyPromise_resolve=t,e._readyPromise_reject=r}),e._readyPromiseState="pending"}function tr(e,t){kt(e),ha(e,t)}function Yr(e){kt(e),jr(e)}function ha(e,t){e._readyPromise_reject!==void 0&&(Ue(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function ts(e){kt(e)}function rs(e,t){tr(e,t)}function jr(e){e._readyPromise_resolve!==void 0&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}const Kr=typeof DOMException<"u"?DOMException:void 0;function ns(e){if(!(typeof e=="function"||typeof e=="object"))return!1;try{return new e,!0}catch{return!1}}function as(){const e=function(r,n){this.message=r||"",this.name=n||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}const is=ns(Kr)?Kr:as();function Zr(e,t,r,n,a,i){const o=Re(e),l=ta(t);e._disturbed=!0;let d=!1,u=P(void 0);return k((c,m)=>{let b;if(i!==void 0){if(b=()=>{const f=new is("Aborted","AbortError"),h=[];n||h.push(()=>t._state==="writable"?wt(t,f):P(void 0)),a||h.push(()=>e._state==="readable"?N(e,f):P(void 0)),_(()=>Promise.all(h.map(g=>g())),!0,f)},i.aborted){b();return}i.addEventListener("abort",b)}function R(){return k((f,h)=>{function g(w){w?f():Q(p(),g,h)}g(!1)})}function p(){return d?P(!0):Q(l._readyPromise,()=>k((f,h)=>{Ve(o,{_chunkSteps:g=>{u=Q(sa(l,g),void 0,ir),f(!1)},_closeSteps:()=>f(!0),_errorSteps:h})}))}if(T(e,o._closedPromise,f=>{n?x(!0,f):_(()=>wt(t,f),!0,f)}),T(t,l._closedPromise,f=>{a?x(!0,f):_(()=>N(e,f),!0,f)}),S(e,o._closedPromise,()=>{r?x():_(()=>$o(l))}),H(t)||t._state==="closed"){const f=new TypeError("the destination writable stream closed before all data could be piped to it");a?x(!0,f):_(()=>N(e,f),!0,f)}Ue(R());function C(){const f=u;return Q(u,()=>f!==u?C():void 0)}function T(f,h,g){f._state==="errored"?g(f._storedError):sr(h,g)}function S(f,h,g){f._state==="closed"?g():Nt(h,g)}function _(f,h,g){if(d)return;d=!0,t._state==="writable"&&!H(t)?Nt(C(),w):w();function w(){$(f(),()=>j(h,g),I=>j(!0,I))}}function x(f,h){d||(d=!0,t._state==="writable"&&!H(t)?Nt(C(),()=>j(f,h)):j(f,h))}function j(f,h){oa(l),G(o),i!==void 0&&i.removeEventListener("abort",b),f?m(h):c(void 0)}})}class Te{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!it(this))throw ot("desiredSize");return Er(this)}close(){if(!it(this))throw ot("close");if(!ve(this))throw new TypeError("The stream is not in a state that permits close");Ne(this)}enqueue(t=void 0){if(!it(this))throw ot("enqueue");if(!ve(this))throw new TypeError("The stream is not in a state that permits enqueue");return Ct(this,t)}error(t=void 0){if(!it(this))throw ot("error");ne(this,t)}[fr](t){ie(this);const r=this._cancelAlgorithm(t);return vt(this),r}[cr](t){const r=this._controlledReadableStream;if(this._queue.length>0){const n=yr(this);this._closeRequested&&this._queue.length===0?(vt(this),Ke(r)):De(this),t._chunkSteps(n)}else Wn(r,t),De(this)}}Object.defineProperties(Te.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Te.prototype,v.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function it(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")?!1:e instanceof Te}function De(e){if(!ba(e))return;if(e._pulling){e._pullAgain=!0;return}e._pulling=!0;const r=e._pullAlgorithm();$(r,()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,De(e))},n=>{ne(e,n)})}function ba(e){const t=e._controlledReadableStream;return!ve(e)||!e._started?!1:!!(te(t)&&Pt(t)>0||Er(e)>0)}function vt(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Ne(e){if(!ve(e))return;const t=e._controlledReadableStream;e._closeRequested=!0,e._queue.length===0&&(vt(e),Ke(t))}function Ct(e,t){if(!ve(e))return;const r=e._controlledReadableStream;if(te(r)&&Pt(r)>0)br(r,t,!1);else{let n;try{n=e._strategySizeAlgorithm(t)}catch(a){throw ne(e,a),a}try{_r(e,t,n)}catch(a){throw ne(e,a),a}}De(e)}function ne(e,t){const r=e._controlledReadableStream;r._state==="readable"&&(ie(e),vt(e),_a(r,t))}function Er(e){const t=e._controlledReadableStream._state;return t==="errored"?null:t==="closed"?0:e._strategyHWM-e._queueTotalSize}function os(e){return!ba(e)}function ve(e){const t=e._controlledReadableStream._state;return!e._closeRequested&&t==="readable"}function ya(e,t,r,n,a,i,o){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,ie(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=o,t._strategyHWM=i,t._pullAlgorithm=n,t._cancelAlgorithm=a,e._readableStreamController=t;const l=r();$(P(l),()=>{t._started=!0,De(t)},d=>{ne(t,d)})}function ss(e,t,r,n){const a=Object.create(Te.prototype);let i=()=>{},o=()=>P(void 0),l=()=>P(void 0);t.start!==void 0&&(i=()=>t.start(a)),t.pull!==void 0&&(o=()=>t.pull(a)),t.cancel!==void 0&&(l=d=>t.cancel(d)),ya(e,a,i,o,l,r,n)}function ot(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function ls(e,t){return ue(e._readableStreamController)?ds(e):us(e)}function us(e,t){const r=Re(e);let n=!1,a=!1,i=!1,o=!1,l,d,u,c,m;const b=k(S=>{m=S});function R(){return n?(a=!0,P(void 0)):(n=!0,Ve(r,{_chunkSteps:_=>{_t(()=>{a=!1;const x=_,j=_;i||Ct(u._readableStreamController,x),o||Ct(c._readableStreamController,j),n=!1,a&&R()})},_closeSteps:()=>{n=!1,i||Ne(u._readableStreamController),o||Ne(c._readableStreamController),(!i||!o)&&m(void 0)},_errorSteps:()=>{n=!1}}),P(void 0))}function p(S){if(i=!0,l=S,o){const _=Me([l,d]),x=N(e,_);m(x)}return b}function C(S){if(o=!0,d=S,i){const _=Me([l,d]),x=N(e,_);m(x)}return b}function T(){}return u=rr(T,R,p),c=rr(T,R,C),sr(r._closedPromise,S=>{ne(u._readableStreamController,S),ne(c._readableStreamController,S),(!i||!o)&&m(void 0)}),[u,c]}function ds(e){let t=Re(e),r=!1,n=!1,a=!1,i=!1,o=!1,l,d,u,c,m;const b=k(f=>{m=f});function R(f){sr(f._closedPromise,h=>{f===t&&(D(u._readableStreamController,h),D(c._readableStreamController,h),(!i||!o)&&m(void 0))})}function p(){de(t)&&(G(t),t=Re(e),R(t)),Ve(t,{_chunkSteps:h=>{_t(()=>{n=!1,a=!1;const g=h;let w=h;if(!i&&!o)try{w=Qr(h)}catch(I){D(u._readableStreamController,I),D(c._readableStreamController,I),m(N(e,I));return}i||ft(u._readableStreamController,g),o||ft(c._readableStreamController,w),r=!1,n?T():a&&S()})},_closeSteps:()=>{r=!1,i||Oe(u._readableStreamController),o||Oe(c._readableStreamController),u._readableStreamController._pendingPullIntos.length>0&&ct(u._readableStreamController,0),c._readableStreamController._pendingPullIntos.length>0&&ct(c._readableStreamController,0),(!i||!o)&&m(void 0)},_errorSteps:()=>{r=!1}})}function C(f,h){ee(t)&&(G(t),t=Zn(e),R(t));const g=h?c:u,w=h?u:c;Jn(t,f,{_chunkSteps:F=>{_t(()=>{n=!1,a=!1;const z=h?o:i;if(h?i:o)z||mt(g._readableStreamController,F);else{let B;try{B=Qr(F)}catch(X){D(g._readableStreamController,X),D(w._readableStreamController,X),m(N(e,X));return}z||mt(g._readableStreamController,F),ft(w._readableStreamController,B)}r=!1,n?T():a&&S()})},_closeSteps:F=>{r=!1;const z=h?o:i,M=h?i:o;z||Oe(g._readableStreamController),M||Oe(w._readableStreamController),F!==void 0&&(z||mt(g._readableStreamController,F),!M&&w._readableStreamController._pendingPullIntos.length>0&&ct(w._readableStreamController,0)),(!z||!M)&&m(void 0)},_errorSteps:()=>{r=!1}})}function T(){if(r)return n=!0,P(void 0);r=!0;const f=er(u._readableStreamController);return f===null?p():C(f._view,!1),P(void 0)}function S(){if(r)return a=!0,P(void 0);r=!0;const f=er(c._readableStreamController);return f===null?p():C(f._view,!0),P(void 0)}function _(f){if(i=!0,l=f,o){const h=Me([l,d]),g=N(e,h);m(g)}return b}function x(f){if(o=!0,d=f,i){const h=Me([l,d]),g=N(e,h);m(g)}return b}function j(){}return u=Jr(j,T,_),c=Jr(j,S,x),R(t),[u,c]}function fs(e,t){Z(e,t);const r=e,n=r==null?void 0:r.autoAllocateChunkSize,a=r==null?void 0:r.cancel,i=r==null?void 0:r.pull,o=r==null?void 0:r.start,l=r==null?void 0:r.type;return{autoAllocateChunkSize:n===void 0?void 0:qn(n,`${t} has member 'autoAllocateChunkSize' that`),cancel:a===void 0?void 0:cs(a,r,`${t} has member 'cancel' that`),pull:i===void 0?void 0:ms(i,r,`${t} has member 'pull' that`),start:o===void 0?void 0:hs(o,r,`${t} has member 'start' that`),type:l===void 0?void 0:bs(l,`${t} has member 'type' that`)}}function cs(e,t,r){return V(e,r),n=>me(e,t,[n])}function ms(e,t,r){return V(e,r),n=>me(e,t,[n])}function hs(e,t,r){return V(e,r),n=>xt(e,t,[n])}function bs(e,t){if(e=`${e}`,e!=="bytes")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function ys(e,t){Z(e,t);const r=e==null?void 0:e.mode;return{mode:r===void 0?void 0:_s(r,`${t} has member 'mode' that`)}}function _s(e,t){if(e=`${e}`,e!=="byob")throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function gs(e,t){return Z(e,t),{preventCancel:!!(e==null?void 0:e.preventCancel)}}function Xr(e,t){Z(e,t);const r=e==null?void 0:e.preventAbort,n=e==null?void 0:e.preventCancel,a=e==null?void 0:e.preventClose,i=e==null?void 0:e.signal;return i!==void 0&&ps(i,`${t} has member 'signal' that`),{preventAbort:!!r,preventCancel:!!n,preventClose:!!a,signal:i}}function ps(e,t){if(!ko(e))throw new TypeError(`${t} is not an AbortSignal.`)}function Ss(e,t){Z(e,t);const r=e==null?void 0:e.readable;Jt(r,"readable","ReadableWritablePair"),hr(r,`${t} has member 'readable' that`);const n=e==null?void 0:e.writable;return Jt(n,"writable","ReadableWritablePair"),ea(n,`${t} has member 'writable' that`),{readable:r,writable:n}}let ae=class{constructor(t={},r={}){t===void 0?t=null:In(t,"First parameter");const n=St(r,"Second parameter"),a=fs(t,"First parameter");if(Ar(this),a.type==="bytes"){if(n.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");const i=Le(n,0);Ro(this,a,i)}else{const i=pt(n),o=Le(n,1);ss(this,a,o,i)}}get locked(){if(!J(this))throw le("locked");return te(this)}cancel(t=void 0){return J(this)?te(this)?y(new TypeError("Cannot cancel a stream that already has a reader")):N(this,t):y(le("cancel"))}getReader(t=void 0){if(!J(this))throw le("getReader");return ys(t,"First parameter").mode===void 0?Re(this):Zn(this)}pipeThrough(t,r={}){if(!J(this))throw le("pipeThrough");Y(t,1,"pipeThrough");const n=Ss(t,"First parameter"),a=Xr(r,"Second parameter");if(te(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(pe(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");const i=Zr(this,n.writable,a.preventClose,a.preventAbort,a.preventCancel,a.signal);return Ue(i),n.readable}pipeTo(t,r={}){if(!J(this))return y(le("pipeTo"));if(t===void 0)return y("Parameter 1 is required in 'pipeTo'.");if(!_e(t))return y(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let n;try{n=Xr(r,"Second parameter")}catch(a){return y(a)}return te(this)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):pe(t)?y(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Zr(this,t,n.preventClose,n.preventAbort,n.preventCancel,n.signal)}tee(){if(!J(this))throw le("tee");const t=ls(this);return Me(t)}values(t=void 0){if(!J(this))throw le("values");const r=gs(t,"First parameter");return bo(this,r.preventCancel)}};Object.defineProperties(ae.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(ae.prototype,v.toStringTag,{value:"ReadableStream",configurable:!0});typeof v.asyncIterator=="symbol"&&Object.defineProperty(ae.prototype,v.asyncIterator,{value:ae.prototype.values,writable:!0,configurable:!0});function rr(e,t,r,n=1,a=()=>1){const i=Object.create(ae.prototype);Ar(i);const o=Object.create(Te.prototype);return ya(i,o,e,t,r,n,a),i}function Jr(e,t,r){const n=Object.create(ae.prototype);Ar(n);const a=Object.create(xe.prototype);return Kn(n,a,e,t,r,0,void 0),n}function Ar(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function J(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")?!1:e instanceof ae}function te(e){return e._reader!==void 0}function N(e,t){if(e._disturbed=!0,e._state==="closed")return P(void 0);if(e._state==="errored")return y(e._storedError);Ke(e);const r=e._reader;r!==void 0&&de(r)&&(r._readIntoRequests.forEach(a=>{a._closeSteps(void 0)}),r._readIntoRequests=new U);const n=e._readableStreamController[fr](t);return ce(n,ir)}function Ke(e){e._state="closed";const t=e._reader;t!==void 0&&(En(t),ee(t)&&(t._readRequests.forEach(r=>{r._closeSteps()}),t._readRequests=new U))}function _a(e,t){e._state="errored",e._storedError=t;const r=e._reader;r!==void 0&&(dr(r,t),ee(r)?(r._readRequests.forEach(n=>{n._errorSteps(t)}),r._readRequests=new U):(r._readIntoRequests.forEach(n=>{n._errorSteps(t)}),r._readIntoRequests=new U))}function le(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function ga(e,t){Z(e,t);const r=e==null?void 0:e.highWaterMark;return Jt(r,"highWaterMark","QueuingStrategyInit"),{highWaterMark:mr(r)}}const pa=e=>e.byteLength;try{Object.defineProperty(pa,"name",{value:"size",configurable:!0})}catch{}class It{constructor(t){Y(t,1,"ByteLengthQueuingStrategy"),t=ga(t,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!tn(this))throw en("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!tn(this))throw en("size");return pa}}Object.defineProperties(It.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(It.prototype,v.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function en(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function tn(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")?!1:e instanceof It}const Sa=()=>1;try{Object.defineProperty(Sa,"name",{value:"size",configurable:!0})}catch{}class Bt{constructor(t){Y(t,1,"CountQueuingStrategy"),t=ga(t,"First parameter"),this._countQueuingStrategyHighWaterMark=t.highWaterMark}get highWaterMark(){if(!nn(this))throw rn("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!nn(this))throw rn("size");return Sa}}Object.defineProperties(Bt.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Bt.prototype,v.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function rn(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function nn(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")?!1:e instanceof Bt}function ws(e,t){Z(e,t);const r=e==null?void 0:e.flush,n=e==null?void 0:e.readableType,a=e==null?void 0:e.start,i=e==null?void 0:e.transform,o=e==null?void 0:e.writableType;return{flush:r===void 0?void 0:Rs(r,e,`${t} has member 'flush' that`),readableType:n,start:a===void 0?void 0:vs(a,e,`${t} has member 'start' that`),transform:i===void 0?void 0:Cs(i,e,`${t} has member 'transform' that`),writableType:o}}function Rs(e,t,r){return V(e,r),n=>me(e,t,[n])}function vs(e,t,r){return V(e,r),n=>xt(e,t,[n])}function Cs(e,t,r){return V(e,r),(n,a)=>me(e,t,[n,a])}class qt{constructor(t={},r={},n={}){t===void 0&&(t=null);const a=St(r,"Second parameter"),i=St(n,"Third parameter"),o=ws(t,"First parameter");if(o.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(o.writableType!==void 0)throw new RangeError("Invalid writableType specified");const l=Le(i,0),d=pt(i),u=Le(a,1),c=pt(a);let m;const b=k(R=>{m=R});xs(this,b,u,c,l,d),Ts(this,o),o.start!==void 0?m(o.start(this._transformStreamController)):m(void 0)}get readable(){if(!an(this))throw sn("readable");return this._readable}get writable(){if(!an(this))throw sn("writable");return this._writable}}Object.defineProperties(qt.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(qt.prototype,v.toStringTag,{value:"TransformStream",configurable:!0});function xs(e,t,r,n,a,i){function o(){return t}function l(b){return As(e,b)}function d(b){return ks(e,b)}function u(){return Is(e)}e._writable=qo(o,l,u,d,r,n);function c(){return Bs(e)}function m(b){return Ot(e,b),P(void 0)}e._readable=rr(o,c,m,a,i),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Ft(e,!0),e._transformStreamController=void 0}function an(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")?!1:e instanceof qt}function Wt(e,t){ne(e._readable._readableStreamController,t),Ot(e,t)}function Ot(e,t){wa(e._transformStreamController),xr(e._writable._writableStreamController,t),e._backpressure&&Ft(e,!1)}function Ft(e,t){e._backpressureChangePromise!==void 0&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=k(r=>{e._backpressureChangePromise_resolve=r}),e._backpressure=t}class Ze{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!st(this))throw lt("desiredSize");const t=this._controlledTransformStream._readable._readableStreamController;return Er(t)}enqueue(t=void 0){if(!st(this))throw lt("enqueue");Ra(this,t)}error(t=void 0){if(!st(this))throw lt("error");js(this,t)}terminate(){if(!st(this))throw lt("terminate");Es(this)}}Object.defineProperties(Ze.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}});typeof v.toStringTag=="symbol"&&Object.defineProperty(Ze.prototype,v.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function st(e){return!q(e)||!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")?!1:e instanceof Ze}function Ps(e,t,r,n){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=r,t._flushAlgorithm=n}function Ts(e,t){const r=Object.create(Ze.prototype);let n=i=>{try{return Ra(r,i),P(void 0)}catch(o){return y(o)}},a=()=>P(void 0);t.transform!==void 0&&(n=i=>t.transform(i,r)),t.flush!==void 0&&(a=()=>t.flush(r)),Ps(e,r,n,a)}function wa(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function Ra(e,t){const r=e._controlledTransformStream,n=r._readable._readableStreamController;if(!ve(n))throw new TypeError("Readable side is not in a state that permits enqueue");try{Ct(n,t)}catch(i){throw Ot(r,i),r._readable._storedError}os(n)!==r._backpressure&&Ft(r,!0)}function js(e,t){Wt(e._controlledTransformStream,t)}function on(e,t){const r=e._transformAlgorithm(t);return ce(r,void 0,n=>{throw Wt(e._controlledTransformStream,n),n})}function Es(e){const t=e._controlledTransformStream,r=t._readable._readableStreamController;Ne(r);const n=new TypeError("TransformStream terminated");Ot(t,n)}function As(e,t){const r=e._transformStreamController;if(e._backpressure){const n=e._backpressureChangePromise;return ce(n,()=>{const a=e._writable;if(a._state==="erroring")throw a._storedError;return on(r,t)})}return on(r,t)}function ks(e,t){return Wt(e,t),P(void 0)}function Is(e){const t=e._readable,r=e._transformStreamController,n=r._flushAlgorithm();return wa(r),ce(n,()=>{if(t._state==="errored")throw t._storedError;Ne(t._readableStreamController)},a=>{throw Wt(e,a),t._storedError})}function Bs(e){return Ft(e,!1),e._backpressureChangePromise}function lt(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function sn(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}const Qt={ReadableStream:ae,ReadableStreamDefaultController:Te,ReadableByteStreamController:xe,ReadableStreamBYOBRequest:He,ReadableStreamDefaultReader:$e,ReadableStreamBYOBReader:Qe,WritableStream:Ge,WritableStreamDefaultController:Pe,WritableStreamDefaultWriter:Ye,ByteLengthQueuingStrategy:It,CountQueuingStrategy:Bt,TransformStream:qt,TransformStreamDefaultController:Ze};if(typeof yt<"u")for(const e in Qt)Object.prototype.hasOwnProperty.call(Qt,e)&&Object.defineProperty(yt,e,{value:Qt[e],writable:!0,configurable:!0});const Gt=5*1024*1024,qs=e=>btoa(String.fromCharCode(...e));function Ws(e){const t=e.stream().getReader();return new ReadableStream({start(r){function n(){t.read().then(({done:a,value:i})=>{if(a){r.close();return}r.enqueue(i),n()})}n()}})}const va=async(e,t)=>{var i;const r=Ws(e),n=new Rn.Sha256;for await(const o of r){if((i=t==null?void 0:t.abortSignal)!=null&&i.aborted)throw new Error("Hash aborted");n.update(o)}const a=await n.digest();return qs(a)};async function Os(e,t,r){var C;if((C=r==null?void 0:r.abortSignal)!=null&&C.aborted)throw new Error("Aborted");const{name:n,type:a,size:i}=e,o={fileSize:0,filename:n,fileType:a},l=await ge.uploadFileMultiPart({step:Mt.Init,input:{fileMeta:o,hash:t,scope:r==null?void 0:r.scope}},{headers:{checksum:"v2"}}),{uploadId:d,exists:u}=l.uploadFileMultiPart??{};if(!d)throw new Error("uploadId invalid");if(u)return l.uploadFileMultiPart;let c=0;const m=Math.ceil(i/Gt),b=Array.from(Array(m).fill(""),(T,S)=>S+1),R=async T=>{const S=e.slice((T-1)*Gt,T===b.length?i:T*Gt),_=await va(S),x=await ge.uploadFileMultiPart({step:Mt.UploadPart,input:{fileMeta:o,uploadId:d,partNumber:T,hash:_}}),{uploadUrl:j}=x.uploadFileMultiPart??{};if(!j)throw new Error("uploadUrl invalid");const f=await Lt.put(j,S,{headers:{"x-amz-checksum-sha256":_},signal:r==null?void 0:r.abortSignal,responseType:"text",onUploadProgress(g){var w,I;(w=r==null?void 0:r.abortSignal)!=null&&w.aborted||(c+=g.bytes,(I=r==null?void 0:r.onProgress)==null||I.call(r,(c-1)/i))}});if(f.status>299)throw console.error("upload failed",f.data),new Error("Upload failed: "+f.status);const h=f.headers.etag;if(!h)throw new Error("ETag invalid");return{eTag:h.replaceAll('"',""),partNumber:T,hash:_}},p=await Br.mapLimit(b,5,async T=>await Br.retry({times:5,interval(_){return 50*Math.pow(2,_)},errorFilter(_){var x;return Lt.isAxiosError(_)&&_ instanceof si?!1:Lt.isAxiosError(_)&&((x=_.response)==null?void 0:x.status)!==400}},async()=>await R(T)));return await ge.uploadFileMultiPart({step:Mt.Complete,input:{fileMeta:o,parts:p,uploadId:d,hash:t}}),{uploadId:d}}const Fs=e=>s.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:s.jsx("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5l1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),zs=e=>s.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:s.jsx("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})});var ln;(function(e){e.waiting="waiting",e.running="running",e.completed="completed",e.failed="failed"})(ln||(ln={}));var un;(function(e){e.available="available",e.waiting="waiting",e.importing="importing",e.validating="validating",e.archived="archived",e.invalid="invalid"})(un||(un={}));const Ca={[A.UnknownModel]:A.SdV1Model,[A.UnknownLora]:A.Lora},Ms={...Ca,[A.SdxlModel]:A.SdV1Model,[A.SdxlLora]:A.Lora,[A.SdxlVae]:A.Vae,[A.UserSdxlLora]:A.UserLora},Ls=e=>e?Ms:Ca,be=(e,t)=>(()=>{let n=e;return t!=null&&t.replacement&&(n=t.replacement[e]||e),t!=null&&t.tagType&&(n=`${t.tagType}-${n}`),n})().replaceAll("_","").toLowerCase(),xa=(e,t,r)=>{const{type:n,version:a}=t,i=t==null?void 0:t.trainingTaskStatus,o=r!=null&&r.ignoreVersionStatus?"available":a==null?void 0:a.status,l=Ba(t.tags)?"pixai":void 0,d=(...u)=>({replacement:Ls(...u),tagType:l});if(i)switch(i){case"waiting":return{label:e(`market:model.type.${be(n,d(!0))}-waiting`),className:"bg-pink-400"};case"running":return{label:e(`market:model.type.${be(n,d(!0))}-running`),className:"bg-yellow-600"}}switch(o){case"importing":case"waiting":case"validating":return{label:e(`market:model.type.${be(n,d(!0))}-running`),className:"bg-yellow-600"};case"available":{if(r!=null&&r.hideIfAvailable)return null;const u=e(`market:model.type.${be(n,d())}`),c=gn({type:n,tagType:l}).with({tagType:"pixai"},()=>"bg-[#E4C1F9]").with({type:qa},()=>"bg-[#E4C1F9]").with({type:Wa},()=>"bg-indigo-300").with({type:A.SdV1Model},()=>"bg-[#FCF6BD]").with({type:A.SdxlModel},()=>"bg-[#D0F4DD]").with({type:A.Sd3MediumModel},()=>"bg-[#A9DDF9]").with({type:Oa},()=>"bg-blue-300").otherwise(()=>"bg-violet-300");return{label:u,className:c}}case"archived":return{label:e(`market:model.type.${be(n,d(!0))}-archived`),className:"bg-slate-400"};case"invalid":return{label:e(`market:model.type.${be(n,d(!0))}-failed`),className:"bg-red-300"};default:return{label:e("market:model.type.unknown"),className:"bg-stone-500"}}};function bl(e){var a,i,o;const{t}=K(["market"]),{label:r,className:n}=xa(t,{type:e.model.type,version:(a=e.model)==null?void 0:a.latestAvailableVersion,trainingTaskStatus:(o=(i=e.model)==null?void 0:i.trainingTask)==null?void 0:o.status,tags:e.model.tags},{ignoreVersionStatus:e.ignoreVersionStatus})??{};return s.jsx("div",{className:Ce("rounded-2xl px-3 py-1 flex items-center gap-2 text-black",e.className,n),style:e.style,children:s.jsx("p",{className:"font-medium text-xs md:text-base",children:r})})}function Ds(e){return s.jsxs(Ir,{sx:{position:"relative",display:"inline-flex"},children:[s.jsx(pn,{variant:"determinate",...e}),e.value!=null&&s.jsx(Ir,{sx:{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Ha,{variant:"caption",component:"div",color:"text.secondary",children:`${Math.round(e.value)}%`})})]})}const dn=[".ckpt",".pt",".safetensors"];function Pa(e){var _;const[t,r]=E.useState(null),{t:n}=K(["market","common","action","artwork"]),[a,i]=E.useState(void 0),[o,l]=E.useState("ready"),{data:d}=za(),u=E.useRef(),[c,m]=Sn(async x=>{var j,f,h,g,w,I,F,z,M;u.current=new AbortController;try{(j=e.setFileUploading)==null||j.call(e,!0),l("hashing");const B=await va(x,{abortSignal:u.current.signal});if(!e.skipHash){const{generationModelVersion:je}=await ge.getGenerationModelVersion({fileHash:B});if(je){if(await ci(je.modelId,{title:(f=e.values)==null?void 0:f.title,mediaId:(g=(h=e.values)==null?void 0:h.media)==null?void 0:g.id,extra:{description:(I=(w=e.values)==null?void 0:w.extra)==null?void 0:I.description,triggerWords:(z=(F=e.values)==null?void 0:F.firstVersionExtra)==null?void 0:z.triggerWords}}),!(d!=null&&d.isAdmin)){e.setFileId(void 0),l("ready"),i(void 0),r(null);return}if(d!=null&&d.isAdmin){l("done"),i(void 0),e.setFileId(je.fileUploadId),L.info("Because you are an admin, duplicated model files are allowed");return}}}l("uploading"),i(0);const X=await Os(x,B,{onProgress:je=>{i(je*100)},abortSignal:u.current.signal});if(!(X!=null&&X.uploadId))throw new Error("upload failed");re("submit_file_success"),e.setFileId(X.uploadId),l("done"),L.success(n("market:submit.file-uploaded"))}catch(B){e.setFileId(void 0),r(null),re("submit_file_failed",{error:B.message}),B.name==="AbortError"||B.name==="CanceledError"?L.info("File upload cancelled"):L.error("Failed to upload file: "+B.message),l("ready")}finally{i(void 0),(M=e.setFileUploading)==null||M.call(e,!1)}},[d==null?void 0:d.isAdmin]),b=E.useCallback(x=>{var f;const[j]=x;if(j){if(!dn.some(h=>j.name.endsWith(h)))return L.error(n("market:submit.notice.invalid-file-extension"));if(bn((f=e.values)==null?void 0:f.type)&&j.size>2**30)return L.error(n("market:submit.notice.lora-max-size-exceeded"));r({name:j.name,size:j.size}),m(j)}},[m,(_=e.values)==null?void 0:_.type]),{getRootProps:R,getInputProps:p,isDragActive:C,acceptedFiles:T}=Ya({onDrop:b,maxFiles:1}),S=()=>{var x;(x=u.current)==null||x.abort(),l("ready"),r(null),e.setFileId(void 0)};return s.jsxs("div",{className:"w-60 relative mt-2",children:[s.jsxs(bt,{variant:"text",className:Ce("border-2 border-dashed border-active text-primary font-medium py-8 rounded-xl flex flex-col gap-1 w-full",(c||o!=="ready")&&"pointer-events-none cursor-not-allowed",o==="done"&&"bg-sky-100"),disabled:c||o!=="ready",title:t==null?void 0:t.name,...R({onClick:()=>{re("submit_file_click")}}),children:[s.jsx("input",{...p({accept:dn.join(", ")})}),o!=="ready"&&o!=="done"&&s.jsx(Ds,{variant:o==="uploading"?"determinate":void 0,value:a,size:32,className:"text-blue-800"}),s.jsx("span",{className:"font-semibold",children:n(o==="ready"?"market:submit.submit-file":o==="hashing"?"market:submit.asset-form.hashing":o==="uploading"?"market:submit.file-uploading":"market:submit.file-uploaded")}),t&&s.jsxs("div",{className:"w-full",children:[s.jsx("p",{className:"truncate font-mono text-xs w-full text-center",children:li(t.size)}),s.jsx("p",{className:"truncate font-mono text-xs w-full text-center",children:t.name})]})]}),o!=="ready"&&s.jsx(Ma,{size:"small",className:"bg-white shadow z-10 absolute right-0 top-0 translate-x-1/3 -translate-y-1/3",onClick:S,children:s.jsx(La,{})})]})}function yl(e){var m;const{t}=K(["market"]),{values:r,handleChange:n,isEditing:a}=e,{modelId:i,media:o}=r,l=E.useRef(null),{modelInfo:d,status:u,error:c}=E.useContext(ai);return s.jsxs("div",{className:"w-full flex flex-col gap-4",children:[!a&&s.jsxs("section",{children:[s.jsx("h2",{className:"text-primary font-semibold text-lg md:text-2xl flex items-center gap-1 mb-1",children:t("market:submit.model-cover.title")}),s.jsx(wn,{value:((m=d==null?void 0:d.mediaList)==null?void 0:m[0])||o,onChange:b=>{b&&n("media")(b)},dropzoneOptions:{accept:{"image/jpeg":[],"image/png":[],"image/webp":[]},noKeyboard:!0},preHandleImage:async b=>await ti({file:b})??b,placeholderElement:s.jsx(ja,{}),className:"relative",fileHandleElement:({action:b})=>s.jsx("div",{className:"absolute bottom-4 font-sans",children:s.jsx(ri,{media:r.media,action:b})})})]}),s.jsxs("section",{children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("h2",{className:"text-primary font-semibold text-lg md:text-2xl flex items-center gap-1 mb-1",children:t("market:submit.model-version.title")}),a&&s.jsx(Ns,{disabled:Fa(r.type),className:"ml-auto",modelProps:{id:r.modelId,type:r.type,isPrivate:r.isPrivate},onSubmit:()=>{var b;(b=l.current)==null||b.mutate()},modelId:r.modelId})]}),!a&&gn(u).with(et.Validating,et.Uploading,()=>s.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-6 py-8 border-2 border-dashed border-active rounded-xl text-primary-light font-medium",children:[s.jsx(pn,{color:"inherit",size:16}),t("market:importer.messages.fetching-in-progress")]})).with(et.Error,()=>s.jsxs("div",{className:"mt-2 flex items-center gap-2 px-6 py-8 border-2 border-dashed border-red-600 rounded-xl",children:[s.jsx(zs,{className:"size-4 text-red-600"}),t("market:importer.messages.fetching-failed",{error:c.toString()})]})).with(et.Success,()=>s.jsxs("div",{className:"mt-2 inline-flex items-center gap-2 px-6 py-8 border-2 border-dashed border-active rounded-xl text-primary-light font-medium",children:[s.jsx(Fs,{className:"size-4 text-green-600"}),t("market:importer.messages.fetching-succeeded")]})).otherwise(()=>s.jsx(Pa,{fileId:r.uploadId,skipHash:r.isPrivate,setFileId:b=>n("uploadId")(b),values:r})),a&&i&&s.jsx(Us,{pagingRef:l,modelId:i,modelType:r.type})]})]})}function Ns(e){const{t}=K(["market"]),[r,n]=E.useState(!1),a=()=>{n(!1)};return s.jsxs(s.Fragment,{children:[s.jsxs(bt,{disabled:e.disabled,className:Ce("font-semibold flex gap-2",e.className),variant:"contained",onClick:()=>{re("add_version_click",{location:"edit-model"}),n(!0)},children:[s.jsx(fi,{className:"text-xl"}),t("market:submit.add-version")]}),s.jsx(nr,{open:r,onClose:a,dialogProps:{fullWidth:!0,maxWidth:"lg"},children:s.jsx(Ta,{modelProps:e.modelProps,onClose:a,mutate:e.onSubmit})})]})}function Us(e){const{t}=K(["market"]),{modelId:r}=e,[{before:n,after:a},i]=E.useState({}),{data:o,isValidating:l,mutate:d}=Da({modelId:r,...ni({before:n,after:a,pageSize:5})}),u=cn(o).reverse(),c=E.useMemo(()=>({mutate:d,data:o}),[d,o]);return E.useImperativeHandle(e.pagingRef,()=>c,[c]),s.jsx(Xa,{children:s.jsxs(hi,{children:[s.jsx(bi,{children:s.jsxs(ut,{children:[s.jsx(O,{children:t("market:submit.model-version.version-name")}),s.jsx(O,{align:"right",children:t("market:submit.model-version.status")}),s.jsx(O,{align:"right",children:t("market:submit.model-version.update-time")}),s.jsx(O,{align:"right",children:t("market:submit.model-version.actions")})]})}),s.jsxs(yi,{children:[u.length<1&&l&&s.jsx(Vs,{}),u.map(m=>s.jsxs(ut,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s.jsx(O,{component:"th",scope:"row",children:s.jsx("pre",{children:m.name??"Unknown"})}),s.jsx(O,{align:"right",children:s.jsx($s,{version:m,modelType:e.modelType})}),s.jsx(O,{align:"right",children:new Date(m.createdAt).toLocaleString()}),s.jsx(O,{align:"right",children:s.jsx(Hs,{status:m.status,versionId:m.id,modelProps:{id:e.modelId},updateTable:d})})]},m.name))]}),s.jsx(Ja,{children:s.jsx(ut,{children:s.jsx(O,{colSpan:100,align:"right",sx:{borderBottom:0},children:s.jsx(ei,{pageInfo:o==null?void 0:o.pageInfo,onCursorChange:i})})})})]})})}function $s(e){const{t}=K(["market"]),{version:r,modelType:n}=e,a=xa(t,{type:n??A.Lora,version:r});return s.jsx("span",{className:Ce(a==null?void 0:a.className,"text-white px-2 py-1 rounded-md text-xs"),children:a==null?void 0:a.label})}function Vs(){return s.jsxs(ut,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[s.jsx(O,{component:"th",scope:"row",children:s.jsx(Je,{})}),s.jsx(O,{align:"right",children:s.jsx(Je,{})}),s.jsx(O,{align:"right",children:s.jsx(Je,{})}),s.jsx(O,{align:"right",children:s.jsx(Je,{})})]})}function Hs(e){const{t}=K(["market"]),[r,n]=E.useState(!1),a=()=>{n(!1)},i=async()=>{var o,l;re("archive_model_version_click");try{await Qa({title:t("market:submit.archive-version.dialog.title"),description:t("market:submit.archive-version.dialog.description")}),re("archive_model_version_confirm",{modelId:(o=e.modelProps)==null?void 0:o.id,versionId:e.versionId});const d=await ge.upsertGenerationModelVersion({id:e.versionId,input:{status:"archived"}});(l=e.updateTable)==null||l.call(e),L.success(t("market:submit.notice.version-archived"))}catch(d){if(d===Ga)return;L.error(t("market:submit.notice.version-archive-failed")+": "+d.message)}};return s.jsx("div",{className:"flex gap-2 justify-end",children:e.status==="archived"?s.jsx("p",{className:"italic",children:t("market:submit.version-status.archived")}):s.jsxs(s.Fragment,{children:[s.jsx(bt,{variant:"text",onClick:()=>{re("edit_version_click",{location:"edit-model"}),n(!0)},children:t("market:submit.edit-version.label")}),s.jsx(bt,{variant:"outlined",color:"warning",onClick:i,children:t("market:submit.archive-version.label")}),s.jsx(nr,{open:r,onClose:a,dialogProps:{fullWidth:!0,maxWidth:"lg"},children:s.jsx(Qs,{versionId:e.versionId,onClose:a,modelProps:e.modelProps,updateTable:e.updateTable})})]})})}function Qs(e){const{data:t,isValidating:r,mutate:n}=Na(e.versionId);return s.jsx(E.Suspense,{fallback:s.jsx(Yt,{}),children:e.versionId&&!t?s.jsx(Yt,{}):s.jsx(Ta,{onClose:e.onClose,modelProps:e.modelProps,versionData:t,mutate:()=>{var a;(a=e.updateTable)==null||a.call(e),n()}})})}function Ta(e){var g;const{versionData:t,mutate:r}=e,{t:n}=K(["market"]),[a,i]=E.useState(!1),[o,l]=E.useState(!1),[d,u]=E.useState(),[c,m]=E.useState(()=>t==null?void 0:t.mediaId),{data:b}=Ua(c),{values:R,handleChange:p,getValues:C,setValues:T}=$a(t?{name:t.name,...t.extra}:void 0),S=(t==null?void 0:t.model)??e.modelProps??{},{id:_,type:x,isPrivate:j}=S,[f,h]=Sn(async()=>{var I,F,z;const w=await C();try{const M=ii({versionVals:w,modelId:_,fileId:d,mediaId:c}),B=await ge.upsertGenerationModelVersion({id:t==null?void 0:t.id,input:M});r==null||r(),(I=B.upsertGenerationModelVersion)!=null&&I.modelId&&Va((F=B.upsertGenerationModelVersion)==null?void 0:F.modelId,(z=B.upsertGenerationModelVersion)==null?void 0:z.model,!0),re("submit_model_version_success",oi({values:w,versionRes:B.upsertGenerationModelVersion,modelId:_,versionId:t==null?void 0:t.id})),L.success(e.versionData?n("market:submit.notice.version-edited"):n("market:submit.notice.version-added")),e.onClose()}catch(M){L.error(M.message)}},[(g=e.versionData)==null?void 0:g.id,d,c,_]);return s.jsxs(s.Fragment,{children:[s.jsx(mn,{className:"text-2xl",children:s.jsx(fe,{i18nKey:"market:model.action.edit-version"})}),s.jsx("div",{className:"@container/form p-4 mmd:p-8",children:s.jsxs("div",{className:"grid grid-cols-1 @[600px]/form:grid-cols-[2fr_1fr] grid-flow-dense gap-4 text-sm",children:[s.jsxs("div",{className:"@[600px]/form:col-start-2 flex flex-col gap-4",children:[s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("span",{className:"text-primary",children:s.jsx(fe,{i18nKey:"common:cover"})}),s.jsx(wn,{value:b,onChange:w=>{w&&m(w.id)},onUpload:i,placeholderElement:s.jsx(ja,{}),className:""})]}),t&&s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("span",{className:"text-primary",children:s.jsx(fe,{i18nKey:"market:model.preview-artwork.label",values:{count:2}})}),s.jsx(Gs,{modelVersion:t,value:R.previewArtworkIds,onChange:w=>p("previewArtworkIds")(w),className:"flex-none w-[300px] md:w-[400px] max-w-full"})]})]}),s.jsxs("div",{className:"col-start-1 flex flex-col gap-4",children:[s.jsx(mi,{versionValues:R,handleChange:p,modelType:x,isEditing:!0}),!(t!=null&&t.id)&&s.jsx(Pa,{fileId:d,setFileId:w=>u(w),skipHash:j,setFileUploading:l})]})]})}),s.jsxs(hn,{className:"sticky bottom-0 bg-white/80 dark:bg-[#383838]/80 backdrop-blur",children:[s.jsx(ht,{variant:"outlined",onPress:e.onClose,children:n("action:cancel")}),s.jsx(ht,{busy:f,disabled:a||o,variant:"filled",onPress:async()=>{try{await h()}catch(w){L.error(w.message)}},color:"normal",children:n("market:submit.upload-submit")})]})]})}function ja(){const{t:e}=K(["action"]);return s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(di,{className:"text-4xl"}),s.jsx("div",{className:"text-center font-medium",dangerouslySetInnerHTML:{__html:e("action:drag-and-drop-hint",{br:"<br />"})}})]})}function Gs(e){var r,n;const t=E.useRef(null);return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:Ce("grid grid-cols-3 content-start gap-1 aspect-square",e.className),style:e.style,onClick:()=>{var a;return(a=t.current)==null?void 0:a.open()},children:[(r=e.value)==null?void 0:r.map(a=>s.jsx(Ys,{artworkId:a},a)),(((n=e.value)==null?void 0:n.length)??0)<9&&s.jsx("button",{className:"grid place-content-center w-full aspect-square text-neutral-500 border border-dashed border-zinc-300 dark:border-zinc-600 rounded-md",children:s.jsx(ui,{className:"size-6"})})]}),s.jsx(pi,{ref:t,modelVersionId:e.modelVersion.id,modelType:e.modelVersion.modelType,value:e.value,multiple:!0,max:9,onSubmit:a=>{var i;(i=e.onChange)==null||i.call(e,a)}})]})}function Ys(e){const{data:t}=yn(e.artworkId);return s.jsx(ar,{media:t==null?void 0:t.media,thumbnail:!0,className:"w-full aspect-square rounded-md"})}export{un as G,yl as M,ln as T,ja as U,Ta as a,bl as b,zs as c,xa as g,_i as i,va as s,Os as u};
//# sourceMappingURL=ModelAssetForm-CSHNk3Nd.js.map
