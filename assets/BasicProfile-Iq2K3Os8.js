import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r as h,s as K}from"./vendor-apollo-B9XqHIAo.js";import{a as g,P as U,K as k,O as T,Q as b,R as L,b as I,V as M,W as S,t as f,m as y,X as V,T as i,Y as w,Z as l,_ as o,$ as d,a0 as v,a1 as R,a2 as C,U as P,a3 as D,a4 as q,a5 as z}from"./index-JhqgbpkX.js";import{P as A,E as B}from"./ProfileCoverEdit-BNRHf3Ip.js";import{P as E}from"./ProfileEditSection-DYLqWFBC.js";import{u as N}from"./vendor-i18next-TC5y0B3W.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-mui-DTp04zm4.js";import"./vendor-react-router-Bm0RsDwP.js";import"./vendor-firebase-BKQqa5bK.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="29ed824f-e811-40de-8e56-ba901af50d08",s._sentryDebugIdIdentifier="sentry-dbid-29ed824f-e811-40de-8e56-ba901af50d08")})()}catch{}(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s._sentryModuleMetadata=s._sentryModuleMetadata||{},s._sentryModuleMetadata[new s.Error().stack]=function(t){for(var a=1;a<arguments.length;a++){var u=arguments[a];if(u!=null)for(var n in u)u.hasOwnProperty(n)&&(t[n]=u[n])}return t}({},s._sentryModuleMetadata[new s.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();function me(){const{data:s}=g();return s?e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx(G,{})]}):e.jsx(U,{})}function O(){const{data:s}=g(),{data:t}=k(),{t:a}=N(["user"]),u=h.useMemo(()=>T(a),[a]),n=b({validateInputOnChange:!0,initialValues:{username:"",displayName:"",experienceLevel:"beginner"},validate:{username:r=>r.trim().length===0?a("user:profile.notice.username-required"):/^[a-z0-9-]+$/.test(r)?null:a("user:profile.notice.username-invalid"),displayName:L(a("user:profile.notice.display-name-required"))}});h.useEffect(()=>{s&&t&&n.setValues({username:s.username,displayName:s.displayName,experienceLevel:t.experienceLevel??"beginner"})},[s,t]);const[m,x]=I(async r=>{const{displayName:c,username:F,experienceLevel:p}=r;try{const j=M({input:{username:F,displayName:c}}),_=p?S({value:{experienceLevel:p}}):Promise.resolve();await Promise.all([j,_]),f.success(a("user:profile.notice.basic-info.update-success")),y("update_basic_info_success",{experienceLevel:p}),V({experienceLevel:p})}catch(j){f.error(a("user:profile.notice.basic-info.update-failed",{message:j?.message}))}},[]);return e.jsxs(E,{heading:e.jsx(i,{i18nKey:"user:profile.profile"}),children:[e.jsx(A,{user:s,isMe:!0,allowEdit:!0,className:"rounded-lg"}),e.jsxs(w,{form:n,onSubmit:x,children:[e.jsxs("div",{className:"mt-4 flex flex-col-reverse msm:flex-row w-full",children:[e.jsxs("div",{className:"flex flex-col gap-8 flex-1",children:[e.jsx(l,{input:n.getInputProps("username"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsxs(o,{required:!0,children:[e.jsx(i,{i18nKey:"auth:username"}),e.jsx("span",{className:"text-primary-light pl-2 text-xs font-normal opacity-75",children:e.jsx(i,{i18nKey:"auth:username-hint"})})]}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0}),e.jsxs(v,{input:r,children:[e.jsx(i,{i18nKey:"user:your-profile-page"}),e.jsx(i,{i18nKey:"common:punctuations.colon"}),"Â https://pixai.art/@",e.jsx("span",{className:"font-bold",children:n.values.username})]})]})}),e.jsx(l,{input:n.getInputProps("displayName"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{required:!0,children:e.jsx(i,{i18nKey:"auth:nickname"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0}),e.jsx(v,{input:r})]})}),e.jsxs(R,{input:n.getInputProps("experienceLevel"),onChange:r=>n.setFieldValue("experienceLevel",r),children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:profile.level-of-experience"})}),u.map(r=>e.jsx(C,{value:r.name,variant:"circle",children:e.jsxs("div",{className:"pt-4 grid grid-cols-[20px_1fr] grid-rows-[20px_1fr] gap-x-1",children:[e.jsx(r.icon,{className:"size-4 self-center justify-self-center"}),e.jsx("p",{className:"text-sm",children:r.label}),e.jsx("p",{className:"col-start-2 text-xs text-neutral-500",children:r.help})]})},r.name))]})]}),e.jsx("div",{className:"flex-col flex sm:pl-8",children:e.jsx(B,{className:"py-4"})})]}),e.jsx(P,{variant:"filled",size:"large",busy:m,className:"mt-8 min-w-[120px] text-sm",type:"submit",children:e.jsx(i,{i18nKey:"action:save"})})]})]})}function G(){const{t:s}=N(["user"]),{data:t}=g(),{data:{profiles:a}={},refetch:u}=D(t?.id??K),n=b({initialValues:{bio:"",location:"",website:"",twitterId:"",instagramId:"",facebookId:"",redditId:"",pixivId:""}});h.useEffect(()=>{if(a){const r=a;n.setValues(r)}},[a]);const[m,x]=I(async r=>{try{await q({value:r}),y("update_user_profile_success"),f.success(s("user:profile.notice.user-profile.update-success")),u()}catch(c){f.error(s("user:profile.notice.user-profile.update-failed",{message:c?.message}))}},[]);return e.jsx(E,{heading:e.jsx(i,{i18nKey:"user:profile.about"}),className:"mt-12",children:a&&e.jsxs(w,{form:n,onSubmit:x,className:"flex flex-col gap-4",children:[e.jsx(l,{input:n.getInputProps("bio"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:bio"})}),e.jsx(z,{variant:"rounded-normal",value:r.value,defaultValue:r.defaultValue,onChange:c=>n.setFieldValue("bio",c.target.value),onBlur:()=>y("bio_input_blur"),rows:4})]})}),e.jsx(l,{input:n.getInputProps("location"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:location"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(l,{input:n.getInputProps("website"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:website"})}),e.jsx(d,{...r,placeholder:"https://",type:"url",variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(l,{input:n.getInputProps("twitterId"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:profile.twitter-username"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(l,{input:n.getInputProps("instagramId"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:profile.instagram-username"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(l,{input:n.getInputProps("facebookId"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:profile.facebook-username"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(l,{input:n.getInputProps("redditId"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:profile.reddit-username"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(l,{input:n.getInputProps("pixivId"),layout:"vertical",children:r=>e.jsxs(e.Fragment,{children:[e.jsx(o,{children:e.jsx(i,{i18nKey:"user:profile.pixiv-userid"})}),e.jsx(d,{...r,variant:"rounded-normal",isError:r.error!==void 0})]})}),e.jsx(P,{variant:"filled",size:"large",busy:m,className:"self-start min-w-[120px] text-sm",type:"submit",children:e.jsx(i,{i18nKey:"action:save"})})]})})}export{me as Component};
