import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r as o}from"./vendor-apollo-B9XqHIAo.js";import{d3 as S,d4 as D,aL as F,b8 as z,b9 as R,bN as H,U as g,m as b,aj as V,d5 as O,a as W,L as B,N as G,d6 as A,d7 as $,j as q,d8 as J,d9 as K,p as Q}from"./index-JhqgbpkX.js";import{$ as j,N as p,G as I}from"./vendor-firebase-BKQqa5bK.js";import{u as y}from"./vendor-i18next-TC5y0B3W.js";import{Q as Y,L as X,k as Z,al as ee,am as te,an as re}from"./vendor-mui-DTp04zm4.js";import{J as se}from"./vendor-lodash-992l3ZN7.js";import{a as E,d as L,i as ae}from"./vendor-react-router-Bm0RsDwP.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="f587325b-da69-4c37-8784-9e54356f4aaa",t._sentryDebugIdIdentifier="sentry-dbid-f587325b-da69-4c37-8784-9e54356f4aaa")})()}catch{}(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t._sentryModuleMetadata=t._sentryModuleMetadata||{},t._sentryModuleMetadata[new t.Error().stack]=function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];if(a!=null)for(var i in a)a.hasOwnProperty(i)&&(s[i]=a[i])}return s}({},t._sentryModuleMetadata[new t.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();function ne(t){const s=document.createElement("div");return s.innerHTML=t||"",s.textContent||s.innerText}const oe=o.forwardRef(function(s,n){const{t:a}=y(["market"]),[i,c]=o.useState(!1);o.useEffect(()=>{i||(d(""),w(void 0),v(void 0))},[i]),o.useImperativeHandle(n,()=>({open:()=>c(!0)}));const[l,d]=o.useState(""),[f,w]=o.useState(),[k,v]=o.useState(),{importModel:_,url:C,validating:x,uploading:h,reset:T}=o.useContext(S),{setValues:U}=D();async function M(u=l){const r=await _(u).catch(v);if(r&&(w(r),r.fileId)){const P=r.items?.find(m=>m.url===r.file?.externalId),N={uploadId:r.fileId,title:r.name,type:r.type?r.type.toLowerCase().includes("lora")?I.UnknownLora:I.UnknownModel:void 0,tags:r.tags,extra:{description:ne(r.description)},firstVersionExtra:{name:P?.name,triggerWords:[].concat(r.extra.triggerWords).join(", ")},media:r.mediaList?.[0]};if(r.exists){const{generationModelVersion:m}=await V.getGenerationModelVersion({fileHash:r.hash});if(m){await O(m.modelId,N),T(),c(!1);return}}U(m=>se({},m,N)),c(!1)}}return e.jsxs(F,{dismissable:!0,open:i,onClose:()=>c(!1),className:"sm:w-screen max-w-screen-sm",children:[e.jsx(z,{heading:e.jsx(e.Fragment,{children:a("market:importer.name")})}),e.jsxs(R,{children:[e.jsx(Y,{value:l,onChange:u=>d(u.target.value),variant:"outlined",label:a("market:importer.model-url-input.label"),placeholder:a("market:importer.model-url-input.placeholder"),className:"mt-2 w-full",slotProps:{inputLabel:{shrink:!0}}}),k&&e.jsx("p",{className:"mt-2 px-2 py-1 text-amber-700 bg-amber-100 rounded-md",children:k?.toString()}),j(f).with({items:p.nullish},{items:[]},()=>"Something wrong").with({hash:p.nullish,items:[p.any,p.any,...p.array()]},u=>e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"mt-4",children:a("market:importer.version-select.label")}),e.jsx(X,{className:"space-y-1",children:u.items.map(r=>e.jsxs(Z,{disablePadding:!0,className:"flex items-center gap-2 hover:bg-black/10 rounded-lg group",children:[e.jsx("img",{src:H(r.mediaList?.[0]),alt:"",className:"flex-none size-12 msm:size-20 object-center object-cover bg-black/20 rounded-lg group-hover:rounded-r-none"}),e.jsx("span",{children:r.name}),e.jsx(g,{variant:"filled",busy:r.url===C&&(x||h),disabled:!r.url||x||h,className:"flex-none ml-auto mr-2 capitalize invisible group-hover:visible [@media(hover:none)]:visible",onPress:()=>{b("import_model_url_version_click",{url:r.url,version:r.name}),r.url&&M(r.url)},children:a("market:importer.import-button.label")})]},r.url))})]})).otherwise(()=>e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(g,{variant:"filled",size:"large",busy:x||h,className:"capitalize",onPress:()=>{b("import_model_url_click",{url:l}),M(l)},children:a("market:importer.import-button.label")})}))]})]},Number(i))}),ie=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zM9.29 16.29L5.7 12.7a.996.996 0 1 1 1.41-1.41L10 14.17l6.88-6.88a.996.996 0 1 1 1.41 1.41l-7.59 7.59a.996.996 0 0 1-1.41 0z"})});function Ue(){const t=E(),s=L(),{data:n,loading:a}=W();return o.useEffect(()=>{t.pathname==="/market/submit"&&s("/market/submit/step-1")},[]),n?e.jsx(A,{children:e.jsxs($,{children:[e.jsx(q,{content:"Submit Model to Market"}),e.jsx(ce,{})]})}):a?e.jsx(B,{}):e.jsx(G,{})}const le={0:"market:submit.model-information",1:"market:submit.add-version",2:"market:submit.add-files"},de=Object.entries(le),me=t=>{if(t.startsWith("/market/submit/step-")){const s=Number(t.slice(-1));return isNaN(s)||s>3?0:s-1}return 0};function ce(){const{t}=y(["market","action"]),s=ae(),n=E(),a=L(),[i,c]=o.useContext(J),l=o.useMemo(()=>me(n.pathname),[n.pathname]);return o.useEffect(()=>{const d=i.step;d<l&&a(`/market/submit/step-${d+1}`)},[l,i.step]),e.jsx(K,{children:e.jsxs("div",{className:"md:px-24",children:[e.jsx("section",{className:"my-8",children:e.jsx(ee,{activeStep:i.step,alternativeLabel:!0,children:de.map(([d,f])=>e.jsx(te,{children:e.jsx(re,{children:t(f)})},d))})}),i.step===0&&e.jsx(ue,{}),e.jsx("section",{children:s})]})})}function ue(){const{t}=y(["market"]),s=o.useRef(null),{uploading:n,success:a}=o.useContext(S);return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"-mx-4 mb-8 flex justify-between items-center gap-4 px-4 py-3 bg-[#1971c2]/10 ring-1 ring-[#1971c2] msm:rounded-lg",children:[e.jsxs("div",{className:"max-w-prose",children:[e.jsx("h2",{className:"text-lg md:text-2xl font-semibold",children:j(!0).with(n,()=>t("market:importer-section.heading",{context:"uploading"})).with(a,()=>t("market:importer-section.heading",{context:"success"})).otherwise(()=>t("market:importer-section.heading"))}),e.jsx("p",{className:Q("mt-2",a&&"hidden"),children:j(!0).with(n,()=>t("market:importer-section.description",{context:"uploading"})).with(a,()=>null).otherwise(()=>t("market:importer-section.description"))})]}),e.jsx(g,{variant:"filled",busy:n,disabled:a,onPress:()=>{b("open_importer_click"),s.current?.open()},className:"shrink-0",children:a?e.jsx(ie,{className:"size-5"}):t("market:importer-section.open-importer-button.label")})]}),e.jsx(oe,{ref:s})]})}export{Ue as Component};
