import{j as n}from"./vendor-motion-Bl2lDopP.js";import{r as t}from"./vendor-apollo-B9XqHIAo.js";import{c6 as H,a as Q,c7 as Y,bY as J,b6 as K,c8 as U,c9 as $,ca as W,cb as X,m as Z,ak as z,p as L,L as E,cc as ee}from"./index-JhqgbpkX.js";import{g as se}from"./vendor-graphql-DeSYh9DC.js";import{u as te}from"./vendor-i18next-TC5y0B3W.js";import{q as ne}from"./vendor-lodash-992l3ZN7.js";import{M as T}from"./ModelCard-BbPEsrCH.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="b4f20eaf-45e8-4d63-8e48-df16bdb165e2",e._sentryDebugIdIdentifier="sentry-dbid-b4f20eaf-45e8-4d63-8e48-df16bdb165e2")})()}catch{}(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(s){for(var r=1;r<arguments.length;r++){var a=arguments[r];if(a!=null)for(var i in a)a.hasOwnProperty(i)&&(s[i]=a[i])}return s}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const fe=({tag:e,keyword:s,order:r,type:a,authorId:i,timeRange:c,pageSize:f=24,renderEmpty:g,renderLoading:k=()=>n.jsx(E,{}),renderContent:p,containerProps:m,extraArgs:l,scene:S="market"})=>{const{t:B}=te(["artwork"]),I=H(),M=t.useMemo(()=>a?a.split(","):void 0,[a]),{loading:v}=Q(),{posSeq:o,feed:_}=Y({order:r,keyword:s}),q=t.useMemo(()=>JSON.stringify(c),[c]),F=t.useCallback((h,x)=>{if(v)return;const w=(o?x?.pageInfo.endCursor:x?.pageInfo.startCursor)??I,d={...l,tag:e,keyword:typeof s=="string"?J(s):void 0,authorId:i,...M?.length===1?{type:M[0]}:{types:M},feed:_,orderBy:K(r),timeRange:c};return o?(d.first=f,d.after=w):(d.last=f,d.before=w),e==="challenge"&&(d.tag=void 0),(e==="all"||!e)&&(d.tag=void 0),d},[I,l,e,s,i,M,r,f,q,_,v,o]),{data:y,isValidating:b,isLoading:O,setSize:A,mutate:D}=U(F,{revalidateFirstPage:!1}),u=t.useMemo(()=>y?.at(-1)?.pageInfo,[y]),P=t.useMemo(()=>o?u?.hasNextPage:u?.hasPreviousPage,[u,o]),N=t.useMemo(()=>y?ne(y.flatMap(x=>{const w=se(x);return o?w:w.reverse()}),"id"):[],[y,o]),R=t.useMemo(()=>{if(o&&u?.hasNextPage)return u.endCursor;if(u?.hasPreviousPage)return u.startCursor},[u,o]),j=t.useCallback(()=>{!b&&P&&A(h=>h+1)},[P,b]);t.useEffect(()=>{$.next(b)},[b]);const C=t.useRef(null);W("scroll",t.useCallback(()=>{C.current&&X(C.current,{offset:-500})&&j()},[j]),window,{passive:!0});const V=t.useCallback(h=>{Z("model_click",{scene:S,type:h.type})},[]),G=v||O?k():N.length===0?g?g():n.jsx(z,{description:B("artwork:search-results.empty-without-keyword")}):p({models:N,loadMore:j,onModelClick:V,loading:b,pageSize:f,mutateModels:D});return n.jsxs(n.Fragment,{children:[n.jsx("div",{...m,className:L("w-full flex justify-center mb-8 min-h-screen",m?.className),children:G}),n.jsx("div",{ref:C,className:"w-full flex justify-center mb-8",children:P?n.jsx(E,{fullHeight:!0}):null}),n.jsx(ee,{cursor:R})]})},ce=({scene:e,models:s,onModelClick:r,loading:a,className:i,lastView:c,pageSize:f=24,modifyModelElements:g=p=>p,mutateModels:k})=>{const p=t.useMemo(()=>{if(!s)return null;const m=s.map(l=>n.jsx(T,{model:l,link:!0,scene:e,onClick:()=>r?.(l),mutateModels:k},l.id));return g(m,{gridItemType:"model"})},[e,s,r,g]);return n.jsxs("div",{className:L("w-full grid content-start mt-4","grid-cols-2 gap-2","lg:grid-cols-4 lg:gap-3",i),children:[p,c,a&&Array.from({length:f}).map((m,l)=>n.jsx(T,{},l))]})};export{fe as B,ce as M};
