import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r,s as v}from"./vendor-apollo-B9XqHIAo.js";import{dY as Y,aG as F,P as E,fn as Q,h3 as J,bO as X,ag as M,l as R,m as S,iX as ee,h4 as te,gR as se,gj as ae,t as k,cA as ne,iY as ie,fo as re,fc as oe,U as f,bp as le,T as u,fl as ce,c4 as de,iA as me,kx as ue,aZ as D,ff as $,ky as B,jO as K,b7 as T,ce as L,kp as ge,c1 as fe,kz as xe,kA as he,kB as pe,jd as be,j as je,bH as we,g8 as ke,g9 as ye,ga as Ie,gb as ve,fd as O,hK as Se,gt as G,fj as Ne,ap as Ce,jz as Pe,gO as H,iD as Te,dW as Ee,gh as Me,im as Ae,p as ze,G as V,aC as Ue,kC as _e,a6 as Fe,aF as Re,bk as De,kD as $e}from"./index-JhqgbpkX.js";import{K as Be,e as Ke,$ as Le,L as Oe}from"./vendor-react-aria-BW9JtD2p.js";import{T as Ge}from"./TaskPublishDialog-C6g-yNPm.js";import{C as He}from"./GenerationModeNavigation-BeGzJJIs.js";import{d as A,c as Ve,N as _}from"./vendor-react-router-Bm0RsDwP.js";import{a4 as qe,a as We,b as Ze,w as Ye,h as Qe,k as q,u as Je}from"./vendor-firebase-BKQqa5bK.js";import{u as z}from"./vendor-i18next-TC5y0B3W.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-mui-DTp04zm4.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new t.Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="a6b8050d-eb71-41a8-bed1-c773b724437a",t._sentryDebugIdIdentifier="sentry-dbid-a6b8050d-eb71-41a8-bed1-c773b724437a")})()}catch{}(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t._sentryModuleMetadata=t._sentryModuleMetadata||{},t._sentryModuleMetadata[new t.Error().stack]=function(s){for(var n=1;n<arguments.length;n++){var a=arguments[n];if(a!=null)for(var i in a)a.hasOwnProperty(i)&&(s[i]=a[i])}return s}({},t._sentryModuleMetadata[new t.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const Xe=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M5.5 2a1 1 0 0 0 0 2h13a1 1 0 1 0 0-2zm7.207 3.793a1 1 0 0 0-1.414 0l-5 5a1 1 0 1 0 1.414 1.414L11 8.914V21a1 1 0 1 0 2 0V8.914l3.293 3.293a1 1 0 0 0 1.414-1.414z"})}),et=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M10.5 2.752a.75.75 0 0 0-1.5 0v.752c0 .633.196 1.22.53 1.703a3.75 3.75 0 0 0-2.52 3.284h-.257a2.25 2.25 0 0 1-2.24-2.26l.006-1.485a.75.75 0 1 0-1.5-.006l-.007 1.485a3.75 3.75 0 0 0 3.735 3.766H7v1.51H2.75a.75.75 0 0 0 0 1.5H7v1.992h-.253a3.75 3.75 0 0 0-3.735 3.765l.007 1.486a.75.75 0 0 0 1.5-.006l-.007-1.486a2.25 2.25 0 0 1 2.241-2.26h.473a5.002 5.002 0 0 0 9.548 0h.473a2.25 2.25 0 0 1 2.24 2.26l-.006 1.486a.75.75 0 0 0 1.5.006l.006-1.486a3.75 3.75 0 0 0-3.734-3.765H17V13h4.251a.75.75 0 0 0 0-1.5H17V9.99h.253a3.75 3.75 0 0 0 3.735-3.766L20.98 4.74a.75.75 0 1 0-1.5.006l.006 1.486a2.25 2.25 0 0 1-2.24 2.259h-.256a3.75 3.75 0 0 0-2.52-3.284c.333-.484.529-1.07.529-1.703v-.752a.75.75 0 0 0-1.5 0v.752a1.5 1.5 0 0 1-3 0zm-2 6.002a2.25 2.25 0 0 1 2.25-2.25h2.5a2.25 2.25 0 0 1 2.25 2.25v6.247a3.5 3.5 0 1 1-7 0z"})}),tt=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 5a7 7 0 1 1-6.946 6.124a1 1 0 1 0-1.984-.248Q3 11.43 3 12a9 9 0 1 0 4-7.484V4a1 1 0 0 0-2 0v3a1 1 0 0 0 1 1h3a1 1 0 0 0 0-2h-.608A6.97 6.97 0 0 1 12 5m1 3a1 1 0 1 0-2 0v4a1 1 0 0 0 1 1h2.5a1 1 0 1 0 0-2H13z"})}),st=r.memo(({mediaId:t,className:s,style:n,preloader:a})=>{const i=Y(t??v),o=F(i?.data),d=r.useRef(null),[m,c]=r.useState(!0),[l,g]=r.useState(!1),p=r.useCallback(()=>{c(!1),g(!0)},[]);return r.useEffect(()=>{if(!o){c(!0);return}g(!1);const b=d.current||new Image;b.complete&&b.naturalHeight!==0?(c(!1),g(!0)):c(!0)},[o]),e.jsxs(e.Fragment,{children:[!l&&e.jsx(E,{className:a?.className,style:a?.style,inline:!0}),e.jsx("img",{ref:d,crossOrigin:"anonymous",className:s,style:n,src:o,hidden:!l,onLoad:p})]})});function at(t){const{task:s,trackingArgs:n}=t,a=!Q(s),i=J(s)>0,o=s?.artworkIds?.[0],d=A(),m=s?.mediaId,c=X(m,"orig"),{me:l}=M(),[g,p]=R(async()=>{s&&(S("image_dl",{authorId:s?.userId,isMyMedia:l?l.id===s?.userId:void 0,artworkId:s?.artworkIds?.[0],mediaId:m,...n}),ee({type:"download",action:"confirm",taskId:s.id,taskParams:s.parameters,otherParams:{mediaId:m,...n}}),c?await te(c,`${se({task:s})}.${ae({task:s})}`,{skipConversion:!0}):k.error("Cannot download image"))},[s,m,c,l]),b=()=>{ue({mediaId:s?.mediaId,afterSubmission(y){d(D("/generator/image/animation",{task:$(y)}))}})};return e.jsx("div",{className:ne("flex w-1/2 items-center justify-center gap-2",t.className),children:i&&o?e.jsx("div",{className:"flex items-center gap-2 ml-auto",children:e.jsx(ie,{artworkId:o,trackingArgs:n})}):e.jsxs(e.Fragment,{children:[a?e.jsx("span",{}):e.jsx(re,{task:s,scene:"i2vPro",icon:e.jsx(oe,{className:"size-5"}),className:"w-36",size:t.size}),e.jsx(f,{variant:"outlined",onPress:b,icon:e.jsx(le,{className:"size-5"}),className:"w-36",size:t.size,children:e.jsx(u,{i18nKey:"generation:image-to-video.action.animate"})}),l?.isAdmin&&s&&e.jsx(f,{variant:"outlined",color:"admin",onPress:()=>ce(s),size:t.size,children:e.jsx(de,{className:"size-5"})}),e.jsx(f,{busy:g.loading,variant:"outlined",onPress:p,size:t.size,children:e.jsx(me,{className:"size-5"})})]})})}const x=r.createContext({sceneId:"anime-figure",selectedScene:void 0});x.displayName="ChatEditingPresetConfigContext";const nt=x.Provider,it="generator::chat-editing-preset",rt=qe(()=>sessionStorage),ot=We(`${it}-state`,void 0,rt),N=Ze({lastSubmittedTaskId:void 0,fileToUpload:void 0}),U="generator::image-generation-preset";function lt(t){if("file"in t){const s=new FileReader;s.onload=function(){const n=this.result;typeof n=="string"?sessionStorage.setItem(`${U}-file`,n):console.error("Cannot save to session storage")},s.readAsDataURL(t.file)}}async function ct(){const t=sessionStorage.getItem(`${U}-file`);if(typeof t=="string")try{const s=await K(t);if(s)return{file:s}}catch{console.error("Failed to import saved image")}}function P(){sessionStorage.removeItem(`${U}-file`)}function W(t){const{data:s,...n}=B(t);return{data:r.useMemo(()=>s?.[0],[s]),...n}}const dt=[[T.mostLiked,e.jsx(u,{i18nKey:"common:order-option.most-liked"})],[T.newest,e.jsx(u,{i18nKey:"common:order-option.newest"})]];function mt(){const{sceneId:t}=r.useContext(x),[s,n]=r.useState(T.mostLiked),{data:a}=W({}),i=a?.tags?.[0],o=L(),[d,m]=r.useState();return r.useEffect(()=>{m(o?void 0:document.getElementById("chat-editing-preset-scroll-container"))},[o]),e.jsxs("section",{className:"mt-8 pt-6 border-t px-6 mmd:px-0 max-w-[1200px] mx-auto",children:[e.jsxs("hgroup",{className:"mb-4 flex items-center",children:[e.jsx("h2",{className:"text-base mmd:text-xl font-bold",children:e.jsx(u,{i18nKey:"generation:image-stitching.related-artworks"})}),e.jsx(ge,{className:"ml-auto",value:s,onChange:c=>{const l=c.target.value;S("chat_editing_preset_related_order_change",{tag:i,value:l,section:t}),n(l)},children:dt.map(c=>e.jsx("option",{value:c[0],children:c[1]},c[0]))})]}),i&&e.jsx(fe,{showSpeedDial:!1,order:s,type:Ye.Default,trackingArgs:{feed:s,scene:"chat-editing-preset",section:t},tag:i,scrollContainer:d})]})}function ut(t){const s=xe();return e.jsxs(he.Provider,{value:{scene:"chat-editing-preset"},children:[!s&&e.jsx(pe,{className:"bg-background backdrop-blur-lg border-b border-neutral-100 dark:border-neutral-700",style:{gridArea:"header"},children:e.jsx(He,{value:be.ChatEditingPreset})}),e.jsx("div",{className:"pt-4 mmd:p-6",children:e.jsx(gt,{sceneData:t.sceneData,children:e.jsx(ft,{})})})]})}function gt(t){const s=r.useMemo(()=>({sceneId:t.sceneData.sceneId,selectedScene:t.sceneData}),[t.sceneData]);return e.jsx(nt,{value:s,children:t.children})}function ft(){const{t}=z(["growth"]),{selectedScene:s}=r.useContext(x);return s?e.jsxs("div",{className:"relative",children:[e.jsx(je,{content:t(s.title)}),e.jsx(we,{content:t(s.description)}),e.jsxs("section",{className:"flex flex-col gap-2 items-center relative my-4 max-w-[1000px] mmd:mx-auto mmd:px-0 px-4",children:[e.jsx("h1",{className:"text-xl sm:text-3xl text-center max-w-[calc(100%-4rem)] font-bold",children:e.jsx(u,{i18nKey:s.title})}),e.jsx("h2",{className:"text-sm text-center pt-2 hidden sm:block",children:e.jsx(u,{i18nKey:s.description})}),e.jsx(xt,{className:"absolute px-1 left-4"})]}),e.jsxs("div",{className:"flex flex-col mmd:grid mmd:grid-cols-2 gap-4 max-w-[1200px] mmd:mx-auto",children:[e.jsxs("section",{className:"flex flex-col gap-2 px-4",children:[e.jsx(jt,{}),e.jsx(It,{})]}),e.jsx("section",{className:"flex flex-col px-4",children:e.jsx(ht,{})})]}),e.jsx(mt,{})]}):e.jsx(E,{})}function xt(t){const s=A(),{sceneId:n}=r.useContext(x),{data:a}=B({});return e.jsxs(ke,{children:[e.jsx(f,{size:"small",variant:"outlined",className:t.className,children:e.jsx(ye,{className:"size-5"})}),e.jsx(Ie,{placement:"bottom",children:a?.map(i=>e.jsx(ve,{onAction:()=>{S("chat_editing_preset_scene_switch",{value:i.sceneId}),n!==i.sceneId&&s(`/generator/preset/${i.sceneId}`)},children:e.jsx(u,{i18nKey:i.title})}))})]})}function ht(){const{lastSubmittedTaskId:t}=Qe(N),{data:s}=O(t??v);return t?e.jsx(pt,{task:s}):e.jsx(bt,{})}function pt(t){const{sceneId:s}=r.useContext(x),n=q(N),{task:a}=t,i=r.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsx("div",{id:"scroll-to-result"}),a?.mediaId?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full aspect-square flex items-center justify-center relative",children:[e.jsx(st,{className:"object-contain aspect-square",mediaId:a?.mediaId}),e.jsx("button",{onClick:()=>n(Se(o=>{o.lastSubmittedTaskId=void 0})),className:"absolute right-0 top-0 z-[2] bg-black border-2 border-white rounded-full p-0.5 translate-x-1/2 -translate-y-1/2 shadow",children:e.jsx(G,{className:"size-5 text-white"})})]}),a?.status==="completed"&&e.jsx(at,{className:"w-full mt-2",task:a,trackingArgs:{scene:"chat-editing-preset",section:s},size:"large"})]}):e.jsx(Ne,{className:"h-full aspect-square",id:a?.id,status:a?.status}),e.jsx(Ge,{ref:i})]})}function bt(){const{selectedScene:t}=r.useContext(x),s=L(),{t:n}=z(["generation"]),{images:a}=t??{},i=a?.demo??[],o=e.jsxs("div",{children:[t?.tutorial&&e.jsx("p",{children:e.jsx(Ce,{className:"prose prose-sm dark:prose-invert",children:n(t?.tutorial)})}),e.jsx("ul",{className:"grid grid-cols-[repeat(auto-fill,minmax(96px,1fr))] gap-3 mt-2",children:i.map((d,m)=>e.jsx("img",{className:"object-contain",alt:`demo-image-${m}`,src:d},d))})]});return s?e.jsxs(Be,{defaultExpanded:!1,className:"mt-4",children:[e.jsx(Ke,{children:e.jsxs(Le,{slot:"trigger",className:"group inline-flex items-center gap-1 outline-none",children:[e.jsx("span",{children:e.jsx(u,{i18nKey:"generation:chat-editing-preset.tutorial.label"})}),e.jsx(Pe,{className:"size-5 transition-transform group-aria-expanded:rotate-90"})]})}),e.jsx(Oe,{className:"mt-2",children:o})]}):e.jsxs("div",{className:"bg-stone-50 dark:bg-neutral-700 border dark:border-neutral-600 p-4 h-full rounded-md",children:[e.jsx("h3",{className:"text-xl mb-4",children:e.jsx(u,{i18nKey:"generation:chat-editing-preset.tutorial.label"})}),o]})}function jt(){const{me:t}=M(),{sceneId:s}=r.useContext(x),[n,a]=r.useState(!1),[i,o]=H(N),[d,m]=Je(ot),c=Te(i.fileToUpload);r.useEffect(()=>{if(!t)return;(async()=>{const j=await ct();if(j){const{file:w}=j;o(I=>{I.fileToUpload=w})}P()})()},[t?.id]);const l=r.useCallback(h=>{const j=h[0];o(w=>{w.fileToUpload=j}),P(),m(void 0),t||lt({file:j})},[t]),{getRootProps:g,getInputProps:p,open:b}=Ee({onDrop:l,multiple:!1,accept:{"image/jpeg":[],"image/png":[]}}),[y,Z]=R(async h=>{C();const j=(await Me({id:h})).data.media,w=F(j);if(w)try{const I=await K(w);l([I])}catch(I){k.error(I.message)}},[]),C=r.useCallback(()=>{o(h=>{h.fileToUpload=void 0}),P()},[]);return e.jsxs("div",{className:"flex flex-col gap-1 mmd:self-end w-full max-w-screen-lg",children:[e.jsx(Ae,{open:n,onClose:()=>a(!1),onSubmit:Z,onSelectedFiles:h=>{C(),l(h),a(!1)},showFileUpload:!0}),e.jsx("div",{className:"relative aspect-square w-full isolate",children:c?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:C,className:"absolute right-0 top-0 z-[2] bg-black border-2 border-white rounded-full p-0.5 translate-x-1/2 -translate-y-1/2 shadow",children:e.jsx(G,{className:"size-5 text-white"})}),e.jsx("img",{src:c,className:"object-contain aspect-square w-full"})]}):e.jsxs("div",{className:ze("font-medium cursor-pointer flex flex-col gap-3 items-center justify-center text-xs border rounded-lg h-full bg-stone-50 dark:bg-neutral-700 dark:border-neutral-600"),...g(),children:[e.jsx("input",{...p()}),e.jsx("h3",{className:"font-semibold mb-10 text-4xl text-neutral-400",children:e.jsx(u,{i18nKey:"workflow:parameter.inputs.media.label"})}),e.jsx(f,{size:"large",variant:"outlined",onPress:()=>{if(S("generator_tab_select_task_history_click",{scene:"chat-editing-preset",section:s}),!t)return V();a(!0)},busy:y.loading,icon:e.jsx(tt,{className:"size-6"}),children:e.jsx(u,{i18nKey:"generation:enhance-image.image-select.select-from-task"})}),e.jsx("div",{className:"h-px w-60 my-2 bg-stone-200"}),e.jsx(f,{variant:"outlined",size:"large",onPress:()=>b(),icon:e.jsx(Xe,{className:"size-6"}),children:e.jsx(u,{i18nKey:"generation:enhance-image.image-select.upload-image"})}),t?.isAdmin&&e.jsx(yt,{}),e.jsx("div",{className:"h-[80px]"})]})})]})}const wt="https://images-ng.pixai.art/gi/thumb/bc3403ab-9575-4170-8e76-b94ddfb7ac97";async function kt(){const t=await fetch(wt,{credentials:"omit"});if(!t.ok)throw new Error(`Fetch failed: ${t.status}`);const s=await t.blob(),n=s.type||"image/jpeg",i=`figure_result.${(n.split("/")[1]||"jpg").replace("jpeg","jpg")}`;return{lastSubmittedTaskId:"1920642336054348728",fileToUpload:new File([s],i,{type:n})}}function yt(){const t=q(N),s=async()=>{try{t(await kt()),k.success("Loaded figure result into uploader")}catch(n){k.error(n?.message||"Failed to load figure result")}};return e.jsx(f,{variant:"outlined",size:"large",className:"border-yellow-600 text-yellow-600",onPress:()=>s(),icon:e.jsx(et,{className:"size-6"}),children:"Use Sample"})}function It(){const{selectedScene:t}=r.useContext(x),[s,n]=H(N),{t:a}=z(["generation"]),i=A(),{me:o}=M(),{data:d}=O(s.lastSubmittedTaskId??v),m=r.useCallback(async()=>{if(!o)return V(void 0,{fromPath:"chat-editing-preset"});if(S("chat_editing_preset_submit_click"),!t){k.error("Scene data not found");return}try{const l=await Ue(s.fileToUpload);if(!l.mediaId)throw new Error("Media failed to upload");const g={sceneId:t.sceneId,preset:"random",mediaIds:[l.mediaId]},p=await _e({input:g});n(y=>{y.lastSubmittedTaskId=p.data?.createChatEditingSceneTask?.id}),document.getElementById("scroll-to-result")?.scrollIntoView({behavior:"smooth"})}catch(l){if(Fe(l)==="INSUFFICIENT_BALANCE"){Re({defaultMode:"packs",reason:a("generation:submit.user-insufficient-credit-buy-more-dialog.description")});return}k.error(l.message)}},[t,o?.id,s.fileToUpload]),c=()=>{if(!d)return;const l=D("/pixai",{task:$(d),showOnStage:"1"});i(l)};return e.jsxs("div",{className:"flex flex-col gap-2 w-full justify-center items-center",children:[e.jsxs(f,{disabled:!s.fileToUpload,busy:"auto",onPress:m,variant:"filled",color:"theme",size:"large",className:"w-80",labelClassName:"flex justify-center items-center gap-2",children:[a(d?"generation:image-to-video.action.submit-again":"generation:image-to-video.action.submit"),o&&e.jsx(De,{value:3e3})]}),d&&s.fileToUpload&&e.jsx(f,{variant:"outlined",className:"w-80",onPress:c,size:"large",children:e.jsx(u,{i18nKey:"generation:image-to-video.action.navigate-generation-panel"})})]})}function vt(){const{sceneId:t}=Ve(),s=$e(t??v),n=W(t?v:{}),a=r.useMemo(()=>t?s:n,[t,s,n]);return!a.loading&&!a.data?e.jsx(_,{to:"/"}):a.data?t?e.jsx(ut,{sceneData:a.data}):e.jsx(_,{to:`/generator/preset/${a.data.sceneId}`,replace:!0}):e.jsx(E,{})}const qt=vt;export{qt as Component};
