import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r as m}from"./vendor-apollo-B9XqHIAo.js";import{a as W,P as q,T as _,f as M,u as T,b as f,g as $,h as D,e as C,t as i,a6 as z,a7 as Q,d as K,U as v,p as Y,a8 as Z,a9 as H,aa as J,ab as X,ac as ee,k as se,ad as ae,ae as ne}from"./index-JhqgbpkX.js";import{_ as P,Z as I}from"./vendor-firebase-BKQqa5bK.js";import{P as U}from"./ProfileEditSection-DYLqWFBC.js";import{u as S}from"./vendor-i18next-TC5y0B3W.js";import{d as te}from"./vendor-react-router-Bm0RsDwP.js";import{q as B,t as O,h as re,j as ie,v as oe}from"./vendor-mui-DTp04zm4.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new s.Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="aa67e280-2e86-4261-8063-86b8844def79",s._sentryDebugIdIdentifier="sentry-dbid-aa67e280-2e86-4261-8063-86b8844def79")})()}catch{}(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s._sentryModuleMetadata=s._sentryModuleMetadata||{},s._sentryModuleMetadata[new s.Error().stack]=function(a){for(var o=1;o<arguments.length;o++){var t=arguments[o];if(t!=null)for(var l in t)t.hasOwnProperty(l)&&(a[l]=t[l])}return a}({},s._sentryModuleMetadata[new s.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();function _e(){const{data:s}=W();return s?e.jsxs(e.Fragment,{children:[e.jsx(U,{heading:e.jsx(_,{i18nKey:"user:profile.account"}),children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(le,{initialValues:s})})}),e.jsx(U,{heading:e.jsx(_,{i18nKey:"user:connect-accounts"}),className:"mt-8",children:e.jsx("div",{className:"flex flex-col gap-8",children:e.jsx(ue,{})})})]}):e.jsx(q,{})}function le({initialValues:s}){return e.jsxs(e.Fragment,{children:[e.jsx(ce,{initialValues:s}),e.jsx(de,{initialValues:s})]})}function ce({initialValues:s}){const{t:a}=S(["auth","common"]),{values:{email:o,emailVerified:t},getValues:l,handleChange:u}=M(s),[{from:d}]=T(),p=te(),[h,n]=m.useState(!1),[x,g]=f(async()=>{const r=await l();if(!r)return;const{email:N}=r;try{const j=await $({input:{email:N}});n(!1),D(j.data?.updateUserSensitiveInfos),await C({input:{intent:P.VerifyEmail,approach:I.Email}}),i.success(`Already send a verification email to ${N}.`)}catch(j){if(z(j)==="INVALID_CODE"){await y();return}i.error(`Failed to update email: ${j?.message}`),console.error(j)}},[]),y=m.useCallback(async()=>{try{await C({input:{intent:P.ChangeEmail,approach:I.Email}}),i.success("Already send a verification email to your current email."),p("/change-email")}catch(r){i.error(`Failed to send verification email: ${r?.message}`),console.error(r)}},[]),[A,L]=f(async()=>{if(!t){n(!0);return}await y()},[s]),[b,c]=m.useState(!1),[F,w]=f(async r=>{if(r)try{await C({input:{intent:P.VerifyEmail,approach:I.Email,origin:window.location.origin,to:d}}),c(!0),i.success(`Already send a verification email to ${r}.`)}catch(N){i.error(`${N?.message}`)}},[s]),[R,G,V]=Q(),E=!!s?.email;return e.jsxs(B,{variant:"standard",children:[e.jsx(O,{shrink:!0,children:a("auth:email")}),h?e.jsxs("div",{className:"flex mt-6 gap-4",children:[e.jsx(K,{fullWidth:!0,value:o,onChange:u("email"),type:"text",autoFocus:!0,onKeyDown:r=>{r.code==="Enter"&&g(),r.code==="Escape"&&n(!1)}}),e.jsx(v,{variant:"filled",className:"w-[100px] h-auto",onPress:g,busy:x,children:a("action:save")}),e.jsx(v,{variant:"outlined",className:"w-[100px] h-auto",onPress:()=>n(!1),disabled:x,children:a("action:cancel")})]}):e.jsxs("div",{className:"mt-6 min-h-[45px] flex gap-4 items-center flex-wrap",children:[e.jsx("span",{children:E?s.email:a("common:not-set")}),e.jsx("span",{className:Y("px-3 text-xs leading-6 font-medium uppercase tracking-wider rounded-full",t?"text-white bg-green-700":"text-yellow-900 bg-yellow-500"),children:E?a(t?"user:profile.verfied":"user:profile.not-verfied"):null}),e.jsx("span",{className:"flex-1"}),E&&!t&&e.jsx("button",{className:"hover:underline",onClick:()=>{b||w(s.email)},children:a(b?"user:profile.sent":"user:profile.resend-verification-email")}),e.jsx("button",{className:"hover:underline",onClick:L,children:a("action:edit")})]}),E&&e.jsx("div",{className:"",children:e.jsx(re,{control:e.jsx(ie,{checked:R,onChange:r=>G(r.target.checked)}),disabled:V,label:a("user:profile.receive-promo-emails")})})]})}function de({initialValues:s}){const{t:a}=S(["auth"]),{values:{email:o,emailVerified:t,passwordEnabled:l,password:u},getValues:d,handleChange:p}=M(s),[h,n]=m.useState(!1),[x,g]=f(async()=>{const c=await d();if(!c)return;const{password:F}=c;if(F)try{const w=await $({input:{password:F}});i.success("Password changed successfully."),n(!1),D(w.data?.updateUserSensitiveInfos)}catch(w){i.error(w?.message)}},[]),[y,A]=m.useState(!1),[L,b]=f(async()=>{try{await C({input:{intent:P.ResetPassword,approach:I.Email}}),A(!0),i.success(`Already sent an email to ${s.email}. Please follow the instructions in the email to continue.`)}catch(c){i.error(`${c?.message}`)}},[s]);return e.jsxs(B,{variant:"standard",children:[e.jsx(O,{shrink:!0,children:a("auth:password")}),h?e.jsxs("div",{className:"flex mt-6 gap-4",children:[e.jsx(K,{fullWidth:!0,value:u,onChange:p("password"),type:"password",autoFocus:!0,onKeyDown:c=>{c.code==="Enter"&&g(),c.code==="Escape"&&n(!1)}}),e.jsx(v,{variant:"filled",className:"w-[100px] h-auto",onPress:g,busy:x,children:a("action:save")}),e.jsx(v,{variant:"outlined",className:"w-[100px] h-auto",onPress:()=>n(!1),disabled:x,children:a("action:cancel")})]}):e.jsxs("div",{className:"mt-6 min-h-[45px] flex gap-4 items-center",children:[e.jsx("span",{className:"flex-1",children:l?"****":"not set"}),t?e.jsx("button",{className:"hover:underline",onClick:()=>{y||b()},children:y?"sent":"reset password"}):e.jsx("button",{className:"hover:underline",onClick:()=>n(!0),children:"edit"})]})]})}function ue(){const[{error:s}]=T(),{t:a}=S(["user"]);return e.jsxs(e.Fragment,{children:[s&&e.jsx(oe,{severity:"warning",children:s}),e.jsx(k,{type:"google"}),e.jsx(k,{type:"twitter"}),e.jsx(k,{type:"discord"}),e.jsx(k,{type:"apple",disabled:!0}),e.jsx("div",{className:"not-prose",children:e.jsx("p",{className:"-mt-6 text-sm",children:a("user:external-accounts.apple.disablement-hint")})})]})}function k({type:s,disabled:a}){const{data:o=[],loading:t,refetch:l}=Z({}),u=m.useMemo(()=>o.find(n=>n.provider===s),[o]),{name:d}=ne[s]||{},[p,h]=f(async()=>{try{await H({title:`Confirm unlink with ${d} account?`}),await J({type:s}),l()}catch(n){if(n===X)return;i.error(`${n?.message}`)}},[s]);return e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:"text-lg font-medium",children:d}),e.jsx("div",{className:"flex gap-4 items-center",children:t?e.jsx(ee,{}):u?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"text-green-600"}),e.jsxs("div",{children:["Connected with ",e.jsx("span",{className:"font-medium",children:u.name})]}),e.jsx(v,{size:"small",color:"danger",busy:p,onPress:h,children:"Unlink"})]}):e.jsxs(ae,{disabled:a,className:"w-[280px]",provider:s,scene:"link",children:["Link with ",d]})})]})}export{_e as Component};
