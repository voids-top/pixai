import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r as w}from"./vendor-apollo-B9XqHIAo.js";import{aP as b,ac as j,T as c,aQ as v,a as C,a8 as I,l as _,m as d,aL as k,ab as f,n as D,t as h,r as P,aR as T,aS as M,aT as E,U as x,ap as N,e as A,aU as R,d as S}from"./index-JhqgbpkX.js";import{f as W,_ as L,Z as U}from"./vendor-firebase-BKQqa5bK.js";import{P as B}from"./ProfileEditSection-DYLqWFBC.js";import{u as p}from"./vendor-i18next-TC5y0B3W.js";import{d as F}from"./vendor-react-router-Bm0RsDwP.js";import{b as K,e as V,f as G,g as $,B as y}from"./vendor-mui-DTp04zm4.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new t.Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="a79c258d-b2a7-4a88-bf23-7ef1e78f448d",t._sentryDebugIdIdentifier="sentry-dbid-a79c258d-b2a7-4a88-bf23-7ef1e78f448d")})()}catch{}(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t._sentryModuleMetadata=t._sentryModuleMetadata||{},t._sentryModuleMetadata[new t.Error().stack]=function(a){for(var n=1;n<arguments.length;n++){var o=arguments[n];if(o!=null)for(var i in o)o.hasOwnProperty(i)&&(a[i]=o[i])}return a}({},t._sentryModuleMetadata[new t.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const O=async(t,{message:a}={})=>{await new Promise(async n=>{const o=await b({fullWidth:!0,maxWidth:"xs",children:e.jsxs("div",{className:"p-8 flex gap-4 items-center",children:[e.jsx(j,{})," ",a]}),afterClose(){n()}});await t(),o.current?.close()})};function be(){return e.jsx(B,{heading:e.jsx(c,{i18nKey:"user:profile.delete-account"}),children:e.jsx("div",{className:"flex flex-col gap-8",children:e.jsx(Y,{})})})}function Q(){const{t}=p(["auth"]);return e.jsxs(e.Fragment,{children:[e.jsx(c,{i18nKey:"auth:delete-account.dialog.description"}),e.jsxs("section",{className:"mt-4",children:[e.jsx("h3",{className:"font-medium",children:e.jsx(c,{i18nKey:"auth:delete-account.dialog.content.title"})}),e.jsx(N,{className:"prose dark:prose-invert prose-sm prose-neutral",children:t("auth:delete-account.dialog.content.content")})]})]})}function Y(){const[t]=v({key:"enable-debug"}),{t:a}=p(["auth","membership"]),{data:n}=C(),{data:o}=I({}),i=F(),[l,m]=_(async r=>{if(d("delete_account_click"),await k.confirm({heading:e.jsx(c,{i18nKey:"auth:delete-account.dialog.title"}),content:r?.force?e.jsx(c,{i18nKey:"auth:delete-account.dialog.description"}):e.jsx(Q,{}),confirmProps:{color:"danger"}})===!1)return d("delete_account",{action:"cancel"});const g=!r?.force&&n?.email&&n.emailVerified?await Z():void 0;if(g===f)return d("delete_account",{action:"cancel",step:"input_code"});try{d("delete_account",{action:"confirm",email:n?.email??"<unknown>",force:r?.force,externalId:(()=>{const s=o?.at(-1);return s?`${s.provider}:${s.externalId}`:"<unknown>"})()}),await D({code:g,force:r?.force}),h.success("Account deleted successfully."),setTimeout(()=>{P(),i("/"),r?.force&&(T(),M())},2e3)}catch(s){h.error(s?.message)}},[n,o]),{data:{membership:u}={}}=E();return e.jsxs(e.Fragment,{children:[u&&e.jsx("div",{className:"contents not-prose",children:e.jsx("p",{children:a("membership:profile-page.no-account-deletion-hint")})}),e.jsx(x,{color:"danger",variant:"outlined",onPress:()=>m(),busy:l.loading,disabled:!!u,className:"w-[300px]",children:a("auth:delete-account.label")}),(t||W.isDev)&&e.jsx(x,{color:"danger",variant:"outlined",onPress:()=>m({force:!0}),busy:l.loading,disabled:!!u,className:"w-fit",children:"Debug only: Force delete account (without delay)"})]})}async function Z(){return await O(async()=>{await Promise.all([A({input:{intent:L.WithdrawAccount,approach:U.Email}}),R(1e3)])},{message:"Sending verification code to your email..."}),await q().catch(t=>t)}async function q(){return new Promise(async(t,a)=>{const n=await b({fullWidth:!0,maxWidth:"xs",onClose:()=>{a(f)},children:e.jsx(z,{onConfirm:o=>{n.current?.close(),t(o)},onCancel:()=>{n.current?.close(),a(f)}})})})}function z({onConfirm:t,onCancel:a}){const{t:n}=p(["action","user"]),[o,i]=w.useState("");return e.jsxs(e.Fragment,{children:[e.jsx(K,{children:n("user:profile.withdraw-verification-code-input-dialog-title")}),e.jsxs(V,{children:[e.jsx(G,{children:n("user:profile.withdraw-verification-code-input-dialog-description")}),e.jsx(S,{fullWidth:!0,autoFocus:!0,value:o,onChange:l=>i(l.target.value),type:"text"})]}),e.jsxs($,{children:[e.jsx(y,{onClick:a,children:n("action:cancel")}),e.jsx(y,{onClick:()=>{t(o)},children:n("action:confirm")})]})]})}export{be as Component};
