import{e as c,j as e,K as d,bD as Z,f as M,c9 as y,ca as r,fD as P,u as f,jt as _,c4 as b,fE as L,fd as I,Q as B,b1 as U,a0 as v,f$ as D,a1 as E,C as p,t as F,bQ as V,i as H,fC as A}from"./index-BTMYyhc6.js";import{f as S,g as R,h as K,i as O,j as q}from"./index-COYvdw4o.js";import{M as G}from"./MediaPreview-CrisSWrJ.js";import{n as Q,B as J,L as W}from"./seo-D6wIoyVq.js";import{d as X}from"./ModelSubmitFormProvider-phtQjuMT.js";import{a as k}from"./formatNum-CBDReyYg.js";import{h as Y}from"./artwork-D9vxumxJ.js";import{m as ee}from"./GeneratorStage-DJGZB2wF.js";import{m as te,h as $,j as z,p as ae}from"./ArtworkListPage-9LI_MBMs.js";import{T as u,g as le}from"./ModelAssetForm-CSHNk3Nd.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="ba7f156a-f372-41ec-8ee2-fd7b093a8f03",t._sentryDebugIdIdentifier="sentry-dbid-ba7f156a-f372-41ec-8ee2-fd7b093a8f03")}catch{}})();{var g=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};g._sentryModuleMetadata=g._sentryModuleMetadata||{},g._sentryModuleMetadata[new Error().stack]=Object.assign({},g._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}const se=c.forwardRef(function({children:a,...l},s){return e.jsx("div",{ref:s,...l,className:d("grid grid-cols-1 grid-rows-1 place-items-center overflow-hidden box-content data-[expanded]:p-[--extent] data-[expanded]:-m-[--extent] transition-all duration-150 ease-out",l.className),style:l.style,children:e.jsx("div",{className:"size-[calc(100%+var(--extent)*2)]",children:a})})}),ne=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsxs("g",{fill:"none",children:[e.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),e.jsx("path",{fill:"currentColor",d:"M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10H4a2 2 0 0 1-2-2v-8C2 6.477 6.477 2 12 2Zm0 12H9a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2Zm3-4H9a1 1 0 0 0-.117 1.993L9 12h6a1 1 0 0 0 .117-1.993L15 10Z"})]})}),ie=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsxs("g",{fill:"none",children:[e.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),e.jsx("path",{fill:"currentColor",d:"m11.514 2.142l-1.26-.755l-.24 1.449C9.632 5.124 8.069 7.25 6.345 8.744C2.97 11.67 2.231 14.85 3.276 17.475c1 2.512 3.538 4.232 6.114 4.519l.596.066c-1.474-.901-2.42-3.006-2.09-4.579c.326-1.546 1.438-2.994 3.574-4.33l1.077-.672l.402 1.205c.237.712.647 1.284 1.064 1.865c.2.28.403.563.589.864c.643 1.045.813 2.207.398 3.36c-.378 1.048-1.001 1.872-1.86 2.329l.97-.108c2.418-.269 4.193-1.096 5.346-2.479C20.599 18.144 21 16.379 21 14.5c0-1.75-.719-3.554-1.567-5.055c-.994-1.758-2.291-3.218-3.707-4.633c-.245.49-.226.688-.73 1.475a8.146 8.146 0 0 0-3.482-4.145Z"})]})}),oe=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsxs("g",{fill:"none",children:[e.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),e.jsx("path",{fill:"currentColor",d:"M12 17a2 2 0 1 1 0 4a2 2 0 0 1 0-4Zm0-7a2 2 0 1 1 0 4a2 2 0 0 1 0-4Zm0-7a2 2 0 1 1 0 4a2 2 0 0 1 0-4Z"})]})}),h=c.createContext({});function Ce(t){const{data:a=t.model,isValidating:l}=Z(t.model?void 0:t.modelId),{data:s}=M(),i={loading:l,selecting:typeof t.selected=="boolean",trainingInProgress:y({trainingTask:{status:r.not(u.completed)}},a),isMyModel:y({authorId:r.intersection(r.string,s==null?void 0:s.id)},a),isPrivate:!!(a!=null&&a.isPrivate),isUserLora:P(a==null?void 0:a.type)};return e.jsx(h.Provider,{value:{model:a,state:i},children:e.jsx(re,{...t})})}function re(t){var x,w;const{model:a,state:l}=c.useContext(h),{t:s}=f(["market"]),[i,o]=c.useState(!1);if(!a)return e.jsx(C,{className:d("aspect-square bg-zinc-200 dark:bg-zinc-700 rounded-[20px]",l.loading&&"animate-pulse",t.className),style:t.style});const m=_(a),n=b({...t,model:a}).with({model:{trainingTask:{status:r.not(u.completed)}}},()=>l.isMyModel,()=>"training-progress").with({model:r.when(L)},()=>l.isMyModel,()=>"category-not-set").with({selected:!1},()=>"unselected").otherwise(()=>null);return e.jsxs(C,{id:`model-card-${a.id}`,link:t.link,className:d("[--extent:5px]","group/model-card","relative isolate aspect-square rounded-[20px] shadow-lg focus:outline outline-[3px] outline-offset-2 outline-zinc-900 dark:outline-zinc-300",t.className),style:t.style,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),onClick:T=>{var j;(j=t.onClick)==null||j.call(t,T,a)},children:[e.jsxs(se,{"data-expanded":i?"":null,className:"relative size-full ring-1 ring-black/10 dark:ring-white/10 rounded-[20px] data-[expanded]:rounded-[calc(20px+var(--extent))]",children:[e.jsx(G,{media:a==null?void 0:a.media,thumbnail:!0,experiments:{safetyBlur:!0},className:"size-full"}),e.jsx("div",{className:d("absolute inset-0 pointer-events-none transition",b(n).with("unselected",()=>"bg-black/20").with(r.string,()=>"bg-black/50").otherwise(()=>d("bg-gradient-to-t from-black/50 from-[40px] to-35%",i&&"opacity-0"))),children:l.trainingInProgress&&e.jsx(de,{model:a})})]}),typeof((x=t.slots)==null?void 0:x.typeLabel)=="function"?t.slots.typeLabel({model:a,typeLabel:e.jsx(N,{model:a})}):e.jsx(N,{model:a,className:"absolute top-2 left-2"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-end w-full py-4 text-white text-shadow shadow-black",children:[n==="category-not-set"&&e.jsx(ce,{onUpdate:t.onUpdate}),m&&e.jsx(me,{}),e.jsx("p",{className:"px-4 line-clamp-3 font-medium",children:(w=a.title)==null?void 0:w.trim()}),!l.isPrivate&&!l.trainingInProgress&&e.jsxs("div",{className:"mt-0.5 -mb-2 -mr-2 flex items-center gap-3 px-4 text-sm",children:[e.jsxs("span",{className:"inline-flex items-center gap-0.5",children:[e.jsx(ie,{className:"size-4 drop-shadow-[0_1px_2px_#000]"}),k(a.refCount)]}),e.jsxs("span",{className:"inline-flex items-center gap-0.5",children:[e.jsx(ne,{className:"size-4 drop-shadow-[0_1px_2px_#000]"}),k(a.commentCount)]}),e.jsx(xe,{model:a,scene:t.scene})]}),l.isPrivate&&e.jsxs("span",{className:"self-start -mb-1.5 ml-2.5 mt-2 inline-flex items-center gap-0.5 h-5 px-1.5 text-black bg-white ring-1 ring-black/20 rounded-full",children:[e.jsx(te,{className:"flex-none size-4"}),e.jsx("span",{className:"text-xs font-medium uppercase text-shadow-none",children:s("market:model.status.unpublished")})]})]}),t.children,e.jsx("div",{className:"absolute top-0 right-0 overflow-visible size-0",children:l.selecting?e.jsxs("div",{className:"contents",children:[e.jsx("input",{type:"checkbox",checked:t.selected,onChange:I,className:"peer absolute invisible",id:`model-card-${a.id}`}),e.jsx("i",{className:"absolute top-1.5 right-1.5 grid place-content-center size-7 text-transparent peer-checked:text-white bg-white/80 peer-checked:bg-purple-600 border-2 peer-checked:border-0 border-black/80 peer-checked:ring-1 ring-black/80 peer-checked:ring-black/10 rounded-full peer-checked:shadow-md",children:e.jsx(ee,{className:"size-5"})})]}):e.jsx(ue,{...t})})]})}function C(t){const{link:a,...l}=t,{model:s,state:i}=c.useContext(h);return b({model:s,state:i,link:a}).with({state:{selecting:!0}},()=>e.jsx("label",{...l,htmlFor:l.id})).with({link:!0,model:{}},{link:r.string.minLength(1)},({link:o,model:m})=>e.jsx(B,{to:o===!0?`https://pixai.art/model/${m.id}`:o,...l})).otherwise(()=>e.jsx("div",{...l}))}function de(t){const{t:a}=f(["market"]);return e.jsx("div",{className:"absolute inset-0 flex flex-col justify-center items-center font-medium text-white text-shadow",children:b(t.model.trainingTask).with({status:u.running,extra:{progress:r.select("progress",r.number),estimatedTotalTime:r.select("estimatedTotalTime",r.number)}},({progress:l,estimatedTotalTime:s})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-3xl",children:[l,"%"]}),e.jsxs("span",{className:"text-sm",children:[a("market:train-lora.model.estimated-time"),":"," ",U.duration(s,"ms").humanize()]})]})).with({status:u.waiting},{status:u.running},()=>e.jsx("span",{className:"text-xl",children:a("market:train-lora.model.waiting")})).with({status:u.failed},()=>e.jsx("span",{className:"text-xl",children:a("market:train-lora.model.failed")})).otherwise(()=>null)})}function ce(t){const{model:a,state:l}=c.useContext(h);return e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-center items-center gap-1 font-medium text-white text-shadow",children:[e.jsx("span",{className:"text-xl",children:e.jsx(v,{i18nKey:"market:submit.messages.await-info-update"})}),a&&e.jsx("button",{className:"h-8 px-2.5 text-sm text-black bg-white rounded-md",onClick:s=>{s.preventDefault(),s.stopPropagation(),$({model:a,mutate:()=>{var i;D(a.id),(i=t.onUpdate)==null||i.call(t)},appendCompForInfo:l.isUserLora?e.jsx(z,{}):void 0,highlightId:"category-field"})},children:e.jsx(v,{i18nKey:"action:update"})})]})}function me(){const{t}=f(["market"]);return e.jsx("div",{className:"flex w-full",children:e.jsx("p",{className:"ml-auto text-sm mr-2 rounded-xl bg-orange-400 font-medium text-shadow-none text-white py-1 px-2",children:t("market:model.content-safety.flagged.label")})})}function N(t){var s;const{t:a}=f(["market"]),l=t.model.type&&le(a,{tags:t.model.tags,type:t.model.type,version:t.model.latestAvailableVersion,trainingTaskStatus:(s=t.model.trainingTask)==null?void 0:s.status});return l&&e.jsx("span",{className:d("inline-flex items-center h-6 px-2 text-xs font-medium uppercase text-black   rounded-[12px]",t.className,l.className),children:l.label})}function ue(t){var m;const{t:a}=f(["action","market","artwork"]),{model:l,state:s}=c.useContext(h),{data:i}=M();if(!l)return null;const o=E([l.isDownloadable&&Y((m=l.latestAvailableVersion)==null?void 0:m.downloadUrl)&&{key:"download",label:a("market:model.download"),onClick:()=>{p("download_model_click",{type:l.type});const n=document.createElement("a");n.href=l.latestAvailableVersion.downloadUrl,n.download="",n.click(),F.info(a("market:model.notice.downloading"))}},i&&!s.isMyModel&&{key:"report",label:a("artwork:action.report"),onClick:()=>{p("report_click"),Q(V.Model,l.id)}},s.isMyModel&&!s.trainingInProgress&&[{key:"edit",label:a("market:model.action.edit-model"),onClick:async()=>{await $({model:l,mutate:t.onUpdate,appendCompForInfo:s.isUserLora?e.jsx(z,{}):void 0})}},s.isPrivate&&!L(l)&&{key:"publish",label:a("action:publish"),onClick:()=>{ae(l.id)}},{key:"delete",label:a("market:model.action.delete-model"),className:"text-red-600 dark:text-red-500",onClick:async()=>{p("delete_click"),await X(l)}}],...t.menu??[]].flat());return o.length===0?null:e.jsxs(S,{modal:!1,children:[e.jsx(R,{asChild:!0,onClick:n=>{n.preventDefault(),n.stopPropagation()},children:e.jsx("button",{className:"absolute top-1.5 right-1.5 flex justify-center items-center size-7 text-white bg-black/50 ring-1 ring-white/30 backdrop-blur rounded-full",children:e.jsx(oe,{className:"size-5"})})}),e.jsx(K,{children:e.jsx(O,{align:"end",className:d("mt-1 overflow-hidden py-2 text-sm bg-white/80 dark:bg-black/80 backdrop-blur ring-1 ring-black/10 dark:ring-white/30 rounded-[12px] rounded-tr shadow-lg origin-top-right !duration-75","data-[state=open]:animate-in","data-[state=open]:fade-in","data-[state=open]:zoom-in-95","data-[state=open]:ease-out","data-[state=closed]:animate-out","data-[state=closed]:fade-out","data-[state=closed]:zoom-out-95","data-[state=closed]:ease-in"),onClick:n=>{n.preventDefault(),n.stopPropagation()},children:o.map(n=>e.jsx(q,{className:d("min-w-[140px] px-4 py-2 hover:bg-black/10 dark:hover:bg-white/10 hover:ring-1 ring-black/10 dark:ring-white/20 outline-none select-none",n.className),style:n.style,onClick:()=>{var x;return(x=n.onClick)==null?void 0:x.call(n,l)},children:n.label},n.key))})})]})}function xe(t){const a=t.scene||"market";return e.jsx(J,{id:t.model.id,initialValue:t.model.liked,initialCount:t.model.likedCount,handler:async(l,s)=>{await H.markGenerationModel({modelId:l,type:A.Like,target:s})},onBtnClick:l=>{l&&p("like_click",{scene:a,type:t.model.type})},render:({value:l,count:s,onClick:i})=>e.jsxs("button",{className:"ml-auto inline-flex items-center gap-1 px-2 py-1 bg-black/50 ring-1 ring-white/20 backdrop-blur rounded-[12px]",onClick:o=>{o.preventDefault(),o.stopPropagation(),i(o)},children:[e.jsx(W,{liked:l,className:"-ml-px size-5"}),e.jsx("span",{className:"text-sm tabular-nums text-shadow-none",children:k(s)})]})})}export{Ce as M,oe as m};
//# sourceMappingURL=ModelCard-CK40-i_d.js.map
