import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r as u}from"./vendor-apollo-B9XqHIAo.js";import{L as v}from"./vendor-react-router-Bm0RsDwP.js";import{p as r,ci as N,a as M,cj as k,ck as g,ce as C,cl as T,cm as L,w as p,cn as I,co as _,cp as z,cq as B,cr as f,T as b,cs as P,ct as E,cu as Z,cv as S,cw as F,cx as A,aj as D,m as H,cy as U,cz as V}from"./index-JhqgbpkX.js";import{e as R,N as o,$ as x,W as G}from"./vendor-firebase-BKQqa5bK.js";import{u as y}from"./vendor-i18next-TC5y0B3W.js";import{n as K}from"./vendor-lodash-992l3ZN7.js";import{d as O}from"./vendor-mui-DTp04zm4.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},l=new t.Error().stack;l&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[l]="9218a854-5e24-4ef7-b50f-c6f1c6dba598",t._sentryDebugIdIdentifier="sentry-dbid-9218a854-5e24-4ef7-b50f-c6f1c6dba598")})()}catch{}(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t._sentryModuleMetadata=t._sentryModuleMetadata||{},t._sentryModuleMetadata[new t.Error().stack]=function(l){for(var a=1;a<arguments.length;a++){var s=arguments[a];if(s!=null)for(var n in s)s.hasOwnProperty(n)&&(l[n]=s[n])}return l}({},t._sentryModuleMetadata[new t.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const q=u.forwardRef(function({children:l,...a},s){return e.jsx("div",{ref:s,...a,className:r("grid grid-cols-1 grid-rows-1 place-items-center overflow-hidden box-content data-[expanded]:p-[--extent] data-[expanded]:-m-[--extent] transition-all duration-150 ease-out",a.className),style:a.style,children:e.jsx("div",{className:"size-[calc(100%+var(--extent)*2)]",children:l})})}),$=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsxs("g",{fill:"none",children:[e.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),e.jsx("path",{fill:"currentColor",d:"M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10H4a2 2 0 0 1-2-2v-8C2 6.477 6.477 2 12 2Zm0 12H9a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2Zm3-4H9a1 1 0 0 0-.117 1.993L9 12h6a1 1 0 0 0 .117-1.993L15 10Z"})]})}),W=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsxs("g",{fill:"none",children:[e.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),e.jsx("path",{fill:"currentColor",d:"m11.514 2.142l-1.26-.755l-.24 1.449C9.632 5.124 8.069 7.25 6.345 8.744C2.97 11.67 2.231 14.85 3.276 17.475c1 2.512 3.538 4.232 6.114 4.519l.596.066c-1.474-.901-2.42-3.006-2.09-4.579c.326-1.546 1.438-2.994 3.574-4.33l1.077-.672l.402 1.205c.237.712.647 1.284 1.064 1.865c.2.28.403.563.589.864c.643 1.045.813 2.207.398 3.36c-.378 1.048-1.001 1.872-1.86 2.329l.97-.108c2.418-.269 4.193-1.096 5.346-2.479C20.599 18.144 21 16.379 21 14.5c0-1.75-.719-3.554-1.567-5.055c-.994-1.758-2.291-3.218-3.707-4.633c-.245.49-.226.688-.73 1.475a8.146 8.146 0 0 0-3.482-4.145Z"})]})}),h=u.createContext({});function de(t){const{data:l=t.model,isValidating:a,mutate:s}=N(t.model?void 0:t.modelId),{data:n}=M(),i=k(l),d={loading:a,selecting:typeof t.selected=="boolean",trainingInProgress:g(l?.type)&&i.length>0,isMyModel:R({authorId:o.intersection(o.string,n?.id)},l),isPrivate:!!l?.isPrivate,isUserLora:g(l?.type)},m={mutate:t.model?t.mutateModels:s};return e.jsx(h.Provider,{value:{model:l,state:d,action:m},children:e.jsx(Y,{...t})})}function Y(t){const{model:l,state:a}=u.useContext(h),{t:s}=y(["market"]),n=C(),[i,d]=u.useState(!1);if(!l)return e.jsx(w,{className:r("aspect-square bg-zinc-200 dark:bg-zinc-700 rounded-[20px]",a.loading&&"animate-pulse",t.className),style:t.style});const m=x({...t,model:l}).with({model:{type:o.when(g)}},()=>a.isMyModel&&a.trainingInProgress,()=>"training-progress").with({model:o.when(T)},()=>a.isMyModel,()=>"category-not-set").with({model:{latestAvailableVersion:o.nullish}},()=>"no-available-versions").with({selected:!1},()=>"unselected").otherwise(()=>null);return e.jsxs(w,{id:`model-card-${l.id}`,link:t.link,className:r("[--extent:5px]","group/model-card","relative isolate aspect-square rounded-[20px] shadow-lg focus:outline outline-[3px] outline-offset-2 outline-zinc-900 dark:outline-zinc-300",t.className),style:t.style,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onClick:c=>{t.onClick?.(c,l)},children:[e.jsxs(q,{"data-expanded":i?"":null,className:"relative size-full ring-1 ring-black/10 dark:ring-white/10 rounded-[20px] data-[expanded]:rounded-[calc(20px+var(--extent))]",children:[e.jsx(L,{mediaId:l?.mediaId,thumbnail:!0,experiments:{safetyBlur:l.flag?.shouldBlur},className:"size-full"}),e.jsx("div",{className:r("absolute inset-0 pointer-events-none transition",x(m).with("unselected",()=>"bg-black/20").with(o.string,()=>"bg-black/50").otherwise(()=>r("bg-gradient-to-t from-black/50 from-[40px] to-35%",i&&"opacity-0"))),children:a.trainingInProgress&&e.jsx(J,{model:l})})]}),typeof t.slots?.typeLabel=="function"?t.slots.typeLabel({model:l,typeLabel:e.jsx(j,{model:l})}):e.jsx(j,{model:l,className:"absolute top-2 left-2"}),e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-end w-full py-4 text-white text-shadow shadow-black",children:[x(m).with("category-not-set",()=>e.jsx(X,{onUpdate:t.onUpdate})).with("no-available-versions",()=>e.jsx(Q,{})).otherwise(()=>null),e.jsx("p",{className:"px-4 line-clamp-3 font-medium",children:l.title?.trim()}),!a.isPrivate&&!a.trainingInProgress&&e.jsxs("div",{className:"mt-0.5 -mb-2 -mr-2 flex items-center gap-3 px-4 text-sm",children:[e.jsxs("span",{className:"inline-flex items-center gap-0.5",children:[e.jsx(W,{className:"size-4 drop-shadow-[0_1px_2px_#000]"}),p(l.refCount)]}),e.jsxs("span",{className:"inline-flex items-center gap-0.5",children:[e.jsx($,{className:"size-4 drop-shadow-[0_1px_2px_#000]"}),p(l.commentCount)]}),n?null:e.jsx(ee,{model:l,scene:t.scene})]}),a.isPrivate&&e.jsxs("span",{className:"self-start -mb-1.5 ml-2.5 mt-2 inline-flex items-center gap-0.5 h-5 px-1.5 text-black bg-white ring-1 ring-black/20 rounded-full",children:[e.jsx(I,{className:"flex-none size-4"}),e.jsx("span",{className:"text-xs font-medium uppercase text-shadow-none",children:s("market:model.status.unpublished")})]})]}),t.children,e.jsx("div",{className:"absolute top-0 right-0 overflow-visible size-0",children:a.selecting?e.jsxs("div",{className:"contents",children:[e.jsx("input",{type:"checkbox",checked:t.selected,onChange:K,className:"peer absolute invisible",id:`model-card-${l.id}`}),e.jsx("i",{className:"absolute top-1.5 right-1.5 grid place-content-center size-7 text-transparent peer-checked:text-white bg-white/80 peer-checked:bg-purple-600 border-2 peer-checked:border-0 border-black/80 peer-checked:ring-1 ring-black/80 peer-checked:ring-black/10 rounded-full peer-checked:shadow-md",children:e.jsx(_,{className:"size-5"})})]}):e.jsx(e.Fragment,{children:e.jsx(z,{extra:l.extra,artworkSafetyScore:l.artworkSafetyScore,children:c=>e.jsx("div",{className:"absolute top-1.5 right-1.5 bg-black/50 py-[2px] px-2 w-max rounded-xl ring-1 ring-white/30 backdrop-blur",children:c})})})})]})}function w(t){const{link:l,...a}=t,{model:s,state:n}=u.useContext(h);return x({model:s,state:n,link:l}).with({state:{selecting:!0}},()=>e.jsx("label",{...a,htmlFor:a.id})).with({link:!0,model:{}},{link:o.string.minLength(1)},({link:i,model:d})=>e.jsx(v,{to:i===!0?B(d):i,...a})).otherwise(()=>e.jsx("div",{...a}))}function J(t){const{t:l}=y(["market"]),a=k(t.model);return e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-center items-center font-medium text-white text-shadow",children:[x(a[0]).with({status:f.running,extra:{progress:o.select("progress",o.number),estimatedTotalTime:o.select("estimatedTotalTime",o.number)}},({progress:s,estimatedTotalTime:n})=>e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-3xl",children:[s,"%"]}),e.jsxs("span",{className:"text-sm",children:[l("market:train-lora.model.estimated-time"),":"," ",O.duration(n,"ms").humanize()]})]})).with({status:f.waiting},{status:f.running},()=>e.jsx("span",{className:"text-xl",children:l("market:train-lora.model.waiting")})).with({status:f.failed},()=>e.jsx("span",{className:"text-xl",children:l("market:train-lora.model.failed")})).otherwise(()=>null),a.length>1&&e.jsx("span",{className:"text-xl",children:l("market:train-lora.model.and-more-tasks",{count:a.length-1})})]})}function Q(){return e.jsx("div",{className:"absolute inset-0 flex flex-col justify-center items-center gap-1 font-medium text-white text-shadow",children:e.jsx("span",{className:"text-xl",children:e.jsx(b,{i18nKey:"market:model.versions-empty"})})})}function X(t){const{model:l,state:a}=u.useContext(h);return e.jsxs("div",{className:"absolute inset-0 flex flex-col justify-center items-center gap-1 font-medium text-white text-shadow",children:[e.jsx("span",{className:"text-xl",children:e.jsx(b,{i18nKey:"market:submit.messages.await-info-update"})}),l&&e.jsx("button",{className:"h-8 px-2.5 text-sm text-black bg-white rounded-md",onClick:s=>{s.preventDefault(),s.stopPropagation(),P({model:l,mutate:()=>{V(l.id),t.onUpdate?.()},highlightId:"category-field"})},children:e.jsx(b,{i18nKey:"action:update"})})]})}function j(t){const{t:l}=y(["market"]),a=t.model.type&&E(l,{tags:t.model.tags,type:t.model.type}),s=Z(t.model.extra),n=S(t.model)??[],i=a&&e.jsx("span",{className:r("inline-flex items-center h-6 px-2 text-xs font-medium uppercase text-black rounded-[12px]",a.bgClassName),children:a.label}),d=F(t.model.type)&&n.length>0&&e.jsx("span",{className:"inline-flex items-center",children:n.map(c=>e.jsx("span",{className:r("inline-flex items-center h-6 px-1 text-xs font-medium uppercase text-black first-of-type:rounded-l-[12px] first-of-type:pl-2 last-of-type:rounded-r-[12px] last-of-type:pr-2",c.bgClassName),children:c.label},c.label))}),m=s&&e.jsx("span",{className:r("inline-flex items-center h-6 px-2 text-xs font-medium uppercase text-white rounded-[12px]",s.bgClassName),children:s.label});return e.jsxs("div",{className:r("flex items-center gap-1",t.className),children:[i,d,m]})}function ee(t){const l=t.scene||"market";return e.jsx(A,{id:t.model.id,initialValue:t.model.liked,initialCount:t.model.likedCount,handler:async(a,s)=>{await D.markGenerationModel({modelId:a,type:G.Like,target:s})},onBtnClick:a=>{a&&H("like_click",{scene:l,type:t.model.type})},render:({value:a,count:s,onClick:n})=>e.jsxs("button",{className:"ml-auto inline-flex items-center gap-1 px-2 py-1 bg-black/50 ring-1 ring-white/20 backdrop-blur rounded-[12px]",onClick:i=>{i.preventDefault(),i.stopPropagation(),n(i)},children:[e.jsx(U,{liked:a,className:"-ml-px size-5"}),e.jsx("span",{className:"text-sm tabular-nums text-shadow-none",children:p(s)})]})})}export{de as M};
