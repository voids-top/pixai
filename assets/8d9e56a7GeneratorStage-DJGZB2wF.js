import{gW as fs,j as t,cH as Pe,e as l,gX as gs,c4 as be,ca as _,gY as xs,gZ as bs,g_ as ps,g$ as js,K as C,eU as vs,c9 as tt,dx as ws,h0 as ys,a1 as ge,h1 as ks,h2 as Is,dj as J,B as O,b7 as We,T as Dt,h3 as Cs,h4 as Ns,di as Et,u as $,f1 as Ms,bS as at,bU as Ft,bv as ae,C as T,P as ne,bV as Rt,$ as De,J as zt,a8 as Bt,bW as Vt,h5 as Ss,g7 as pe,h6 as oe,t as F,a0 as D,a7 as Ee,i as W,aM as st,h7 as Ts,h8 as _s,H as de,fg as Fe,U as K,bx as nt,h9 as it,ha as qe,cR as $s,gy as je,gz as Ut,hb as _e,hc as Ls,l as As,h as ve,hd as vt,he as q,hf as Ps,b8 as Ds,cf as Es,F as we,b9 as Ke,az as Ht,aB as re,aC as Ze,d8 as Fs,bX as Rs,a6 as ue,b2 as Q,ap as zs,b as Gt,gg as lt,hg as Bs,dp as Vs,aV as Ot,bn as Wt,fy as Us,cK as rt,I as qt,de as Kt,Q as Zt,cD as Qt,f as ye,hh as Hs,aP as Xt,b1 as Y,fA as Gs,hi as Os,hj as Ws,hk as qs,fV as Ks,ch as Zs,hl as Qs,cC as wt,hm as U,aG as ot,gs as Xs,gt as Ys,by as Yt,ab as ct,ac as $e,bm as Jt,gb as Js,gp as en,bH as Ue,bi as ea,b6 as tn,E as ta,ec as aa,fY as sa,fH as Me,bw as na,hn as an,eb as ia,gC as la,ho as ra,aa as oa,hp as ca,hq as da,hr as ma,hs as ce,ai as te,ht as Se,hu as ua,hv as sn,hw as nn,hx as ln,g8 as rn,hy as on,da as ha,hz as cn,cI as Qe,db as Xe,f2 as He,cc as fa,hA as dn,hB as mn,hC as ga,fd as un,bQ as hn,c0 as fn,hD as gn,hE as xn,aq as bn,dl as pn}from"./index-BTMYyhc6.js";import{S as jn,i as vn,w as wn,I as yn,m as kn,a as In,G as Cn}from"./baseline-circle-DKv3JZ6t.js";import{S as he,u as dt,G as se,H as xa,a as ba,b as pa,F as ja,I as va,$ as wa,c as Nn,d as Mn,e as Sn,m as Tn,L as ya,W as _n}from"./index-COYvdw4o.js";import{i as $n}from"./baseline-delete-outline-B3-PwQHh.js";import{i as Ln}from"./baseline-edit-CrCwmctU.js";import{i as ka,W as An}from"./AppLayout-Bx68cLmY.js";import{d as mt,a as Ia,b as Ca}from"./utils-CORjiwlf.js";import{d as Na}from"./defaults-DtvpRUtA.js";import{C as Pn}from"./CircularSpinner-nWd4HBSC.js";import{d as Ma}from"./InspectDialog-BPHcKRwz.js";import{U as ke}from"./unFile-B3RwQvIR.js";import{o as Dn}from"./baseline-add-XAdAsUn_.js";import{A as En}from"./ArtworkInfoForm-BbAax4Gm.js";import{a as Sa}from"./imageUtil-NFh1c57i.js";import{$ as Fn,f as Rn,g as zn,b as yt}from"./Tab-BLMS8a9U.js";import{S as xe}from"./Slider-0j-9tQ0Y.js";import{C as Ta,a as _a}from"./ControlSection-BIQjDNv8.js";import{i as Bn}from"./baseline-keyboard-arrow-down-CRihOzH-.js";import{Q as $a}from"./QuotaBalance-DP6pnxJ0.js";import{M as Le}from"./MenuItem-DLax9T5L.js";import{g as Vn}from"./cursorPagingUtils-YTUXhLAt.js";import{T as Un,a as Hn,b as Gn,S as Ge,f as On}from"./dismiss-24-filled-DmGl87MD.js";import{T as Wn,a as qn,b as Te,c as Z,d as Kn}from"./TableRow-qxF9QOyo.js";import{G as Zn}from"./index-Cpf8OWOQ.js";import{b as Qn}from"./_baseSlice-CD5g_G3g.js";import{M as La}from"./MediaPreview-CrisSWrJ.js";import{u as Ye}from"./pagination-B34yMghJ.js";import{i as Xn}from"./round-plus-RCIMN6sR.js";import{u as kt}from"./uniqBy-DWZdfvgJ.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="268f3c72-9318-4e57-af9e-00dca2055f65",e._sentryDebugIdIdentifier="sentry-dbid-268f3c72-9318-4e57-af9e-00dca2055f65")}catch{}})();{var Ce=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};Ce._sentryModuleMetadata=Ce._sentryModuleMetadata||{},Ce._sentryModuleMetadata[new Error().stack]=Object.assign({},Ce._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}var Yn=Math.ceil,Jn=Math.max;function ei(e,a,s){a===void 0?a=1:a=Jn(fs(a),0);var n=e==null?0:e.length;if(!n||a<1)return[];for(var i=0,r=0,d=Array(Yn(n/a));i<n;)d[r++]=Qn(e,i,i+=a);return d}const ut=(e,a)=>{var r,d,o,c,u;const s={...(r=e==null?void 0:e.extra)==null?void 0:r.externalParameters,...a==null?void 0:a.parameters,...(d=a==null?void 0:a.outputs)==null?void 0:d.detailParameters},n=ti(e,a),i=(e==null?void 0:e.prompts)??(e!=null&&e.hidePrompts||(o=a==null?void 0:a.parameters)==null?void 0:o.prompts);return{...n&&!(e!=null&&e.hidePrompts)?{prompts:n,enablePromptsRewrite:!0}:{prompts:i,enablePromptsRewrite:!1},negativePrompts:s.negativePrompts||s.negative_prompt,samplingSteps:s.samplingSteps||s.steps,samplingMethod:s.samplingMethod||s.sample,cfgScale:s.cfgScale||s.cfg_scale,seed:s.seed,modelId:s.modelId,controlNets:((c=a==null?void 0:a.parameters)==null?void 0:c.controlNets)??[],lora:s.lora,upscale:s.upscale,upscaleDenoisingSteps:s.upscaleDenoisingSteps,upscaleDenoisingStrength:s.upscaleDenoisingStrength,batchSize:s.batchSize==null?1:s.batchSize===3?4:s.batchSize,enableADetailer:s.enableADetailer,clipSkip:s.clipSkip,vaeModelId:s.vaeModelId,ipAdapter:s.ipAdapter?{...s.ipAdapter,imagesAreValid:!0}:void 0,qualityTag:s.qualityTag?s.qualityTag:void 0,styleMix:(u=s.styleMix)!=null&&u.enabled?s.styleMix:void 0,lightning:s.lightning}};function ti(e,a){var s,n,i;return((s=e==null?void 0:e.extra)==null?void 0:s.naturalPrompts)||((i=(n=a==null?void 0:a.parameters)==null?void 0:n.extra)==null?void 0:i.naturalPrompts)}const ai=e=>t.jsx("svg",{viewBox:"0 0 16 16",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M5.74 3.2a.75.75 0 0 0-.04 1.06L9.227 8L5.7 11.74a.75.75 0 1 0 1.1 1.02l4-4.25a.75.75 0 0 0 0-1.02l-4-4.25a.75.75 0 0 0-1.06-.04"})}),si=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsxs("g",{fill:"none",fillRule:"evenodd",children:[t.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),t.jsx("path",{fill:"currentColor",d:"M21.546 5.111a1.5 1.5 0 0 1 0 2.121L10.303 18.475a1.6 1.6 0 0 1-2.263 0L2.454 12.89a1.5 1.5 0 1 1 2.121-2.121l4.596 4.596L19.424 5.111a1.5 1.5 0 0 1 2.122 0Z"})]})});function ni(e){const a=l.useContext(gs);return be(e).with({children:_.array(_.when(l.isValidElement))},s=>!!a,s=>t.jsx(xs,{children:s.children})).with({onOpenChange:_.optional(_.any)},s=>t.jsx(bs,{onOpenChange:s.onOpenChange,children:s.children})).otherwise(()=>null)}function ii(e){return t.jsx(ps,{id:e.id,className:"col-span-full -mx-1 my-1 border-t border-black/10 dark:border-white/10"})}function Hr(e){return t.jsx(js,{...e,className:C("col-span-full flex items-center h-7 px-2 text-xs",e.className),children:e.children})}const Je=l.createContext({isRoot:!0});function li(e){const a=l.useContext(Je);return t.jsx(Je.Provider,{value:{isRoot:!a},children:e.children})}const ri=Pe({slots:{popover:["entering:animate-in","entering:fade-in","entering:data-[placement=top]:slide-in-from-bottom-1","entering:data-[placement=bottom]:slide-in-from-top-1","entering:data-[placement=left]:slide-in-from-right-1","entering:data-[placement=right]:slide-in-from-left-1","exiting:animate-out","exiting:fade-out","exiting:data-[placement=top]:slide-out-to-bottom-1","exiting:data-[placement=bottom]:slide-out-to-top-1","exiting:data-[placement=left]:slide-out-to-right-1","exiting:data-[placement=right]:slide-out-to-left-1"],menu:["grid grid-cols-[auto_1fr_auto] min-w-[100px] max-h-[inherit] p-1 overflow-auto text-sm rounded-lg ring-1 shadow-lg outline-none","bg-white ring-black/20","dark:bg-zinc-700 dark:ring-white/20 dark:shadow-black/20"]}}),et=Symbol("menu separator");function Aa(e){const a=l.useContext(Je),s=l.useContext(vs),n=l.useRef(null);n.current=oi(s);const i=l.useMemo(()=>{var o;return e.items&&((o=Array.from(e.items))==null?void 0:o.map((c,u)=>c===et?{id:`sep-${u}`,type:"separator"}:c))},[e.items]),r=l.useCallback(o=>typeof e.children=="function"?tt({id:_.string,type:"separator"},o)?t.jsx(ii,{id:o.id}):e.children(o):e.children,[e]),d=ri();return t.jsx(li,{children:t.jsx(ws,{triggerRef:n,placement:e.placement,offset:a.isRoot?4:0,crossOffset:a.isRoot?0:-4,className:d.popover(),children:t.jsx(ys,{items:i,onAction:e.onAction,selectionMode:e.selectionMode,selectedKeys:e.selectedKeys,onSelectionChange:e.onSelectionChange,className:d.menu({className:e.className}),style:e.style,children:typeof e.children=="function"?r:e.children})})})}Aa.compact=e=>{const a=ge(e);return a.slice(a.findIndex(s=>s!==et),a.findLastIndex(s=>s!==et)+1)};function oi(e){var s;const a=e&&"triggerRef"in e?(s=e.triggerRef)==null?void 0:s.current:void 0;return(a==null?void 0:a.querySelector("[data-ref-caret]"))??a}const ci=Pe({slots:{root:"col-span-full grid grid-cols-subgrid items-center min-h-8 rounded outline-none cursor-default",icon:"col-start-1 inline-grid place-content-center min-w-2.5",label:"col-start-2 py-1",caret:"col-start-3 self-stretch inline-grid justify-end items-center min-w-2.5 text-neutral-600 dark:text-neutral-400",description:"col-start-2 mb-1 text-xs text-neutral-500"},variants:{color:{normal:{root:["hover:bg-black/5 focus-visible:bg-black/5 open:bg-black/5","dark:hover:bg-white/5 dark:focus-visible:bg-white/5 dark:open:bg-white/5"]},danger:{root:["text-red-600 dark:text-red-500 hover:!text-white focus-visible:!text-white open:!text-white","hover:bg-red-600 focus-visible:bg-red-600 open:bg-red-600","dark:hover:bg-red-500 dark:focus-visible:bg-red-500 dark:open:bg-red-500"]},warning:{root:["text-orange-600 dark:text-orange-500 hover:!text-white focus-visible:!text-white open:!text-white","hover:bg-orange-600 focus-visible:bg-orange-600 open:bg-orange-600","dark:hover:bg-orange-500 dark:focus-visible:bg-orange-500 dark:open:bg-orange-500"]},admin:{root:["text-amber-600 hover:bg-amber-100 focus-visible:bg-amber-100 open:bg-amber-100","dark:text-amber-500 dark:hover:bg-amber-500/10 dark:focus-visible:bg-amber-500/10 dark:open:bg-amber-500/10"]}},disabled:{true:{root:"opacity-50"}}},defaultVariants:{color:"normal",disabled:!1}});function di(e){const a=ci({color:e.color,disabled:e.disabled});return t.jsx(ks,{id:e.id,textValue:e.textValue,isDisabled:e.disabled,className:a.root({className:e.className}),style:e.style,onAction:e.onAction,children:({selectionMode:s,isSelected:n,hasSubmenu:i})=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:a.icon({className:(e.icon||s!=="none")&&"size-8"}),children:n?s==="multiple"?t.jsx(si,{className:"size-3"}):t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 10",className:"size-1.5",children:t.jsx("circle",{cx:"5",cy:"5",r:"5",fill:"currentColor"})}):e.icon}),t.jsx("div",{className:a.label(),children:e.children}),t.jsx("span",{"data-ref-caret":"",className:a.caret({className:i&&"w-4 ml-4"}),children:i&&t.jsx(ai,{className:"size-4"})}),e.description&&t.jsx("p",{className:a.description(),children:t.jsx(Is,{slot:"description",children:e.description})})]})})}const mi=e=>t.jsx("svg",{viewBox:"0 0 20 20",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M7.398 12.809a1.04 1.04 0 0 0 1.204-.003c.178-.13.313-.31.387-.518l.447-1.373a2.34 2.34 0 0 1 1.477-1.479l1.391-.45a1.045 1.045 0 0 0-.044-1.98l-1.375-.448a2.34 2.34 0 0 1-1.48-1.477l-.452-1.388a1.044 1.044 0 0 0-1.973.017l-.457 1.4a2.34 2.34 0 0 1-1.44 1.45l-1.39.447a1.045 1.045 0 0 0 .016 1.974l1.374.445a2.33 2.33 0 0 1 1.481 1.488l.452 1.391c.072.204.206.38.382.504m6.137 4.042a.806.806 0 0 0 1.226-.398l.248-.762a1.1 1.1 0 0 1 .26-.42c.118-.12.262-.208.42-.26l.772-.252a.8.8 0 0 0-.023-1.52l-.764-.25a1.08 1.08 0 0 1-.68-.678l-.252-.773a.8.8 0 0 0-1.518.01l-.247.762a1.07 1.07 0 0 1-.665.679l-.773.252a.8.8 0 0 0 .008 1.518l.763.247c.16.054.304.143.422.261c.119.119.207.263.258.422l.253.774a.8.8 0 0 0 .292.388"})}),ui=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"m19.713 8.128l-.246.566a.506.506 0 0 1-.934 0l-.246-.566a4.36 4.36 0 0 0-2.22-2.25l-.759-.339a.53.53 0 0 1 0-.963l.717-.319a4.37 4.37 0 0 0 2.251-2.326l.253-.611a.506.506 0 0 1 .942 0l.253.61a4.37 4.37 0 0 0 2.25 2.327l.718.32a.53.53 0 0 1 0 .962l-.76.338a4.36 4.36 0 0 0-2.219 2.251M3.993 3H13v2H5v14h14v-8h2v9.007a.994.994 0 0 1-.993.993H3.993A.993.993 0 0 1 3 20.007V3.993C3 3.445 3.445 3 3.993 3m6.629 5.415l4.879 3.252a.4.4 0 0 1 0 .666l-4.88 3.252a.4.4 0 0 1-.621-.332V8.747a.4.4 0 0 1 .622-.332"})}),hi=J(O);J(We);J(Dt);function fi(e){return Cs.post("/blip2_and_wd",{media_id:e.mediaId,param_dict:{}})}function gi({open:e,onClose:a,children:s}){const{t:n}=$(["artwork"]),i=Ms("(max-width:1200px)");return t.jsxs(at,{dismissable:!0,open:e,onClose:a,type:i?"drawer":"dialog",className:"w-screen max-w-screen-lg",children:[t.jsx(Ft,{heading:n("artwork:captioning.title"),children:({heading:r})=>t.jsxs(t.Fragment,{children:[r,t.jsx("p",{className:"text-sm text-gray-500",children:n("artwork:captioning.subtitle")})]})}),s]})}const xi=Ns(e=>fi({mediaId:e}).then(a=>a.data),{revalidateOnFocus:!1,revalidateOnReconnect:!1,revalidateIfStale:!1}),bi=e=>{const{data:a,isValidating:s}=xi(e);return l.useMemo(()=>{var i;return{data:(i=a==null?void 0:a.output)==null?void 0:i.map(r=>({id:Ss(),prompt:r})),isValidating:s}},[a,s])};function pi({type:e,media:a,mediaId:s,onRemoveMedia:n,onConfirmPrompt:i}){const{t:r}=$(["artwork","action"]),[d,o]=l.useState(),[c,u]=l.useState("simple-select"),[h,m]=l.useState(),{data:f,isValidating:p}=bi(s),{data:b,isValidating:v}=ae(a?void 0:s),k=a??b;l.useEffect(()=>{(f==null?void 0:f[0])&&u("simple-select")},[f]),l.useEffect(()=>{T("captioning_begin",{mediaId:s})},[s]),l.useEffect(()=>{f&&T("captioning_received_response",{mediaId:s})},[s,f]);const w=l.useMemo(()=>c==="simple-select"?{children:r("action:confirm"),disabled:!d,onClick:()=>{var x;if(d){i==null||i(d);const g=((x=f==null?void 0:f.filter(j=>j.id!==d.id))==null?void 0:x.map(j=>j.prompt))??[];T("captioning_confirmed_selection",{mediaId:s,formType:e,source:"simple-select",preferredPrompts:[d.prompt],dislikedPrompts:g})}}}:c==="unsatisfied-select"?{children:r("action:next"),disabled:!d,onClick:()=>{m(d==null?void 0:d.prompt),u("input"),T("captioning_entered_edit",{mediaId:s})}}:{children:r("action:confirm"),onClick:()=>{var x;if(d&&h){i==null||i({...d,prompt:h});const g=((x=f==null?void 0:f.filter(j=>j.id!==d.id))==null?void 0:x.map(j=>j.prompt))??[];T("captioning_confirmed_selection",{mediaId:s,formType:e,source:"unsatisfied-edit",preferredPrompts:[h],dislikedPrompts:g})}}},[c,d,h,i,r,s]);return!k&&!v?t.jsx(ne,{}):t.jsxs(t.Fragment,{children:[t.jsx(Rt,{children:t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 overflow-y-auto min-w-0 min-h-0",children:[t.jsxs("div",{className:"flex overflow-hidden rounded-lg md:w-1/3 flex-shrink-0 border border-solid border-black/10 dark:border-white/10 relative",children:[t.jsx("img",{src:De(k),className:"w-full h-auto object-contain"}),n&&t.jsx(zt,{className:"absolute right-0 top-0",onClick:n,children:t.jsx(Bt,{})})]}),t.jsx(J.div,{className:"flex flex-col gap-2 justify-stretch flex-grow",children:p?t.jsx(vi,{}):t.jsxs(t.Fragment,{children:[c==="unsatisfied-select"&&t.jsxs(J.div,{className:"flex flex-col items-start mb-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[t.jsx("div",{className:"text-base font-bold",children:r("artwork:captioning.select-and-edit.title")}),t.jsx("div",{className:"text-sm opacity-80",children:r("artwork:captioning.select-and-edit.subtitle")})]}),["simple-select","unsatisfied-select"].includes(c)&&(f==null?void 0:f.map(x=>t.jsx(wi,{layout:!0,layoutId:"captioning-prompt-select-button::"+x.id,active:(d==null?void 0:d.id)===x.id,onSelectPrompt:()=>o({id:x.id,originalPrompt:x.prompt,prompt:x.prompt}),prompt:x.prompt},x.id))),c==="input"&&t.jsx(J.div,{layout:!0,layoutId:"captioning-prompt-select-button::"+(d==null?void 0:d.id),initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"rounded-lg flex flex-col items-center",children:t.jsx(Dt,{multiline:!0,minRows:3,maxRows:5,fullWidth:!0,value:h,label:r("artwork:captioning.edit-prompt"),variant:"outlined",autoFocus:!0,onChange:x=>m(x.target.value)})}),c==="simple-select"&&t.jsx(O,{variant:"outlined",size:"large",onClick:()=>u("unsatisfied-select"),children:r("artwork:captioning.no-good-prompt")})]})})]})}),t.jsx(Vt,{children:t.jsx(O,{variant:"contained",className:"max-mlg:w-full",...w})})]})}const ji={hidden:{opacity:0},visible:{opacity:1}};function vi(){return t.jsx(t.Fragment,{children:Array.from({length:4}).map((e,a)=>t.jsx(J.div,{className:"bg-skeleton h-24 rounded-lg p-4",initial:"hidden",animate:"visible",variants:ji,transition:{repeat:1/0,repeatType:"reverse",delay:a*.1,duration:1.2},children:t.jsx("div",{className:"flex flex-col gap-2 items-start justify-center overflow-hidden",children:Array.from({length:3}).map((s,n)=>t.jsx(J.div,{className:C("bg-slate-700/20 h-4",n===2?"w-3/4":"w-full"),initial:{x:-48,opacity:0},animate:{x:0,opacity:1},transition:{repeat:1/0,repeatType:"reverse",delay:a*.25,duration:1.5}},n))})},a))})}const wi=J(({prompt:e,active:a,onSelectPrompt:s})=>{const n=l.useCallback(()=>{s()},[s]),i=l.useMemo(()=>{const r=e.split(",");return r.length<2?{diff:e,same:""}:{diff:r[0],same:r.slice(1).join(",").trim()}},[e]);return t.jsx(Et,{children:t.jsx(hi,{layout:!0,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},variant:"contained",className:C("border border-solid p-4 text-base text-left",a?"bg-purple-600 border-purple-700 text-white":"bg-white border-gray-300 text-primary"),onClick:n,children:t.jsxs("div",{className:"block w-full",children:[t.jsx("span",{className:C("rounded-lg px-1 py-0.5",a?"bg-purple-800":"bg-purple-100"),children:i.diff}),t.jsx("span",{className:"px-1 py-0.5",children:i.same})]})})})});function yi(){const[e,a]=l.useContext(he),{setValues:s}=pe(),{data:n}=oe(e.taskId),i=()=>{a({openCaptioningDialog:!1})},[r,d]=l.useMemo(()=>{var o,c,u,h;return e.mediaIdx!==void 0?[(u=(c=(o=n==null?void 0:n.outputs)==null?void 0:o.batch)==null?void 0:c[e.mediaIdx])==null?void 0:u.mediaId]:[(h=n==null?void 0:n.media)==null?void 0:h.id,n==null?void 0:n.media]},[n,e]);return e!=null&&e.openCaptioningDialog&&(!n||!r)?t.jsx(ne,{}):t.jsx(gi,{open:!!(e!=null&&e.openCaptioningDialog),onClose:()=>{i()},children:!!(e!=null&&e.openCaptioningDialog)&&t.jsx(pi,{type:"base-image",media:d,mediaId:r,onConfirmPrompt:o=>{s(c=>({...c,prompts:o==null?void 0:o.prompt})),i()}})})}const Pa=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"m14 4l2.29 2.29l-2.88 2.88l1.42 1.42l2.88-2.88L20 10V4zm-4 0H4v6l2.29-2.29l4.71 4.7V20h2v-8.41l-5.29-5.3z"})});async function ht(e,a){const s=await Da(e);if(!s)return F.error(l.createElement(D,{i18nKey:"artwork:delete-task.notice.resolve-task-failed"})),!1;const n=_s(s);if((a==null?void 0:a.skipConfirm)||await Ee(Na(a==null?void 0:a.dialogProps,{title:l.createElement(D,{i18nKey:"artwork:delete-task.confirm-dialog.title"}),description:l.createElement(l.Fragment,null,[l.createElement("p",null,l.createElement(D,{i18nKey:"artwork:delete-task.confirm-dialog.description.content"})),n?l.createElement("p",{className:"text-red-600 dark:text-red-500"},l.createElement(D,{i18nKey:"artwork:delete-task.confirm-dialog.description.fav-del-reminder"})):null])})).then(()=>!0,()=>!1)){try{return await W.deleteGenerationTask({taskId:s.id}),F.success(l.createElement(D,{i18nKey:"artwork:delete-task.notice.success"})),!0}catch(r){F.error(l.createElement("p",null,[l.createElement(D,{i18nKey:"artwork:delete-task.notice.fail"}),` (${String(r)})`]))}return!1}}async function ki(e,a,s){const n=await Da(e);if(!n)return F.error(l.createElement(D,{i18nKey:"artwork:delete-task.notice.resolve-task-failed"})),!1;const i=tt(_.union({outputs:{batch:_.intersection(_.array(_.union({mediaId:a},{deletedAt:_.nonNullable})),_.when(o=>o.some(c=>c.mediaId===a)))}},{outputs:_.optional({batch:_.optional(_.nullish)}),media:{id:a}}),n),r=typeof s=="function"?s(i):s;if(i)return ht(n,r||void 0);if((r==null?void 0:r.skipConfirm)||await Ee(Na(r==null?void 0:r.dialogProps,{title:l.createElement(D,{i18nKey:"artwork:delete-media.confirm-dialog.title"}),description:l.createElement(D,{i18nKey:"artwork:delete-media.confirm-dialog.description.content"})})).then(()=>!0,()=>!1))try{return await W.updateGenerationTask({id:n.id,input:{deleteBatchMedia:{mediaId:a}}}),F.success(l.createElement(D,{i18nKey:"artwork:delete-media.notice.success"})),!0}catch(o){return F.error(l.createElement("p",null,[l.createElement(D,{i18nKey:"artwork:delete-media.notice.fail"},[` (${String(o)})`])])),!1}}async function Da(e){return typeof e=="string"?(await W.getTaskById({id:e})).task:e}const It=30;function Gr(e){const{me:a}=st();return Ts((s,n)=>{var i;return!a||e===null?null:s===0?{...e,userId:a.id,last:It}:(i=n==null?void 0:n.pageInfo)!=null&&i.hasPreviousPage?{...e,userId:a.id,last:It,before:n.pageInfo.startCursor}:null},s=>W.listTasks(s).then(n=>n.tasks))}const Or=({task:e,className:a})=>{const{t:s}=$(["artwork"]);return t.jsx(O,{className:a,variant:"contained",onClick:async()=>{if(e)try{await Ee({title:"Cancel this generation?",description:"Used credits won't be refunded.",cancelLabel:"No",confirmLabel:"Yes"}),await W.cancelGenerationTask({taskId:e.id}),F.info("Task cancelled")}catch(n){if(n===de)return;F.error(n==null?void 0:n.message)}},children:s("artwork:cancel-generation")})},Wr=l.forwardRef(function({task:a,onBeforeClick:s,onSuccess:n=()=>{},children:i,...r},d){const[{loading:o},c]=Fe(async()=>{await ht(a)&&n()},[a]);return t.jsx(K,{onPress:()=>{s==null||s(),c()},busy:o,ref:d,...r,children:i})}),Ii=l.forwardRef(function({task:a,onMediaDelete:s,onTaskDelete:n,onCancel:i,mediaId:r,children:d,...o},c){const{t:u}=$(["artwork"]),[{loading:h},m]=Fe(async()=>{let f=!r;const p=f?await ht(a):await ki(a,r,b=>{f=b});p?f?n==null||n():s==null||s(r):p==null&&(i==null||i())},[a,r]);return t.jsx(K,{variant:"filled",onPress:m,busy:h,ref:c,...o,children:d||u("artwork:delete-media.label")})}),qr=({task:e,onSuccess:a=()=>{}})=>{const{t:s}=$(["artwork"]),[{loading:n},i]=Fe(async()=>{try{await Ee({title:"Confirm to rerun this task?",description:"Usually the failure is due to the bad parameters. If you think there is no problem you can try to rerun the failed task. This will not consume extra credits.",cancelLabel:"No",confirmLabel:"Yes"}),await W.rerunGenerationTask({taskId:e.id}),a(),F.success(s("artwork:task.rerun.success"))}catch(r){if(r===de)return;F.error(r==null?void 0:r.message)}},[e]);return t.jsx(K,{variant:"filled",onPress:i,busy:n,children:s("artwork:rerun-task")})};function Kr(e){const{preferVideo:a,videoMediaId:s,...n}=e;return!s||!a?t.jsx(jn,{...n}):t.jsx(Ci,{...n,videoMediaId:s})}function Ci(e){const[a,s]=l.useState(!1),[n,i]=l.useState(!1),{videoMediaId:r,videoMedia:d}=e,{data:o=d}=ae(d?void 0:r),c=nt(o),u=l.useRef(null),h=l.useCallback(()=>{i(!0)},[]);return c?t.jsxs(t.Fragment,{children:[t.jsx(it,{ref:u,src:c,autoPlay:!0,className:C("object-top object-contain",e.imgClassName),onClick:()=>{var m;s(!0),(m=u.current)==null||m.pause()},onLoadedData:h}),!n&&t.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-neutral-900/60 z-20",children:t.jsx(qe,{className:"size-12 absolute inset-0 m-auto animate-spin"})}),a&&t.jsx(Ea,{videoUrl:c,fileName:`pixai-${r}.mp4`,onClose:()=>{var m;(m=u.current)==null||m.play(),s(!1)}})]}):t.jsx(Pn,{})}function Ea(e){function a(){mt(e.videoUrl,e.fileName,{skipConversion:!0})}return $s.createPortal(t.jsxs("div",{className:"left-0 top-0 fixed w-full h-full z-[100000] grid place-content-center bg-black/80",tabIndex:-1,role:"dialog",onClick:()=>{var s;return(s=e.onClose)==null?void 0:s.call(e)},children:[t.jsx(it,{src:e.videoUrl,className:"max-w-full max-h-screen object-contain",autoPlay:!0,controls:!0}),t.jsxs("div",{className:"p-3 absolute top-0 right-0 flex items-center gap-4 text-white",children:[t.jsx("button",{onClick:s=>{s.stopPropagation(),a()},children:t.jsx("svg",{"aria-hidden":"true",viewBox:"0 0 32 32",width:"32",height:"32",children:t.jsx("path",{d:"M20.5 14.3 17.1 18V10h-2.2v7.9l-3.4-3.6L10 16l6 6.1 6-6.1ZM23 23H9v2h14Z",fill:"currentColor"})})}),t.jsx("button",{onClick:()=>{var s;return(s=e.onClose)==null?void 0:s.call(e)},children:t.jsx("svg",{"aria-hidden":"true",viewBox:"0 0 32 32",width:"32",height:"32",children:t.jsx("path",{d:"M24 10l-2-2-6 6-6-6-2 2 6 6-6 6 2 2 6-6 6 6 2-2-6-6z",fill:"currentColor"})})})]})]}),document.body)}const Ni=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M1 19.025v-5h2v3h18v-3h2v5H1ZM9.55 15v-.85h-.075q-.325.5-.875.788t-1.25.287q-1.225 0-1.925-.637t-.7-1.738q0-1.05.813-1.712t2.087-.663q.575 0 1.063.088t.837.287v-.35q0-.675-.463-1.075t-1.262-.4q-.525 0-.987.225t-.788.65L4.95 9.1q.475-.675 1.2-1.025t1.675-.35q1.55 0 2.375.738t.825 2.137V15H9.55ZM7.9 11.65q-.8 0-1.225.313t-.425.887q0 .5.375.813t.975.312q.8 0 1.363-.562t.562-1.363q-.35-.2-.8-.3t-.825-.1ZM12.525 15V4.975h1.55V7.8L14 8.8h.075q.075-.125.6-.638t1.65-.512q1.6 0 2.525 1.15t.925 2.65q0 1.5-.912 2.638t-2.538 1.137q-1.025 0-1.563-.45t-.687-.7H14V15h-1.475ZM16.1 9.05q-1 0-1.55.738T14 11.425q0 .925.55 1.65t1.55.725q1 0 1.563-.725t.562-1.65q0-.925-.563-1.65T16.1 9.05Z"})}),Fa=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M17.9 17.39c-.26-.8-1.01-1.39-1.9-1.39h-1v-3a1 1 0 0 0-1-1H8v-2h2a1 1 0 0 0 1-1V7h2a2 2 0 0 0 2-2v-.41a7.984 7.984 0 0 1 2.9 12.8M11 19.93c-3.95-.49-7-3.85-7-7.93c0-.62.08-1.22.21-1.79L9 15v1a2 2 0 0 0 2 2m1-16A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2Z"})}),Ra=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M21 15h2v2h-2v-2m0-4h2v2h-2v-2m2 8h-2v2c1 0 2-1 2-2M13 3h2v2h-2V3m8 4h2v2h-2V7m0-4v2h2c0-1-1-2-2-2M1 7h2v2H1V7m16-4h2v2h-2V3m0 16h2v2h-2v-2M3 3C2 3 1 4 1 5h2V3m6 0h2v2H9V3M5 3h2v2H5V3m-4 8v8a2 2 0 0 0 2 2h12V11H1m2 8l2.5-3.21l1.79 2.15l2.5-3.22L13 19H3Z"})}),Ct=8,za=1344,Mi=2048,Si=2688;function Ne(e,a){return Math.floor(e*a/Ct)*Ct}function Ba({width:e,height:a}){if(e==null||a==null)return;const s=Mi;return Math.floor(Math.min(s/e,s/a)*10)/10}function Ti({width:e,height:a}){if(e==null||a==null)return;const s=za,n=Math.floor(Math.min(s/e,s/a)*10)/10,i=Ba({width:e,height:a});if(!i)return;const r=Math.min(n,i);return r<1.1?1.1:r}function Va({width:e,height:a}){if(e==null||a==null)return;const s=Si;return Math.floor(Math.min(s/e,s/a)*10)/10}function _i({width:e,height:a}){if(e==null||a==null)return;const s=za,n=Math.floor(Math.min(s/e,s/a)*10)/10,i=Va({width:e,height:a});if(!i)return;const r=Math.min(n,i);return r<1.1?1.1:r}const Zr=({media:e,noteContent:a,defaultValues:s=_e,taskModelList:n=[],samplingMethods:i=Ls,extraInitialValues:r={}})=>({...s,...e?{strength:.7,baseImage:ke.fromMedia(e),...Sa(e),size:void 0}:{},...Ut(a,(d,o)=>{if(o==="samplingMethod"&&!i.includes(d)||o==="model"&&!n.map(c=>c.model).includes(d))return!1;if(d!=null)return!0}),...r}),me=e=>{var a,s,n;if(e){if(e.parameters.batchSize>1){if(!e.outputs.batch)return Array.from({length:e.parameters.batchSize}).map(()=>({taskId:e.id,mediaId:void 0}));const i=((e==null?void 0:e.outputs.batch)??[]).map(r=>({mediaId:r.mediaId,taskId:e.id,deleted:!!r.deletedAt,bookmarked:!!r.favoritedAt}));return e.parameters.batchSize===3&&e.parameters.mediaId?[{taskId:e.id,mediaId:e.parameters.mediaId},...i]:i}return je(e)?[{taskId:e.id,taskType:"workflow",mediaId:((s=(a=e.outputs.batch)==null?void 0:a[0])==null?void 0:s.mediaId)||e.outputs.mediaId}]:[{taskId:e.id,mediaId:(n=e.media)==null?void 0:n.id,bookmarked:!!e.favoritedAt}]}},$i=(e,a)=>{var s;return e.length===1?[{taskId:a.id,mediaId:(s=a.media)==null?void 0:s.id}]:e.length===4?me(a)??[]:[]},Li=e=>!e||!e.height||!e.width?!1:Math.sqrt(e.height*e.width)<=1024,Ua=(e,a)=>{var s,n,i,r,d,o;return e?a?{width:a.width,height:a.height}:!((s=e.parameters)!=null&&s.width)||!((n=e.parameters)!=null&&n.height)?{width:(i=e.media)==null?void 0:i.width,height:(r=e.media)==null?void 0:r.height}:{width:(d=e.parameters)==null?void 0:d.width,height:(o=e.parameters)==null?void 0:o.height}:{width:void 0,height:void 0}},Ai=(e,a)=>a?((e==null?void 0:e.outputs.batch)??[]).some(s=>s.mediaId===a&&!!s.favoritedAt):!1,Ha=(e,a)=>{var n;if(!a||!Array.isArray(e==null?void 0:e.outputs.batch))return;const s=(((n=e==null?void 0:e.outputs)==null?void 0:n.batch)??[]).findIndex(i=>i.mediaId===a);if(!(s<0))return s},Qr=({prompts:e,wordsToAppend:a,wordsToDelete:s})=>{let n=e??"";return s.length>0&&s.forEach(i=>{n=n.replaceAll(i,"")}),a.length>0&&(n=[n,a.join(",")].filter(i=>!!i).join(",")),n.replaceAll(/,+/g,",")},Pi=e=>{const{batchSize:a=1,upscale:s=1,enlarge:n=1}=e.parameters;return a===3?"variation":n>1?"upscale":s>1?"enhance":"generation"},Ga=({task:e,mediaIdx:a,onSuccess:s=()=>{},scene:n,mediaId:i,openShareAfterSuccess:r,formInit:d,formProps:o})=>{var v,k,w,x;const{t:c}=$(["artwork"]),{values:u,handleChange:h,getValues:m}=As({...e.parameters,...d}),f=l.useRef(new Date().getTime()),[p,b]=ve(async()=>{const g=await m();if(g)try{const j={taskId:e.id,input:vt(g),...a!=null?{opt:{mediaIndex:a}}:{}},I=await W.createArtworkFromTask(j);T("publish_success",{isPrivate:g.isPrivate,scene:n,taskType:Pi(e)});const S={type:"publish",taskParams:e.parameters,taskId:e.id,publishParams:{...vt(g),hasFav:!!e.favoritedAt||Ai(e,i)},action:"confirm",otherParams:{scene:n,mediaIdx:a,mediaId:i,duration:new Date().getTime()-f.current}};q(S),F.success(c("artwork:notice.publish-successfully")),Ps(e.id),s(),r&&I.createArtworkFromTask&&!I.createArtworkFromTask.isPrivate&&Dn(I.createArtworkFromTask,{scene:n})}catch(j){F.error(`Failed to publish. ${j==null?void 0:j.message}`)}},[r]);return t.jsxs(t.Fragment,{children:[t.jsx(Ft,{heading:c("artwork:generation.publish-settings")}),t.jsx(Rt,{className:"flex flex-col gap-4",children:t.jsx(En,{showPrompts:!1,showDescription:!0,values:{...u,mediaId:a!=null?(w=(k=(v=e.outputs)==null?void 0:v.batch)==null?void 0:k[a])==null?void 0:w.mediaId:(x=e.media)==null?void 0:x.id},handleChange:h,...o})}),t.jsx(Vt,{className:C("sticky bottom-0 bg-white dark:bg-zinc-800 translate-y-4 justify-end"),children:t.jsx(K,{busy:p,variant:"filled",onPress:()=>{b()},children:c("artwork:publish")})})]})};function Xr({task:e,scene:a,...s}){const{t:n}=$(["artwork"]),[i,r]=l.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx(K,{variant:"filled",onPress:()=>{T("publish_btn_click",{scene:"tasks"}),r(!0)},...s,children:n("artwork:publish")}),t.jsx(at,{open:i,onClose:()=>r(!1),dismissable:!0,className:"mlg:w-[600px] max-w-full",children:e&&t.jsx(Ga,{scene:a,task:e,onSuccess:()=>{r(!1)}})})]})}const Oa={"default-placeholder":"_default-placeholder_1q4vp_1","default-gradient":"_default-gradient_1q4vp_1","dark-purple-placeholder":"_dark-purple-placeholder_1q4vp_23","dark-purple-gradient":"_dark-purple-gradient_1q4vp_1","animated-text-letter":"_animated-text-letter_1q4vp_79","animated-text":"_animated-text_1q4vp_79"},Di=({text:e})=>{const a=l.useMemo(()=>e.split(""),[e]);return t.jsx("div",{className:"tracking-[0.1rem] uppercase font-light",children:a.map((s,n)=>t.jsx("span",{className:C(Oa["animated-text-letter"]),style:{animationDelay:`${n*30}ms`},children:s},n))})},Wa=({id:e="",status:a,className:s,waitingDescription:n,withDescription:i=!0,icon:r,children:d,style:o,defaultClassName:c,placeholderVariant:u="default",contentStyleProps:h,...m})=>{const f=c??Oa[`${u}-placeholder`],p=l.useMemo(()=>a==="failed"||a=="cancelled"?{icon:t.jsx(Bt,{className:"size-6"}),description:t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"capitalize",children:a}),t.jsx("div",{className:"text-xs font-mono justify-self-end",children:e})]}),stop:!0}:a==="waiting"?{icon:t.jsx(Ds,{size:28,variant:"indeterminate",className:"text-white"}),description:t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"capitalize",children:[a,"..."]}),n&&t.jsx("p",{className:"px-4",children:n})]})}:a==="running"?{icon:t.jsx(ne,{dark:!0,inline:!0,duration:1500}),description:t.jsx(Di,{text:"Generating"})}:{icon:t.jsx(vn,{className:"size-6"}),description:t.jsxs("div",{className:"capitalize",children:[`${a==="completed"?"":"Unknown:"}`," ",a]}),stop:!0},[e,a,n]);return t.jsx("div",{className:C(s,f),style:{animationDelay:`-${Es(e)%15}s`,animationPlayState:p.stop?"paused":"initial",...o},...m,children:t.jsxs("div",{className:C("w-full h-full flex flex-col gap-4 justify-center items-center relative",h==null?void 0:h.className),style:h==null?void 0:h.style,children:[r??p.icon,i&&p.description,d]})})},X={"image-placeholder":"_image-placeholder_mnnzj_1","image-wrapper":"_image-wrapper_mnnzj_7","generated-task-top-operation-btn":"_generated-task-top-operation-btn_mnnzj_11","prompt-helper-masked-background":"_prompt-helper-masked-background_mnnzj_17","prompt-helper-active":"_prompt-helper-active_mnnzj_47"};function Ei(e){const{t:a}=$(["generation"]),{params:s,setParams:n}=e,{selectedTab:i,v1:r,v2:d}=s,o=h=>{n(m=>({...m,selectedTab:h}))},c=[{value:"v1",label:a("generation:animated-image.animate-dialog.params.variant.v1")},{value:"v2",label:a("generation:animated-image.animate-dialog.params.variant.v2")},{value:"professional",label:a("generation:animated-image.animate-dialog.params.variant.professional")}],u=l.useMemo(()=>t.jsxs(we,{className:"w-full",children:[t.jsx(Ke,{id:"animate-params-input-tab-selector-label",children:a("generation:animated-image.animate-dialog.params.variant.label")}),t.jsx(Ht,{row:!0,"aria-labelledby":"animate-params-input-tab-selector-label",name:"radio-buttons-group",value:i,onChange:(h,m)=>o(m),children:c.map(({value:h,label:m})=>t.jsx(re,{value:h,control:t.jsx(Ze,{}),label:m,disabled:!e.allowAnimateDiff&&h!=="professional"}))})]}),[e.allowAnimateDiff,i,o,c]);return t.jsxs("div",{className:"w-full",children:[u,t.jsxs(Fn,{selectedKey:i,onSelectionChange:h=>o(h),children:[t.jsx(Rn,{className:"hidden",children:c.map(({value:h})=>t.jsx(zn,{id:h},h))}),i!=="professional"&&t.jsxs(t.Fragment,{children:[t.jsx(Ke,{id:"animate-params-input-params",className:"mt-2",children:a("generation:animated-image.animate-dialog.params.label")}),t.jsxs(yt,{id:"v1",className:"p-0",children:[t.jsx(re,{control:t.jsx(We,{checked:r.long,onChange:h=>n(m=>({...m,v1:{...m.v1,long:h.target.checked}}))}),label:a("generation:animated-image.animate-dialog.params.v1.long")}),t.jsx(re,{control:t.jsx(We,{checked:r.smooth,onChange:h=>n(m=>({...m,v1:{...m.v1,smooth:h.target.checked}}))}),label:a("generation:animated-image.animate-dialog.params.v1.smooth")})]}),t.jsxs(yt,{id:"v2",className:"p-0 pt-2",children:[t.jsx("p",{children:a("generation:animated-image.animate-dialog.params.v2.motion-scale")}),t.jsx(xe,{value:d.motionScale,onChange:(h,m)=>{n(f=>({...f,v2:{...f.v2,motionScale:m}}))},step:.01,max:1.4,min:1.1,valueLabelFormat:h=>h.toFixed(2),valueLabelDisplay:"auto"}),t.jsx("p",{children:a("generation:animated-image.animate-dialog.params.v2.denoise")}),t.jsx(xe,{value:d.denoise,onChange:(h,m)=>{n(f=>({...f,v2:{...f.v2,denoise:m}}))},step:.01,max:1,min:.7,valueLabelFormat:h=>h.toFixed(2),valueLabelDisplay:"auto"})]})]})]})]})}const Fi={v1:{smooth:!1,long:!1},v2:{motionScale:1.2,denoise:.9},selectedTab:"professional"};function Ri({taskParameters:e,mediaId:a,itemIdx:s,v1Params:n,v2Params:i,animateTaskExtraArgs:r}){var c,u;const d=!!((c=e==null?void 0:e.parameters.animateDiff)!=null&&c.enabled);if(!(e!=null&&e.outputs))return{};const o=a??(d?e.parameters.mediaId:e.outputs.batch?(u=e.outputs.batch[s])==null?void 0:u.mediaId:e.outputs.mediaId);return{...Rs(e.parameters,["prompts","width","height"]),modelId:e.parameters.modelId,mediaId:o,animateDiff:{enabled:!0,...n?{...n}:{v2:i}},seed:d&&(n!=null&&n.smooth)?e.outputs.detailParameters.seed:void 0,extra:r}}function zi({taskParameters:e,mediaId:a,itemIdx:s,v1Params:n,v2Params:i,animateTaskExtraArgs:r,scene:d}){const{mutate:o}=Fs(),c=l.useMemo(()=>Ri({taskParameters:e,mediaId:a,itemIdx:s,v1Params:n,v2Params:i,animateTaskExtraArgs:r}),[e,a,s,n,i,r]),{data:u,isValidating:h}=dt(c),[,m]=l.useContext(se),[,f]=l.useContext(xa),[p,b]=ve(async v=>{var x,g,j,I;const{createGenerationTask:k}=await W.createGenerationTask({parameters:c});k&&T("animate_task_submit",{taskId:k.id,modelId:c.modelId,reroll:v,smooth:c.animateDiff.smooth,duration:c.animateDiff.long?"long":"short",denoise:(g=(x=c.animateDiff)==null?void 0:x.v2)==null?void 0:g.denoise,motionScale:(I=(j=c.animateDiff)==null?void 0:j.v2)==null?void 0:I.motionScale,scene:d});const w=me(k);return w&&(m(w),f(w[0].mediaId)),o(),k},[c]);return{price:u,computingPrice:h,createTask:b,creatingTask:p,parameters:c}}const Bi=e=>t.jsxs("video",{loop:!0,muted:!0,playsInline:!0,autoPlay:!0,"data-nosnippet":!0,...e,children:[t.jsx("source",{src:"https://cdn.pixai.art/animations/anim_gradient.mp4",type:"video/mp4"}),t.jsx("source",{src:"https://cdn.pixai.art/animations/anim_gradient.webm",type:"video/webm"})]});function Vi(e){const a=l.useRef(null),n=ue()?"medium":"small";return t.jsxs(t.Fragment,{children:[t.jsx(Q,{title:typeof e.disabled=="string"?e.disabled:e.tooltip,placement:"top",enterDelay:0,children:t.jsx("span",{className:e.className,style:e.style,children:t.jsx(O,{size:n,disabled:!!e.disabled,className:C(X["generated-task-top-operation-btn"]),onClick:()=>{var i;T("animate_click"),(i=a.current)==null||i.open()},children:t.jsx(mi,{className:"size-5"})})})}),t.jsx(Ui,{ref:a,...e})]})}const Ui=l.forwardRef(function(a,s){const{t:n}=$(["generation"]),[i,r]=l.useState(!1),d=()=>r(!1);return l.useImperativeHandle(s,()=>({open:()=>r(!0),close:d})),t.jsx(zs,{open:i,onClose:()=>r(!1),className:"max-w-xl p-2 mx-auto",children:t.jsx(Hi,{onClose:d,description:n("generation:animated-image.animate-dialog.description"),...a})})});function Hi(e){var p,b,v;const a=Gt(),[s,n]=l.useState(Fi),{onClose:i,description:r,afterConfirm:d,...o}=e,c=lt((p=o.taskParameters)==null?void 0:p.parameters.modelId),u=Bs(c==null?void 0:c.modelType),h=zi({...o,...s.selectedTab==="v1"?{v1Params:s.v1}:{v2Params:s.v2}}),{t:m}=$(["action","generation"]),f=l.useCallback(async()=>{var k;if(T("animate_generate_click"),s.selectedTab==="professional")return a(Vs("//pixai/animation",{mediaId:(k=h.parameters)==null?void 0:k.mediaId}));try{const w=await h.createTask();i(),w&&(d==null||d(w))}catch(w){F.error(w.message)}},[s.selectedTab]);return t.jsxs(t.Fragment,{children:[t.jsxs("h4",{className:"text-lg mb-4 font-medium relative",children:[t.jsx("div",{className:"z-[1] text-white relative p-4 font-bold",children:m("generation:animated-image.animate-dialog.title")}),t.jsx(Bi,{className:"absolute inset-0 w-full h-full object-cover group-hover:brightness-125 transition-all duration-75 rounded-none md:rounded-2xl shadow"})]}),t.jsx("div",{className:"p-4 pt-0",children:t.jsx(Ot,{className:"prose dark:prose-invert",children:r})}),!u&&t.jsx(Ta,{type:_a.Warning,className:"mx-4",children:m("generation:animated-image.animate-dialog.incompatible-with-animate-diff")}),t.jsx("div",{className:"p-4 flex items-center justify-center",children:t.jsx(Ei,{params:s,setParams:n,allowAnimateDiff:u})}),t.jsxs(Wt,{className:"max-mmd:flex-col max-mmd:items-stretch max-mmd:gap-4",children:[t.jsx(K,{variant:"outlined",onPress:i,children:m("action:cancel")}),t.jsx(K,{variant:"filled",color:"theme",busy:h.creatingTask,onPress:f,disabled:!u&&s.selectedTab!=="professional",children:t.jsxs("span",{className:"inline-flex gap-2",children:[m("generation:animated-image.animate-button.label"),t.jsx(Us,{value:(b=h.price)==null?void 0:b.actualPrice,originalValue:(v=h.price)==null?void 0:v.originalPrice,updating:h.computingPrice,className:C(s.selectedTab==="professional"&&"hidden")})]})})]})]})}function Gi(e){const{t:a}=$(["generation"]),{data:{enlargeModels:s=[]}={},isValidating:n}=rt();return t.jsxs(we,{className:e.className,children:[t.jsx(qt,{className:"font-semibold text-sm",id:"upscaler-select",children:a("generation:upscale.enlarge-model")}),t.jsx(Kt,{labelId:"upscaler-select",label:a("generation:upscale.enlarge-model"),value:e.value,onChange:i=>e.onChange(i.target.value),disabled:e.disabled,children:n?t.jsx(Le,{disabled:!0,value:"",children:"Loading"}):s.map(i=>t.jsx(Le,{value:i,children:i},i))})]})}function Oi(e){const{t:a}=$(["membership"]);return t.jsxs(Zt,{to:"/membership/plans",className:C("px-4 py-4 flex flex-col items-start bg-cover","[--bg-mask-color:#fffc] dark:[--bg-mask-color:#000b]",e.className),style:{backgroundImage:`linear-gradient(to right, var(--bg-mask-color), #0000),
          url(${a("membership:plans-page.bg")})`,backgroundPosition:"0 20%",height:144,...e.style},onClick:()=>{var n;const s=e.scene;T("enter_member_click",{location:s}),Qt("member_source",s,{persistent:!0}),(n=e.onClick)==null||n.call(e)},children:[t.jsx("p",{className:"dark:text-white font-bold text-shadow shadow-black/20",children:"PixAI"}),t.jsx("p",{className:"text-3xl font-bold text-theme-primary text-shadow shadow-black/20",children:a("membership:membership.label")}),t.jsx("p",{className:"text-sm font-medium text-shadow shadow-black/20",children:a("membership:promotion.slogan")}),t.jsx("button",{className:"flex-none px-10 py-1 text-sm font-semibold bg-theme-primary text-white text-shadow shadow-black/20 rounded-full mt-auto",children:a("membership:promotion.cta.label")})]})}const Wi={daily:"daily",task_cost:"task_cost",referral_reward:"referral_reward",register_gift:"register_gift",app_gift:"app_gift",xmas_gift_2023:"xmas_gift_2023",membership:"membership",extra_package:"extra_package",task_refund:"task_refund",op:"op",event_gift:"event_gift",user_lora_task_cost:"user_lora_task_cost",user_lora_task_refund:"user_lora_task_refund",user_lora_rebate:"user_lora_rebate",user_share:"user_share",quest_reward:"quest_reward",credit_coupon:"credit_coupon"};function qi(){return t.jsxs(Te,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[t.jsx(Z,{component:"th",scope:"row",children:t.jsx(Ge,{})}),t.jsx(Z,{align:"right",children:t.jsx(Ge,{})}),t.jsx(Z,{align:"right",children:t.jsx(Ge,{})})]})}const Ki=({userId:e})=>{const{t:a}=$(["user","artwork"]),[s,n]=l.useState(),[{before:i,after:r},d]=l.useState({}),{data:o}=ye(),{data:c,isValidating:u}=Hs({reason:s,userId:e,...Vn({before:i,after:r,pageSize:20})}),h=l.useMemo(()=>Xt(c).reverse(),[c]);return t.jsxs("div",{className:"flex flex-col gap-4",children:[o!=null&&o.isAdmin?t.jsx("div",{children:t.jsxs(we,{size:"small",children:[t.jsx(qt,{children:"Type"}),t.jsxs(Kt,{label:"type",className:"w-[200px]",value:s,onChange:m=>n(m.target.value),children:[t.jsx(Le,{value:"",children:t.jsx("em",{children:"None"})}),Object.values(Wi).map(m=>t.jsx(Le,{value:m,children:a(`user:quota-log-type.${m}`,{defaultValue:"Unknown"})},m))]})]})}):null,t.jsx(Un,{children:t.jsxs(Wn,{size:"small",children:[t.jsx(qn,{children:t.jsxs(Te,{children:[t.jsx(Z,{children:a("user:quota-log.head.credit-change")}),t.jsx(Z,{children:a("user:quota-log.head.credit-type")}),t.jsx(Z,{align:"right",children:a("user:quota-log.head.date")}),t.jsx(Z,{})]})}),t.jsxs(Kn,{children:[h.length<1&&u&&t.jsx(qi,{}),h.map(m=>{var f,p;return t.jsxs(Te,{children:[t.jsx(Z,{component:"th",scope:"row",children:t.jsxs("pre",{children:[m.amount>0?"+":"",m.amount.toLocaleString()]})}),t.jsx(Z,{children:a(`user:quota-log-type.${m.type}`,{defaultValue:"Unknown"})}),t.jsxs(Z,{align:"right",children:[Y(m.createdAt).format("lll"),t.jsxs("span",{className:"text-xs ml-1",children:["(",Y(m.createdAt).fromNow(),")"]})]}),t.jsx(Z,{align:"right",children:((f=m.extra)==null?void 0:f.reason)&&t.jsx("p",{children:(p=m.extra)==null?void 0:p.reason})})]},m.createdAt)})]}),t.jsx(Hn,{children:t.jsx(Te,{children:t.jsx(Z,{colSpan:100,align:"right",sx:{borderBottom:0},children:t.jsx(Gn,{pageInfo:c==null?void 0:c.pageInfo,onCursorChange:d})})})})]})})]})},ft=l.createContext(void 0),Yr=()=>l.useContext(ft),Zi=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M12 8a2 2 0 1 1 0-4a2 2 0 0 1 0 4m0 6a2 2 0 1 1 0-4a2 2 0 0 1 0 4m-2 4a2 2 0 1 0 4 0a2 2 0 0 0-4 0"})}),Qi=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsxs("g",{fill:"none",children:[t.jsx("path",{d:"M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"}),t.jsx("path",{fill:"currentColor",d:"M19 4a3 3 0 0 1 2.995 2.824L22 7v1.817a1.55 1.55 0 0 1-.776 1.33l-.107.058a2 2 0 0 0-.14 3.515l.14.075c.433.214.82.656.876 1.24l.007.148V17a3 3 0 0 1-2.824 2.995L19 20H5a3 3 0 0 1-2.995-2.824L2 17v-1.817c0-.606.352-1.078.776-1.33l.107-.058a2 2 0 0 0 .14-3.515l-.14-.075c-.433-.214-.82-.656-.876-1.24L2 8.818V7a3 3 0 0 1 2.824-2.995L5 4h14Zm0 2H5a1 1 0 0 0-.993.883L4 7v1.535a3.999 3.999 0 0 1 .185 6.816L4 15.465V17a1 1 0 0 0 .883.993L5 18h14a1 1 0 0 0 .993-.883L20 17v-1.535a3.999 3.999 0 0 1-.185-6.816L20 8.535V7a1 1 0 0 0-.883-.993L19 6Zm-9 3a1 1 0 0 1 .993.883L11 10v4a1 1 0 0 1-1.993.117L9 14v-4a1 1 0 0 1 1-1Z"})]})}),Xi=({className:e})=>{const{t:a}=$(["generation"]);return t.jsx(Gs,{variant:"normal",iconClassName:e,children:t.jsx(Ot,{className:"flex flex-col prose dark:prose-invert",children:a("generation:generation.quota-help.content")})})};function Jr(e){return t.jsxs("div",{className:"flex flex-col gap-12 relative",children:[t.jsx(Ji,{}),t.jsx(el,{userId:e.userId})]})}const qa=Pe({slots:{root:"flex flex-col gap-4",heading:"text-xl font-semibold"}}),Yi=Pe({slots:{list:"grid grid-cols-[auto_1fr] content-start gap-x-8 gap-y-2",item:"contents",title:"text-neutral-600 dark:text-neutral-400",value:"max-msm:justify-self-end"}});function Ji(){var u;const{t:e}=$(["membership"]),{user:a,isMyProfile:s}=l.useContext(ft),{data:n}=Os(a.id),i=l.useMemo(()=>(n==null?void 0:n.subscription)&&Ws(n.subscription),[n]),r=be(n).with({subscription:{provider:_.union(_.string.startsWith("apple"),_.string.startsWith("google"))}},()=>"membership:membership.auto-renewal.messages.check-status-on-store").otherwise(()=>{var h;return!((h=n==null?void 0:n.subscription)!=null&&h.cancelAtPeriodEnd)}),{unsubscribe:d}=qs(),o=qa(),c=Yi();return t.jsxs("section",{className:o.root(),children:[t.jsxs("header",{className:"flex items-end gap-4",children:[t.jsx("h4",{className:o.heading(),onClick:()=>{},children:t.jsx(D,{i18nKey:"membership:membership.label"})}),(n==null?void 0:n.membership)&&t.jsxs(ni,{children:[t.jsx(K,{variant:"ghost",icon:t.jsx(Zi,{className:"size-6"}),className:"ml-auto"}),t.jsx(Aa,{placement:"bottom end",children:t.jsx(di,{color:"danger",disabled:!s||!r,onAction:()=>{T("plan_cancel_click",{scene:"profile"}),d()},children:t.jsx(D,{i18nKey:"membership:plan.action.cancel.label"})})})]})]}),t.jsx("div",{children:n!=null&&n.membership?t.jsxs("dl",{className:c.list(),children:[t.jsxs("div",{className:c.item(),children:[t.jsx("dt",{className:c.title(),children:t.jsx(D,{i18nKey:"membership:membership.current-tier.label"})}),t.jsx("dd",{className:c.value({className:"flex items-center gap-1"}),children:t.jsx(Nt,{tier:(u=n==null?void 0:n.membership)==null?void 0:u.tier})})]}),i&&t.jsxs("div",{className:c.item(),children:[t.jsx("dt",{className:c.title(),children:t.jsx(D,{i18nKey:"membership:membership.expiry-date.label"})}),t.jsxs("dd",{className:c.value({className:"flex flex-col max-msm:items-end"}),children:[t.jsx("span",{children:Y(i.endAt).format("ll")}),i.nextTier&&t.jsx("p",{className:"text-sm max-msm:text-right text-balance text-neutral-600 dark:text-neutral-400",children:t.jsx(D,{i18nKey:"membership:membership.auto-renewal.messages.following-tier-change",values:{tier:1,time:e("membership:plan.action.subscribe.interval.month")},components:{tier:t.jsx(Nt,{}),time:t.jsx("span",{className:"lowercase"})}})})]})]}),t.jsxs("div",{className:c.item(),children:[t.jsx("dt",{className:c.title(),children:t.jsx(D,{i18nKey:"membership:membership.auto-renewal.label"})}),t.jsx("dd",{className:c.value({className:"inline-flex items-center gap-0.5"}),children:r?typeof r=="string"?t.jsx("p",{className:"max-msm:text-right text-balance",children:t.jsx(D,{i18nKey:r})}):t.jsx(D,{i18nKey:"common:on"}):t.jsx(D,{i18nKey:"common:off"})})]})]}):t.jsx(Oi,{scene:"credits",className:"w-full outline outline-1 -outline-offset-1 outline-black/10 rounded-2xl shadow-md",style:{maxWidth:554}})})]})}function Nt(e){return e.tier?t.jsxs("span",{className:Ks("whitespace-nowrap",e.className),style:e.style,children:[t.jsx(Zs,{className:"size-[1.2em] inline-grid align-text-top mr-0.5"}),t.jsx("span",{className:"",children:t.jsx(D,{i18nKey:Qs(Number(e.tier)).label})})]}):null}function el(e){const{isMyProfile:a}=l.useContext(ft),s=Gt(),n=qa();return t.jsxs("section",{className:n.root(),children:[t.jsxs("header",{className:"flex items-end gap-4",children:[t.jsx("h4",{className:n.heading(),children:t.jsx(D,{i18nKey:"artwork:generation.credit-change-history",context:"preview"})}),t.jsx(K,{variant:"outlined",size:"small",disabled:!a,icon:t.jsx(Qi,{}),className:"ml-auto",onPress:()=>{T("redeem_code_link_click"),s("/redeem")},children:t.jsx(D,{i18nKey:"user:code-redemption.redeem-code.label"})})]}),t.jsx(Ki,{userId:e.userId})]})}const tl=()=>{const e=wt("(min-width:1200px)"),a=wt("(min-width:1200px) and (max-width:1400px)");return l.useEffect(()=>{a?document.body.classList.add("dense"):document.body.classList.remove("dense")},[a]),{desktop:e,dense:a,denseMode:a?"dense":void 0}};function al(e){return typeof e!="number"?!1:Object.values(U).includes(e)}const Ka=({value:e,onChange:a=()=>{},disabled:s=!1,className:n,forceHighPriorityForNonMember:i})=>{const{beingMember:r}=st(),{t:d}=$(["artwork"]),{denseMode:o}=tl();l.useEffect(()=>{!r&&i?a(U.default):!r&&e===U.turboMode?a(U.low):al(e)||a(U.default)},[e,r,i]);const c=i&&!r;return t.jsx(we,{className:n,children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(re,{className:"mmd:mr-1",onChange:(u,h)=>{h?(a(U.default),T("priority_channel_select",{priority:U.default})):(a(r?U.turboMode:U.low),T("priority_channel_select",{priority:U.low}))},disabled:s||c,control:t.jsx(ot,{className:"p-1",checked:e===U.default}),label:t.jsx("p",{className:"flex items-center text-sm",children:d("artwork:generation:priority-channel:high",{context:o})})}),t.jsx(Xi,{className:"mr-3"})]})})};function Mt({title:e,value:a,inputProps:s,safeRange:n,handleChange:i,className:r,disabled:d}){return t.jsxs("div",{className:r,children:[t.jsx("p",{className:"text-base text-primary-light",children:e}),t.jsxs("div",{className:"flex gap-4 pt-2",children:[t.jsx(xe,{disabled:d,className:C("max-w-[400px]",n&&!d&&(a<n.min||a>n.max)?"text-red-500":""),value:a,onChange:(o,c)=>{i(c)},min:s==null?void 0:s.min,max:s==null?void 0:s.max,step:s==null?void 0:s.step,valueLabelDisplay:"auto"}),t.jsx(Xs,{disabled:d,type:"number",className:C("w-[60px]",n&&!d&&(a<n.min||a>n.max)?"text-red-500":""),value:a,onChange:o=>{const c=+o.target.value;i(Ys(c,(s==null?void 0:s.min)??0,s==null?void 0:s.max))},inputProps:s})]})]})}function sl(e){const{t:a}=$(["generation"]),{data:s,isValidating:n}=oe(e.taskId),{data:i}=Yt(s==null?void 0:s.artworkId),{submit:r}=pe(),[,d]=l.useContext(se),[o,c]=l.useState(1e3),u=e.baseMedia??(s==null?void 0:s.media),{width:h,height:m}=u??(s==null?void 0:s.parameters)??{},f=ut(i,s),p={mediaId:u==null?void 0:u.id,strength:.8,priority:o,width:h,height:m,controlNets:[]},b=Li(u),v=l.useMemo(()=>({...f,...p,batchSize:3}),[e.baseMedia,s,p.priority,p.height,p.width]),k=l.useRef(new Date().getTime()),w=l.useMemo(()=>({type:"variation",taskId:s==null?void 0:s.id,taskParams:{...f,...p},otherParams:{duration:new Date().getTime()-k.current,scene:"gen",mediaId:u==null?void 0:u.id,mediaIdx:e.mediaIdx}}),[s==null?void 0:s.id,f,p]);l.useImperativeHandle(e.onCancelCallbackRef,()=>({onCancel:()=>q({...w,action:"cancel"})}),[w]);const{data:x,isValidating:g}=dt(v),[j,I]=ve(async()=>{var y,N;if(!s||!e.baseMedia)return;const S=((y=e.baseMedia)==null?void 0:y.id)??((N=s.media)==null?void 0:N.id);try{if(s.status!=="completed")throw new Error("Task or artwork not available");q({...w,action:"confirm"}),await r({...p,prompts:f.prompts??s.parameters.prompts,baseImage:u?ke.fromMedia(u):void 0,batchSize:3},A=>{const V=A.createGenerationTask;if(V){d([{taskId:s.id,mediaId:S},...me(V)??[]]),q({type:"variation",taskParams:V.parameters,taskId:s.id,currentTaskId:V.id,action:"success",otherParams:{scene:"gen",mediaId:u==null?void 0:u.id,mediaIdx:e.mediaIdx}});return}})}catch(A){console.log(A),F.error("Cannot perform variation")}finally{e.onClose()}},[s,p,u]);return t.jsxs(t.Fragment,{children:[t.jsx(ct,{className:"font-semibold",children:a("generation:variation.confirm-dialog.title")}),b?t.jsxs(t.Fragment,{children:[t.jsx(Wt,{children:t.jsx(K,{className:"w-full",color:"normal",variant:"filled",busy:j,onPress:I,children:t.jsxs("span",{className:"inline-flex items-center gap-2 font-semibold",children:[a("generation:submit.lets-go.label"),t.jsx($a,{value:x==null?void 0:x.actualPrice,iconSize:12,loading:g,className:"inline-flex !gap-1 !text-inherit"})]})})}),t.jsx("div",{className:"w-full px-4 flex flex-col gap-4 items-center mb-2",children:t.jsx(Ka,{value:o,onChange:c})})]}):t.jsx($e,{children:t.jsx(Jt,{children:a("generation:variation.upscaled-not-allowed")})})]})}const nl=.5;function il(e){var jt;const{t:a}=$(["common","generation"]),[s,n]=l.useState(1),[i,r]=l.useState(1),[d,o]=l.useState("upscale"),{values:c,submit:u}=pe(),h=Js((jt=lt(c.modelId))==null?void 0:jt.modelType),[m,f]=l.useState(()=>c.strength??nl),[p,b]=l.useState(()=>c.samplingSteps??_e.samplingSteps),[v,k]=l.useState(!1),{data:w,isValidating:x}=en(),g=l.useRef(!1),j=l.useRef(!1),[I,S]=l.useState(!1),{data:y,isValidating:N}=oe(e.taskId),[A,V]=l.useState(c.enlargeModel),{data:B}=Yt(y==null?void 0:y.artworkId),[ee,M]=l.useState(1e3),[,P]=l.useContext(se),L=e.baseMedia??(y==null?void 0:y.media),{width:E,height:R}=e.baseMedia??(y==null?void 0:y.media)??{},ie=Ba({width:E,height:R}),fe=Va({width:E,height:R}),le=ut(B,y),H={mediaId:L==null?void 0:L.id,priority:ee,width:E,height:R,...d==="upscale"?{enlarge:void 0,upscale:s,strength:m,samplingSteps:p,enableTile:v}:{enlarge:i,enlargeModel:A,upscale:void 0,enableADetailer:void 0},controlNets:void 0},os=l.useMemo(()=>({...le,...H,batchSize:void 0}),[y,H.priority,H.upscale,H.enlarge,H.enlargeModel,H.strength,H.samplingSteps,H.width,H.height,H.enableTile]),cs=l.useRef(new Date().getTime()),Re=l.useMemo(()=>({type:d,taskId:y==null?void 0:y.id,taskParams:{...le,...H},otherParams:{duration:new Date().getTime()-cs.current,scene:"gen",mediaId:L==null?void 0:L.id,mediaIdx:e.mediaIdx}}),[y==null?void 0:y.id,le,H,d]);l.useImperativeHandle(e.onCancelCallbackRef,()=>({onCancel:()=>q({...Re,action:"cancel"})}),[Re]);const{data:ze,isValidating:ds}=dt(os),[ms,us]=ve(async()=>{if(!(!y||!e.baseMedia))try{if((y==null?void 0:y.status)!=="completed")throw new Error("Task or artwork not available");q({...Re,action:"confirm"}),u({...le,...H,prompts:le.prompts??y.parameters.prompts,baseImage:L?ke.fromMedia(L):void 0,batchSize:void 0},z=>{const G=z.createGenerationTask;if(G){P(me(z.createGenerationTask)??[]),q({type:d,taskParams:G.parameters,taskId:y.id,currentTaskId:G.id,action:"success",otherParams:{scene:"gen",mediaId:L==null?void 0:L.id,mediaIdx:e.mediaIdx}});return}}),e.onClose()}catch(z){console.log(z),F.error("Cannot perform upscale")}},[y,H,L]),Be=!!ie&&ie>=1.1&&!!E&&!!R,Ve=!!fe&&fe>=1.1&&!!E&&!!R,Ie=Be||Ve,hs=d==="upscale"&&h&&v;return l.useEffect(()=>{if((Be||Ve)&&!g.current){const z=Ti({width:E,height:R});z&&n(z);const G=_i({width:E,height:R});G&&r(G),g.current=!0}},[E,R]),l.useEffect(()=>{if(!j.current&&w){const z=w.base.enlargeModel;z&&V(z),j.current=!0}},[w]),t.jsxs(t.Fragment,{children:[t.jsx(ct,{className:"font-semibold",children:a("generation:upscale.dialog.title")}),!Ie&&t.jsx($e,{children:t.jsx(Jt,{children:a("generation:upscale.limit-reached")})}),Ie&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"w-full px-4 flex flex-col gap-4 items-center",children:[t.jsx(K,{className:"w-full",color:"normal",variant:"filled",busy:ms,onPress:us,disabled:hs,children:t.jsxs("span",{className:"inline-flex items-center gap-2 font-semibold",children:[a("generation:submit.lets-go.label"),t.jsx($a,{value:ze==null?void 0:ze.actualPrice,iconSize:12,loading:ds,className:"inline-flex !gap-1 !text-inherit"})]})}),t.jsx(Ka,{value:ee,onChange:M})]}),t.jsxs(we,{className:"px-6",children:[t.jsx(Ke,{id:"upscale-method-group",children:a("generation:upscale.method-choose")}),t.jsxs(Ht,{row:!0,name:"upscale-method-group",value:d,onChange:z=>{const G=z.target.value;T("upscale_select",{value:G==="upscale"?"enhance":G==="enlarge"?"upscale":void 0}),o(G)},children:[t.jsx(re,{value:"enlarge",control:t.jsx(Ze,{}),label:t.jsxs("div",{className:"inline-flex gap-2",children:[a("generation:upscale.method.enlarge"),t.jsx(Ue,{children:t.jsx("p",{className:"p-4 text-sm whitespace-pre-wrap",children:a("generation:upscale.enlarge-help")})})]}),disabled:!Ve}),t.jsx(re,{value:"upscale",control:t.jsx(Ze,{}),label:t.jsxs("div",{className:"inline-flex gap-2",children:[a("generation:upscale.method.upscale"),t.jsx(Ue,{children:t.jsx("p",{className:"p-4 text-sm whitespace-pre-wrap",children:a("generation:upscale.upscale-help")})})]}),disabled:!Be})]})]})]}),I?Ie&&t.jsx($e,{className:"pt-2",children:d==="upscale"?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-base text-primary-light",children:a("generation:upscale.upscale-ratio")}),t.jsxs("div",{className:"flex gap-4 pt-2 justify-center w-full",children:[t.jsx(xe,{className:"max-w-[400px]",value:s,onChange:(z,G)=>{n(G)},min:1,max:ie,step:.1,valueLabelDisplay:"auto"}),t.jsx("p",{children:s.toFixed(1)})]}),t.jsxs("p",{children:[E,"×",R," → ",Ne(E,s),"×",Ne(R,s)]}),t.jsx(ll,{steps:p,strength:m,handleChange:{steps:b,strength:f}}),h&&t.jsx(Ta,{type:_a.Warning,className:"mt-2",children:a("generation:upscale.enable-tile.incompatible-model-used-hint")}),t.jsx(re,{checked:v,control:t.jsx(ot,{onChange:z=>{k(z.target.checked)}}),label:t.jsxs("div",{className:"inline-flex gap-2 items-center",children:[t.jsx("p",{children:a("generation:upscale.enable-tile.label")}),t.jsx(Ue,{children:t.jsx("p",{className:"p-4 text-sm whitespace-pre-wrap",children:a("generation:upscale.enable-tile.help")})})]})})]}):t.jsxs("div",{className:"flex flex-col",children:[t.jsx(Gi,{className:"mt-4",value:A,onChange:z=>{V(z)},disabled:x}),t.jsx("p",{className:"text-base text-primary-light mt-4",children:a("generation:upscale.enlarge-ratio")}),t.jsxs("div",{className:"flex gap-4 pt-2 items-center",children:[t.jsx(xe,{className:"max-w-[400px]",value:i,onChange:(z,G)=>{r(G)},min:1,max:fe,step:.1,valueLabelDisplay:"auto"}),t.jsx("p",{children:i.toFixed(1)})]}),t.jsxs("p",{children:[E,"×",R," → ",Ne(E,i),"×",Ne(R,i)]})]})}):t.jsx(O,{className:"w-full",onClick:()=>{T("expand_btn_click"),S(!0)},disabled:!Ie,children:t.jsx(Bn,{})})]})}const Oe={min:.4,max:.6};function ll(e){const{strength:a,steps:s,handleChange:n}=e,{t:i}=$(["generation"]);return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"flex gap-2 items-start mt-4 w-full",children:t.jsx(Mt,{className:"grow",title:i("generation:hires.strength.label"),value:a,inputProps:{min:.01,max:.99,step:.01},safeRange:Oe,handleChange:r=>{n.strength(r)}})}),t.jsx("p",{className:C("text-sm text-icon",a<Oe.min||a>Oe.max?"text-red-500":""),children:i("generation:hires.strength.description")}),t.jsx("div",{className:"flex gap-2 items-start mt-4 w-full",children:t.jsx(Mt,{className:"grow",title:i("generation:hires.steps.label"),value:s,inputProps:{min:1,max:50,step:1},handleChange:r=>{n.steps(r)}})})]})}const St=["doesnt-follow-prompt","unwanted-elements","incorrect-anatomy","blurry-or-artifacts","unattractive-style"];function rl(e){const{t:a}=$(["artwork","action"]),[s,n]=l.useState(""),[i,r]=l.useState(()=>Object.fromEntries(St.map(c=>[c,!1]))),d=c=>{r(u=>({...u,[c.target.name]:c.target.checked}))},o=()=>{var c;T("image_issue_submit",{content:s,...i}),(c=e.onConfirm)==null||c.call(e)};return t.jsxs("div",{children:[t.jsx(ct,{className:"font-bold",children:a("artwork:generation.image-survey.title")}),t.jsxs($e,{children:[t.jsx(tn,{children:St.map(c=>t.jsx(re,{control:t.jsx(ot,{name:c,onChange:d}),checked:i[c],label:a(`artwork:generation.image-survey.reasons.${c}`)},c))}),t.jsx(ta,{className:"mt-4",fullWidth:!0,value:s,onChange:c=>{n(c.target.value)},inputProps:{maxLength:500},multiline:!0,placeholder:a("artwork:generation.image-survey.reasons.other")})]}),t.jsx("div",{className:"py-2 pb-6 w-full flex items-center justify-center",children:t.jsx(K,{onPress:o,variant:"filled",className:"capitalize",children:a("action:submit")})})]})}const Tt=async()=>new Promise(async(e,a)=>{const s=await ea({onClose:()=>{a(de)},children:t.jsx(t.Fragment,{children:t.jsx(rl,{onConfirm:()=>{var n;(n=s.current)==null||n.close(),e()}})})})}),ol=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2L9.19 8.63L2 9.24l5.46 4.73L5.82 21z"})}),cl=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"m22 9.24l-7.19-.62L12 2L9.19 8.63L2 9.24l5.46 4.73L5.82 21L12 17.27L18.18 21l-1.63-7.03L22 9.24zM12 15.4l-3.76 2.27l1-4.28l-3.32-2.88l4.38-.38L12 6.1l1.71 4.04l4.38.38l-3.32 2.88l1 4.28L12 15.4z"})});function dl(e){const{updateTaskFavoriteDelete:a}=ba(),[,s]=l.useContext(se),n=e.bookmarked,{t:i}=$(["artwork"]),[r,d]=ve(async()=>{var o;try{await W.updateBookmarkItem({input:{taskId:e.taskId,mediaId:e.mediaId,remove:n}}),F.success(i(n?"artwork:bookmark.notice.remove-success":"artwork:bookmark.notice.success")),s(c=>{const u=[...c],h=u.findIndex(m=>m.mediaId===e.mediaId);return h<0?c:(u.splice(h,1,{...u[h],bookmarked:!n}),u)}),a(e.taskId,{type:"favorite",mediaId:e.mediaId,target:!n}),(o=e.afterAction)==null||o.call(e,!n)}catch(c){F.error(c.message)}},[n,e.taskId,e.mediaId]);return t.jsx(Q,{title:t.jsx("span",{className:"capitalize",children:i(n?"artwork:bookmark.remove.label":"artwork:bookmark.add.label")}),children:t.jsx(K,{busy:r,onPress:d,variant:"ghost",className:"rounded-full p-2 bg-white hover:bg-white dark:hover:bg-white ml-auto shadow-lg",labelClassName:"text-amber-400 dark:text-amber-400",children:n?t.jsx(ol,{className:"size-5"}):t.jsx(cl,{className:"size-5"})})})}const ml=()=>[{name:"download-button",ariaLabel:"Download",order:8,isButton:!0,tagName:"button",appendTo:"bar",html:{isCustomSVG:!0,inner:'<path d="M20.5 14.3 17.1 18V10h-2.2v7.9l-3.4-3.6L10 16l6 6.1 6-6.1ZM23 23H9v2h14Z" id="pswp__icn-download"/>',outlineID:"pswp__icn-download"},onClick:(e,a,s)=>{var c,u,h,m,f,p;const n=((c=s.currSlide)==null?void 0:c.data.pid)??"",i=n.split("#")[0]||void 0,r=n.split("#")[1]||void 0,d=(h=(u=s.currSlide)==null?void 0:u.data)==null?void 0:h.task,o=(f=(m=s.currSlide)==null?void 0:m.data)==null?void 0:f.videoMedia;(p=s.currSlide)!=null&&p.data.src&&mt((o==null?void 0:o.fileUrl)??s.currSlide.data.src,`${Ia({task:d,mediaIdx:r})}.${Ca({task:d})}`,{skipConversion:aa(d)}),(d==null?void 0:d.parameters)!=null&&q({type:"download",action:"confirm",taskId:d.id,taskParams:d.parameters,otherParams:{scene:"gen",mediaId:i}})}}];function ul(e){var N,A,V;const[,a]=l.useContext(se),{t:s}=$(["artwork"]),[n,i]=l.useContext(xa),[r,d]=l.useState(!1),[o,c]=l.useState(!1),[u,h]=l.useState(!1),{data:m}=oe(e.taskId),{data:f}=ae(e.mediaId),p=f;De(p),l.useEffect(()=>{var B;p&&((B=e.onMediaLoad)==null||B.call(e,p))},[p,e]),l.useEffect(()=>{(m==null?void 0:m.status)==="completed"&&e.mediaId==null&&a(B=>{const ee=[...B];return $i(ee,m)})},[m==null?void 0:m.id,m==null?void 0:m.status,e.mediaId,e.idx]);const b=l.useCallback(()=>{e.itemsCount!==1&&(d(!0),i(e.mediaId))},[e.itemsCount,e.mediaId]),v=B=>()=>{e.itemsCount!==1&&(B==="toolbar"?c(!0):h(!0))},k=B=>()=>{e.itemsCount!==1&&(B==="toolbar"?c(!1):B==="action"?h(!1):d(!1))};sa(()=>{!r&&!o&&!u&&n===e.mediaId&&i(void 0)},100,[r,o,u,e.mediaId]);const w=l.useCallback(()=>{j(!1)},[]);(((N=m==null?void 0:m.parameters)==null?void 0:N.upscale)??0)>1;const{data:x}=ye(),[g,j]=l.useState(!0),I=ue();if(e.deleted)return t.jsx("div",{className:C(X["image-wrapper"]),style:{aspectRatio:`${Me(p)}`},children:t.jsx("div",{className:"flex items-center justify-center text-base font-medium text-center p-2 bg-gray-700 text-white rounded-md size-full",children:s("artwork:generation.image-deleted")})});if(p)return t.jsxs("div",{className:X["image-wrapper"],style:{aspectRatio:`${Me(p)}`},children:[t.jsx(hl,{media:p,task:m,idx:e.idx,itemsCount:e.itemsCount,onMouseEnter:b,onMouseLeave:k("image"),onImgLoad:w}),t.jsx(Et,{children:!g&&(n===e.mediaId||e.itemsCount===1||I)&&t.jsxs(t.Fragment,{children:[t.jsx(gl,{taskId:e.taskId,baseMedia:f,itemIdx:e.idx,bookmarked:e.bookmarked,onMouseEnter:v("toolbar"),onMouseLeave:k("toolbar")}),x&&t.jsx(fl,{taskId:e.taskId,baseMedia:f,itemIdx:e.idx,bookmarked:e.bookmarked,onMouseEnter:v("action"),onMouseLeave:k("action")})]})})]});if(!m)return t.jsx(ne,{inline:!0,className:"absolute inset-0 m-auto"});const S=(m==null?void 0:m.parameters.width)??((A=m==null?void 0:m.media)==null?void 0:A.width)??512,y=(m==null?void 0:m.parameters.height)??((V=m==null?void 0:m.media)==null?void 0:V.height)??512;return t.jsxs(Wa,{className:C(X["image-placeholder"],"w-full h-full overflow-hidden rounded-md"),style:S&&y?{aspectRatio:Me({width:S,height:y}),maxWidth:e.itemsCount===2&&S,maxHeight:e.itemsCount===2&&y}:void 0,id:m==null?void 0:m.id,status:m.status,placeholderVariant:m.parameters.priority===U.default?"dark-purple":"default",children:[t.jsx(jl,{priority:m.parameters.priority}),(x==null?void 0:x.isAdmin)&&t.jsx(Q,{title:"admin only",children:t.jsx(O,{variant:"contained",color:"warning",onClick:()=>{Ma(m)},children:"Inspect"})})]})}function hl(e){var ee;const[a,s]=l.useState(null),[n,i]=l.useState(!1),[r,d]=l.useState(!1),{media:o,task:c}=e,u=De(o),h=na(o),m=an(o),f=(((ee=c==null?void 0:c.parameters)==null?void 0:ee.upscale)??0)>1,p=l.useCallback(()=>q({type:"click",taskId:c==null?void 0:c.id,taskParams:c==null?void 0:c.parameters,otherParams:{scene:"gen",mediaId:o.id,mediaIdx:e.idx}}),[c==null?void 0:c.parameters,o.id,e.idx]),{height:b,width:v}=o;l.useEffect(()=>{if(e.enableWatermark&&!(!u||!b||!v))return wn({src:u,height:b,width:v}).then(M=>{M&&s(M)}),()=>{a&&URL.revokeObjectURL(a)}},[u,v,b,e.enableWatermark]);const k=e.enableWatermark?a:u,w=e.enableWatermark&&!a,x=ia(c),{data:g}=ae(x),j=nt(g),I=l.useRef(null),[S,y]=l.useState(!1),N=l.useCallback(()=>{var M;y(!0),(M=I.current)==null||M.pause()},[]),A=l.useCallback((M,P)=>{w||(T("task_image_click",{scene:e.itemsCount}),p(),P(M))},[w,e.itemsCount]),V=l.useCallback(()=>(i(!0),e.onImgLoad()),[e.onImgLoad]),B=l.useCallback(()=>{d(!0)},[]);return t.jsx(yn,{original:k??u,thumbnail:h,width:o.width,height:o.height,id:`${o.id}#${e.idx}`,task:c,videoMedia:g,children:({ref:M,open:P})=>t.jsxs("div",{ref:M,className:"h-full relative",style:{minWidth:80,minHeight:80},children:[!n&&t.jsx(qe,{className:"w-6 h-6 absolute inset-0 m-auto animate-spin"}),t.jsx("img",{crossOrigin:"anonymous",className:C("relative z-10 h-full object-center object-contain rounded-md",w&&"cursor-wait"),src:x?m:u,onClick:L=>A(L,P),onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,width:f?c==null?void 0:c.parameters.width:void 0,height:f?c==null?void 0:c.parameters.height:void 0,onLoad:V}),g&&t.jsxs(t.Fragment,{children:[t.jsx(it,{ref:I,media:g,autoPlay:!0,className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-10 h-full rounded-md object-center object-contain",onLoadedData:B,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:N}),!r&&t.jsx("div",{className:"absolute inset-0 bg-white/40 dark:bg-neutral-900/60 z-20",children:t.jsx(qe,{className:"w-6 h-6 absolute inset-0 m-auto animate-spin"})}),S&&t.jsx(Ea,{videoUrl:j||"",fileName:`pixai-${g.id}.mp4`,onClose:()=>{var L;y(!1),(L=I.current)==null||L.play()}})]})]})})}function fl(e){var h,m;const[,a]=l.useContext(he),{data:s,mutate:n}=oe(e.taskId),i=la(s),{t:r}=$(["generation"]),d=(s==null?void 0:s.parameters.batchSize)===3&&((h=e.baseMedia)==null?void 0:h.id)===s.parameters.mediaId,o=Ha(s,(m=e.baseMedia)==null?void 0:m.id),c=f=>{var b;const p={type:"fav",action:f?"confirm":"cancel",taskId:s==null?void 0:s.id,taskParams:s==null?void 0:s.parameters,otherParams:{scene:"gen",mediaIdx:o,mediaId:(b=e.baseMedia)==null?void 0:b.id}};q(p)},u=(()=>{var f,p,b;return!((s==null?void 0:s.status)!=="completed"||(p=s.artworks)!=null&&p.map(v=>v.mediaId).includes((f=e.baseMedia)==null?void 0:f.id)||(s==null?void 0:s.parameters.batchSize)===3&&((b=e.baseMedia)==null?void 0:b.id)===s.parameters.mediaId||i)})();return t.jsxs(J.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-x-0 bottom-2 w-full flex items-center gap-2 px-2 z-20",onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[!i&&!je(s)&&t.jsx(Q,{title:r("generation:image-operation.scale"),children:t.jsx(zt,{className:"rounded-full w-10 h-10 p-2 mr-auto text-black bg-white shadow hover:shadow-md shadow-black/40",disabled:!(s!=null&&s.id),onClick:f=>{var p;f.stopPropagation(),T("base_image_upscale_click",{path:e.baseMedia?"batch":"single"}),a({taskId:s==null?void 0:s.id,baseMedia:e.baseMedia,openUpscaleDialog:!0}),q({type:"upscale",action:"click",taskId:s==null?void 0:s.id,taskParams:s==null?void 0:s.parameters,otherParams:{scene:"gen",mediaId:(p=e.baseMedia)==null?void 0:p.id,mediaIdx:o}})},children:t.jsx(Ra,{height:20,width:20})})}),u&&t.jsx(O,{variant:"contained",className:"px-3",onClick:f=>{f.stopPropagation(),T("publish_btn_click",{path:e.baseMedia?"batch":"single",scene:"panel"}),a({taskId:s.id,mediaIdx:o,baseMedia:e.baseMedia,openPublishDialog:!0})},children:t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(Fa,{className:"size-5"}),r("artwork:publish")]})}),(s==null?void 0:s.status)==="completed"&&e.baseMedia&&!d&&t.jsx(dl,{taskId:s.id,mediaId:e.baseMedia.id,bookmarked:e.bookmarked,afterAction:c})]})}function gl(e){var V,B,ee;const{t:a}=$(["artwork","common","generation"]),{dispatch:s}=l.useContext(pa),n=l.useContext(ja),{updateTaskFavoriteDelete:i}=ba(),[,r]=l.useContext(he),[,d]=l.useContext(se),{data:o,mutate:c}=oe(e.taskId),u=la(o),{data:h}=ae(u?ia(o):void 0),{data:m}=ye(),[,f]=l.useContext(va),{values:p,setValues:b}=pe(),v=(M,P=M.media)=>{b(L=>({...L,baseImage:P?ke.fromMedia(P):void 0,...Ua(M,P),inpaintMaskImage:void 0,previewImage:void 0})),f(L=>({...L,dirty:!0}))},k=(p.controlNets??[]).length>0,w=(o==null?void 0:o.parameters.batchSize)===3&&((V=e.baseMedia)==null?void 0:V.id)===o.parameters.mediaId,x=Ha(o,(B=e.baseMedia)==null?void 0:B.id),g=()=>{b(M=>({...M,controlNets:[]}))},j=()=>{b(M=>({...M,upscale:void 0,upscaleDenoisingSteps:void 0,upscaleDenoisingStrength:void 0}))},I=M=>{var P;q({type:"delete",action:M!=null&&M.onCancel?"cancel":"confirm",taskId:o==null?void 0:o.id,taskParams:o==null?void 0:o.parameters,otherParams:{scene:"gen",mediaIdx:x,mediaId:(P=e.baseMedia)==null?void 0:P.id}})},S=ue(),y=1,N="left",A=S?"medium":"small";return t.jsxs(J.div,{initial:{x:36*y,opacity:0},animate:{x:0,opacity:1},transition:{type:"spring",bounce:0,duration:.4},exit:{x:36*y,opacity:0},className:C("absolute top-0 p-1 h-full flex flex-col border bg-neutral-100 dark:bg-neutral-700 border-stone-800/20 overflow-y-auto","pr-6 rounded-l-lg",S?"-left-12":"-left-11"),onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.baseMedia&&!u&&t.jsx(Vi,{scene:"panel",taskParameters:o,itemIdx:e.itemIdx,mediaId:e.baseMedia.id,tooltip:a("generation:animated-image.animate-button.label")}),t.jsx("div",{className:"flex-1"}),(m==null?void 0:m.isAdmin)&&t.jsx(Q,{title:"Inspect (admin only)",placement:N,children:t.jsx(O,{size:A,className:C(X["generated-task-top-operation-btn"],"opacity-20"),onClick:()=>{Ma(o)},children:t.jsx(ka,{className:"size-5"})})}),t.jsx("div",{className:"flex-1"}),!u&&t.jsx(Q,{title:a("generation:image-operation.captioning"),placement:N,children:t.jsx(O,{className:C(X["generated-task-top-operation-btn"]),disabled:!(o!=null&&o.id),onClick:M=>{M.stopPropagation(),T("base_image_captioning_click"),r({taskId:o==null?void 0:o.id,baseMedia:e.baseMedia,mediaIdx:x,openCaptioningDialog:!0})},children:t.jsx(Ni,{})})}),(o==null?void 0:o.status)==="completed"&&!w&&!e.bookmarked&&t.jsx(Q,{title:t.jsx("span",{className:"capitalize",children:a("generation:delete-media.label")}),placement:N,children:t.jsx(Ii,{size:A==="medium"?"normal":A,task:o,mediaId:(ee=e.baseMedia)==null?void 0:ee.id,variant:"ghost",onTaskDelete:async()=>{I(),c(),r({}),d(P=>[...P].filter(E=>E.taskId!==o.id)),i(o.id,{type:"delete",target:!0}),Math.random()<.25&&await Tt()},onMediaDelete:async M=>{I(),d(L=>{const E=[...L],R=E.findIndex(ie=>ie.mediaId===M);return R<0?L:(E.splice(R,1,{...E[R],deleted:!0}),E)}),i(o.id,{type:"delete",mediaId:M,target:!0}),c(),r({}),Math.random()<.25&&await Tt()},onCancel:()=>I({onCancel:!0}),className:C(X["generated-task-top-operation-btn"]),children:t.jsx($n,{className:"size-5 mx-auto"})})}),!u&&t.jsx(Q,{title:a("generation:image-operation.variation"),placement:N,children:t.jsx(O,{size:A,className:C(X["generated-task-top-operation-btn"]),disabled:!(o!=null&&o.id),onClick:M=>{var P;M.stopPropagation(),T("base_image_variations_click"),r({taskId:o==null?void 0:o.id,baseMedia:e.baseMedia,openVariationDialog:!0}),q({type:"variation",action:"click",taskId:o==null?void 0:o.id,taskParams:o==null?void 0:o.parameters,otherParams:{scene:"gen",mediaId:(P=e.baseMedia)==null?void 0:P.id,mediaIdx:x}})},children:t.jsx(Pa,{className:"size-5"})})}),!u&&t.jsx(Q,{title:a("generation:image-operation.edit"),placement:N,children:t.jsx(O,{size:A,className:C(X["generated-task-top-operation-btn"]),onClick:M=>{M.stopPropagation(),T("base_image_edit_click",{label:"left"}),e.baseMedia&&(n.current.setBaseImageFromMedia(e.baseMedia,{task:o,cate:"task"}),s({type:"set-mode",value:ra.Fill}),j(),k&&g())},children:t.jsx(Ln,{className:"size-5"})})}),!u&&t.jsx(Q,{title:a("generation:image-operation.use-base-image"),placement:N,children:t.jsx(O,{size:A,className:X["generated-task-top-operation-btn"],disabled:!(o!=null&&o.id),onClick:M=>{M.stopPropagation(),T("use_as_base_click",{scene:"gen"}),o&&(f(P=>({...P,isInpaintOn:!1})),v(o,e.baseMedia),j(),k&&g(),F.info(a("generation:image-operation.notice.added-as-base-image")))},children:t.jsx(kn,{className:"size-5"})})}),(o==null?void 0:o.status)==="completed"&&t.jsx(Q,{title:a("generation:image-operation.download-image"),placement:N,children:t.jsx(O,{size:A,className:X["generated-task-top-operation-btn"],disabled:!(o!=null&&o.id),onClick:M=>{var E,R,ie;if(M.stopPropagation(),!o)return;const P=e.baseMedia??o.media;T("image_dl",{scene:"gen",authorId:o==null?void 0:o.userId,artworkId:(R=(E=o.artworks)==null?void 0:E.find(fe=>{var le;return fe.mediaId===((le=e.baseMedia)==null?void 0:le.id)}))==null?void 0:R.id,mediaId:u?h==null?void 0:h.id:P==null?void 0:P.id}),q({type:"download",action:"confirm",taskId:o.id,taskParams:o.parameters,otherParams:{scene:"gen",mediaId:(ie=e.baseMedia)==null?void 0:ie.id,mediaIdx:x}});const L=(u?nt(h):null)||De(P);L?mt(L,`${Ia({task:o,mediaIdx:x})}.${Ca({task:o})}`,{skipConversion:u}):F.error("Cannot download image")},children:t.jsx(In,{className:"size-5"})})})]})}function xl(){const[e,a]=l.useContext(he),s=l.useRef(null),n=()=>{a({openUpscaleDialog:!1})};return t.jsx(oa,{open:!!(e!=null&&e.openUpscaleDialog),onClose:(i,r)=>{var d;(d=s.current)==null||d.onCancel(),n()},PaperProps:{sx:{minWidth:400}},children:e!=null&&e.taskId?t.jsx(il,{mediaIdx:e.mediaIdx,taskId:e.taskId,baseMedia:e.baseMedia,onClose:n,onCancelCallbackRef:s}):null})}function bl(){const[e,a]=l.useContext(he),s=l.useRef(null),n=()=>{a({openVariationDialog:!1})};return t.jsx(oa,{open:!!(e!=null&&e.openVariationDialog),onClose:(i,r)=>{var d;(d=s.current)==null||d.onCancel(),n()},PaperProps:{sx:{minWidth:400}},children:e!=null&&e.taskId?t.jsx(sl,{mediaIdx:e.mediaIdx,taskId:e.taskId,baseMedia:e.baseMedia,onClose:n,onCancelCallbackRef:s}):null})}function pl(){const[e,a]=l.useContext(he),{data:s}=oe(e.taskId);return t.jsx(t.Fragment,{children:t.jsx(at,{open:e.openPublishDialog??!1,onClose:()=>a({openPublishDialog:!1}),dismissable:!0,className:"mlg:w-[600px]",children:s?t.jsx(Ga,{scene:"generation",mediaIdx:e.mediaIdx,task:s,openShareAfterSuccess:!0,onSuccess:()=>{a({openPublishDialog:!1})}}):t.jsx(ne,{})})})}function jl(e){const{t:a}=$(["generation"]);return e.priority!==U.default&&e.priority!==U.turboMode?null:t.jsx("div",{className:"-translate-y-3 bg-black/20 rounded-[4px] px-[3px]",children:t.jsx("p",{className:"bg-clip-text bg-gradient-purple-pink text-transparent font-medium text-[10px]",children:e.priority===U.turboMode?a("generation:generate.turbo-mode.on-label"):a("generation:generate.high-priority.on-label")})})}const vl=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8s8 3.58 8 8s-3.58 8-8 8zm-.22-13h-.06c-.4 0-.72.32-.72.72v4.72c0 .35.18.68.49.86l4.15 2.49c.34.2.78.1.98-.24a.71.71 0 0 0-.25-.99l-3.87-2.3V7.72c0-.4-.32-.72-.72-.72z"})}),Za="Collapsible",[wl,eo]=ca(Za),[yl,gt]=wl(Za),kl=l.forwardRef((e,a)=>{const{__scopeCollapsible:s,open:n,defaultOpen:i,disabled:r,onOpenChange:d,...o}=e,[c=!1,u]=da({prop:n,defaultProp:i,onChange:d});return l.createElement(yl,{scope:s,disabled:r,contentId:ma(),open:c,onOpenToggle:l.useCallback(()=>u(h=>!h),[u])},l.createElement(ce.div,te({"data-state":xt(c),"data-disabled":r?"":void 0},o,{ref:a})))}),Il="CollapsibleTrigger",Cl=l.forwardRef((e,a)=>{const{__scopeCollapsible:s,...n}=e,i=gt(Il,s);return l.createElement(ce.button,te({type:"button","aria-controls":i.contentId,"aria-expanded":i.open||!1,"data-state":xt(i.open),"data-disabled":i.disabled?"":void 0,disabled:i.disabled},n,{ref:a,onClick:Se(e.onClick,i.onOpenToggle)}))}),Qa="CollapsibleContent",Nl=l.forwardRef((e,a)=>{const{forceMount:s,...n}=e,i=gt(Qa,e.__scopeCollapsible);return l.createElement(ua,{present:s||i.open},({present:r})=>l.createElement(Ml,te({},n,{ref:a,present:r})))}),Ml=l.forwardRef((e,a)=>{const{__scopeCollapsible:s,present:n,children:i,...r}=e,d=gt(Qa,s),[o,c]=l.useState(n),u=l.useRef(null),h=sn(a,u),m=l.useRef(0),f=m.current,p=l.useRef(0),b=p.current,v=d.open||o,k=l.useRef(v),w=l.useRef();return l.useEffect(()=>{const x=requestAnimationFrame(()=>k.current=!1);return()=>cancelAnimationFrame(x)},[]),nn(()=>{const x=u.current;if(x){w.current=w.current||{transitionDuration:x.style.transitionDuration,animationName:x.style.animationName},x.style.transitionDuration="0s",x.style.animationName="none";const g=x.getBoundingClientRect();m.current=g.height,p.current=g.width,k.current||(x.style.transitionDuration=w.current.transitionDuration,x.style.animationName=w.current.animationName),c(n)}},[d.open,n]),l.createElement(ce.div,te({"data-state":xt(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!v},r,{ref:h,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":b?`${b}px`:void 0,...e.style}}),v&&i)});function xt(e){return e?"open":"closed"}const Sl=kl,Tl=Cl,_l=Nl,Xa="Tabs",[$l,to]=ca(Xa,[wa]),Ya=wa(),[Ll,bt]=$l(Xa),Al=l.forwardRef((e,a)=>{const{__scopeTabs:s,value:n,onValueChange:i,defaultValue:r,orientation:d="horizontal",dir:o,activationMode:c="automatic",...u}=e,h=Nn(o),[m,f]=da({prop:n,onChange:i,defaultProp:r});return l.createElement(Ll,{scope:s,baseId:ma(),value:m,onValueChange:f,orientation:d,dir:h,activationMode:c},l.createElement(ce.div,te({dir:h,"data-orientation":d},u,{ref:a})))}),Pl="TabsList",Dl=l.forwardRef((e,a)=>{const{__scopeTabs:s,loop:n=!0,...i}=e,r=bt(Pl,s),d=Ya(s);return l.createElement(Mn,te({asChild:!0},d,{orientation:r.orientation,dir:r.dir,loop:n}),l.createElement(ce.div,te({role:"tablist","aria-orientation":r.orientation},i,{ref:a})))}),El="TabsTrigger",Fl=l.forwardRef((e,a)=>{const{__scopeTabs:s,value:n,disabled:i=!1,...r}=e,d=bt(El,s),o=Ya(s),c=Ja(d.baseId,n),u=es(d.baseId,n),h=n===d.value;return l.createElement(Sn,te({asChild:!0},o,{focusable:!i,active:h}),l.createElement(ce.button,te({type:"button",role:"tab","aria-selected":h,"aria-controls":u,"data-state":h?"active":"inactive","data-disabled":i?"":void 0,disabled:i,id:c},r,{ref:a,onMouseDown:Se(e.onMouseDown,m=>{!i&&m.button===0&&m.ctrlKey===!1?d.onValueChange(n):m.preventDefault()}),onKeyDown:Se(e.onKeyDown,m=>{[" ","Enter"].includes(m.key)&&d.onValueChange(n)}),onFocus:Se(e.onFocus,()=>{const m=d.activationMode!=="manual";!h&&!i&&m&&d.onValueChange(n)})})))}),Rl="TabsContent",zl=l.forwardRef((e,a)=>{const{__scopeTabs:s,value:n,forceMount:i,children:r,...d}=e,o=bt(Rl,s),c=Ja(o.baseId,n),u=es(o.baseId,n),h=n===o.value,m=l.useRef(h);return l.useEffect(()=>{const f=requestAnimationFrame(()=>m.current=!1);return()=>cancelAnimationFrame(f)},[]),l.createElement(ua,{present:i||h},({present:f})=>l.createElement(ce.div,te({"data-state":h?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":c,hidden:!f,id:u,tabIndex:0},d,{ref:a,style:{...e.style,animationDuration:m.current?"0s":void 0}}),f&&r))});function Ja(e,a){return`${e}-trigger-${a}`}function es(e,a){return`${e}-content-${a}`}const Bl=Al,Vl=Dl,_t=Fl,$t=zl;function ts(e){const{items:a,itemContent:s=x=>t.jsx("div",{children:String(x)}),groups:n=[void 0],groupSorter:i=()=>{},groupHeaderContent:r=x=>x,columns:d=3,footerContent:o,classes:c={},styles:u={},atBottomStateChange:h,isScrollingStateChange:m}=e,f=l.useMemo(()=>{var g;const x=new Map(n.map(j=>[j,[]]));for(const j of e.items)(g=x.get(i(j)))==null||g.push(j);return x},[a,n,i]),p=l.useMemo(()=>n.map(x=>ei(f.get(x),d)).flat(),[f]),b=n.map(x=>{var g;return Math.ceil((((g=f.get(x))==null?void 0:g.length)??0)/d)}),v=l.useMemo(()=>l.forwardRef(function(g,j){const I=g["data-test-id"]==="virtuoso-top-item-list";return t.jsx("div",{ref:j,...g,className:I?void 0:c.list,style:{...g.style,...I?void 0:u.list}})}),[c.list,u.list]),k=l.useMemo(()=>l.forwardRef(function(g,j){return t.jsx("div",{ref:j,...g,className:c.groupHeader,style:u.groupHeader})}),[c.groupHeader,u.groupHeader]),w=l.useMemo(()=>function(){return o?t.jsx(t.Fragment,{children:o}):null},[o]);return t.jsx(Zn,{groupCounts:b,groupContent:x=>r(n[x],x),itemContent:x=>{var g;return t.jsx("div",{className:c.row,style:{display:"grid",gridTemplateColumns:`repeat(${d}, 1fr)`,...u.row},children:(g=p[x])==null?void 0:g.map((j,I)=>t.jsx("div",{className:"contents",children:s(j)},`${x}-${I}`))})},className:e.className,style:e.style,atBottomStateChange:h,atBottomThreshold:300,isScrolling:m,components:{List:v,Group:k,Footer:w}})}const Ul=e=>t.jsx("svg",{viewBox:"0 0 16 16",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M5.465 9.83a.92.92 0 0 0 1.07-.001a1 1 0 0 0 .341-.459l.347-1.067a1.7 1.7 0 0 1 1.078-1.079l1.086-.353a.923.923 0 0 0-.037-1.75l-1.069-.346a1.7 1.7 0 0 1-1.08-1.078l-.353-1.084a.92.92 0 0 0-.869-.61a.92.92 0 0 0-.875.624l-.356 1.09A1.71 1.71 0 0 1 3.7 4.775l-1.084.351a.923.923 0 0 0 .013 1.745l1.067.347a1.71 1.71 0 0 1 1.081 1.083l.352 1.08c.063.18.181.337.337.448m5.07 4.021a.8.8 0 0 0 .464.148a.81.81 0 0 0 .759-.55l.248-.762c.053-.158.143-.303.26-.421s.262-.207.42-.259l.772-.252a.8.8 0 0 0-.023-1.521l-.764-.249a1.08 1.08 0 0 1-.68-.678l-.252-.774a.8.8 0 0 0-1.518.011l-.247.762a1.07 1.07 0 0 1-.664.679l-.776.253a.8.8 0 0 0-.388 1.221c.099.14.239.245.4.3l.763.247a1.08 1.08 0 0 1 .68.683l.253.774a.8.8 0 0 0 .292.388"})}),Hl=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"m21.9 21.9l-8.49-8.49l-9.82-9.82L2.1 2.1L.69 3.51L3 5.83V19c0 1.1.9 2 2 2h13.17l2.31 2.31l1.42-1.41zM5 18l3.5-4.5l2.5 3.01L12.17 15l3 3H5zm16 .17L5.83 3H19c1.1 0 2 .9 2 2v13.17z"})}),Gl=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M21 3H3C2 3 1 4 1 5v14c0 1.1.9 2 2 2h18c1 0 2-1 2-2V5c0-1-1-2-2-2zM5 17l3.5-4.5l2.5 3.01L14.5 11l4.5 6H5z"})}),Ol=e=>t.jsxs("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:[t.jsx("path",{fill:"currentColor",d:"M18.29 17.29a.996.996 0 0 0 0-1.41L14.42 12l3.88-3.88a.996.996 0 1 0-1.41-1.41L12.3 11.3a.996.996 0 0 0 0 1.41l4.59 4.59c.38.38 1.01.38 1.4-.01z"}),t.jsx("path",{fill:"currentColor",d:"M11.7 17.29a.996.996 0 0 0 0-1.41L7.83 12l3.88-3.88a.996.996 0 1 0-1.41-1.41L5.71 11.3a.996.996 0 0 0 0 1.41l4.59 4.59c.38.38 1.01.38 1.4-.01z"})]}),Wl=e=>t.jsxs("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:[t.jsx("path",{fill:"currentColor",d:"M5.7 6.71a.996.996 0 0 0 0 1.41L9.58 12L5.7 15.88a.996.996 0 1 0 1.41 1.41l4.59-4.59a.996.996 0 0 0 0-1.41L7.12 6.71c-.39-.39-1.03-.39-1.42 0z"}),t.jsx("path",{fill:"currentColor",d:"M12.29 6.71a.996.996 0 0 0 0 1.41L16.17 12l-3.88 3.88a.996.996 0 1 0 1.41 1.41l4.59-4.59a.996.996 0 0 0 0-1.41L13.7 6.7c-.38-.38-1.02-.38-1.41.01z"})]}),ql=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M18 12.998H6a1 1 0 0 1 0-2h12a1 1 0 0 1 0 2z"})});function Kl(e){var I;const{baseImageMedia:a,task:s,artwork:n,allowedSamplingMethods:i,modelVersion:r,loraVersion:d,presetModelList:o,options:c,extraInitialValues:u}=e,{isUseAsReference:h}=c??{},m=n||s?ut(n,s):{};let f;if(a&&!h)try{f=ke.fromMedia(a)}catch{}const p=typeof(s==null?void 0:s.id)=="string"&&!r,b=r?r.model:ln(o,d==null?void 0:d.modelType),v=r??(b==null?void 0:b.latestAvailableVersion),k=b==null?void 0:b.extra,w=v==null?void 0:v.extra,x=p?void 0:rn({versionExtra:w,modelExtra:k,modelId:b==null?void 0:b.id},{skipEmptyFields:!0,enableLightningMode:!0}),{width:g,height:j}=h?on(a??(s==null?void 0:s.parameters)):s?Ua(s,a):Sa(a);return{..._e,baseImage:f,...f?{strength:((I=s==null?void 0:s.parameters)==null?void 0:I.strength)??_e.strength}:{},...Ut(m,(S,y)=>{if(y==="samplingMethod"&&!(i??[]).includes(S)||y==="seed")return!1;if(S!=null)return!0}),width:g,height:j,inpaintMaskImage:void 0,previewImage:void 0,seed:"",...h?{upscale:void 0,upscaleDenoisingSteps:void 0,upscaleDenoisingStrength:void 0,enlarge:void 0}:{},...!p&&v?{modelId:v.id,...x}:{},...u}}function Zl(e){const{data:a}=ae(e.mediaIds[0]);return t.jsx("div",{className:"grid grid-cols-2 grid-rows-2 gap-4 p-4 max-w-full items-center justify-items-center",style:{width:`calc((100dvh - 64px) * ${Me(a)})`},children:e.mediaIds.map(s=>t.jsx(Ql,{mediaId:s,onConfirm:e.onConfirm},s))})}function Ql(e){const{data:a,isValidating:s}=ae(e.mediaId),n=na(a);return!a&&s?t.jsx(ne,{}):a&&n?t.jsx("button",{className:"size-full hover:shadow-xl hover:-translate-y-1 transition-all",onClick:()=>{e.onConfirm(a)},children:t.jsx("img",{className:"rounded-2xl size-full object-cover",src:n})}):null}const as=e=>new Promise((a,s)=>{const n=ea({PaperProps:{className:"w-auto rounded-[2rem]"},children:t.jsx(Zl,{mediaIds:e,onCancel:()=>{var i;(i=n.current)==null||i.close(),s(de)},onConfirm:i=>{var r;(r=n.current)==null||r.close(),a(i)}}),onClose:()=>{s(de)},fullWidth:!0,maxWidth:"md",scroll:"paper"})});var Lt;(function(e){e.Tasks="tasks",e.Favorites="favorites"})(Lt||(Lt={}));const Xl=Y.duration(1,"hour").as("ms"),Yl=Y.duration(6,"hours").as("ms"),ss={"1h":"generation:task-list.groups.in-1-hour","6h":"generation:task-list.groups.in-6-hours",today:"generation:task-list.groups.today",yesterday:"generation:task-list.groups.yesterday"};function Ae(e,a){const s=Date.now();return be(Y(e)).when(n=>n.isAfter(s-Xl),()=>a?Y.duration(1,"hour").humanize():"1h").when(n=>n.isAfter(s-Yl),()=>a?Y.duration(6,"hours").humanize():"6h").when(n=>n.isAfter(Y().startOf("day").valueOf()-1),()=>"today").when(n=>n.isAfter(Y().subtract(1,"day").startOf("day").valueOf()-1),()=>"yesterday").otherwise(()=>Y(e).format(a?"MMM D":"LL"))}const At=1,Pt=6,pt=ha(3),ns=ha("");function Jl({allowedTypes:e,scene:a,afterClick:s,className:n,style:i,onSelectItem:r,enableClickToImportTask:d,enableBatchMediaSelect:o}){const{data:c}=ye(),u=c,[h,m]=l.useState("tasks");l.useEffect(()=>{c||m("tasks")},[c]);const{t:f}=$(["common","generation"]),p={tab:"p-2 -m-2 data-[state=inactive]:text-[rgb(var(--fg-color)/.4)]",content:"flex-1 data-[state=active]:flex flex-col overflow-hidden"},b=ue("lg"),[v,k]=cn("generator-task-panel-open",!1),w=v||b,[x,g]=l.useState(!1),[,j]=Qe(ns);l.useEffect(()=>{(!w||!x)&&j("")},[w,x]);const I=N=>{j(N),T("task_search_commit",{scene:"generator"})},[S,y]=Qe(pt);return t.jsxs(Bl,{value:h,onValueChange:N=>{T("i2i_left_tab_click",{label:N}),m(N)},className:C("flex flex-col overflow-hidden",w?"mmd:w-80":"mmd:w-28",n),style:{"--grid-size":S,...i},children:[t.jsxs(Sl,{className:"flex-none flex p-2",open:w,onOpenChange:N=>{k(N),m("tasks")},children:[t.jsx(_l,{children:t.jsxs(Vl,{className:"flex-none flex gap-4 p-2",children:[t.jsx(_t,{value:"tasks",className:p.tab,children:f("generation:tasks.label")}),u&&t.jsx(_t,{value:"favorites",className:p.tab,children:t.jsx(D,{i18nKey:"user:profile-sub-tab.favorites.label"})})]})}),!w&&t.jsx("div",{className:"p-2",children:f("generation:tasks.label")}),t.jsx("span",{className:"mx-auto"}),w&&t.jsxs("span",{className:"inline-flex overflow-hidden rounded-lg",children:[h==="tasks"?t.jsx("button",{className:"inline-grid place-content-center p-2 active:bg-black/10 dark:active:bg-white/10 rounded transition",onClick:()=>{g(N=>!N),T("task_search_toggle",{open:!x,scene:"generator"})},children:t.jsx(ka,{})}):null,t.jsx("button",{disabled:S===Pt,className:"inline-grid place-content-center p-2 pr-1 active:bg-black/10 dark:active:bg-white/10 rounded disabled:opacity-40 transition",onClick:()=>{y(N=>Math.min(Pt,N+1))},children:t.jsx(ql,{className:"size-5"})}),t.jsx("button",{disabled:S===At,className:"inline-grid place-content-center p-2 pl-1 active:bg-black/10 dark:active:bg-white/10 rounded disabled:opacity-40 transition",onClick:()=>{y(N=>Math.max(At,N-1))},children:t.jsx(Xn,{className:"size-5"})})]}),t.jsx(Tl,{className:"-mr-1 p-2 active:bg-black/10 dark:active:bg-white/10 rounded-lg transition",children:!b&&(w?t.jsx(Ol,{className:"size-5"}):t.jsx(Wl,{className:"size-5"}))})]}),c&&t.jsx($t,{value:"tasks",className:C(p.content,"!overflow-auto"),children:t.jsxs(l.Suspense,{fallback:t.jsx(ne,{}),children:[w&&x?t.jsx("div",{className:"my-px mx-2",children:t.jsx(ta,{fullWidth:!0,size:"small",placeholder:f("common:search"),onKeyDown:N=>{N.key==="Enter"&&I(N.currentTarget.value)},onBlur:N=>{I(N.currentTarget.value)}})}):null,t.jsx(er,{allowedTypes:e,scene:a,className:"flex-1",collapsed:!w,afterClick:s,onSelectItem:r,enableClickToImportTask:d,enableBatchMediaSelect:o})]})}),u&&t.jsx($t,{value:"favorites",className:p.content,children:t.jsx(ar,{scene:a,className:"flex-1",onSelectItem:r,enableClickToImportTask:d})})]})}function er(e){const{data:{samplingMethods:a}={}}=rt(),{data:s}=ye(),n=Xe(ns),[i,r]=Qe(Tn),{hasMore:d,loadMore:o,loading:c,reset:u}=n&&(s!=null&&s.id)?Ye({fetcher:W.listUserTasks,getArgs:g=>{var j;return{userId:s.id,keyword:n,before:(j=g==null?void 0:g.tasks)==null?void 0:j.pageInfo.startCursor,last:30,parameterFields:He}},getItems:g=>{var j,I;return ge((I=(j=g.tasks)==null?void 0:j.edges)==null?void 0:I.map(S=>S==null?void 0:S.node))},getHasMore:g=>{var j;return((j=g.tasks)==null?void 0:j.pageInfo.hasPreviousPage)??!1},customState:{items:i,setItems:r}}):Ye({fetcher:W.listMyTasks,getArgs:g=>{var j,I;return{before:(I=(j=g==null?void 0:g.me)==null?void 0:j.tasks)==null?void 0:I.pageInfo.startCursor,last:30,parameterFields:He}},getItems:g=>{var j,I,S;return ge((S=(I=(j=g.me)==null?void 0:j.tasks)==null?void 0:I.edges)==null?void 0:S.map(y=>y==null?void 0:y.node))},getHasMore:g=>{var j,I;return((I=(j=g.me)==null?void 0:j.tasks)==null?void 0:I.pageInfo.hasPreviousPage)??!1},customState:{items:i,setItems:r}});l.useEffect(()=>{u()},[n]);const h=l.useMemo(()=>i.filter(g=>{if(!e.allowedTypes)return!0;const j=be(g).returnType().with({parameters:{animateDiff:{enabled:!0}}},()=>"animated").with(_.when(fa),()=>"i2vPro").otherwise(()=>"image");return e.allowedTypes.includes(j)}).map(g=>{var j;return je(g)&&((j=g.outputs.batch)!=null&&j.length)?ge(g.outputs.batch.map(I=>I.deletedAt?void 0:{...g,media:void 0,outputs:{...g.outputs,batch:void 0,...I}})):g}).flat().sort((g,j)=>j.createdAt<g.createdAt?-1:1),[i,e.allowedTypes]),[m,f]=l.useState(!1),[p,b]=l.useState(!1),v=l.useRef(),k=l.useCallback(g=>{g?b(!0):(window.clearTimeout(v.current),v.current=window.setTimeout(()=>{b(!1)},100))},[b]);sa(()=>{m&&d&&!c&&o()},100,[o,d,m,c]),l.useEffect(()=>{if(!n)if(dn()){const g=mn.subscribe(j=>{r(I=>kt([j,...I],"id"))});return()=>{g.unsubscribe()}}else{const g=window.setInterval(async()=>{var S,y,N;const j=await W.listMyTasks({last:30,parameterFields:He}),I=ge((N=(y=(S=j==null?void 0:j.me)==null?void 0:S.tasks)==null?void 0:y.edges)==null?void 0:N.map(A=>A==null?void 0:A.node));r(A=>kt([...I,...A],"id"))},5e3);return()=>window.clearInterval(g)}},[r,n]);const{t:w}=$(["generation"]),x=Xe(pt);return t.jsx(ts,{items:h,itemContent:g=>t.jsx(tr,{task:g,columns:e.collapsed?1:x,onSelectItem:e.onSelectItem&&(j=>{var I;T("image_click",{from:"task",scene:e.scene},{destinations:["getway"]}),(I=e.onSelectItem)==null||I.call(e,j)}),enableClickToImportTask:e.enableClickToImportTask,enableBatchMediaSelect:e.enableBatchMediaSelect,allowedSamplingMethods:a}),columns:e.collapsed?1:x,groups:ga(h.map(g=>Ae(g.createdAt,e.collapsed))),groupSorter:g=>Ae(g.createdAt,e.collapsed),groupHeaderContent:g=>w(ss[g])||g,footerContent:t.jsx(ls,{loading:c,hasMore:d}),className:e.className,style:e.style,classes:{groupHeader:C("px-2 py-1 text-sm text-[color:rgb(var(--fg-color)/.8)]","bg-background/80 backdrop-blur",e.collapsed&&"whitespace-nowrap"),row:"px-2 py-1 gap-2"},atBottomStateChange:f,isScrollingStateChange:k})}function is(e){const{task:a,allowedSamplingMethods:s}=e,n=((a==null?void 0:a.outputs.batch)??[""]).length,i=xn(a),{data:r,isLoading:d}=ae(i),o=lt(a==null?void 0:a.parameters.modelId),{state:c}=l.useContext(pa),[,u]=l.useContext(se),h=l.useContext(ja),[,m]=l.useContext(va),{setValues:f}=pe(),[,p]=l.useContext(ya),b=c.mode===ra.Fill;return Fe(async()=>{var k;if(!a)return;if(d)return F.info("Still Loading…");if(b){if(a.status!=="completed")return;let w=a.media;if(!w&&((k=a.outputs)!=null&&k.mediaId)&&(w=await W.getMedia({id:a.outputs.mediaId}).then(x=>x.media)),!w)return;try{n>1&&(w=await as((a.outputs.batch??[]).map(x=>x.mediaId)))}catch(x){x!==de&&F.error(x.message);return}h.current.setBaseImageFromMedia(w,{task:a,cate:"task"}),u(me(a)??[]);return}const v=Kl({task:a,baseImageMedia:r,allowedSamplingMethods:s});u(me(a)??[]),f(v),m(w=>({...w,dirty:!0})),p(a.id)},[a,b,r,d,o==null?void 0:o.id,s])}function tr({task:e,className:a,style:s,columns:n,allowedSamplingMethods:i,enableClickToImportTask:r,onSelectItem:d,enableBatchMediaSelect:o}){var I,S;const c=(e.outputs.batch??[""]).length,u=c>1?(S=(I=e.outputs.batch)==null?void 0:I.find(y=>y.deletedAt==null))==null?void 0:S.mediaId:je(e)?e.outputs.mediaId:void 0,{data:h}=ae(u),m=h??e.media,f=aa(e),[p,b]=l.useState(!0),v=y=>{f&&b(y)},[k]=l.useContext(se),[w]=l.useContext(ya),[x,g]=is({task:e,allowedSamplingMethods:i}),j=l.useMemo(()=>k.length?(()=>{const y=k[0];return y.taskType==="workflow"?y.taskId===e.id&&y.mediaId===u:y.taskId===e.id})():w===e.id,[k,w,u,e.id]);return t.jsx("button",{disabled:x.loading,className:C("w-full aspect-square rounded overflow-hidden relative",!m&&"flex items-center justify-center text-gray-400",j&&"ring-2 ring-offset-1 ring-theme-primary ring-offset-background-light",a),style:s,onMouseEnter:()=>v(!1),onMouseLeave:()=>v(!0),onClick:async()=>{if(r&&g(),c===1||!o)d==null||d({task:e,media:m});else{const y=await as(e.outputs.batch.map(N=>N.mediaId)).catch(un);y&&(d==null||d({task:e,media:y}))}},children:m?t.jsxs(t.Fragment,{children:[t.jsx(La,{className:C("w-full h-full",!d&&!r&&"cursor-default"),media:m,preferStill:p,thumbnail:!0}),n<=5&&t.jsx(rs,{task:e}),n<=4&&t.jsx(ir,{task:e})]}):t.jsx(Wa,{id:e.id,status:e.status,className:"w-full h-full",withDescription:!1,icon:e.status==="failed"?t.jsx(Hl,{className:"size-6"}):void 0})})}function ar(e){const{data:{samplingMethods:a}={}}=rt(),{items:s,hasMore:n,loading:i,loadMore:r}=Ye({fetcher:W.listMyBookmarkItems,getItems:b=>{var v,k;return Xt((k=(v=b==null?void 0:b.me)==null?void 0:v.defaultBookmark)==null?void 0:k.items)},getArgs:b=>{var v,k,w;return{types:[hn.Task],orderBy:"-createdAt",first:30,after:(w=(k=(v=b==null?void 0:b.me)==null?void 0:v.defaultBookmark)==null?void 0:k.items)==null?void 0:w.pageInfo.endCursor}},getHasMore:b=>{var v,k,w;return(w=(k=(v=b.me)==null?void 0:v.defaultBookmark)==null?void 0:k.items)==null?void 0:w.pageInfo.hasNextPage}}),[d,o]=l.useState(!1),c=l.useRef(!1),u=l.useMemo(()=>fn(()=>{c.current=!1},200),[]);l.useEffect(()=>{d&&!i&&n&&r()},[d,i,n,r]);const[h]=l.useContext(se),[m,f]=l.useState();l.useEffect(()=>{h.find(b=>{var v;return b.taskId===((v=m==null?void 0:m.task)==null?void 0:v.id)})||f(void 0)},[h]);const p=Xe(pt);return t.jsx(ts,{items:s,groups:ga(s.map(b=>Ae(b.createdAt))),groupSorter:b=>Ae(b.createdAt),groupHeaderContent:b=>t.jsx(D,{i18nKey:ss[b],defaults:b}),columns:p,className:e.className,style:e.style,classes:{groupHeader:C("px-2 py-1 text-sm text-[color:rgb(var(--fg-color)/.8)]","bg-background/80 backdrop-blur"),row:"px-2 py-1 gap-2"},itemContent:b=>t.jsx(sr,{setLastClickedItem:f,scene:e.scene,lastClickedItem:m,item:b,allowedSamplingMethods:a,enableClickToImportTask:e.enableClickToImportTask,onSelectItem:e.onSelectItem}),footerContent:t.jsx(ls,{loading:i,hasMore:n}),atBottomStateChange:o,isScrollingStateChange:b=>{b&&(c.current=!0,u())}})}function sr(e){var o;const{item:a,lastClickedItem:s,setLastClickedItem:n}=e,i=a.media??((o=a.task)==null?void 0:o.media),[r,d]=is({task:a.task,allowedSamplingMethods:e.allowedSamplingMethods});return t.jsx(nr,{disabled:r.loading,media:i,selected:a.id===(s==null?void 0:s.id),onClick:()=>{var c;T("image_click",{from:"favorite",scene:e.scene},{destinations:["getway"]}),n(a),e.enableClickToImportTask&&d(),(c=e.onSelectItem)==null||c.call(e,{task:a.task,media:i})},children:a.task&&t.jsx(rs,{task:a.task,types:["animated","workflow"]})})}function nr(e){const{data:a=e.media,isLoading:s}=ae(e.media?void 0:e.mediaId),[n,i]=l.useState(!1);return t.jsxs("button",{type:"button",disabled:e.disabled??s,className:C("relative w-full aspect-square overflow-hidden rounded ring-1 ring-black/5 dark:ring-white/5 shadow",!a&&"flex items-center justify-center text-neutral-400",e.selected&&"outline outline-2 outline-offset-1 outline-theme-primary",e.className),style:e.style,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),onClick:()=>{var r;return(r=e.onClick)==null?void 0:r.call(e)},children:[a?t.jsx(La,{media:a,preferStill:!n,thumbnail:!0,className:C("size-full",!e.onClick&&"cursor-default")}):e.placeholder,e.children]})}function ls(e){const{t:a}=$(["common"]);return t.jsx("div",{className:"box-content mx-2 py-4 flex justify-center items-center",children:e.hasMore?e.loading?t.jsx(ne,{inline:!0,style:{transform:"scale(0.7619)"}}):null:t.jsx("span",{className:"opacity-50",children:a("common:list-reached-the-end")})})}function rs(e){const a=be(e.task).with({parameters:{animateDiff:{enabled:!0}}},()=>!e.types||e.types.includes("animated"),()=>t.jsx(Ul,{className:"size-3.5"})).with({parameters:_.when(s=>(s.upscale>1||s.enlarge>1)&&s.mediaId)},()=>!e.types||e.types.includes("upscale"),()=>t.jsx(Ra,{className:"size-3.5"})).with({outputs:{batch:{length:_.select(4)}}},s=>!e.types||e.types.includes("batch"),s=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:"pl-0.5 text-xs",children:s}),t.jsx(Gl,{className:"size-3.5"})]})).with({outputs:{batch:{length:3}}},()=>!e.types||e.types.includes("variation"),()=>t.jsx(Pa,{className:"size-3.5"})).with(_.when(je),()=>!e.types||e.types.includes("workflow"),()=>t.jsx(An,{className:"size-3.5"})).with(_.when(fa),()=>!e.types||e.types.includes("i2vPro"),()=>t.jsx(ui,{className:"size-3.5"})).otherwise(()=>null);return a?t.jsx("div",{className:"absolute bottom-1 right-1 flex items-center gap-0.5 w-fit text-sm text-white rounded p-0.5 leading-4 bg-black/60 font-medium",children:a}):null}function ir(e){const a=gn(e.task)??0;return a>0?t.jsxs("div",{className:"absolute bottom-1 left-1 flex items-center gap-0.5 w-fit text-sm text-white rounded p-0.5 leading-4 bg-black/60 font-medium",children:[t.jsx(Fa,{className:"size-3.5"}),t.jsx("span",{className:"pr-0.5 text-xs",children:a})]}):null}const lr={PaperProps:{className:"max-h-[calc(100%-160px)] overflow-y-visible"},slotProps:{backdrop:{className:"bg-black/80"}}};function rr({onSelectItem:e,enableBatchMediaSelect:a,enableClickToImportTask:s,trigger:n,DrawerProps:i}){const[r,d]=l.useState(!1),o=ue("lg"),c=l.useCallback(()=>d(!1),[]),u=l.useCallback(()=>d(!0),[]),h=l.useCallback(m=>e?e({onClose:c,item:m}):c(),[e]);return o?t.jsxs(t.Fragment,{children:[n({onOpen:u}),t.jsx(bn,{anchor:"bottom",open:r,onClose:c,...lr,...i,children:t.jsx(or,{onClose:c,children:t.jsx(Jl,{onSelectItem:h,enableClickToImportTask:s,enableBatchMediaSelect:a,className:"supports-[height:100dvh]:h-[(calc(100dvh-160px)] h-[calc(var(--visible-height)-160px)]"})})})]}):null}function or(e){return t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"absolute right-0 -translate-y-10 mr-3 ml-auto",onClick:e.onClose,children:t.jsx(On,{className:"size-6 text-neutral-400 dark:text-neutral-500"})}),e.children]})}function cr(e){const{t:a}=$(["growth"]),s=pn()==="common",{beingMember:n}=st();return n?null:t.jsx("aside",{className:C("bg-gradient-purple-pink rounded-xl p-[2px] gap-1",e.className),children:t.jsxs("div",{className:C("bg-background rounded-[10.5px] flex items-center","gap-3 px-3 py-[11px] dense:gap-1 dense:px-2 dense:py-2"),children:[t.jsx("p",{className:"text-sm",children:a(s?"growth:join-membership.banner.common-discount-content":"growth:join-membership.banner.content")}),t.jsx(Zt,{to:"/membership/plans",className:C("bg-gradient-purple-pink text-white ml-auto rounded-lg shrink-0 hover:no-underline","px-5 py-2 dense:px-2 dense:py-1"),onClick:()=>{const i="panel-bottom-bar";T("enter_member_click",{location:i}),Qt("member_source",i,{persistent:!0})},children:a("growth:join-membership.banner.label")})]})})}const ao=l.memo(function(a){var d;const[s]=l.useContext(se),{data:n}=oe((d=s[0])==null?void 0:d.taskId),{width:i=512,height:r=512}=(n==null?void 0:n.parameters)??(n==null?void 0:n.outputs.detailParameters)??{};return t.jsxs("div",{className:C("relative bg-background flex flex-col mmd:flex-col-reverse bg-[length:20px_20px] bg-repeat bg-dot-pattern",a.className),style:a.style,children:[t.jsxs("div",{className:C("flex-1 flex flex-col mlg:p-2",s.length>0&&"p-2"),children:[t.jsxs("div",{className:C("flex-1 flex relative flex-col mlg:flex-row"),children:[s.length===0?t.jsx("div",{className:"flex-1"}):n?t.jsx(dr,{itemWidth:i,itemHeight:r,items:s}):t.jsx(ne,{inline:!0,className:"m-auto"}),t.jsx("div",{className:"items-end mlg:absolute mlg:-right-2 mlg:bottom-0",children:a.action})]}),a.toolbar&&t.jsx("div",{className:"flex-none",children:a.toolbar}),t.jsx(cr,{className:"hidden mlg:block w-full"})]}),t.jsx(pl,{}),t.jsx(xl,{}),t.jsx(bl,{}),t.jsx(yi,{}),t.jsx(ur,{})]})});function dr(e){const[a,s]=l.useState(e.items.length),[n,i]=l.useState(1),r=ue("lg","up"),[d,o]=l.useState(e.itemWidth),[c,u]=l.useState(e.itemHeight);function h(v){(v.width??0)*(v.height??0)>0&&(o(v.width),u(v.height))}const[m,f]=l.useState(null),[p,b]=l.useState(()=>[0,0]);return l.useEffect(()=>{const v=new ResizeObserver(()=>{if(!m)return;const{width:k,height:w}=m.getBoundingClientRect();b([k,w])});return m&&v.observe(m),()=>v.disconnect()},[m]),l.useEffect(()=>{const{rows:v,cols:k}=hr(p,[d??0,c??0],e.items.length,16);s(v),i(k)},[p,c,d,e.items.length]),t.jsx(Cn,{options:{initialZoomLevel:"fit",secondaryZoomLevel:2,maxZoomLevel:"fill"},uiElements:ml(),children:t.jsx("div",{ref:f,className:C("flex-1 px-8 mmd:px-0","pb-2","grid gap-4 dense:gap-2 grid-cols-1 mlg:grid-cols-[repeat(var(--grid-cols),1fr)] max-mlg:auto-rows-auto mlg:grid-rows-[repeat(var(--grid-rows),1fr)]","isolate"),style:{"--grid-rows":a,"--grid-cols":n},children:e.items.map((v,k)=>tt({taskId:_.string,mediaId:_.optional(_.string),deleted:_.optional(_.boolean),bookmarked:_.optional(_.boolean)},v)&&t.jsx(mr,{ratio:(d||e.itemWidth)/(c||e.itemHeight),maxWidth:d||e.itemWidth,maxHeight:c||e.itemHeight,alignment:r&&n===2?["bottom-right","bottom-left","top-right","top-left"][k]:"center",static:!r,className:"hover:z-20",children:t.jsx("div",{className:"h-full ring-1 ring-black/10 rounded-md shadow-md hover:shadow-lg !shadow-black/20 transition",children:t.jsx(ul,{...v,itemsCount:e.items.length,idx:k,onMediaLoad:h})})},`${v.taskId}-${k}`))})})}function mr(e){var n;const a=((n=e.alignment)==null?void 0:n.split("-"))??["center"];a.length<2&&a.push("center");const s=a.map(i=>({top:"mt-0",bottom:"mb-0",left:"ml-0",right:"mr-0"})[i]).join(" ");return t.jsx("div",{className:C("relative",e.className),style:{...e.style},children:t.jsx("div",{className:C(!e.static&&"absolute inset-0","m-auto",s),style:{aspectRatio:e.ratio,maxWidth:`min(100%, ${e.maxWidth?e.maxWidth+"px":"100%"})`,maxHeight:`min(100%, ${e.maxHeight?e.maxHeight+"px":"100%"})`},children:e.children})})}function ur(){const e=document.getElementById("workbench-generate-button-intersector"),[a,s]=l.useState(!1),n=new IntersectionObserver(([r])=>{s(r.intersectionRatio>=1)},{threshold:1});l.useEffect(()=>{if(e)return n.observe(e),()=>{n.unobserve(e)}},[!!e]);const i=document.getElementById("workbench-layout-overlays");return t.jsx(_n,{children:t.jsx("div",{style:{"--offset-height":a?"192px":"60px"},className:"absolute mlg:hidden transition right-3 transform translate-y-[calc(100dvh-var(--offset-height))] flex flex-col gap-3",children:t.jsx(rr,{trigger:({onOpen:r})=>t.jsx("button",{className:"w-fit p-3 rounded-full bg-black/60",onClick:()=>{r(),T("panel_history_click")},children:t.jsx(vl,{className:"text-white size-6"})}),DrawerProps:{container:i},enableClickToImportTask:!0})})})}function hr(e,a,s,n){const[i,r]=e,d=a[0]/a[1];let o=1/0;const c={};for(let u=1;u<=s;u++){const h=Math.ceil(s/u);if(u*h-s>=h)continue;const m=(i-n*(h+1))/h,f=(r-n*(u+1))/u,p=m/f,b=Math.abs(p-d);b<o&&(o=b,Object.assign(c,{rows:u,cols:h}))}return c}export{Bl as $,Ei as A,tl as B,mr as C,Wr as D,Ka as E,Ne as F,Mt as G,Ba as H,gi as I,cr as J,pi as K,Tt as L,Li as M,vl as N,$t as O,Ga as P,Xi as Q,qr as R,Kr as S,Wa as T,Aa as U,ao as V,Kl as W,Qr as X,Gr as Y,ts as Z,fi as _,et as a,ni as b,di as c,ii as d,Hr as e,mi as f,ei as g,ut as h,Zi as i,ki as j,Fa as k,Xr as l,si as m,Or as n,ol as o,Zr as p,Jr as q,ui as r,ft as s,rr as t,Yr as u,me as v,Jl as w,Ha as x,Fi as y,zi as z};
//# sourceMappingURL=GeneratorStage-DJGZB2wF.js.map
