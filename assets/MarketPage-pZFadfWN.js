import{j as o}from"./vendor-motion-Bl2lDopP.js";import{r as m}from"./vendor-apollo-B9XqHIAo.js";import{u as b,m as p,aZ as I,T as _,a as S,cd as R,b7 as c,ce as B,bW as C,M as D,G as F,b3 as P,c2 as E,cf as A,cg as G,ch as L,c0 as O,P as U,c3 as Q}from"./index-JhqgbpkX.js";import{B as $,M as x}from"./ModelGrid-pbezVJd1.js";import{N as K}from"./TrainLoraEvent-YJOi9HOY.js";import{S as V}from"./SearchForm-BZr1F1ci.js";import{u as k}from"./vendor-i18next-TC5y0B3W.js";import{d as w,c as Y}from"./vendor-react-router-Bm0RsDwP.js";import{G as f}from"./vendor-firebase-BKQqa5bK.js";import{B as q}from"./vendor-mui-DTp04zm4.js";import"./vendor-graphql-DeSYh9DC.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";import"./ModelCard-BbPEsrCH.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},s=new e.Error().stack;s&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[s]="0641dc56-fc56-42b0-bfad-2eb13bf3624e",e._sentryDebugIdIdentifier="sentry-dbid-0641dc56-fc56-42b0-bfad-2eb13bf3624e")})()}catch{}(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(s){for(var l=1;l<arguments.length;l++){var t=arguments[l];if(t!=null)for(var a in t)t.hasOwnProperty(a)&&(s[a]=t[a])}return s}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();function H(){const[{type:e,keyword:s}]=b(),{t:l}=k(["market","common"]),t=w();return o.jsx(V,{keyword:s,placeholder:l("market:search.search-placeholder"),onSubmit:a=>{const r={keyword:a,type:e};p("search",{value:a,type:e,scene:"market"}),t(I("/market",r))},button:"separated",scene:"market",className:"grid grid-cols-[minmax(max-content,1fr)_minmax(200px,500px)_minmax(max-content,1fr)] justify-center items-center gap-2",prepend:o.jsx("h1",{className:"justify-self-end px-2 font-rhodium text-2xl",children:o.jsx("span",{className:"block whitespace-nowrap",style:{transform:"translateY(2px)"},children:o.jsx(_,{i18nKey:"common:market.long-label"})})})})}function h(e){if(!e)return e;const s=f.Dit7BModel,l=f.Dit7Model,t=e.findIndex(a=>a===s);if(t>=0){const a=[...e];return a.splice(t,1,l),a}return e}function M(e){if(!e)return e;const s=f.Dit7Model,l=f.Dit7BModel,t=e.split(","),a=t.findIndex(r=>r===s);if(a>=0){const r=[...t];return r.splice(a,1,l),r.join(",")}return e}const J=()=>{const[{order:e=c.trending,type:s,base:l,category:t,timeRange:a,baseModelTypes:r},d]=b(),u=i=>d(g=>({...g,...i,type:h(i.type),baseModelTypes:h(i.baseModelTypes)}));return[{order:e,base:l,category:t,timeRange:a,type:M(s),baseModelTypes:M(r)},u]};function Me(){const{tag:e}=Y(),[{keyword:s},l]=b(),[t,a]=J(),{t:r}=k(["common","market","artwork"]),d=w(),{data:u}=S(),i=R(),g=m.useMemo(()=>JSON.stringify({keyword:s,filter:t,refreshTime:i,tag:e}),[t.order,t.timeRange,t.type,t.base,t.category,t.baseModelTypes,i,e,s]),T=[{value:c.trending,label:r("common:order-option.trending")},{value:c.mostLiked,label:r("common:order-option.most-liked")},{value:c.mostUsed,label:r("common:order-option.most-used")},{value:c.newest,label:r("common:order-option.newest")}],j=B(),v=m.useCallback(n=>C("model",n),[]),N=m.useCallback(({id:n})=>`/contest/${n}`,[]);return o.jsxs("div",{className:"w-full flex flex-col items-center justify-center md:pt-6",children:[o.jsx(D,{title:r("common:meta.title.market"),description:r("common:meta.description.market"),ogUrlPathname:"/market"}),o.jsxs("div",{className:"w-full max-w-full flex flex-col items-center",children:[o.jsxs("div",{className:"w-full flex flex-col items-center md:gap-2",children:[!j&&o.jsx("div",{className:"self-stretch mt-4",children:o.jsx(H,{})}),o.jsxs("div",{className:"mt-4 mb-6 flex gap-2 items-center",children:[o.jsx(K,{from:"market"}),o.jsx(q,{variant:"contained",className:"bg-purple-600 text-white font-bold rounded-lg px-6",onClick:()=>{p("upload_lora_model_click"),u?d("/market/submit"):F({onSuccess(){d("/market/submit")}},{fromPath:"upload-model"})},children:r("artwork:upload-local-image")}),o.jsx(P,{children:o.jsx("p",{className:"p-4 text-sm w-80 whitespace-pre-line",children:r("market:hero.submit.help-text")})})]})]}),o.jsxs("div",{className:"mt-2 flex max-msm:flex-wrap items-center gap-x-2 gap-y-4 w-full",children:[o.jsx(E,{choices:T,onChange:n=>{p("order_click",{value:n,scene:"market"}),a({order:n})},value:t.order,alwaysCollapse:!0,className:"flex-1 msm:flex-none"}),o.jsx(A,{value:{...G(t.type?.split(","),t.baseModelTypes?.split(",")),...t.base?{baseModelId:t.base}:{},category:t.category,time:t.timeRange},onChange:n=>{p("filter_change",n);const y=L(n);a({type:y.type,baseModelTypes:y.loraBaseModelTypes,base:/^\d+$/.test(n.baseModelId??"")?n.baseModelId:void 0,category:n.category,timeRange:n.time})},hideDisabled:!0,className:"flex-1 msm:flex-none"}),o.jsx(O,{scene:"market",className:"flex-none msm:flex-1 -my-1.5 w-full overflow-auto",listTagVariables:{category:"market"},navigateToTag:v,navigateToContest:N,currentTag:e,contestItemsStayFirst:!0})]}),o.jsx(m.Suspense,{fallback:o.jsx(U,{}),children:o.jsx($,{order:t.order,keyword:s,tag:e,type:t.type,timeRange:Q(t.timeRange),extraArgs:{loraBaseModelIds:/^\d+$/.test(t.base??"")?[t.base]:void 0,category:t.category,loraBaseModelTypes:t.baseModelTypes?.split(",")},renderContent:n=>o.jsx(x,{scene:"market",...n}),renderLoading:()=>o.jsx(x,{loading:!0})},g)})]})]})}export{Me as Component,J as useModelFilterState};
