import{j as e}from"./vendor-motion-Bl2lDopP.js";import{r as l}from"./vendor-apollo-B9XqHIAo.js";import{a as x,j as w,l as N,m as c,n as k,t as u,o as C,U as m,T as i,C as I,p as A,q as T,P as d,s as _,v as S,w as D,x as K,B as p,y as h,z as L}from"./index-JhqgbpkX.js";import{g}from"./vendor-graphql-DeSYh9DC.js";import{N as f,d as P}from"./vendor-react-router-Bm0RsDwP.js";import{u as j}from"./vendor-i18next-TC5y0B3W.js";import{d as U}from"./vendor-mui-DTp04zm4.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-firebase-BKQqa5bK.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-lodash-992l3ZN7.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="192e1375-c957-49b8-84bf-eecb557882b8",s._sentryDebugIdIdentifier="sentry-dbid-192e1375-c957-49b8-84bf-eecb557882b8")})()}catch{}(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};s._sentryModuleMetadata=s._sentryModuleMetadata||{},s._sentryModuleMetadata[new s.Error().stack]=function(t){for(var a=1;a<arguments.length;a++){var r=arguments[a];if(r!=null)for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}return t}({},s._sentryModuleMetadata[new s.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const o=l.createContext({});function M(){const{data:s}=x(),t=s?.deleteAfter&&new Date(s.deleteAfter).getTime()>new Date().getTime();return s?t?e.jsx(o.Provider,{value:{user:s},children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(w,{content:"User Revival"}),e.jsx(E,{user:s}),e.jsx(z,{})]})}):e.jsx(f,{to:"/"}):e.jsx(f,{to:"/"})}function E(s){const{t}=j(["user"]),{refetch:a}=x(),r=P(),[n,b]=N(async()=>{try{c("revive_account_click"),await k({cancel:!0}),a(),u.success(t("user:revival.notice.revive-success")),setTimeout(()=>{r("/")},1e3)}catch(y){u.error(`${t("user:revival.notice.revive-failed")} : ${y.message}`)}},[s.user]),v=l.useCallback(()=>{c("logout_click",{scene:"user-revival-page"}),C(),setTimeout(()=>{r("/")},1e3)},[]);return e.jsxs("header",{className:"sticky top-0 shadow-md p-8 flex items-center gap-4 bg-white dark:bg-zinc-700 z-10",children:[e.jsx(R,{user:s.user}),e.jsx(m,{busy:n.loading,variant:"filled",className:"ml-auto",size:"large",onPress:b,color:"theme",children:e.jsx(i,{i18nKey:"user:revival.action-banner.revive-button.label"})}),e.jsx(m,{variant:"outlined",size:"large",onPress:v,children:e.jsx(i,{i18nKey:"auth:logout"})})]})}function R(s){const t=s.user.deleteAfter;return t?e.jsxs("p",{children:[e.jsx(i,{i18nKey:"user:revival.action-banner.time-before-revival"}),e.jsx(I,{targetDate:t,utc:!0,children:({timeLeft:a})=>e.jsx("span",{className:A("inline-grid grid-flow-col items-center px-1 tabular-nums text-white bg-black rounded","mx-2"),children:U.duration(a).format("D:H:m:s").split(":").map(Number).map((r,n)=>e.jsxs(e.Fragment,{children:[n>0&&":",e.jsx(T,{value:r,trend:-1,digits:n===0?void 0:{1:{max:5}},format:n===0?void 0:{minimumIntegerDigits:2}},n)]}))})})]}):null}function z(){return e.jsxs("main",{className:"px-4 pt-4 md:px-8 md:pt-8",children:[e.jsx("h1",{className:"font-bold text-2xl leading-10",children:e.jsx(i,{i18nKey:"user:revival.account-detail"})}),e.jsx(l.Suspense,{fallback:e.jsx(d,{}),children:e.jsx(B,{})}),e.jsx(l.Suspense,{fallback:e.jsx(d,{}),children:e.jsx(F,{})}),e.jsx(l.Suspense,{fallback:e.jsx(d,{}),children:e.jsx(O,{})})]})}function B(){const{t:s}=j(["user"]),{user:t}=l.useContext(o),{data:a}=_(t.id,{revalidateOnFocus:!1,revalidateOnReconnect:!1});return t?e.jsxs("section",{className:"mt-4 mb-2 pb-6 border-b",children:[e.jsx("h2",{className:"font-medium text-lg mb-2",children:e.jsx(i,{i18nKey:"user:profile.profile"})}),e.jsxs("div",{className:"grid grid-cols-[96px_1fr] w-fit gap-4",children:[e.jsx(S,{style:{width:96,height:96},user:t}),e.jsxs("div",{className:"flex flex-col text-sm",children:[e.jsxs("dl",{className:"grid grid-rows-2 grid-cols-[auto_1fr] gap-x-2",children:[e.jsx("dt",{className:"w-fit text-neutral-700 dark:text-neutral-200 font-medium",children:e.jsx(i,{i18nKey:"auth:nickname"})}),e.jsx("dd",{className:"",children:t.displayName}),e.jsx("dt",{className:"w-fit text-neutral-700 dark:text-neutral-200 font-medium",children:e.jsx(i,{i18nKey:"auth:username"})}),e.jsxs("dd",{className:"",children:["@",t.username]})]}),e.jsxs("div",{className:"flex gap-2 items-center mt-auto",children:[e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("span",{className:"font-bold",children:(t.followingCount||0).toLocaleString()}),e.jsx("span",{className:"text-sm text-primary-light",children:s("user:following-count-label")})]}),e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsx("span",{className:"font-bold",children:(t.followerCount||0).toLocaleString()}),e.jsx("span",{className:"text-sm text-primary-light",children:s("user:follower-count-label")})]}),a!=null&&e.jsxs("span",{className:"flex gap-1 items-center",children:[e.jsx("span",{className:"font-bold text-theme-primary",children:D(a)}),e.jsx("span",{className:"text-sm text-primary-light",children:s("user:artwork-liked-count-label")})]})]})]})]})]}):null}function F(){const{user:s}=l.useContext(o),{data:t}=K({authorId:s.id,last:20,orderBy:"-markInfo.likedCount"}),a=g(t);return e.jsxs("section",{className:"mt-4 mb-2 pb-6 border-b",children:[e.jsx("h2",{className:"font-medium text-lg mb-2",children:e.jsx(i,{i18nKey:"user:revival.most-liked-artworks"})}),e.jsxs("div",{className:"grid gap-4 grid-cols-[repeat(auto-fill,minmax(172px,1fr))]",children:[a.length===0&&e.jsx("p",{children:e.jsx(i,{i18nKey:"user:no-artworks"})}),a.map(r=>{const n=r.title||r.prompts;return e.jsx(p,{artwork:r,mediaId:r.mediaId,hideShare:!0,disabled:!0,borderClassName:"group-hover:shadow-md",label:e.jsx("span",{title:n,children:n}),secondLabel:e.jsx("span",{children:h(r.createdAt)})})})]})]})}function O(){const{user:s}=l.useContext(o),{data:t}=L({userId:s.id,last:20}),a=g(t);return e.jsxs("section",{className:"my-4",children:[e.jsx("h2",{className:"font-medium text-lg mb-2",children:e.jsx(i,{i18nKey:"user:revival.latest-tasks"})}),e.jsxs("div",{className:"grid gap-4 grid-cols-[repeat(auto-fill,minmax(172px,1fr))]",children:[a.length===0&&e.jsx("p",{children:e.jsx(i,{i18nKey:"user:no-artworks"})}),a.map(r=>{const n=r.parameters.prompts;return e.jsx(p,{mediaId:r.mediaId,hideShare:!0,disabled:!0,borderClassName:"group-hover:shadow-md",label:e.jsx("span",{title:n,children:n}),secondLabel:e.jsx("span",{children:h(r.createdAt)})})})]})]})}const de=M;export{de as Component};
