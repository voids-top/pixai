import{j as a,bQ as R,aM as A,fg as T,e as u,c4 as I,ca as g,Q as W,K as r,a0 as L,C as D,fc as K,fd as M,a1 as H,U as P}from"./index-BTMYyhc6.js";import{M as S}from"./MediaPreview-CrisSWrJ.js";import{d as Y}from"./InspectDialog-BPHcKRwz.js";import{U as Q}from"./index-m6nh9vV8.js";import{g as q}from"./UserLink-D-ltrUye.js";import{a as $,b as J,U as V,c as X}from"./GeneratorStage-DJGZB2wF.js";import{l as Z,o as G,q as ee,r as ae}from"./ArtworkListPage-9LI_MBMs.js";import{a as U}from"./formatNum-CBDReyYg.js";import{f as te}from"./ModelInfoForm-DCsOkC3d.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},n=new Error().stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1a56dec3-491e-43c7-96b1-a8c39b0007ea",e._sentryDebugIdIdentifier="sentry-dbid-1a56dec3-491e-43c7-96b1-a8c39b0007ea")}catch{}})();{var x=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};x._sentryModuleMetadata=x._sentryModuleMetadata||{},x._sentryModuleMetadata[new Error().stack]=Object.assign({},x._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}const ne=e=>a.jsx("svg",{viewBox:"0 0 20 20",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M10 2a8 8 0 1 1-3.613 15.14l-.121-.065l-3.645.91a.5.5 0 0 1-.62-.441v-.082l.014-.083l.91-3.644l-.063-.12a8 8 0 0 1-.83-2.887l-.025-.382L2 10a8 8 0 0 1 8-8m.5 9h-3l-.09.008a.5.5 0 0 0 0 .984L7.5 12h3l.09-.008a.5.5 0 0 0 0-.984zm2-3h-5l-.09.008a.5.5 0 0 0 0 .984L7.5 9h5l.09-.008a.5.5 0 0 0 0-.984z"})}),se=e=>a.jsx("svg",{viewBox:"0 0 20 20",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M9.388 4.29a4.3 4.3 0 0 0-6.127-.016c-1.688 1.705-1.68 4.476.016 6.189l6.277 6.34c.26.263.682.263.942 0l6.245-6.304a4.41 4.41 0 0 0-.017-6.187a4.305 4.305 0 0 0-6.135-.015l-.596.603z"})}),O=u.createContext({});function le(e){var n;return a.jsx(O.Provider,{value:{artwork:e.artwork,workflow:(n=e.artwork)==null?void 0:n.workflow},children:e.children})}function ge(e){var b,j,v,y,N,p,z,C,_;const n=typeof e.selected=="boolean",i=(b=e.data)==null?void 0:b.id,{author:t,workflow:o}=e.data??{},{id:f,latestPublishedVersion:d}=o??{},[{liked:m,count:c,optimistic:w},k]=Z(i,R.Artwork,e.data),{me:h}=A(),[{loading:B},E]=T(async s=>{var l;switch(await s){case"delete":(l=e.onDelete)==null||l.call(e,e.data);break}},[]),F=u.useRef(s=>I(s).with({to:g.not(g.nullish)},l=>a.jsx(W,{...l})).otherwise(l=>a.jsx("div",{"data-skeleton":"",...l}))).current;return a.jsx(le,{artwork:e.data,children:a.jsxs(F,{to:e.data?G(e.data):void 0,"data-selecting":n?"":null,className:r("group/card relative flex rounded-[10px]",B&&"opacity-50 pointer-events-none",e.className),style:e.style,onClick:s=>{var l;n&&s.preventDefault(),e.data&&((l=e.onClick)==null||l.call(e,e.data))},children:[a.jsxs("div",{className:"size-full overflow-hidden bg-white dark:bg-zinc-700 rounded-[10px] ring-1 ring-black/10 dark:ring-black/15",children:[a.jsxs("div",{className:"relative w-full aspect-[1200/630]",children:[a.jsx(S,{media:(j=e.data)==null?void 0:j.media,className:"size-full object-center object-cover bg-zinc-200 dark:bg-zinc-600"}),a.jsx("div",{className:r("absolute inset-0 group-data-[skeleton]/card:hidden size-full bg-gradient-to-t from-black/40 via-black/20 via-[60px] to-[80px] group-hover/card:opacity-0 transition","group-data-[selecting]/card:bg-none","group-data-[selecting]/card:bg-black/50","group-data-[selecting]/card:group-hover/card:opacity-100")}),a.jsxs("div",{className:"absolute inset-0 size-full flex flex-col justify-end gap-1 p-2 font-medium text-white text-shadow shadow-black ",children:[a.jsx("p",{className:"-my-1 line-clamp-2 prepend-zws",children:(v=e.data)==null?void 0:v.title}),a.jsxs("div",{className:"flex items-center gap-1",children:[e.data?a.jsx(Q,{user:t,className:"flex-none !size-6 text-shadow-none"}):a.jsx("i",{className:"block size-6 bg-zinc-200 dark:bg-zinc-600 rounded-full"}),a.jsx("span",{className:"flex-1 text-sm truncate",children:q(t)})]})]})]}),a.jsx("div",{className:"row-start-2 relative px-2 py-1 text-sm shadow-[0_-1px_#0003] dark:shadow-[inset_0_1px_#fff2] group-data-[skeleton]/card:shadow-none space-y-1",children:a.jsxs("div",{className:"flex-none flex items-center gap-2 text-neutral-600 dark:text-neutral-400 group-data-[skeleton]/card:invisible",children:[(((p=(N=(y=d==null?void 0:d.data)==null?void 0:y.workflow)==null?void 0:N.nodes)==null?void 0:p.length)||!1)&&a.jsx("span",{children:a.jsx(L,{i18nKey:"workflow:node-counter",values:{count:d.data.workflow.nodes.length}})}),a.jsxs("span",{className:"inline-flex items-center gap-0.5",children:[a.jsx(ne,{className:"size-5 text-neutral-500"}),U((z=e.data)==null?void 0:z.commentCount)]}),a.jsx("span",{className:"ml-auto"}),a.jsxs("button",{disabled:!h,className:r("inline-flex items-center gap-0.5 px-1.5 -mx-1 py-0.5 hover:bg-black/5 dark:hover:bg-black/15 disabled:bg-transparent rounded-md transition",w&&"opacity-50"),onClick:s=>{s.preventDefault(),m||D("like_click",{type:"workflow",scene:e.scene,workflowId:f}),K().then(()=>k(),M)},children:[a.jsx(se,{className:r("-ml-0.5 size-5",m??((C=e.data)==null?void 0:C.liked)?"text-red-600":"text-neutral-500")}),U(c??((_=e.data)==null?void 0:_.likedCount))]})]})})]}),a.jsx("div",{className:"absolute top-1 right-1",children:I(e).with({selected:g.select(g.boolean)},s=>a.jsxs("span",{className:"relative inline-block size-6 bg-white/0 has-[:checked]:bg-purple-600 rounded-full ring-1 [&:not(:has(:checked))]:ring-inset ring-white/50 has-[:checked]:ring-black/50 has-[:checked]:shadow-[inset_0_1px_#fff4]",children:[a.jsx("input",{type:"checkbox",checked:s,onChange:M,className:"peer absolute size-0 invisible"}),a.jsx(te,{className:"absolute inset-0 m-auto size-5 text-white invisible peer-checked:visible"})]})).otherwise(()=>a.jsx(ie,{scene:e.scene,triggerUpdate:E}))})]})})}function ie(e){const{me:n,beingAdmin:i}=A(),{artwork:t}=u.useContext(O),o=n&&n.id===(t==null?void 0:t.authorId),f=u.useMemo(()=>{const c=i||!1;return H([(o||i)&&{id:"delete",color:i&&!o?"admin":"danger",children:a.jsx(L,{i18nKey:"action:delete.label"}),onAction:()=>{e.triggerUpdate(ee(t.id).then(k=>{var h;if(k)return D("workflow_delete_success",{scene:e.scene,workflowId:(h=t==null?void 0:t.workflow)==null?void 0:h.id}),"delete"}))}},c&&$,c&&{id:"inspect",color:"admin",children:"Inspect",onAction:()=>Y(t)}])},[t,i,o,e]),[d,m]=u.useState(!1);return f.length>0?a.jsxs(J,{onOpenChange:m,children:[a.jsx(P,{variant:d?"filled":"outlined",size:"small",icon:a.jsx(ae,{className:"size-5"}),className:r("group-hover/card:visible",!d&&"!bg-white dark:!bg-black invisible")}),a.jsx(V,{placement:"bottom end",items:f,style:{minWidth:100},children:c=>a.jsx(X,{...c})})]}):null}export{ge as W,se as f};
//# sourceMappingURL=WorkflowCard-C9uJkztT.js.map
