import{j as t}from"./vendor-motion-Bl2lDopP.js";import{dA as C,dH as N,dV as k,dz as E,t as R,dW as _,p as P,dX as A,dY as T,bN as O,aG as S,cB as D,dZ as z,aC as F,d_ as H}from"./index-JhqgbpkX.js";import{C as B}from"./vendor-axios-CFwfAwt2.js";import{r as d,s as V}from"./vendor-apollo-B9XqHIAo.js";import{g as G}from"./rand-CeqwHrxf.js";import{u as W}from"./vendor-i18next-TC5y0B3W.js";import{C as $}from"./vendor-mui-DTp04zm4.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new e.Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="0f572144-ed3b-4eb0-90c8-eaad15372cdb",e._sentryDebugIdIdentifier="sentry-dbid-0f572144-ed3b-4eb0-90c8-eaad15372cdb")})()}catch{}(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(a){for(var r=1;r<arguments.length;r++){var n=arguments[r];if(n!=null)for(var s in n)n.hasOwnProperty(s)&&(a[s]=n[s])}return a}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();function X(e){const[a,r]=d.useState(null);return d.useEffect(()=>{if(!e){r(null);return}const n=URL.createObjectURL(e);return r(n),()=>URL.revokeObjectURL(n)},[e]),a}const Y=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M20 4v12H8V4h12m0-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 9.67l1.69 2.26l2.48-3.1L19 15H9zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"})}),K={"image/png":[],"image/jpeg":[],"image/webp":[]},U=100;function se(e){const{t:a}=W(["common"]),[,r]=d.useContext(C),n=N(e.group),[s,c]=k(e.group),u=d.useContext(E),l=async y=>{const w=Object.entries(y);w.forEach(p=>{const[v,{file:j,controller:I}]=p,i=`upload-${v}`;u.current?.set(i,{file:j,controller:I}),c(o=>[...o,i])}),await z(w,3,async p=>{const[v,{file:j,controller:I}]=p,i=`upload-${v}`;try{const o=await F(j,{signal:I.signal,onProgress:g=>{r(b=>({...b,[i]:g}))}});o.media&&(H(o.media.id,o.media),c(g=>{const b=[...g],M=b.findIndex(L=>L===i);return M>-1&&b.splice(M,1,o.media.id),b}),u.current?.delete(i),e.onItemUploadSuccess?.(o.media.id))}catch(o){o instanceof B||R.error(o.message),u.current?.delete(i)}finally{r(o=>{const g={...o};return delete g[i],g})}}),e.onUploadSuccess?.()},m=d.useCallback(y=>{if(s.length+y.length>(e.maxAllowedMedia??U))return R.error(a("common:media-upload.max-number-exceeded",{number:e.maxAllowedMedia??U}));const w=Object.fromEntries(y.map(p=>[G(),{file:p,controller:new AbortController}]));l(w)},[s.length]),{getRootProps:h,getInputProps:f,open:x}=_({onDrop:m,onFileDialogOpen:()=>{e.onFileDialogOpen?.()},accept:K,multiple:e.maxAllowedMedia!==1,...e.dropzoneOpts});return t.jsxs("div",{className:P("font-medium cursor-pointer flex flex-col gap-3 items-center justify-center text-xs",e.wrapperProps?.className),...h(),children:[t.jsx("input",{...f()}),n?t.jsxs(t.Fragment,{children:[t.jsx(A,{className:"size-6"}),t.jsx("p",{className:"mt-1",children:a("market:train-lora.add-image.label")})]}):t.jsxs(t.Fragment,{children:[t.jsx(Y,{className:"size-[104px] text-neutral-400"}),e.uploadTrigger({open:x})]})]})}function re(e){const{onRemove:a,group:r,...n}=e,[s,c]=k(r),u=d.useCallback(l=>{c(m=>[...m].filter(f=>f!==l)),a?.(l)},[]);return s.length?t.jsx(t.Fragment,{children:s.map(l=>t.jsx(Z,{isUploading:l.startsWith("upload"),itemId:l,onRemove:u,...n},l))}):null}function Z(e){const a=d.useContext(E),[r]=d.useContext(C),{itemId:n,isUploading:s}=e,{data:c}=T(s?V:n),u=O(c),l=S(c),m=s?a.current?.get(n):void 0,h=X(m?.file),f=(e.usePublicUrl?l:u)??h,x=(r[n]??0)*100;return t.jsxs("div",{className:P("relative group",e.wrapperProps?.className),style:e.wrapperProps?.style,children:[f&&t.jsx("img",{className:e.imgProps?.className,style:e.imgProps?.style,src:f,loading:"lazy",decoding:"async"}),s&&t.jsx("div",{className:"absolute top-0 left-0 w-full h-full backdrop-blur bg-white/40 dark:bg-black/40 flex items-center justify-center rounded-lg",children:t.jsx($,{variant:x>15?"determinate":void 0,value:x})}),!e.disableRemove&&t.jsx("button",{title:"Remove",className:P("absolute right-1 top-1 bg-white text-black p-0 rounded-full","[@media((hover:hover)_and_(pointer:fine))]:hidden group-hover:block"),onClick:()=>{s&&m?.controller.abort(),e.onRemove(e.itemId)},children:t.jsx(D,{className:"size-5"})})]})}export{se as M,re as a,X as u};
