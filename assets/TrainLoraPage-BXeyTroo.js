import{j as e}from"./vendor-motion-Bl2lDopP.js";import{dx as U,ag as W,p as b,m as y,G as z,b0 as re,dy as O,dz as Le,dA as _e,dB as De,dC as E,b8 as ce,b9 as me,dD as Se,bf as ue,dE as xe,P as ge,a as Pe,b5 as Ee,dF as Re,ak as Ae,dq as Fe,bN as ze,u as $,aL as fe,T as B,t as K,dG as Be,dH as Ue,U as V,b3 as pe,dI as he,dJ as be,aD as je,dK as We,l as Oe,dL as qe,a6 as Ge,aF as Qe,dM as He,dN as Ke,dO as Ve,dP as $e,ci as ke,dQ as Xe,dR as Je,y as Ye,dS as Ze,dT as et,dU as tt,j as at}from"./index-JhqgbpkX.js";import{r as o}from"./vendor-apollo-B9XqHIAo.js";import{G as M,$ as rt,N as se}from"./vendor-firebase-BKQqa5bK.js";import{i as Ie}from"./outline-info-C4eOIxV8.js";import{M as st,a as nt}from"./index-DDDieZ2E.js";import{g as ot}from"./vendor-graphql-DeSYh9DC.js";import{s as it,B as F,h as _,q as A,O as ne,ac as oe,z as ie,E as H}from"./vendor-mui-DTp04zm4.js";import{u as w,T as lt}from"./vendor-i18next-TC5y0B3W.js";import{w as q}from"./vendor-lodash-992l3ZN7.js";import{T as dt}from"./TrainLoraEvent-YJOi9HOY.js";import{d as ct}from"./vendor-react-router-Bm0RsDwP.js";import"./vendor-amplitude-core-CQMkGYFj.js";import"./vendor-axios-CFwfAwt2.js";import"./vendor-sentry-BZZLy1DV.js";import"./vendor-react-aria-BW9JtD2p.js";import"./vendor-markdown-1uD3znr6.js";import"./i18n-resources-43uzMSBc.js";import"./vendor-hls-cbDBXQj9.js";import"./vendor-tldraw-CaaMemrL.js";import"./vendor-fabric-Bg02ktlP.js";import"./vendor-radix-ui-DX5JiNHB.js";import"./vendor-photoswipe-UqzIRFho.js";import"./rand-CeqwHrxf.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},a=new t.Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="76e45ba1-fe35-4c31-aba8-3c60535c2414",t._sentryDebugIdIdentifier="sentry-dbid-76e45ba1-fe35-4c31-aba8-3c60535c2414")})()}catch{}(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};t._sentryModuleMetadata=t._sentryModuleMetadata||{},t._sentryModuleMetadata[new t.Error().stack]=function(a){for(var s=1;s<arguments.length;s++){var r=arguments[s];if(r!=null)for(var n in r)r.hasOwnProperty(n)&&(a[n]=r[n])}return a}({},t._sentryModuleMetadata[new t.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();const[D,mt]=U({title:"",triggerWords:"",importedLoraList:[],versionId:void 0,modelType:M.SdxlModel,primaryLoraModelId:void 0}),[X,ut]=U([]),[J,xt]=U([]),G=o.createContext({current:void 0});function gt(t){const a=o.useRef(new Map);return e.jsx(G.Provider,{value:a,children:t.children})}const N=o.createContext({current:void 0});function ft(t){const a=o.useRef(new Map);return e.jsx(N.Provider,{value:a,children:t.children})}const[S,pt]=U({datasetMode:"default",datasetId:void 0}),ht=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10s10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8zm3.59-13L12 10.59L8.41 7L7 8.41L10.59 12L7 15.59L8.41 17L12 13.41L15.59 17L17 15.59L13.41 12L17 8.41z"})}),le=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10s10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8s8 3.59 8 8s-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4l8-8z"})}),v=100;function bt(t){return!(t.length>v||t.some(a=>a.startsWith("upload")))}function ye(t){const{prices:a,modelType:s}=t,r=s?a?.[s]:void 0;return r?rt(t).with({isFreeToTrain:!0},()=>0).with({datasetId:se.string},()=>r.reuse).with({primaryLoraModelId:se.string},()=>r.retrain).otherwise(()=>r.price)??0:0}const jt=it("div")(()=>({display:"flex",flexFlow:"column",gap:"0.25rem"})),[kt]=Be("getTrainingTaskById",{transform:t=>t?{id:t}:void 0});function It(){const[,t]=o.useContext(S),a=O(),s=o.useContext(N),[{trainingTaskId:r},n]=$(),{data:i,isLoading:l,error:u}=kt(r),m=o.useCallback(d=>{a(c=>q([...c,...d])),s.current&&d.forEach(c=>{s.current?.set(c,"dataset")})},[]);o.useEffect(()=>{if(!l){if(i){const d=i.trainingTask?.parameters.mediaIds??[];d.length>0&&(t({datasetMode:"reuse",datasetId:r}),m(d))}n(d=>({...d,trainingTaskId:null}))}},[r,l,i?.trainingTask?.id])}function yt(t){It();const{variant:a="at-top"}=t,{t:s}=w(["market"]),[r,n]=o.useState(!1),[i,l]=o.useState(!1),[{datasetMode:u},m]=o.useContext(S),{me:d}=W(),c=a==="at-bottom";return e.jsxs("div",{className:b("flex items-center gap-2 relative",c?'order-2 h-[108px] border-t border-dashed border-zinc-300 dark:border-zinc-500 justify-center before:content-["Or"] before:absolute before:top-0 before:-translate-y-2 before:text-neutral-500 dark:before:text-neutral-300 before:text-xs before:bg-neutral-100 dark:before:bg-neutral-800 before:px-2':"px-4 pt-4 justify-end"),children:[u==="reuse"&&e.jsxs(e.Fragment,{children:[e.jsx(F,{variant:c?"text":"outlined",className:b(c?"underline text-neutral-500 dark:text-neutral-300":"","rounded-full text-xs"),onClick:()=>{y("switch_to_default_mode_click",{location:c?"bottom":"top"}),m(j=>({...j,datasetMode:j.datasetMode==="default"?"reuse":"default",datasetId:void 0}))},children:s("market:train-lora.image-select.switch-to-default-mode")}),c&&e.jsx("span",{className:"text-neutral-500 dark:text-neutral-300",children:"/"})]}),e.jsx(F,{variant:c?"text":"outlined",className:b(c?"underline text-neutral-500 dark:text-neutral-300":"","rounded-full text-xs"),disabled:u!=="default",onClick:()=>{y("import_generation_history_click",{location:c?"bottom":"top"}),d?.id?n(!0):z()},children:s("market:train-lora.image-select.import-from-history")}),c&&e.jsx("span",{className:"text-neutral-500 dark:text-neutral-300",children:"/"}),e.jsx(F,{variant:c?"text":"outlined",className:b(c?"underline text-neutral-500 dark:text-neutral-300":"","rounded-full text-xs"),disabled:u!=="default",onClick:()=>{y("import_dataset_click",{location:c?"bottom":"top"}),d?.id?l(!0):z()},children:s("market:train-lora.image-select.dataset.import-from-previous-datasets")}),!c&&e.jsx(wt,{}),e.jsx(re,{open:r,onClose:()=>n(!1),className:"mmd:w-[calc(100vw-64px)]",dismissable:!0,children:e.jsx(ut,{children:e.jsx(vt,{onClose:()=>n(!1)})})}),e.jsx(re,{open:i,onClose:()=>l(!1),dismissable:!0,children:e.jsx(xt,{children:e.jsx(gt,{children:e.jsx(Tt,{onClose:()=>l(!1)})})})})]})}function wt(){const[{datasetMode:t}]=o.useContext(S),a=O(),s=o.useContext(Le),r=o.useContext(N),[,n]=o.useContext(_e),i=async()=>{try{if(y("selected_image_clear_click"),!await fe.confirm({heading:e.jsx(B,{i18nKey:"market:train-lora.image-select.clear-images.dialog.title"}),content:e.jsx(B,{i18nKey:"market:train-lora.image-select.clear-images.dialog.content"})}))return;y("selected_image_clear_confirm_click"),a([]),r.current?.clear(),s.current?.forEach(u=>{u.controller.abort()}),s.current?.clear(),n({})}catch(l){K.error(l.message)}};return e.jsx(F,{onClick:i,variant:"outlined",className:"min-w-0 rounded-full p-1",disabled:t==="reuse",children:e.jsx(De,{})})}function vt(t){const a=E(),[s]=o.useContext(X),r=o.useMemo(()=>a+s.length,[a,s.length]),{t:n}=w(["market"]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{heading:e.jsxs("div",{className:"",children:[e.jsx("p",{className:"font-medium",children:n("market:train-lora.image-select.import-from-history")}),e.jsx("p",{className:"font-medium text-xs text-neutral-500 mt-1",children:n("market:train-lora.image-select.import-total-remaining",{total:v,remaining:v-r})})]})}),e.jsx(me,{children:e.jsx("div",{className:"relative [--list-height:calc(var(--visible-height)-4rem-24px-44px-32px-80px)] md:[--list-height:calc(min(100vh-64px,620px)-48px-50px]",children:e.jsx(Se,{gapSize:12,className:"h-[--list-height]",renderItem:({mediaId:i})=>e.jsx(Mt,{mediaId:i},i)})})}),e.jsx(ue,{children:e.jsx(Ct,{className:"ml-auto",onClose:t.onClose})})]})}function Ct(t){const{t:a}=w(["market"]),[s]=o.useContext(X),r=O(),n=o.useContext(N),i=()=>{r(l=>q([...l,...s])),n.current&&s.forEach(l=>{n.current?.set(l,"task")}),t.onClose?.()};return e.jsx("button",{disabled:s.length<1,className:b("rounded-full py-3 px-6 font-medium bg-violet-600 text-white text-xs","disabled:cursor-not-allowed disabled:opacity-50",t.className),onClick:i,children:a("market:train-lora.image-select.add-images")})}function Mt(t){const[a,s]=o.useContext(X),r=xe(t.mediaId),n=E(),i=o.useMemo(()=>a.includes(t.mediaId),[t.mediaId,a]),l=o.useCallback(()=>{y(i?"dataset_image_deselect_click":"dataset_image_select_click"),s(m=>{const d=new Set(m);return d.has(t.mediaId)?d.delete(t.mediaId):d.add(t.mediaId),[...d]})},[t.mediaId,i]),u=o.useMemo(()=>n+a.length>=v,[n,a.length]);return e.jsx(_,{className:b("m-0 relative",u&&!i&&"cursor-not-allowed opacity-50"),disableTypography:!0,disabled:u&&!i,checked:i,control:e.jsx("input",{type:"checkbox",id:"media-item",className:"absolute accent-purple-600 right-2 bottom-2 size-4 disabled:cursor-not-allowed"}),onChange:l,label:e.jsx("div",{className:b("h-[120px] w-[120px] rounded-lg",i&&"outline outline-offset-1 outline-2 outline-purple-600"),children:e.jsx("img",{className:"object-cover w-full h-full rounded-lg",src:r,loading:"lazy"})})})}function Tt(t){const{t:a}=w(),s=E(),[r]=o.useContext(J),n=o.useContext(G),i=o.useMemo(()=>r.reduce((l,u)=>l+(n?.current.get(u)??[]).length,s),[s,r]);return e.jsxs(e.Fragment,{children:[e.jsx(ce,{heading:e.jsxs("div",{className:"",children:[e.jsx("h1",{className:"font-medium",children:a("market:train-lora.image-select.dataset.import-from-dataset")}),e.jsx("p",{className:"font-medium text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:a("market:train-lora.image-select.import-total-remaining",{total:v,remaining:v-i})})]})}),e.jsx(me,{children:e.jsx("div",{className:"[--list-height:calc(var(--visible-height)-4rem-24px-44px-32px-80px)] md:[--list-height:320px] md:w-[320px]",children:e.jsx(o.Suspense,{fallback:e.jsx(ge,{}),children:e.jsx(Nt,{})})})}),e.jsx(ue,{children:e.jsx(Lt,{className:"ml-auto",onClose:t.onClose})})]})}function Nt(){const{t}=w(["market"]),{data:a}=Pe(),s=o.useCallback((f,h)=>{if(!a?.id)return;const k=h?.pageInfo.startCursor;return{...Ee({before:k,pageSize:20,isPosSeq:!1}),authorId:a.id,type:M.AnyUserLora}},[a?.id]),{data:r,isValidating:n,isLoading:i,setSize:l,size:u}=Re(s),m=o.useMemo(()=>r?r.flatMap(f=>ot(f).reverse()):[],[r]),c=o.useMemo(()=>r?.at(-1)?.pageInfo,[r])?.hasPreviousPage,j=o.useCallback(()=>{!n&&c&&l(f=>f+1)},[c]),I=o.useMemo(()=>r?.at(-1)?.totalCount,[r]);return m.length<1?i?e.jsx(ge,{}):e.jsx(Ae,{className:"text-xl",description:t("market:train-lora.image-select.dataset.empty-placeholder")}):e.jsx(Fe,{className:"w-full min-h-[140px]",style:{height:"var(--list-height)"},totalCount:I,data:m,endReached:j,itemContent:(f,h)=>e.jsx(_t,{model:h},h.id),components:{List:jt}})}function Lt(t){const{t:a}=w(["market"]),[,s]=o.useContext(D),r=O(),[n]=o.useContext(J),i=o.useContext(N),l=o.useContext(G),u=o.useCallback(()=>{s(d=>({...d,importedLoraList:[...d.importedLoraList,...n]}));const m=n.reduce((d,c)=>{const j=l.current?.get(c)??[];return[...d,...j]},[]);r(d=>q([...d,...m])),i.current&&m.forEach(d=>{i.current?.set(d,"dataset")}),t.onClose?.()},[n]);return e.jsx("button",{disabled:n.length<1,className:b("rounded-full py-3 px-6 font-medium bg-violet-600 text-white text-xs","disabled:cursor-not-allowed disabled:opacity-50",t.className),onClick:u,children:a("market:train-lora.image-select.dataset.import-datasets")})}function _t(t){const{model:a}=t,s=ze(a.media),r=E(),n=a.trainingTask?.parameters.mediaIds??[],i=n.length,[l,u]=o.useContext(J),m=o.useContext(G);m.current||(m.current=new Map);const d=o.useMemo(()=>l.includes(a.id),[l]),c=o.useMemo(()=>{const I=l.reduce((h,k)=>h+(m.current.get(k)??[]).length,r),f=v-I;return i>f},[l,r,i]),j=o.useCallback(()=>{u(I=>{let f=[...I];return f.includes(a.id)?(f=f.filter(k=>k!==a.id),m.current.delete(a.id)):(f.push(a.id),m.current.set(a.id,n)),f})},[a.id,n]);return e.jsx(_,{className:b("ml-0 mr-0 px-1 py-[6px] w-full flex items-center gap-2 min-w-0 rounded-[4px]",d&&"bg-sky-200 dark:bg-sky-900",!d&&c&&"cursor-not-allowed text-neutral-400"),disabled:!d&&c,disableTypography:!0,label:e.jsxs(e.Fragment,{children:[e.jsx("img",{className:"object-cover size-6 shrink-0 rounded",src:s}),e.jsx("span",{className:"font-medium text-sm truncate",children:t.model.title}),e.jsxs("span",{className:b("ml-auto text-sm",c&&!d?"text-neutral-400 dark:text-neutral-600":"text-neutral-500 dark:text-neutral-300"),children:[i,"/",v]})]}),onChange:j,control:e.jsx("input",{type:"checkbox",className:"sr-only"})})}function Dt(t){const{me:a}=W();return e.jsxs(e.Fragment,{children:[e.jsx(V,{variant:"outlined",className:"rounded-full font-medium",disabled:t.disabled,onPress:()=>{a?.id?t.open():z()},children:e.jsx(B,{i18nKey:"market:train-lora.add-image.label"})}),e.jsx("p",{className:"text-neutral-400 max-w-[240px] text-center",children:e.jsx(B,{i18nKey:"market:train-lora.add-image.upload-hint"})})]})}function St(){const t=Ue(),{me:a}=W(),s=o.useContext(N),[{datasetMode:r}]=o.useContext(S),n=r!=="default";return e.jsxs("section",{className:"flex flex-col",children:[e.jsx(Pt,{}),e.jsxs("div",{className:b("bg-neutral-100 dark:bg-neutral-800 rounded-xl border border-dashed border-zinc-300 dark:border-zinc-500 grow flex flex-col"),children:[e.jsx(yt,{variant:t?"at-top":"at-bottom"}),e.jsxs("div",{className:b("gap-3",t?"p-4 grid grid-cols-[repeat(auto-fill,minmax(90px,1fr))] grid-rows-[repeat(auto-fill,minmax(90px,1fr))]":"w-full h-full flex flex-col"),children:[e.jsx(st,{onFileDialogOpen:()=>{y("dataset_image_upload_click")},onItemUploadSuccess:i=>{s.current?.set(i,"upload")},onUploadSuccess:()=>{y("dataset_image_upload_success")},maxAllowedMedia:v,wrapperProps:{className:b("rounded-lg",t?"h-full bg-neutral-200 dark:bg-neutral-600":"w-full h-full grow",n&&"!cursor-not-allowed opacity-50")},dropzoneOpts:{disabled:!a?.id||n},uploadTrigger:({open:i})=>e.jsx(Dt,{open:i,disabled:n})}),e.jsx(nt,{onRemove:i=>{s.current?.delete(i)},wrapperProps:{className:"h-full w-full rounded-lg bg-white dark:bg-neutral-700"},imgProps:{className:"aspect-square object-cover h-full w-full rounded-lg"},disableRemove:n})]})]})]})}function Pt(){const{t}=w(["market"]),a=E();return e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsxs("h2",{className:"font-medium",children:[t("market:train-lora.image-select.image-count"),e.jsxs("span",{className:"ml-1",children:[a,"/",v]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx("span",{children:t("market:train-lora.image-select.example-images")}),e.jsx(pe,{iconComp:Ie,variant:"normal",TooltipProps:{placement:"bottom"},children:e.jsx("article",{className:"flex gap-4",children:[[t("market:train-lora.example.clear-subject.label"),t("market:train-lora.example.clear-subject.cover-url"),e.jsx(le,{className:"text-emerald-500"},"icon")],[t("market:train-lora.example.distinctive-style.label"),t("market:train-lora.example.distinctive-style.cover-url"),e.jsx(le,{className:"text-emerald-500"},"icon")],[t("market:train-lora.example.blur-image.label"),t("market:train-lora.example.blur-image.cover-url"),e.jsx(ht,{className:"text-rose-400"},"icon")]].map(([s,r,n],i)=>e.jsxs("figure",{children:[e.jsx("img",{width:120,height:120,className:"object-cover rounded-[6px]",src:r}),e.jsxs("figcaption",{className:"mt-1 flex justify-between text-sm items-center",children:[s," ",n]})]},i))})})]})]})}const we=256;function Et(t,a){if(!a.baseModelId)throw new Error(t("market:train-lora.notice.model-needed"));if(a.mediaIds.length<10&&!a.trainingTaskId)throw new Error(t("market:train-lora.notice.too-few-images"));if(!a.title||a.title.length<1)throw new Error(t("market:train-lora.notice.title-invalid"));if(!a.triggerWords||a.triggerWords.length<1)throw new Error(t("market:train-lora.notice.trigger-words-invalid"));if(a.triggerWords.length>we)throw new Error(t("market:train-lora.notice.trigger-words-too-long"));return a}function Rt(t,a){const{trainedLoraList:s,mediaSourceMap:r,...n}=a;let i=0,l=0,u=0;return r?.forEach(m=>{m==="task"&&(i+=1),m==="upload"&&(l+=1),m==="dataset"&&(u+=1)}),{trainModel:t.baseModelId,trainInfo:t.title,triggerWords:t.triggerWords,imagesCount:t.mediaIds.length,trainedLoraList:s?q(s):[],trainedLoraCount:s?.length,taskImagesCount:i,uploadImagesCount:l,datasetImagesCount:u,...n}}function At(){Bt();const t=ct(),{data:a,isLoading:s}=he(),[{datasetId:r}]=o.useContext(S),[n,i]=o.useState(!1),{data:l}=be({currency:"free::user_lora_training"}),u=je(l),m=l?.quotaAmount,d=u&&(m??0)>0,{me:c}=W(),j=o.useContext(N),[{title:I,triggerWords:f,versionId:h,modelType:k,importedLoraList:Y,primaryLoraModelId:P},L]=o.useContext(D),R=We(),Q=a?.models??[],T=Q.filter(g=>g.modelType===k),Z=T.find(g=>g.versionId===h)?.usage;o.useCallback(g=>T.filter(p=>p.usage===g).length===1,[T]),Ut({trainLoraModelList:Q,trainLoraModelsLoading:s,modelType:k});const{t:x}=w(["market","action","artwork"]),ve=async()=>{y("train_lora_reset_click");try{if(!await fe.confirm({heading:x("market:train-lora.info.reset.dialog.title"),content:x("market:train-lora.info.reset.dialog.description")}))return;y("train_lora_reset_confirm_click"),L({title:"",triggerWords:"",importedLoraList:[],versionId:T[0]?.versionId,modelType:M.SdxlModel})}catch{}},ee=ye({prices:a?.pricing?.pricesByModelType,modelType:k,datasetId:r,primaryLoraModelId:P,isFreeToTrain:d}),[Ce,Me]=Oe(async g=>{if(g.preventDefault(),!c?.id){z();return}try{if(!h)throw new Error(x("market:train-lora.notice.model-needed"));if(!bt(R))throw new Error(x("market:train-lora.notice.uploading-images"));y("start_training_click");const p=Et(x,{baseModelId:h,mediaIds:R&&!r?R:[],title:I,type:M.UserMultiLora,triggerWords:f,primaryLoraModelId:P,trainingTaskId:r});y("create_training_task_input",{...Rt(p,{trainedLoraList:Y,modelType:k,modelTheme:Z,credit:ee,mediaSourceMap:j.current})});const C=await qe({input:p});C.data?.createTrainingTask?.refId&&t(`/model/${C.data.createTrainingTask.refId}`),K.success(x("market:train-lora.notice.submit-success"))}catch(p){if(Ge(p)==="INSUFFICIENT_BALANCE"){Qe({scene:"insufficient-credit-train-lora",trackingLocation:"insufficient-credit-train-lora",reason:x("generation:submit.user-insufficient-credit-dialog.description")});return}K.error(p.message)}},[I,f,h,k,R,ee,Z,P]),te=k===M.Dit7Model,ae=!!r||!!P,Te=T.length>8;return e.jsxs("section",{children:[e.jsx(Wt,{}),e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:x("market:train-lora.parameters.title")}),e.jsx(V,{variant:"outlined",className:"capitalize rounded-full",type:"reset",onPress:ve,children:x("action:reset.label")})]}),e.jsxs("form",{className:"flex flex-col gap-5 mt-4",onSubmit:Me,children:[e.jsxs(A,{className:"w-full",children:[e.jsx("label",{htmlFor:"lora-name",className:"font-medium mb-1 text-black dark:text-neutral-300",children:x(ae?"market:train-lora.info.version-name.title":"market:train-lora.info.name.title")}),e.jsx(ne,{id:"lora-name",placeholder:x(ae?"market:train-lora.info.version-name.placeholder":"market:train-lora.info.name.placeholder"),value:I,onChange:g=>{L(p=>({...p,title:g.target.value}))},fullWidth:!0,required:!0})]}),e.jsxs(A,{className:"w-full",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(oe,{htmlFor:"lora-model-type",className:"font-medium text-black dark:text-neutral-300",children:x("market:train-lora.info.model-type.title")}),e.jsx(pe,{variant:"normal",TooltipProps:{placement:"top"},iconComp:Ie,children:e.jsx("p",{className:"text-sm max-w-sm text-neutral-600 dark:text-neutral-300",children:e.jsx(lt,{t:x,i18nKey:"market:train-lora.info.model-type.help-info.text",components:{a:e.jsx("a",{className:"text-violet-600 dark:text-violet-400",target:"_blank",href:x("market:train-lora.info.model-type.help-info.link"),rel:"noopener noreferrer"})}})})})]}),e.jsxs(ie,{name:"lora-model-type",value:k,row:!0,onChange:g=>{const p=g.target.value;L(C=>({...C,modelType:p,versionId:Q.find(Ne=>Ne.modelType===p)?.versionId}))},children:[e.jsx(_,{value:M.SdV1Model,control:e.jsx(H,{disableRipple:!0}),label:x("market:train-lora.info.model-type.sdv1model.label")}),e.jsx(_,{value:M.SdxlModel,control:e.jsx(H,{disableRipple:!0}),label:x("market:train-lora.info.model-type.sdxlmodel.label")}),e.jsx(_,{value:M.Dit7Model,control:e.jsx(H,{disableRipple:!0}),label:e.jsxs("span",{className:"inline-flex items-center",children:[x("market:train-lora.info.model-type.dit7model.label"),e.jsx(He,{className:"ml-1"})]})})]})]}),e.jsxs(A,{className:"w-full",children:[e.jsx(oe,{htmlFor:"lora-model-theme",className:"font-medium mb-1 text-black dark:text-neutral-300",children:x("market:train-lora.info.model-theme.title")}),e.jsxs(ie,{name:"lora-model-theme",value:h??"",row:!0,className:"flex flex-wrap gap-4",children:[T.slice(0,8).map(g=>e.jsx(de,{labelDisplay:"name",selected:g.versionId===h,onChange:p=>L(C=>({...C,versionId:p})),trainLoraModel:g},g.versionId)),Te&&e.jsx(V,{className:b("w-full"),onPress:()=>i(g=>!g),variant:"ghost",children:e.jsxs("span",{className:"flex items-center",children:[n?e.jsx(Ke,{className:"size-6"}):e.jsx(Ve,{className:"size-6"}),e.jsx("span",{className:"text-sm",children:x(n?"artwork:show.less":"artwork:show.more")})]})}),e.jsx("div",{className:b(!n&&"hidden","contents"),children:T.slice(8).map(g=>e.jsx(de,{labelDisplay:"name",selected:g.versionId===h,onChange:p=>L(C=>({...C,versionId:p})),trainLoraModel:g},g.versionId))})]})]}),e.jsxs(A,{className:"w-full",children:[e.jsx("label",{htmlFor:"lora-trigger-words",className:"font-medium mb-1 dark:text-neutral-300",children:x("market:train-lora.info.trigger-words.title")}),e.jsx(ne,{id:"lora-trigger-words",fullWidth:!0,placeholder:x("market:train-lora.info.trigger-words.placeholder",{context:te?"dit-model":void 0}),value:f,onChange:g=>L(p=>({...p,triggerWords:g.target.value})),inputProps:{maxLength:we},required:!0}),te?e.jsx("p",{className:"p-4 mt-2 rounded-xl text-amber-800 bg-amber-500/10 dark:text-amber-400 dark:bg-amber-400/5 text-xs whitespace-pre-line",children:x("market:train-lora.info.trigger-words.description",{context:"dit-model"})}):e.jsx("p",{className:"text-neutral-500 dark:text-neutral-400 text-xs mt-1",children:x("market:train-lora.info.trigger-words.description")})]}),e.jsx(dt,{}),e.jsxs("div",{className:"relative w-full",children:[e.jsxs("button",{type:"submit",disabled:Ce.loading,className:"text-white bg-violet-600 rounded-full font-medium text-xs w-full py-3 disabled:opacity-40 disabled:cursor-wait flex flex-wrap items-center justify-center",children:[x("market:train-lora.submit.label"),e.jsx("span",{className:"inline-flex items-center pl-4",children:e.jsx(Ft,{})})]}),d&&(m??0)>0&&e.jsx("span",{className:"absolute top-0 -translate-y-1/2 right-5 bg-left rounded-full bg-gradient-to-r from-[#02c0a4] via-[#0282de] via-80% to-[#714FFE] px-2 py-1 text-white font-medium text-xs",children:x("market:train-lora.info.free-training-times.label",{amount:m})})]})]}),e.jsx(zt,{})]})}function Ft(){const[{modelType:t,primaryLoraModelId:a}]=o.useContext(D),[{datasetId:s}]=o.useContext(S),{data:r,isValidating:n}=he(),{data:i,loading:l}=be({currency:"free::user_lora_training"}),u=r?.pricing?.pricesByModelType,m=je(i),d=i?.quotaAmount,c=m&&(d??0)>0,I=(t?u?.[t]:void 0)?.originalPrice,f=ye({prices:u,modelType:t,datasetId:s,primaryLoraModelId:a,isFreeToTrain:c});return e.jsxs(e.Fragment,{children:[e.jsx($e,{loading:n||l,iconClassName:"size-4",valueClassName:"text-white",value:f,className:"text-white"}),I&&e.jsx("span",{className:"text-white font-quicksand ml-2 line-through",children:I.toLocaleString()})]})}function zt(){const{t}=w(["market"]);return e.jsx("div",{className:"flex items-center w-full justify-center text-xs mt-5",children:e.jsx("p",{className:"pl-2 ml-2 text-neutral-500 dark:text-neutral-300",children:t("market:train-lora.info.estimated-time")})})}function de(t){const{t:a}=w(["market"]),{onChange:s,selected:r,trainLoraModel:n}=t,{coverUrl:i,versionId:l,modelName:u,usage:m}=n;return e.jsx(_,{className:b("rounded-lg shadow border w-[120px] cursor-pointer min-w-0 flex flex-col ml-0 mr-0",r&&"outline outline-2 outline-violet-600"),disableTypography:!0,value:l,onChange:d=>{s?.(l)},title:u,control:e.jsx("input",{className:"sr-only",type:"radio",onClick:d=>{s(l)}}),label:e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i,width:120,height:120,className:"object-cover aspect-square rounded-t-md"}),e.jsx("p",{className:"text-center my-auto max-w-full px-2 pb-[2px] text-sm",children:t.labelDisplay==="theme"?a(`market:train-lora.info.model-theme.${m}.label`):u})]})})}function Bt(){const[{addToModelId:t},a]=$(),{data:s,isLoading:r,error:n}=ke(t),[,i]=o.useContext(D);o.useEffect(()=>{r||(s&&Xe(s?.type)&&i(l=>({...l,primaryLoraModelId:t})),a(l=>({...l,addToModelId:null})))},[r,n,s?.type])}function Ut(t){const[,a]=o.useContext(D),s=o.useRef(!1),[{trainWithModelId:r},n]=$(),{trainLoraModelsLoading:i,trainLoraModelList:l,modelType:u}=t;o.useEffect(()=>{if(!s.current&&!i&&l){let m=l.find(c=>c.modelType===u)?.versionId,d=u;if(r){const c=l.find(j=>j.versionId===r);c&&(d=c.modelType,m=r),n(j=>({...j,trainWithModelId:null}))}a(c=>({...c,versionId:m,modelType:d})),s.current=!0}},[i,u,r,l])}function Wt(){const[{primaryLoraModelId:t}]=o.useContext(D),{t:a}=w(["common","market"]),{data:s,isLoading:r}=ke(t);if(!s)return null;const n=xe(s.mediaId);return r?e.jsx("div",{className:"w-full",children:e.jsx(Je,{})}):e.jsxs("div",{className:"flex flex-col gap-4 w-full mb-6",children:[e.jsx("h2",{children:a("market:train-lora.parameters.adding-to-model.title")}),e.jsxs("div",{className:"flex flex-row items-center justify-start px-4 py-2 bg-background-light rounded-xl gap-4",children:[e.jsx("div",{className:"shrink-0 border border-px rounded-xl w-16 h-16 mb-1",children:n&&e.jsx("img",{src:n,alt:"",loading:"lazy",decoding:"async",className:"rounded-xl w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h3",{children:s.title}),e.jsxs("p",{className:"text-sm text-neutral-500 dark:text-neutral-300",children:[a("common:updated-at"),": ",Ye(s.updatedAt)]})]})]})]})}function Ot(){const t=o.useMemo(Ze,[]);return e.jsx("div",{className:"grid lg:grid-cols-[1fr_540px] gap-8 bg-background w-full p-5",children:e.jsx(ft,{children:e.jsx(et.Provider,{value:t,children:e.jsx(mt,{children:e.jsxs(pt,{children:[e.jsx(tt,{children:e.jsx(St,{})}),e.jsx(At,{})]})})})})})}const qt=()=>{const{t}=w(["common"]);return e.jsxs("div",{children:[e.jsx(at,{content:t("common:meta.title.train-lora")}),e.jsx(Ot,{})]})},ga=qt;export{ga as Component};
