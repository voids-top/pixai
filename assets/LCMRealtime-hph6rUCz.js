import{j as a}from"./vendor-motion-Bl2lDopP.js";import{r as m,a as yt,R as L}from"./vendor-apollo-B9XqHIAo.js";import{jE as Ct,jF as _t,p as O,fI as me,ie as jt,ik as St,gi as ie,dx as We,b as kt,jG as Et,dB as Rt,ac as Tt,iK as Pt,jH as ke,a9 as Ze,gV as Bt,jI as Mt,jJ as Nt,jK as Ee,aU as Re,jL as Lt,jM as At,jN as Ot,jd as It,a as Xe,iD as Dt,aQ as zt,aV as Ft,m as G,jO as Ht,t as he,gQ as qt,jP as Ut,ab as Gt,jQ as Vt,h4 as $t,dg as Wt,iJ as Zt,gU as Xt,jR as Yt,iA as Kt,bk as Qt,dP as Jt,G as er,gh as tr}from"./index-JhqgbpkX.js";import{f as _}from"./vendor-fabric-Bg02ktlP.js";import{_ as w,s as rr,Y as Ye,Q as Ke,B as A,q as sr,ac as ar,a as be,Z as nr,a9 as Qe,ab as N,ae as Te,af as J,x as ue,C as ir}from"./vendor-mui-DTp04zm4.js";import{g as or}from"./vendor-amplitude-core-CQMkGYFj.js";import{u as q,a as I}from"./vendor-i18next-TC5y0B3W.js";import{_ as Je}from"./objectDestructuringEmpty-YVl7faCL.js";import{i as lr}from"./baseline-arrow-downward-zIQhHbGH.js";import{a as cr}from"./vendor-axios-CFwfAwt2.js";import{C as dr}from"./GenerationModeNavigation-BeGzJJIs.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e.SENTRY_RELEASE={id:"0ec442be81a4ee21bfcf5745e8ef10bc76836958"}}catch{}})();try{(function(){var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="42d76bcc-af78-4989-883a-484e9025216b",e._sentryDebugIdIdentifier="sentry-dbid-42d76bcc-af78-4989-883a-484e9025216b")})()}catch{}(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];if(s!=null)for(var n in s)s.hasOwnProperty(n)&&(t[n]=s[n])}return t}({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}catch{}})();var ur=Ct(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}});function hr(e,t){return new Promise(function(r,s){var n=new _t({next:function(l){r(l),n.unsubscribe()},error:s,complete:function(){s(new ur)}});e.subscribe(n)})}var xe={exports:{}},Z=typeof Reflect=="object"?Reflect:null,Pe=Z&&typeof Z.apply=="function"?Z.apply:function(t,r,s){return Function.prototype.apply.call(t,r,s)},te;Z&&typeof Z.ownKeys=="function"?te=Z.ownKeys:Object.getOwnPropertySymbols?te=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:te=function(t){return Object.getOwnPropertyNames(t)};function fr(e){console&&console.warn&&console.warn(e)}var et=Number.isNaN||function(t){return t!==t};function B(){B.init.call(this)}xe.exports=B;xe.exports.once=mr;B.EventEmitter=B;B.prototype._events=void 0;B.prototype._eventsCount=0;B.prototype._maxListeners=void 0;var Be=10;function oe(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(B,"defaultMaxListeners",{enumerable:!0,get:function(){return Be},set:function(e){if(typeof e!="number"||e<0||et(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Be=e}});B.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};B.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||et(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function tt(e){return e._maxListeners===void 0?B.defaultMaxListeners:e._maxListeners}B.prototype.getMaxListeners=function(){return tt(this)};B.prototype.emit=function(t){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);var n=t==="error",l=this._events;if(l!==void 0)n=n&&l.error===void 0;else if(!n)return!1;if(n){var c;if(r.length>0&&(c=r[0]),c instanceof Error)throw c;var d=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw d.context=c,d}var i=l[t];if(i===void 0)return!1;if(typeof i=="function")Pe(i,this,r);else for(var o=i.length,u=it(i,o),s=0;s<o;++s)Pe(u[s],this,r);return!0};function rt(e,t,r,s){var n,l,c;if(oe(r),l=e._events,l===void 0?(l=e._events=Object.create(null),e._eventsCount=0):(l.newListener!==void 0&&(e.emit("newListener",t,r.listener?r.listener:r),l=e._events),c=l[t]),c===void 0)c=l[t]=r,++e._eventsCount;else if(typeof c=="function"?c=l[t]=s?[r,c]:[c,r]:s?c.unshift(r):c.push(r),n=tt(e),n>0&&c.length>n&&!c.warned){c.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=c.length,fr(d)}return e}B.prototype.addListener=function(t,r){return rt(this,t,r,!1)};B.prototype.on=B.prototype.addListener;B.prototype.prependListener=function(t,r){return rt(this,t,r,!0)};function pr(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function st(e,t,r){var s={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},n=pr.bind(s);return n.listener=r,s.wrapFn=n,n}B.prototype.once=function(t,r){return oe(r),this.on(t,st(this,t,r)),this};B.prototype.prependOnceListener=function(t,r){return oe(r),this.prependListener(t,st(this,t,r)),this};B.prototype.removeListener=function(t,r){var s,n,l,c,d;if(oe(r),n=this._events,n===void 0)return this;if(s=n[t],s===void 0)return this;if(s===r||s.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,s.listener||r));else if(typeof s!="function"){for(l=-1,c=s.length-1;c>=0;c--)if(s[c]===r||s[c].listener===r){d=s[c].listener,l=c;break}if(l<0)return this;l===0?s.shift():gr(s,l),s.length===1&&(n[t]=s[0]),n.removeListener!==void 0&&this.emit("removeListener",t,d||r)}return this};B.prototype.off=B.prototype.removeListener;B.prototype.removeAllListeners=function(t){var r,s,n;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var l=Object.keys(s),c;for(n=0;n<l.length;++n)c=l[n],c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=s[t],typeof r=="function")this.removeListener(t,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(t,r[n]);return this};function at(e,t,r){var s=e._events;if(s===void 0)return[];var n=s[t];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?vr(n):it(n,n.length)}B.prototype.listeners=function(t){return at(this,t,!0)};B.prototype.rawListeners=function(t){return at(this,t,!1)};B.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):nt.call(e,t)};B.prototype.listenerCount=nt;function nt(e){var t=this._events;if(t!==void 0){var r=t[e];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}B.prototype.eventNames=function(){return this._eventsCount>0?te(this._events):[]};function it(e,t){for(var r=new Array(t),s=0;s<t;++s)r[s]=e[s];return r}function gr(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function vr(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}function mr(e,t){return new Promise(function(r,s){function n(c){e.removeListener(t,l),s(c)}function l(){typeof e.removeListener=="function"&&e.removeListener("error",n),r([].slice.call(arguments))}ot(e,t,l,{once:!0}),t!=="error"&&br(e,n,{once:!0})})}function br(e,t,r){typeof e.on=="function"&&ot(e,"error",t,r)}function ot(e,t,r,s){if(typeof e.on=="function")s.once?e.once(t,r):e.on(t,r);else if(typeof e.addEventListener=="function")e.addEventListener(t,function n(l){s.once&&e.removeEventListener(t,n),r(l)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var xr=xe.exports;const wr=or(xr);var $=255,H=100,Y=e=>{var{r:t,g:r,b:s,a:n}=e,l=Math.max(t,r,s),c=l-Math.min(t,r,s),d=c?l===t?(r-s)/c:l===r?2+(s-t)/c:4+(t-r)/c:0;return{h:60*(d<0?d+6:d),s:l?c/l*H:0,v:l/$*H,a:n}},lt=e=>{var{h:t,s:r,l:s,a:n}=we(e);return"hsla("+t+", "+r+"%, "+s+"%, "+n+")"},ee=e=>{var{h:t,s:r,l:s,a:n}=e;return r*=(s<50?s:H-s)/H,{h:t,s:r>0?2*r/(s+r)*H:0,v:s+r,a:n}},we=e=>{var{h:t,s:r,v:s,a:n}=e,l=(200-r)*s/H;return{h:t,s:l>0&&l<200?r*s/H/(l<=H?l:200-l)*H:0,l:l/2,a:n}},ct=e=>{var{r:t,g:r,b:s}=e,n=t<<16|r<<8|s;return"#"+(l=>new Array(7-l.length).join("0")+l)(n.toString(16))},dt=e=>{var{r:t,g:r,b:s,a:n}=e,l=typeof n=="number"&&(n*255|256).toString(16).slice(1);return""+ct({r:t,g:r,b:s,a:n})+(l||"")},V=e=>Y(yr(e)),yr=e=>{var t=e.replace("#","");/^#?/.test(e)&&t.length===3&&(e="#"+t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2));var r=new RegExp("[A-Za-z0-9]{2}","g"),[s,n,l=0,c]=e.match(r).map(d=>parseInt(d,16));return{r:s,g:n,b:l,a:(c??255)/$}},Q=e=>{var{h:t,s:r,v:s,a:n}=e,l=t/60,c=r/H,d=s/H,i=Math.floor(l)%6,o=l-Math.floor(l),u=$*d*(1-c),f=$*d*(1-c*o),x=$*d*(1-c*(1-o));d*=$;var h={};switch(i){case 0:h.r=d,h.g=x,h.b=u;break;case 1:h.r=f,h.g=d,h.b=u;break;case 2:h.r=u,h.g=d,h.b=x;break;case 3:h.r=u,h.g=f,h.b=d;break;case 4:h.r=x,h.g=u,h.b=d;break;case 5:h.r=d,h.g=u,h.b=f;break}return h.r=Math.round(h.r),h.g=Math.round(h.g),h.b=Math.round(h.b),w({},h,{a:n})},Cr=e=>{var{r:t,g:r,b:s,a:n}=Q(e);return"rgba("+t+", "+r+", "+s+", "+n+")"},_r=e=>{var{r:t,g:r,b:s}=e;return{r:t,g:r,b:s}},jr=e=>{var{h:t,s:r,l:s}=e;return{h:t,s:r,l:s}},le=e=>ct(Q(e)),Sr=e=>dt(Q(e)),kr=e=>{var{h:t,s:r,v:s}=e;return{h:t,s:r,v:s}},z=e=>{var t,r,s,n,l,c,d,i;return typeof e=="string"&&ce(e)?(c=V(e),d=e):typeof e!="string"&&(c=e),c&&(s=kr(c),l=we(c),n=Q(c),i=dt(n),d=le(c),r=jr(l),t=_r(n)),{rgb:t,hsl:r,hsv:s,rgba:n,hsla:l,hsva:c,hex:d,hexa:i}},ce=e=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(e);class Er extends wr{_canvas;get canvas(){if(!this._canvas)throw new Error("editor not initialized");return this._canvas}}const Rr=e=>class extends e{_state=[];_stateIndex=0;afterRestoreState(){}afterResetHistory(){}resetHistory(){this._state=[this._saveState()],this._stateIndex=0,this.emit("stateChange",{}),this.afterResetHistory()}async clearChanges(){const r=this._state[0];await this._restoreState(r),this.resetHistory()}_saveState(){return this.canvas.toObject(["name"])}async _restoreState(r){await new Promise(s=>{this.canvas.loadFromJSON(r,s)}),this.afterRestoreState()}canUndo(){return this._state[this._stateIndex-1]!=null}canRedo(){return this._state[this._stateIndex+1]!=null}recordHistory(){this._state=this._state.slice(0,this._stateIndex+1),this._state.push(this._saveState()),this._stateIndex+=1,this.emit("stateChange",{})}async undo(){const r=this._state[this._stateIndex-1];r&&(this._stateIndex-=1,await this._restoreState(r),this.emit("stateChange",{}))}async redo(){const r=this._state[this._stateIndex+1];r&&(this._stateIndex+=1,await this._restoreState(r),this.emit("stateChange",{}))}async restoreScope(r,{save:s}={}){const n=this._saveState();let l=!1;const c=()=>{l=!0};try{return await r(c)}finally{l?await this._restoreState(n):s&&this.recordHistory()}}restoreOnError(r,s={}){return this.restoreScope(n=>{try{return r(n)}catch(l){throw n(),l}},s)}},Tr=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7.5 18c-.83 0-1.5-.67-1.5-1.5S6.67 15 7.5 15s1.5.67 1.5 1.5S8.33 18 7.5 18zm0-9C6.67 9 6 8.33 6 7.5S6.67 6 7.5 6S9 6.67 9 7.5S8.33 9 7.5 9zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zm4.5 4.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5s-.67 1.5-1.5 1.5zm0-9c-.83 0-1.5-.67-1.5-1.5S15.67 6 16.5 6s1.5.67 1.5 1.5S17.33 9 16.5 9z"})}),Pr=rr(Ye)(()=>({"& .MuiSlider-thumb":{height:16,width:16,backgroundColor:"#7c3aed","&:hover":{boxShadow:"0px 0px 0px 4px #7c3aed66"},"&.Mui-active":{boxShadow:"0px 0px 0px 8px #7c3aed66"}},"& .MuiSlider-track":{height:8,borderRadius:"24px 0 0 24px",border:"none",backgroundColor:"#c084fc"},"& .MuiSlider-rail":{height:8,borderRadius:4,backgroundColor:"#bfbfbf"}}));function Br({value:e,onChange:t}){const{t:r}=q(["generation"]);return a.jsx(Ke,{multiline:!0,value:e,onChange:t,minRows:2,maxRows:3,className:"w-full md:w-[38%] transition",label:r("generation:lcm.params.negative-prompts.label")})}m.memo(Br);function Mr({value:e,onChange:t,showExtraLabel:r}){const{t:s}=q(["generation"]);return a.jsx(Ke,{multiline:!0,value:e,onChange:t,minRows:1,maxRows:3,className:"w-full",label:a.jsxs(a.Fragment,{children:[s("generation:lcm.params.prompts.label"),r&&a.jsx("span",{className:"ml-4 text-theme-primary text-[1.25em]",children:"Start here!"})]}),slotProps:{inputLabel:{shrink:!0}}})}function Nr({value:e,onClick:t}){const{t:r}=q(["generation"]);return a.jsxs(A,{disableRipple:!0,variant:"outlined",className:"flex items-center gap-1 px-2",onClick:t,children:[a.jsx("h4",{className:"mr-1",children:r("generation:lcm.params.reroll.label")}),a.jsx(Tr,{})]})}function Lr({value:e,onChange:t,className:r}){const{t:s}=q(["generation"]);return a.jsxs(sr,{className:O("w-full flex flex-row grow items-center gap-4",r),fullWidth:!0,size:"small",children:[a.jsx(ar,{className:"whitespace-nowrap text-black dark:text-white !text-sm",children:s("generation:lcm.params.strength.label")}),a.jsx(Pr,{size:"small",value:e,onChange:t,min:.25,max:1,step:.01,valueLabelDisplay:"auto",valueLabelFormat:n=>n.toFixed(2)})]})}const Ar=({status:e})=>{const{t}=q(["generation"]),[r,s]=m.useState(!1),n=m.useRef(e);n.current=e;const[l,c]=m.useState(0),d=m.useRef(0),i=m.useRef(),o=m.useCallback(()=>{n.current==="rendering"&&(c(Date.now()-d.current),i.current=requestAnimationFrame(o))},[]);return m.useEffect(()=>(s(!1),e==="rendering"?(d.current=Date.now(),i.current=requestAnimationFrame(o)):c(0),()=>cancelAnimationFrame(i.current)),[e,o]),me(()=>{e==="idle"&&s(!0)},850,[e,l]),a.jsx("div",{className:"absolute top-0 left-0 right-0 flex justify-center overflow-hidden pointer-events-none",children:a.jsxs("div",{className:O("flex items-center justify-center gap-2 px-5 py-1","rounded-b-lg border-b border-l border-r border-gray-200 dark:border-gray-600 bg-background","transition-transform duration-200 ease-in-out transform",r?"-translate-y-full":"translate-y-0"),children:[a.jsx("div",{className:O("rounded-full w-3 h-3",e==="debouncing"&&"bg-amber-400",e==="rendering"&&"bg-sky-400 cursor-wait",e==="idle"&&"bg-emerald-400")}),a.jsxs("span",{className:"text-sm text-primary tabular-nums",children:[e==="debouncing"&&t("generation:lcm.status.debouncing"),e==="rendering"&&t("generation:lcm.status.rendering",{elapsed:(l/1e3).toFixed(3)}),e==="idle"&&t("generation:lcm.status.idle")]})]})})};function fe(){return fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)({}).hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},fe.apply(null,arguments)}function Or(e){const t=e;return t.__esModule?t.default:e}const Ir=Or(be),Dr=m.forwardRef(function(t,r){var s,n;const l=m.useMemo(()=>{var c;const d=(c=t.slotProps)===null||c===void 0?void 0:c.paper;return d instanceof Function?i=>{const o=d(i);return{...o,style:{pointerEvents:"auto",...o.style}}}:{...d,style:{pointerEvents:"auto",...d?.style}}},[(s=t.slotProps)===null||s===void 0?void 0:s.paper]);return m.createElement(Ir,fe({},t,{ref:r,style:{pointerEvents:"none",...t.style},PaperProps:{...t.PaperProps,style:{pointerEvents:"auto",...(n=t.PaperProps)===null||n===void 0?void 0:n.style}},slotProps:{...t.slotProps,paper:l}}))});function X(e){if(typeof window>"u")return e;const t=m.useRef(null);return m.useLayoutEffect(()=>{t.current=e}),m.useCallback((...r)=>{var s;(s=t.current)===null||s===void 0||s.call(t,...r)},[])}const Me={};function zr(e,t){Me[e]||(Me[e]=!0,console.error("[material-ui-popup-state] WARNING",t))}const Fr={isOpen:!1,setAnchorElUsed:!1,anchorEl:void 0,anchorPosition:void 0,hovered:!1,focused:!1,_openEventType:null,_childPopupState:null,_deferNextOpen:!1,_deferNextClose:!1},Ne=yt,Hr="useId"in Ne?()=>Ne.useId():()=>{};function re({parentPopupState:e,popupId:t=Hr(),variant:r,disableAutoFocus:s}){const n=m.useRef(!0);m.useEffect(()=>(n.current=!0,()=>{n.current=!1}),[]);const[l,c]=m.useState(Fr),d=m.useCallback(p=>{n.current&&c(p)},[]),i=m.useCallback(p=>d(b=>({...b,setAnchorElUsed:!0,anchorEl:p??void 0})),[]),o=X(p=>(l.isOpen?x(p):u(p),l)),u=X(p=>{const b=p instanceof Element?void 0:p,S=p instanceof Element?p:p?.currentTarget instanceof Element?p.currentTarget:void 0;if(b?.type==="touchstart"){d(E=>({...E,_deferNextOpen:!0}));return}const P=b?.clientX,j=b?.clientY,k=typeof P=="number"&&typeof j=="number"?{left:P,top:j}:void 0,R=E=>{if(!p&&!E.setAnchorElUsed&&r!=="dialog"&&zr("missingEventOrAnchorEl","eventOrAnchorEl should be defined if setAnchorEl is not used"),e){if(!e.isOpen)return E;setTimeout(()=>e._setChildPopupState(g))}const T={...E,isOpen:!0,anchorPosition:k,hovered:b?.type==="mouseover"||E.hovered,focused:b?.type==="focus"||E.focused,_openEventType:b?.type};return E.setAnchorElUsed||(b!=null&&b.currentTarget?T.anchorEl=b.currentTarget:S&&(T.anchorEl=S)),T};d(E=>E._deferNextOpen?(setTimeout(()=>d(R),0),{...E,_deferNextOpen:!1}):R(E))}),f=p=>{const{_childPopupState:b}=p;return setTimeout(()=>{b?.close(),e?._setChildPopupState(null)}),{...p,isOpen:!1,hovered:!1,focused:!1}},x=X(p=>{const b=p instanceof Element?void 0:p;if(b?.type==="touchstart"){d(S=>({...S,_deferNextClose:!0}));return}d(S=>S._deferNextClose?(setTimeout(()=>d(f),0),{...S,_deferNextClose:!1}):f(S))}),h=m.useCallback((p,b)=>{p?u(b):x(b)},[]),C=X(p=>{const{relatedTarget:b}=p;d(S=>S.hovered&&!(b instanceof Element&&pe(b,g))?S.focused?{...S,hovered:!1}:f(S):S)}),y=X(p=>{if(!p)return;const{relatedTarget:b}=p;d(S=>S.focused&&!(b instanceof Element&&pe(b,g))?S.hovered?{...S,focused:!1}:f(S):S)}),v=m.useCallback(p=>d(b=>({...b,_childPopupState:p})),[]),g={...l,setAnchorEl:i,popupId:t??void 0,variant:r,open:u,close:x,toggle:o,setOpen:h,onBlur:y,onMouseLeave:C,disableAutoFocus:s??!!(l.hovered||l.focused),_setChildPopupState:v};return g}function ut({isOpen:e,popupId:t,variant:r}){return{...r==="popover"?{"aria-haspopup":!0,"aria-controls":e?t:void 0}:r==="popper"?{"aria-describedby":e?t:void 0}:void 0}}function qr(e){return{...ut(e),onClick:e.open,onTouchStart:e.open}}function Ur(e){const{open:t,onMouseLeave:r}=e;return{...ut(e),onTouchStart:t,onMouseOver:t,onMouseLeave:r}}function ht({isOpen:e,anchorEl:t,anchorPosition:r,close:s,popupId:n,onMouseLeave:l,disableAutoFocus:c,_openEventType:d}){return{id:n,anchorEl:t,anchorPosition:r,anchorReference:d==="contextmenu"?"anchorPosition":"anchorEl",open:e,onClose:s,onMouseLeave:l,...c&&{disableAutoFocus:!0,disableEnforceFocus:!0,disableRestoreFocus:!0}}}function Gr(e,{popupId:t}){if(!t)return null;const r=typeof e.getRootNode=="function"?e.getRootNode():document;return typeof r.getElementById=="function"?r.getElementById(t):null}function pe(e,t){const{anchorEl:r,_childPopupState:s}=t;return Le(r,e)||Le(Gr(e,t),e)||s!=null&&pe(e,s)}function Le(e,t){if(!e)return!1;for(;t;){if(t===e)return!0;t=t.parentElement}return!1}(function(){_.fabric.Object.ENLIVEN_PROPS.push("eraser");var e=_.fabric.Object.prototype._drawClipPath,t=_.fabric.Object.prototype.needsItsOwnCache,r=_.fabric.Object.prototype.toObject,s=_.fabric.Object.prototype.getSvgCommons,n=_.fabric.Object.prototype._createBaseClipPathSVGMarkup,l=_.fabric.Object.prototype._createBaseSVGMarkup;_.fabric.Object.prototype.cacheProperties.push("eraser"),_.fabric.Object.prototype.stateProperties.push("eraser"),_.fabric.util.object.extend(_.fabric.Object.prototype,{erasable:!0,eraser:void 0,needsItsOwnCache:function(){return t.call(this)||!!this.eraser},_drawClipPath:function(i,o){if(e.call(this,i,o),this.eraser){var u=this._getNonTransformedDimensions();this.eraser.isType("eraser")&&this.eraser.set({width:u.x,height:u.y}),e.call(this,i,this.eraser)}},toObject:function(i){var o=r.call(this,["erasable"].concat(i));return this.eraser&&!this.eraser.excludeFromExport&&(o.eraser=this.eraser.toObject(i)),o},getSvgCommons:function(){return s.call(this)+(this.eraser?'mask="url(#'+this.eraser.clipPathId+')" ':"")},_createEraserSVGMarkup:function(i){return this.eraser?(this.eraser.clipPathId="MASK_"+_.fabric.Object.__uid++,['<mask id="',this.eraser.clipPathId,'" >',this.eraser.toSVG(i),"</mask>",`
`].join("")):""},_createBaseClipPathSVGMarkup:function(i,o){return[this._createEraserSVGMarkup(o&&o.reviver),n.call(this,i,o)].join("")},_createBaseSVGMarkup:function(i,o){return[this._createEraserSVGMarkup(o&&o.reviver),l.call(this,i,o)].join("")}});var c=_.fabric.Group.prototype._restoreObjectsState;_.fabric.util.object.extend(_.fabric.Group.prototype,{_addEraserPathToObjects:function(i){this._objects.forEach(function(o){_.fabric.EraserBrush.prototype._addPathToObjectEraser.call(_.fabric.EraserBrush.prototype,o,i)})},applyEraserToObjects:function(){var i=this,o=this.eraser;if(o){delete this.eraser;var u=i.calcTransformMatrix();o.clone(function(f){var x=i.clipPath;f.getObjects("path").forEach(function(h){var C=_.fabric.util.multiplyTransformMatrices(u,h.calcTransformMatrix());_.fabric.util.applyTransformToObject(h,C),x?x.clone(function(y){var v=_.fabric.EraserBrush.prototype.applyClipPathToPath.call(_.fabric.EraserBrush.prototype,h,y,u);i._addEraserPathToObjects(v)},["absolutePositioned","inverted"]):i._addEraserPathToObjects(h)})})}},_restoreObjectsState:function(){return this.erasable===!0&&this.applyEraserToObjects(),c.call(this)}}),_.fabric.Eraser=_.fabric.util.createClass(_.fabric.Group,{type:"eraser",originX:"center",originY:"center",drawObject:function(i){i.save(),i.fillStyle="black",i.fillRect(-this.width/2,-this.height/2,this.width,this.height),i.restore(),this.callSuper("drawObject",i)},_getBounds:function(){},_toSVG:function(i){var o=["<g ","COMMON_PARTS",` >
`],u=-this.width/2,f=-this.height/2,x=["<rect ",'fill="white" ','x="',u,'" y="',f,'" width="',this.width,'" height="',this.height,`" />
`].join("");o.push("		",x);for(var h=0,C=this._objects.length;h<C;h++)o.push("		",this._objects[h].toSVG(i));return o.push(`</g>
`),o}}),_.fabric.Eraser.fromObject=function(i,o){var u=i.objects;_.fabric.util.enlivenObjects(u,function(f){var x=_.fabric.util.object.clone(i,!0);delete x.objects,_.fabric.util.enlivenObjectEnlivables(i,x,function(){o&&o(new _.fabric.Eraser(f,x,!0))})})};var d=_.fabric.Canvas.prototype._renderOverlay;_.fabric.util.object.extend(_.fabric.Canvas.prototype,{isErasing:function(){return this.isDrawingMode&&this.freeDrawingBrush&&this.freeDrawingBrush.type==="eraser"&&this.freeDrawingBrush._isErasing},_renderOverlay:function(i){d.call(this,i),this.isErasing()&&!this.freeDrawingBrush.inverted&&this.freeDrawingBrush._render()}}),_.fabric.EraserBrush=_.fabric.util.createClass(_.fabric.PencilBrush,{type:"eraser",inverted:!1,_isErasing:!1,_isErasable:function(i){return i.erasable!==!1},_prepareCollectionTraversal:function(i,o,u){i.forEachObject(function(f){f.forEachObject&&f.erasable==="deep"?this._prepareCollectionTraversal(f,o,u):!this.inverted&&f.erasable&&f.visible?(f.visible=!1,i.dirty=!0,u.visibility.push(f),u.collection.push(i)):this.inverted&&f.visible&&(f.erasable&&f.eraser?(f.eraser.inverted=!0,f.dirty=!0,i.dirty=!0,u.eraser.push(f),u.collection.push(i)):(f.visible=!1,i.dirty=!0,u.visibility.push(f),u.collection.push(i)))},this)},preparePattern:function(){this._patternCanvas||(this._patternCanvas=_.fabric.util.createCanvasElement());var i=this._patternCanvas;i.width=this.canvas.width,i.height=this.canvas.height;var o=i.getContext("2d");if(this.canvas._isRetinaScaling()){var u=this.canvas.getRetinaScaling();this.canvas.__initRetinaScaling(u,i,o)}var f=this.canvas.backgroundImage,x=f&&this._isErasable(f),h=this.canvas.overlayImage,C=h&&this._isErasable(h);if(!this.inverted&&(f&&!x||this.canvas.backgroundColor))x&&(this.canvas.backgroundImage=void 0),this.canvas._renderBackground(o),x&&(this.canvas.backgroundImage=f);else if(this.inverted&&f&&x){var y=this.canvas.backgroundColor;this.canvas.backgroundColor=void 0,this.canvas._renderBackground(o),this.canvas.backgroundColor=y}o.save(),o.transform.apply(o,this.canvas.viewportTransform);var v={visibility:[],eraser:[],collection:[]};if(this._prepareCollectionTraversal(this.canvas,o,v),this.canvas._renderObjects(o,this.canvas._objects),v.visibility.forEach(function(g){g.visible=!0}),v.eraser.forEach(function(g){g.eraser.inverted=!1,g.dirty=!0}),v.collection.forEach(function(g){g.dirty=!0}),o.restore(),!this.inverted&&(h&&!C||this.canvas.overlayColor))C&&(this.canvas.overlayImage=void 0),d.call(this.canvas,o),C&&(this.canvas.overlayImage=h);else if(this.inverted&&h&&C){var y=this.canvas.overlayColor;this.canvas.overlayColor=void 0,d.call(this.canvas,o),this.canvas.overlayColor=y}},_setBrushStyles:function(i){this.callSuper("_setBrushStyles",i),i.strokeStyle="black"},_saveAndTransform:function(i){this.callSuper("_saveAndTransform",i),this._setBrushStyles(i),i.globalCompositeOperation=i===this.canvas.getContext()?"destination-out":"source-over"},needsFullRender:function(){return!0},onMouseDown:function(i,o){this.canvas._isMainEvent(o.e)&&(this._prepareForDrawing(i),this._captureDrawingPath(i),this.preparePattern(),this._isErasing=!0,this.canvas.fire("erasing:start"),this._render())},_render:function(){var i;this.inverted||(i=this.canvas.getContext(),this.callSuper("_render",i)),i=this.canvas.contextTop,this.canvas.clearContext(i),this.callSuper("_render",i),i.save();var o=this.canvas.getRetinaScaling(),u=1/o;i.scale(u,u),i.globalCompositeOperation="source-in",i.drawImage(this._patternCanvas,0,0),i.restore()},createPath:function(i){var o=this.callSuper("createPath",i);return o.globalCompositeOperation=this.inverted?"source-over":"destination-out",o.stroke=this.inverted?"white":"black",o},applyClipPathToPath:function(i,o,u){var f=_.fabric.util.invertTransform(i.calcTransformMatrix()),x=o.calcTransformMatrix(),h=o.absolutePositioned?f:_.fabric.util.multiplyTransformMatrices(f,u);return o.absolutePositioned=!1,_.fabric.util.applyTransformToObject(o,_.fabric.util.multiplyTransformMatrices(h,x)),i.clipPath=i.clipPath?_.fabric.util.mergeClipPaths(o,i.clipPath):o,i},clonePathWithClipPath:function(i,o,u){var f=o.calcTransformMatrix(),x=o.clipPath,h=this;i.clone(function(C){x.clone(function(y){u(h.applyClipPathToPath(C,y,f))},["absolutePositioned","inverted"])})},_addPathToObjectEraser:function(i,o){var u=this;if(i.forEachObject&&i.erasable==="deep"){var f=i._objects.filter(function(h){return h.erasable});f.length>0&&i.clipPath?this.clonePathWithClipPath(o,i,function(h){f.forEach(function(C){u._addPathToObjectEraser(C,h)})}):f.length>0&&f.forEach(function(h){u._addPathToObjectEraser(h,o)});return}var x=i.eraser;x||(x=new _.fabric.Eraser,i.eraser=x),o.clone(function(h){var C=_.fabric.util.multiplyTransformMatrices(_.fabric.util.invertTransform(i.calcTransformMatrix()),h.calcTransformMatrix());_.fabric.util.applyTransformToObject(h,C),x.addWithUpdate(h),i.set("dirty",!0),i.fire("erasing:end",{path:h}),i.group&&Array.isArray(u.__subTargets)&&u.__subTargets.push(i)})},applyEraserToCanvas:function(i){var o=this.canvas,u={};return["backgroundImage","overlayImage"].forEach(function(f){var x=o[f];x&&x.erasable&&(this._addPathToObjectEraser(x,i),u[f]=x)},this),u},_finalizeAndAddPath:function(){var i=this.canvas.contextTop,o=this.canvas;i.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate)),o.clearContext(o.contextTop),this._isErasing=!1;var u=this._points&&this._points.length>1?this.convertPointsToSVGPath(this._points):null;if(!u||this._isEmptySVGPath(u)){o.fire("erasing:end"),o.requestRenderAll();return}var f=this.createPath(u);f.setCoords(),o.fire("before:path:created",{path:f});var x=this.applyEraserToCanvas(f),h=this;this.__subTargets=[];var C=[];o.forEachObject(function(y){y.erasable&&y.intersectsWithObject(f,!0,!0)&&(h._addPathToObjectEraser(y,f),C.push(y))}),o.fire("erasing:end",{path:f,targets:C,subTargets:this.__subTargets,drawables:x}),delete this.__subTargets,o.requestRenderAll(),this._resetShadow(),o.fire("path:created",{path:f})}})})();const Vr=e=>e?.type==="path",$r=e=>e?.type==="image",Ae=jt.debug("pixai:NotAnEditor"),Oe="draw";class Wr extends Rr(Er){constructor(t,r){super(),this.canvasEl=t,this.containerEl=r}inpaintColor="#f008";_brushSize=10;_drawingType="pencil";_drawingBrush;_pencilColor="#000";_eraserBrush;_shape="rect";_shapeColor="#000";_editMode="draw";_disposeEditMode=void 0;_baseImage;_baseFile;_unFileUrls=new Map;_drawGroupOptions={};_shiftHeld=!1;_disposeContainerListeners=[];_disposeDocumentListeners=[];async init(t){const r=new _.fabric.Canvas(this.canvasEl,t);r.preserveObjectStacking=!0,this._canvas=r,t.width&&t.height&&this.setSize(t.width,t.height),this._drawingType=t.drawingType??="pencil",t.drawingType==="inpaint"?(this._drawingBrush=new _.fabric.PatternBrush(r),this._drawingBrush.source=this._getInpaintPatternSrc()):this._drawingBrush=new _.fabric.PencilBrush(r),this._eraserBrush=new _.fabric.EraserBrush(r),this.setMode("draw"),t.baseImage&&await this._loadImage(t.baseImage),this.resetHistory(),r.on("object:modified",n=>{Ae("object:modified %o",n),this.recordHistory()}),r.on("path:created",n=>{if(Ae("path:created %o",n),!n.path)return;const l=n.path;this._editMode==="draw"&&this.setDrawGroup(l),this.recordHistory()}),this._addContainerListener("keydown",n=>{(n.key==="Backspace"||n.key==="Delete")&&this.deleteSelection()},{passive:!0});const s=n=>{this._shiftHeld!==n.shiftKey&&(this._shiftHeld=n.shiftKey,this.emit("shiftHeldChange",this._shiftHeld))};this._addDocumentListener("keydown",s,{passive:!0}),this._addDocumentListener("keyup",s,{passive:!0})}dispose(){this.removeAllListeners(),this._disposeContainerListeners.forEach(t=>t()),this._disposeDocumentListeners.forEach(t=>t()),this._canvas&&(this._unFileUrls.forEach((t,r)=>r.revokeUrl()),this._unFileUrls.clear(),this._canvas.dispose())}_addContainerListener(t,r,s){this.containerEl.addEventListener(t,r,s),this._disposeContainerListeners.push(()=>this.containerEl.removeEventListener(t,r))}_addDocumentListener(t,r,s){document.addEventListener(t,r,s),this._disposeDocumentListeners.push(()=>document.removeEventListener(t,r))}get drawingType(){return this._drawingType}get baseFile(){return this._baseFile}_setFreeDrawingCursor(){const t=this.canvas.freeDrawingCursor,r=this.canvas.getZoom(),s=this._brushSize*r,n=s/2+1;return this.canvas.freeDrawingCursor=["url('data:image/svg+xml;utf8,",`<svg xmlns="http://www.w3.org/2000/svg" width="${s+2}" height="${s+2}">`,`<circle cx="${n}" cy="${n}" r="${s/2}" stroke="white" fill="none" stroke-width="2"/>`,`<circle cx="${n}" cy="${n}" r="${s/2-1}" stroke="black" fill="none" stroke-width="2"/>`,`</svg>') ${n} ${n}, crosshair`].join(""),()=>{this.canvas.freeDrawingCursor=t}}_setDrawMode(){this.canvas.isDrawingMode=!0;const t=this._drawingBrush;this.canvas.freeDrawingBrush=t,t.width=this._brushSize,t.color=this._drawingType==="inpaint"?this.inpaintColor:this._pencilColor;const r=this._setFreeDrawingCursor();return()=>r()}_setEraseMode(){this.canvas.isDrawingMode=!0;const t=this._eraserBrush;this.canvas.freeDrawingBrush=t,t.width=this._brushSize;const r=this._setFreeDrawingCursor();return()=>r()}_setShapeMode(){this.canvas.isDrawingMode=!1;const t=this.canvas.defaultCursor;this.canvas.defaultCursor="crosshair",this.canvas.selection=!1,this.canvas.skipTargetFind=!0,this.canvas.discardActiveObject(),this.canvas.requestRenderAll();const r=c=>{if(!c.absolutePointer)return;const{x:d,y:i}=c.absolutePointer,o={left:d,top:i,width:0,height:0,naShapeSX:d,naShapeSY:i,fill:this._shapeColor};let u;const f=this._shape;switch(f){case"rect":u=new _.fabric.Rect(o);break;case"ellipse":u=new _.fabric.Ellipse({...o,originX:"left",originY:"top"});break;case"triangle":u=new _.fabric.Triangle(o);break;default:throw new Error(`Unknown shape ${f}`)}this.canvas.add(u),this.setDrawGroup(u),this.canvas.setActiveObject(u),this.canvas.requestRenderAll()},s=()=>{const c=this.canvas.getActiveObject();if(!c)return;const{naShapeSX:d,naShapeSY:i}=c;let{naShapeCX:o,naShapeCY:u}=c;if(d==null||i==null||o==null||u==null)return;if(!this._shiftHeld){const y=Math.abs(o-d),v=Math.abs(u-i);y>v?o=d+Math.sign(o-d)*v:u=i+Math.sign(u-i)*y}const f=Math.min(d,o),x=Math.min(i,u),h=Math.abs(o-d),C=Math.abs(u-i);c instanceof _.fabric.Ellipse?c.set({left:f,top:x,rx:h/2,ry:C/2}):c.set({left:f,top:x,width:h,height:C}),c.setCoords(),this.canvas.requestRenderAll()},n=c=>{if(!c.absolutePointer)return;const{x:d,y:i}=c.absolutePointer,o=this.canvas.getActiveObject();if(!o)return;const{naShapeSX:u,naShapeSY:f}=o;u==null||f==null||(o.set({naShapeCX:d,naShapeCY:i}),s())},l=c=>{const d=this.canvas.getActiveObject();if(d){if(d.naShapeCX==null||d.naShapeCY==null){this.canvas.discardActiveObject(),this.canvas.remove(d),this.canvas.skipTargetFind=!1;const i=this.canvas.findTarget(c.e,!0);this.canvas.skipTargetFind=!0,i&&(this.setMode("select"),this.canvas.setActiveObject(i)),this.canvas.requestRenderAll();return}d.set({naShapeSX:void 0,naShapeSY:void 0,naShapeCX:void 0,naShapeCY:void 0}),d.setCoords(),this.canvas.discardActiveObject(),this.canvas.requestRenderAll(),this.recordHistory()}};return this.canvas.on("mouse:down",r),this.canvas.on("mouse:move",n),this.canvas.on("mouse:up",l),this.on("shiftHeldChange",s),()=>{this.canvas.defaultCursor=t,this.canvas.selection=!0,this.canvas.skipTargetFind=!1,this.canvas.off("mouse:down",r),this.canvas.off("mouse:move",n),this.canvas.off("mouse:up",l),this.off("shiftHeldChange",s)}}_setSelectMode(){this.canvas.isDrawingMode=!1}_getInpaintPatternSrc(){const r=window.document.createElement("canvas"),s=new _.fabric.Group([new _.fabric.Rect({width:5,height:5,fill:"#888",left:0,top:0}),new _.fabric.Rect({width:5,height:5,fill:"#888",left:5,top:5}),new _.fabric.Rect({width:5,height:5,fill:"#fff",left:0,top:5}),new _.fabric.Rect({width:5,height:5,fill:"#fff",left:5,top:0})]);r.width=5*2,r.height=5*2;const n=r.getContext("2d");if(!n)throw new Error('"CanvasRenderingContext2D" is expected to be available');return s.render(n),r}setMode(t){switch(this._disposeEditMode&&this._disposeEditMode(),this._editMode=t,t){case"draw":this._disposeEditMode=this._setDrawMode();break;case"erase":this._disposeEditMode=this._setEraseMode();break;case"shape":this._disposeEditMode=this._setShapeMode();break;case"select":this._disposeEditMode=this._setSelectMode();break}this.emit("editModeChange",t)}setSize(t,r){const s=this.containerEl.getBoundingClientRect(),n=s.width/t,l=s.height/r,c=Math.min(n,l),d=c;this.canvas.setDimensions({width:t*c,height:r*c}),this.canvas.setViewportTransform([d,0,0,d,0,0])}setBrushSize(t){this._brushSize=t,this._drawingBrush.width=t,this._eraserBrush.width=t,this.canvas.isDrawingMode&&this._setFreeDrawingCursor()}setPencilColor(t){this._drawingBrush.color=t,this._pencilColor=t}setShapeColor(t){this._shapeColor=t}setBackgroundColor(t){this.canvas.setBackgroundColor(t,()=>{this.canvas.requestRenderAll()})}setShape(t){this._shape=t}_loadFile(t,r){this._unFileUrls.has(t)||this._unFileUrls.set(t,t.createUrl());const s=this._unFileUrls.get(t);return new Promise(n=>{_.fabric.Image.fromURL(s,n,{...r,naUnFile:t})})}async _loadImage(t){this._baseFile=t;const r=await this._loadFile(t,{name:"image",crossOrigin:"anonymous",erasable:!1});this._baseImage=r,r.width&&r.height&&this.setSize(r.width,r.height),this.canvas.insertAt(r,0,!1),this.canvas.requestRenderAll()}resizeImageToFitCanvas(t=this._baseImage){if(console.info("resizeImageToFitCanvas",{image:t}),!t)return;const{width:r=0,height:s=0}=t,{width:n=0,height:l=0}=this.canvas,c=n/r,d=l/s,i=Math.min(c,d),o=(n-r*i)/2,u=(l-s*i)/2;t.scale(i),t.set({left:o,top:u}),t.setCoords(),this.canvas.requestRenderAll()}async addDrawImage(t){const r=await this._loadFile(t,{crossOrigin:"anonymous",erasable:!1});return this.canvas.add(r),this.setDrawGroup(r),this.resizeImageToFitCanvas(r),this.recordHistory(),r}selectObject(t){this.setMode("select"),this.canvas.discardActiveObject(),this.canvas.setActiveObject(t),this.canvas.requestRenderAll()}async cloneSelection(){const t=this.canvas.getActiveObjects();if(t.length===0)return;this.canvas.discardActiveObject();const r=await Promise.all(t.map(n=>new Promise(l=>n.clone(l))));for(const n of r)n.set({left:n.left+10,top:n.top+10}),n.setCoords();this.canvas.add(...r);const s=new _.fabric.ActiveSelection(r,{canvas:this.canvas});this.canvas.setActiveObject(s),this.canvas.requestRenderAll(),this.recordHistory()}deleteSelection(){const t=this.canvas.getActiveObjects();t.length!==0&&(this.canvas.discardActiveObject(),this.canvas.remove(...t),this.canvas.requestRenderAll(),this.recordHistory())}_getDrawGroupObjects(){return this.canvas.getObjects().filter(t=>t.naGroup===Oe)}setDrawGroup(t){t.set(this._drawGroupOptions),t.set({naGroup:Oe})}clearDrawings(){this.canvas.remove(...this._getDrawGroupObjects()),this.canvas.requestRenderAll()}on(t,r){return super.on(t,r)}afterRestoreState(){this.canvas.getObjects().map(t=>{$r(t)&&t.name==="image"&&(this._baseImage=t)})}afterResetHistory(){const t=new Set;this.canvas.getObjects().forEach(r=>{r.naUnFile&&t.add(r.naUnFile)});for(const[r]of this._unFileUrls)t.has(r)||(r.revokeUrl(),this._unFileUrls.delete(r))}toCanvas(){return this.canvas.renderAll(),this.canvas.toCanvasElement(1/this.canvas.getZoom())}async getImage(){if(this._getDrawGroupObjects().length===0)return this._baseFile;const t=await St(this.toCanvas(),"canvas.png");if(!t)throw new Error("Failed to convert canvas to file");return ie.fromFile(t)}async getInpaintMaskImage(){if(this._drawingType!=="inpaint")throw new Error('"getInpaintMaskImage" can only be called in a canvas with drawingType set to "inpaint"');const t=this._getDrawGroupObjects();if(t.length===0)return;const r=await Promise.all(t.map(l=>new Promise(c=>l.clone(c)))),s=await new Promise(l=>this.canvas.cloneWithoutData(l));await new Promise(l=>s.setBackgroundColor("#000",l)),s.setZoom(this.canvas.getZoom()),s.add(...r),r.forEach(l=>{Vr(l)&&(l.stroke="#fff")}),s.renderAll();const n=s.toCanvasElement(1/this.canvas.getZoom(),{width:this.canvas.width,height:this.canvas.height});return n.style.border="1px solid black",n}}const Zr=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M3 17h18v-2H3v2zm0 3h18v-1H3v1zm0-7h18v-3H3v3zm0-9v4h18V4H3z"})}),ge=({value:e,onChange:t})=>{const{t:r}=q(["generation","action"]);return a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-sm text-primary-light",children:r("generation:image-edit.brush-size")}),a.jsxs("div",{className:"flex gap-8",children:[a.jsx(Ye,{size:"small",className:"max-w-[200px]",value:e,onChange:(s,n)=>{t(+n)},min:5,max:100,step:1,valueLabelDisplay:"auto"}),a.jsx(nr,{size:"small",type:"number",className:"w-[60px]",value:e,onChange:s=>{const n=+s.target.value;t(n)},inputProps:{min:5,max:100}})]})]})},ra=({value:e,onChange:t,className:r})=>{const[s,n]=m.useState();return a.jsxs(a.Fragment,{children:[a.jsx(A,{className:O("px-0",r),onClick:l=>{n(l.currentTarget)},children:a.jsx(Zr,{className:"size-6"})}),a.jsx(be,{open:!!s,anchorEl:s,onClose:()=>{n(void 0)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:a.jsx("div",{className:"w-[300px] px-8 py-4",children:a.jsx(ge,{value:e,onChange:t})})})]})};var Xr=["prefixCls","className","color","colors","style","rectProps","onChange","addonAfter","addonBefore","rectRender"],ye=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-swatch",className:s,color:n,colors:l=[],style:c,rectProps:d={},onChange:i,addonAfter:o,addonBefore:u,rectRender:f}=e,x=I(e,Xr),h=w({"--swatch-background-color":"rgb(144, 19, 254)",background:"var(--swatch-background-color)",height:15,width:15,marginRight:5,marginBottom:5,cursor:"pointer",position:"relative",outline:"none",borderRadius:2},d.style),C=(y,v)=>{i&&i(V(y),z(V(y)),v)};return a.jsxs("div",w({ref:t},x,{className:[r,s||""].filter(Boolean).join(" "),style:w({display:"flex",flexWrap:"wrap",position:"relative"},c),children:[u&&L.isValidElement(u)&&u,l&&Array.isArray(l)&&l.map((y,v)=>{var g="",p="";typeof y=="string"&&(g=y,p=y),typeof y=="object"&&y.color&&(g=y.title||y.color,p=y.color);var b=n&&n.toLocaleLowerCase()===p.toLocaleLowerCase(),S=f&&f({title:g,color:p,checked:!!b,style:w({},h,{background:p}),onClick:j=>C(p,j)});if(S)return a.jsx(m.Fragment,{children:S},v);var P=d.children&&L.isValidElement(d.children)?L.cloneElement(d.children,{color:p,checked:b}):null;return a.jsx("div",w({tabIndex:0,title:g,onClick:j=>C(p,j)},d,{children:P,style:w({},h,{background:p})}),v)}),o&&L.isValidElement(o)&&o]}))});ye.displayName="Swatch";var Yr={marginRight:0,marginBottom:0,borderRadius:0,boxSizing:"border-box",height:25,width:25};function Kr(e){var{style:t,title:r,checked:s,color:n,onClick:l,rectProps:c}=e,d=m.useRef(null),i=m.useCallback(()=>{d.current.style.zIndex="2",d.current.style.outline="#fff solid 2px",d.current.style.boxShadow="rgb(0 0 0 / 25%) 0 0 5px 2px"},[]),o=m.useCallback(()=>{s||(d.current.style.zIndex="0",d.current.style.outline="initial",d.current.style.boxShadow="initial")},[s]),u=s?{zIndex:1,outline:"#fff solid 2px",boxShadow:"rgb(0 0 0 / 25%) 0 0 5px 2px"}:{zIndex:0};return a.jsx("div",w({ref:d,title:r},c,{onClick:l,onMouseEnter:i,onMouseLeave:o,style:w({},t,{marginRight:0,marginBottom:0,borderRadius:0,boxSizing:"border-box",height:25,width:25},Yr,u,c?.style)}))}var Qr=["prefixCls","placement","className","style","color","colors","rectProps","onChange","rectRender"],Jr=["#B80000","#DB3E00","#FCCB00","#008B02","#006B76","#1273DE","#004DCF","#5300EB","#EB9694","#FAD0C3","#FEF3BD","#C1E1C5","#BEDADC","#C4DEF6","#BED3F3","#D4C4FB"],M=function(e){return e.Left="L",e.LeftTop="LT",e.LeftBottom="LB",e.Right="R",e.RightTop="RT",e.RightBottom="RB",e.Top="T",e.TopRight="TR",e.TopLeft="TL",e.Bottom="B",e.BottomLeft="BL",e.BottomRight="BR",e}({}),ft=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-github",placement:s=M.TopRight,className:n,style:l,color:c,colors:d=Jr,rectProps:i={},onChange:o,rectRender:u}=e,f=I(e,Qr),x=typeof c=="string"&&ce(c)?V(c):c,h=c?le(x):"",C=S=>o&&o(z(S)),y=w({"--github-border":"1px solid rgba(0, 0, 0, 0.2)","--github-background-color":"#fff","--github-box-shadow":"rgb(0 0 0 / 15%) 0px 3px 12px","--github-arrow-border-color":"rgba(0, 0, 0, 0.15)",width:200,borderRadius:4,background:"var(--github-background-color)",boxShadow:"var(--github-box-shadow)",border:"var(--github-border)",position:"relative",padding:5},l),v={borderStyle:"solid",position:"absolute"},g=w({},v),p=w({},v);/^T/.test(s)&&(g.borderWidth="0 8px 8px",g.borderColor="transparent transparent var(--github-arrow-border-color)",p.borderWidth="0 7px 7px",p.borderColor="transparent transparent var(--github-background-color)"),s===M.TopRight&&(g.top=-8,p.top=-7),s===M.Top&&(g.top=-8,p.top=-7),s===M.TopLeft&&(g.top=-8,p.top=-7),/^B/.test(s)&&(g.borderWidth="8px 8px 0",g.borderColor="var(--github-arrow-border-color) transparent transparent",p.borderWidth="7px 7px 0",p.borderColor="var(--github-background-color) transparent transparent",s===M.BottomRight&&(g.top="100%",p.top="100%"),s===M.Bottom&&(g.top="100%",p.top="100%"),s===M.BottomLeft&&(g.top="100%",p.top="100%")),/^(B|T)/.test(s)&&((s===M.Top||s===M.Bottom)&&(g.left="50%",g.marginLeft=-8,p.left="50%",p.marginLeft=-7),(s===M.TopRight||s===M.BottomRight)&&(g.right=10,p.right=11),(s===M.TopLeft||s===M.BottomLeft)&&(g.left=7,p.left=8)),/^L/.test(s)&&(g.borderWidth="8px 8px 8px 0",g.borderColor="transparent var(--github-arrow-border-color) transparent transparent",p.borderWidth="7px 7px 7px 0",p.borderColor="transparent var(--github-background-color) transparent transparent",g.left=-8,p.left=-7),/^R/.test(s)&&(g.borderWidth="8px 0 8px 8px",g.borderColor="transparent transparent transparent var(--github-arrow-border-color)",p.borderWidth="7px 0 7px 7px",p.borderColor="transparent transparent transparent var(--github-background-color)",g.right=-8,p.right=-7),/^(L|R)/.test(s)&&((s===M.RightTop||s===M.LeftTop)&&(g.top=5,p.top=6),(s===M.Left||s===M.Right)&&(g.top="50%",p.top="50%",g.marginTop=-8,p.marginTop=-7),(s===M.LeftBottom||s===M.RightBottom)&&(g.top="100%",p.top="100%",g.marginTop=-21,p.marginTop=-20));var b=S=>{var P=w({},(Je(S),S)),j=u&&u(w({},P));return j||a.jsx(Kr,w({},P,{rectProps:i}))};return a.jsx(ye,w({ref:t,className:[r,n].filter(Boolean).join(" "),colors:d,color:h,rectRender:b},f,{onChange:C,style:y,rectProps:{style:{marginRight:0,marginBottom:0,borderRadius:0,height:25,width:25}},addonBefore:a.jsxs(m.Fragment,{children:[a.jsx("div",{style:g}),a.jsx("div",{style:p})]})}))});ft.displayName="Github";function Ie(e){var t=m.useRef(e);return m.useEffect(()=>{t.current=e}),m.useCallback((r,s)=>t.current&&t.current(r,s),[])}var K=e=>"touches"in e,De=e=>{!K(e)&&e.preventDefault&&e.preventDefault()},ze=function(t,r,s){return r===void 0&&(r=0),s===void 0&&(s=1),t>s?s:t<r?r:t},Fe=(e,t)=>{var r=e.getBoundingClientRect(),s=K(t)?t.touches[0]:t;return{left:ze((s.pageX-(r.left+window.pageXOffset))/r.width),top:ze((s.pageY-(r.top+window.pageYOffset))/r.height),width:r.width,height:r.height,x:s.pageX-(r.left+window.pageXOffset),y:s.pageY-(r.top+window.pageYOffset)}},es=["prefixCls","className","onMove","onDown"],Ce=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-interactive",className:s,onMove:n,onDown:l}=e,c=I(e,es),d=m.useRef(null),i=m.useRef(!1),[o,u]=m.useState(!1),f=Ie(n),x=Ie(l),h=p=>i.current&&!K(p)?!1:(i.current=K(p),!0),C=m.useCallback(p=>{De(p);var b=K(p)?p.touches.length>0:p.buttons>0;b&&d.current?f&&f(Fe(d.current,p),p):u(!1)},[f]),y=m.useCallback(()=>u(!1),[]),v=m.useCallback(p=>{var b=p?window.addEventListener:window.removeEventListener;b(i.current?"touchmove":"mousemove",C),b(i.current?"touchend":"mouseup",y)},[]);m.useEffect(()=>(v(o),()=>{o&&v(!1)}),[o,v]);var g=m.useCallback(p=>{De(p.nativeEvent),h(p.nativeEvent)&&(x&&x(Fe(d.current,p.nativeEvent),p.nativeEvent),u(!0))},[x]);return a.jsx("div",w({},c,{className:[r,s||""].filter(Boolean).join(" "),style:w({},c.style,{touchAction:"none"}),ref:d,tabIndex:0,onMouseDown:g,onTouchStart:g}))});Ce.displayName="Interactive";var ts=e=>{var{className:t,color:r,left:s,top:n,prefixCls:l}=e,c={position:"absolute",top:n,left:s},d={"--saturation-pointer-box-shadow":"rgb(255 255 255) 0px 0px 0px 1.5px, rgb(0 0 0 / 30%) 0px 0px 1px 1px inset, rgb(0 0 0 / 40%) 0px 0px 1px 2px",width:6,height:6,transform:"translate(-3px, -3px)",boxShadow:"var(--saturation-pointer-box-shadow)",borderRadius:"50%",backgroundColor:r};return m.useMemo(()=>a.jsx("div",{className:l+"-pointer "+(t||""),style:c,children:a.jsx("div",{className:l+"-fill",style:d})}),[n,s,r,t,l])},rs=["prefixCls","radius","pointer","className","hue","style","hsva","onChange"],pt=L.forwardRef((e,t)=>{var r,{prefixCls:s="w-color-saturation",radius:n=0,pointer:l,className:c,hue:d=0,style:i,hsva:o,onChange:u}=e,f=I(e,rs),x=w({width:200,height:200,borderRadius:n},i,{position:"relative"}),h=(y,v)=>{u&&o&&u({h:o.h,s:y.left*100,v:(1-y.top)*100,a:o.a})},C=m.useMemo(()=>{if(!o)return null;var y={top:100-o.v+"%",left:o.s+"%",color:lt(o)};return l&&typeof l=="function"?l(w({prefixCls:s},y)):a.jsx(ts,w({prefixCls:s},y))},[o,l,s]);return a.jsx(Ce,w({className:[s,c||""].filter(Boolean).join(" ")},f,{style:w({position:"absolute",inset:0,cursor:"crosshair",backgroundImage:"linear-gradient(0deg, #000, transparent), linear-gradient(90deg, #fff, hsl("+((r=o?.h)!=null?r:d)+", 100%, 50%))"},x),ref:t,onMove:h,onDown:h,children:C}))});pt.displayName="Saturation";var ss=["className","prefixCls","left","top","style","fillProps"],as=e=>{var{className:t,prefixCls:r,left:s,top:n,style:l,fillProps:c}=e,d=I(e,ss),i=w({},l,{position:"absolute",left:s,top:n}),o=w({width:18,height:18,boxShadow:"var(--alpha-pointer-box-shadow)",borderRadius:"50%",backgroundColor:"var(--alpha-pointer-background-color)"},c?.style,{transform:s?"translate(-9px, -1px)":"translate(-1px, -9px)"});return a.jsx("div",w({className:r+"-pointer "+(t||""),style:i},d,{children:a.jsx("div",w({className:r+"-fill"},c,{style:o}))}))},ns=["prefixCls","className","hsva","background","bgProps","innerProps","pointerProps","radius","width","height","direction","style","onChange","pointer"],is="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==",ne=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-alpha",className:s,hsva:n,background:l,bgProps:c={},innerProps:d={},pointerProps:i={},radius:o=0,width:u,height:f=16,direction:x="horizontal",style:h,onChange:C,pointer:y}=e,v=I(e,ns),g=k=>{C&&C(w({},n,{a:x==="horizontal"?k.left:k.top}),k)},p=lt(Object.assign({},n,{a:1})),b="linear-gradient(to "+(x==="horizontal"?"right":"bottom")+", rgba(244, 67, 54, 0) 0%, "+p+" 100%)",S={};x==="horizontal"?S.left=n.a*100+"%":S.top=n.a*100+"%";var P=w({"--alpha-background-color":"#fff","--alpha-pointer-background-color":"rgb(248, 248, 248)","--alpha-pointer-box-shadow":"rgb(0 0 0 / 37%) 0px 1px 4px 0px",borderRadius:o,background:"url("+is+") left center",backgroundColor:"var(--alpha-background-color)"},{width:u,height:f},h,{position:"relative"}),j=y&&typeof y=="function"?y(w({prefixCls:r},i,S)):a.jsx(as,w({},i,{prefixCls:r},S));return a.jsxs("div",w({},v,{className:[r,r+"-"+x,s||""].filter(Boolean).join(" "),style:P,ref:t,children:[a.jsx("div",w({},c,{style:w({inset:0,position:"absolute",background:l||b,borderRadius:o},c.style)})),a.jsx(Ce,w({},d,{style:w({},d.style,{inset:0,zIndex:1,position:"absolute"}),onMove:g,onDown:g,children:j}))]}))});ne.displayName="Alpha";var os=["prefixCls","className","hue","onChange","direction"],gt=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-hue",className:s,hue:n=0,onChange:l,direction:c="horizontal"}=e,d=I(e,os);return a.jsx(ne,w({ref:t,className:r+" "+(s||"")},d,{direction:c,background:"linear-gradient(to "+(c==="horizontal"?"right":"bottom")+", rgb(255, 0, 0) 0%, rgb(255, 255, 0) 17%, rgb(0, 255, 0) 33%, rgb(0, 255, 255) 50%, rgb(0, 0, 255) 67%, rgb(255, 0, 255) 83%, rgb(255, 0, 0) 100%)",hsva:{h:n,s:100,v:100,a:n/360},onChange:(i,o)=>{l&&l({h:c==="horizontal"?360*o.left:360*o.top})}}))});gt.displayName="Hue";var ls=["prefixCls","placement","label","value","className","style","labelStyle","inputStyle","onChange","onBlur"],cs=e=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(e),ds=e=>Number(String(e).replace(/%/g,"")),W=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-editable-input",placement:s="bottom",label:n,value:l,className:c,style:d,labelStyle:i,inputStyle:o,onChange:u,onBlur:f}=e,x=I(e,ls),[h,C]=m.useState(l),y=m.useRef(!1);m.useEffect(()=>{e.value!==h&&(y.current||C(e.value))},[e.value]);function v(P,j){var k=(j||P.target.value).trim().replace(/^#/,"");cs(k)&&u&&u(P,k);var R=ds(k);isNaN(R)||u&&u(P,R),C(k)}function g(P){y.current=!1,C(e.value),f&&f(P)}var p={};s==="bottom"&&(p.flexDirection="column"),s==="top"&&(p.flexDirection="column-reverse"),s==="left"&&(p.flexDirection="row-reverse");var b=w({"--editable-input-label-color":"rgb(153, 153, 153)","--editable-input-box-shadow":"rgb(204 204 204) 0px 0px 0px 1px inset","--editable-input-color":"#666",position:"relative",alignItems:"center",display:"flex",fontSize:11},p,d),S=w({width:"100%",paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,fontSize:11,background:"transparent",boxSizing:"border-box",border:"none",color:"var(--editable-input-color)",boxShadow:"var(--editable-input-box-shadow)"},o);return a.jsxs("div",{className:[r,c||""].filter(Boolean).join(" "),style:b,children:[a.jsx("input",w({ref:t,value:h,onChange:v,onBlur:g,autoComplete:"off",onFocus:()=>y.current=!0},x,{style:S})),n&&a.jsx("span",{style:w({color:"var(--editable-input-label-color)",textTransform:"capitalize"},i),children:n})]})});W.displayName="EditableInput";var us=["prefixCls","hsva","placement","rProps","gProps","bProps","aProps","className","style","onChange"],_e=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-editable-input-rgba",hsva:s,placement:n="bottom",rProps:l={},gProps:c={},bProps:d={},aProps:i={},className:o,style:u,onChange:f}=e,x=I(e,us),h=s?Q(s):{};function C(v){var g=Number(v.target.value);g&&g>255&&(v.target.value="255"),g&&g<0&&(v.target.value="0")}var y=(v,g,p)=>{typeof v=="number"&&(g==="a"&&(v<0&&(v=0),v>100&&(v=100),f&&f(z(Y(w({},h,{a:v/100}))))),v>255&&(v=255,p.target.value="255"),v<0&&(v=0,p.target.value="0"),g==="r"&&f&&f(z(Y(w({},h,{r:v})))),g==="g"&&f&&f(z(Y(w({},h,{g:v})))),g==="b"&&f&&f(z(Y(w({},h,{b:v})))))};return a.jsxs("div",w({ref:t,className:[r,o||""].filter(Boolean).join(" ")},x,{style:w({fontSize:11,display:"flex"},u),children:[a.jsx(W,w({label:"R",value:h.r||0,onBlur:C,placement:n,onChange:(v,g)=>y(g,"r",v)},l,{style:w({},l.style)})),a.jsx(W,w({label:"G",value:h.g||0,onBlur:C,placement:n,onChange:(v,g)=>y(g,"g",v)},c,{style:w({marginLeft:5},l.style)})),a.jsx(W,w({label:"B",value:h.b||0,onBlur:C,placement:n,onChange:(v,g)=>y(g,"b",v)},d,{style:w({marginLeft:5},d.style)})),i&&a.jsx(W,w({label:"A",value:h.a?parseInt(String(h.a*100),10):0,onBlur:C,placement:n,onChange:(v,g)=>y(g,"a",v)},i,{style:w({marginLeft:5},i.style)}))]}))});_e.displayName="EditableInputRGBA";var hs=["prefixCls","hsva","hProps","sProps","lProps","aProps","className","onChange"],vt=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-editable-input-hsla",hsva:s,hProps:n={},sProps:l={},lProps:c={},aProps:d={},className:i,onChange:o}=e,u=I(e,hs),f=s?we(s):{h:0,s:0,l:0,a:0},x=(h,C,y)=>{typeof h=="number"&&(C==="h"&&(h<0&&(h=0),h>360&&(h=360),o&&o(z(ee(w({},f,{h}))))),C==="s"&&(h<0&&(h=0),h>100&&(h=100),o&&o(z(ee(w({},f,{s:h}))))),C==="l"&&(h<0&&(h=0),h>100&&(h=100),o&&o(z(ee(w({},f,{l:h}))))),C==="a"&&(h<0&&(h=0),h>1&&(h=1),o&&o(z(ee(w({},f,{a:h}))))))};return a.jsx(_e,w({ref:t,hsva:s,rProps:w({label:"H",value:Math.round(f.h)},n,{onChange:(h,C)=>x(C,"h")}),gProps:w({label:"S",value:Math.round(f.s)+"%"},l,{onChange:(h,C)=>x(C,"s")}),bProps:w({label:"L",value:Math.round(f.l)+"%"},c,{onChange:(h,C)=>x(C,"l")}),aProps:w({label:"A",value:Math.round(f.a*100)/100},d,{onChange:(h,C)=>x(C,"a")}),className:[r,i||""].filter(Boolean).join(" ")},u))});vt.displayName="EditableInputHSLA";var fs=["style"];function ps(e){var{style:t}=e,r=I(e,fs),s=m.useRef(null),n=m.useCallback(()=>{s.current.style.backgroundColor="var(--chrome-arrow-background-color)"},[]),l=m.useCallback(()=>{s.current.style.backgroundColor="transparent"},[]);return a.jsx("div",w({ref:s,style:w({marginLeft:5,cursor:"pointer",transition:"background-color .3s",borderRadius:2},t)},r,{onMouseEnter:n,onMouseLeave:l,children:a.jsx("svg",{viewBox:"0 0 1024 1024",width:"24",height:"24",style:{display:"block"},children:a.jsx("path",{d:"M373.888 576h276.224c9.322667 0 14.293333 11.178667 9.173333 18.773333l-1.258666 1.557334-138.112 146.858666a10.709333 10.709333 0 0 1-14.293334 1.365334l-1.536-1.365334-138.112-146.858666c-6.592-6.997333-2.666667-18.645333 5.973334-20.16l1.941333-0.170667h276.224-276.224z m146.026667-295.189333l138.112 146.858666c7.04 7.509333 2.069333 20.330667-7.914667 20.330667H373.888c-9.984 0-14.976-12.821333-7.914667-20.330667l138.112-146.858666a10.730667 10.730667 0 0 1 15.829334 0z",fill:"var(--chrome-arrow-fill)"})})}))}var gs=["prefixCls","className","style","color","inputType","rectProps","onChange"],F=function(e){return e.HEXA="hexa",e.RGBA="rgba",e.HSLA="hsla",e}({}),mt=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-chrome",className:s,style:n,color:l,inputType:c=F.RGBA,rectProps:d={},onChange:i}=e,o=I(e,gs),u=typeof l=="string"&&ce(l)?V(l):l||{h:0,s:0,l:0,a:0},f=b=>i&&i(z(b)),[x,h]=m.useState(c),C=()=>{x===F.RGBA&&h(F.HSLA),x===F.HSLA&&h(F.HEXA),x===F.HEXA&&h(F.RGBA)},y={paddingTop:6},v={textAlign:"center",paddingTop:4,paddingBottom:4},g=w({"--chrome-arrow-fill":"#333","--chrome-arrow-background-color":"#e8e8e8",borderRadius:0,flexDirection:"column",width:230,padding:0},n),p={"--chrome-alpha-box-shadow":"rgb(0 0 0 / 25%) 0px 0px 1px inset",borderRadius:"50%",background:Cr(u),boxShadow:"var(--chrome-alpha-box-shadow)"};return a.jsx(ft,w({ref:t,color:u,style:g,colors:void 0,className:[r,s].filter(Boolean).join(" "),placement:M.TopLeft},o,{addonAfter:a.jsxs(m.Fragment,{children:[a.jsx(pt,{hsva:u,style:{width:"100%",height:130},onChange:b=>{f(w({},u,b,{a:u.a}))}}),a.jsxs("div",{style:{padding:15,display:"flex",alignItems:"center"},children:[a.jsx(ne,{width:24,height:24,hsva:u,radius:2,style:{marginRight:15,borderRadius:"50%"},bgProps:{style:{background:"transparent"}},innerProps:{style:p},pointer:()=>a.jsx(m.Fragment,{})}),a.jsxs("div",{style:{flex:1},children:[a.jsx(gt,{hue:u.h,style:{width:"100%"},bgProps:{style:{borderRadius:2}},onChange:b=>{f(w({},u,b))}}),a.jsx(ne,{hsva:u,style:{marginTop:10},bgProps:{style:{borderRadius:2}},onChange:b=>{f(w({},u,b))}})]})]}),a.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:"0 15px 15px 15px",userSelect:"none"},children:[a.jsxs("div",{style:{flex:1},children:[x==F.RGBA&&a.jsx(_e,{hsva:u,rProps:{labelStyle:y,inputStyle:v},gProps:{labelStyle:y,inputStyle:v},bProps:{labelStyle:y,inputStyle:v},aProps:{labelStyle:y,inputStyle:v},onChange:b=>f(b.hsva)}),x===F.HEXA&&a.jsx(W,{label:"HEX",labelStyle:y,inputStyle:v,value:u.a>0&&u.a<1?Sr(u).toLocaleUpperCase():le(u).toLocaleUpperCase(),onChange:(b,S)=>{typeof S=="string"&&f(V(/^#/.test(S)?S:"#"+S))}}),x===F.HSLA&&a.jsx(vt,{hsva:u,hProps:{labelStyle:y,inputStyle:v},sProps:{labelStyle:y,inputStyle:v},lProps:{labelStyle:y,inputStyle:v},aProps:{labelStyle:y,inputStyle:v},onChange:b=>f(b.hsva)})]}),a.jsx(ps,{onClick:C})]})]}),rectRender:()=>a.jsx(m.Fragment,{})}))});mt.displayName="Chrome";function vs(e){var{style:t,title:r,checked:s,color:n,onClick:l,rectProps:c}=e,d=m.useRef(null),i=m.useCallback(()=>{d.current.style.transform="scale(1.2)"},[]),o=m.useCallback(()=>{d.current.style.transform="scale(1)"},[]),u=w({"--circle-point-background-color":"#fff",height:s?"100%":0,width:s?"100%":0,borderRadius:"50%",backgroundColor:"var(--circle-point-background-color)",boxSizing:"border-box",transition:"height 100ms ease 0s, width 100ms ease 0s"},c.style);return a.jsx("div",{ref:d,onClick:l,onMouseEnter:i,onMouseLeave:o,title:r,style:w({},t,{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,padding:3,borderRadius:"50%",marginRight:12,marginBottom:12,boxSizing:"border-box",transform:"scale(1)",boxShadow:n+" 0px 0px "+(s?5:0)+"px",transition:"transform 100ms ease 0s, box-shadow 100ms ease 0s"}),children:a.jsx("div",w({},c,{style:u}))})}var ms=["prefixCls","className","color","colors","rectProps","onChange"],bt=L.forwardRef((e,t)=>{var{prefixCls:r="w-color-circle",className:s,color:n,colors:l=[],rectProps:c={},onChange:d}=e,i=I(e,ms),o=typeof n=="string"&&ce(n)?V(n):n||{},u=n?le(o):"";return a.jsx(ye,w({ref:t,colors:l,color:u},i,{className:[r,s].filter(Boolean).join(" "),rectRender:f=>{var x=w({},(Je(f),f));return a.jsx(vs,w({},x,{rectProps:c}))},onChange:f=>{d&&d(z(f))}}))});bt.displayName="Circle";const bs=["#28282880","#58585880","#D8D8D880","#F8F8F880","#AB464280","#DC965680","#F7CA8880","#A1B56C80","#86C1B980","#7CAFC280","#BA8BAF80","#A1694680"],se=m.forwardRef(function({hex:t,swatches:r=bs,alpha:s=!0,onChange:n,popoverProps:l,parentPopupState:c,...d},i){const o=re({parentPopupState:c,variant:"popover",popupId:"color-picker"});return a.jsxs(a.Fragment,{children:[a.jsx(A,{...d,...qr(o),ref:i,variant:"outlined",size:"small",style:{backgroundColor:t,...d.style}}),a.jsxs(be,{anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},...l,slotProps:{paper:{...l?.slotProps?.paper,className:"border border-gray-300 rounded-none bg-transparent overflow-visible"}},...ht(o),children:[a.jsx(mt,{className:"[&>:first-child]:!hidden [&>:nth-child(2)]:!hidden [&>:last-child_span]:!hidden",style:{border:"none",boxShadow:"none"},color:t,inputType:F.HEXA,onChange:u=>{n(s?u.hexa:u.hex,u)}}),a.jsx(bt,{className:"pl-[12px] justify-between bg-white [&>*]:!w-[24px] [&>*]:!h-[24px]",style:{width:230},colors:r,color:t,onChange:u=>{n(s?u.hexa:u.hex,u)}})]})]})}),xs=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"m4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8l-8 8z"})}),He=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M2 4h20v16H2z"})}),ws=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16a8.002 8.002 0 0 1 7.6-5.5c1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"})}),ys=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88c3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"})}),Cs=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M16 13h-3V3h-2v10H8l4 4l4-4zM4 19v2h16v-2H4z"})}),_s=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M8 11h3v10h2V11h3l-4-4l-4 4zM4 3v2h16V3H4z"})}),js=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M21.02 5H19V2.98c0-.54-.44-.98-.98-.98h-.03c-.55 0-.99.44-.99.98V5h-2.01c-.54 0-.98.44-.99.98v.03c0 .55.44.99.99.99H17v2.01c0 .54.44.99.99.98h.03c.54 0 .98-.44.98-.98V7h2.02c.54 0 .98-.44.98-.98v-.04c0-.54-.44-.98-.98-.98zM16 9.01V8h-1.01c-.53 0-1.03-.21-1.41-.58c-.37-.38-.58-.88-.58-1.44c0-.36.1-.69.27-.98H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2v-8.28c-.3.17-.64.28-1.02.28A2 2 0 0 1 16 9.01zM15.96 19H6a.5.5 0 0 1-.4-.8l1.98-2.63c.21-.28.62-.26.82.02L10 18l2.61-3.48c.2-.26.59-.27.79-.01l2.95 3.68c.26.33.03.81-.39.81z"})}),Ss=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"m13.775 22l-3.625-7.8L6 20V2l14 11h-7.1l3.6 7.725L13.775 22Z"})}),ks=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M7 21q-.825 0-1.413-.588T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.588 1.413T17 21H7Zm2-4h2V8H9v9Zm4 0h2V8h-2v9Z"})}),Es=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M9 16q-2.925 0-4.963-2.038T2 9q0-2.925 2.038-4.963T9 2q2.925 0 4.963 2.038T16 9q0 2.925-2.038 4.963T9 16Zm-1 4v-2.05q.25.025.5.038T9 18q3.75 0 6.375-2.625T18 9q0-.25-.013-.5T17.95 8H20q.825 0 1.413.588T22 10v10q0 .825-.588 1.413T20 22H10q-.825 0-1.413-.588T8 20Z"})}),qe=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"M1 21h22L12 2"})}),Rs=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsxs("g",{fill:"none",children:[a.jsx("path",{fill:"currentColor",d:"m5.505 11.41l.53.53l-.53-.53ZM3 14.952h-.75H3ZM9.048 21v.75V21ZM11.41 5.505l-.53-.53l.53.53Zm1.831 12.34a.75.75 0 0 0 1.06-1.061l-1.06 1.06ZM7.216 9.697a.75.75 0 1 0-1.06 1.061l1.06-1.06Zm10.749 2.362l-5.905 5.905l1.06 1.06l5.905-5.904l-1.06-1.06Zm-11.93-.12l5.905-5.905l-1.06-1.06l-5.905 5.904l1.06 1.06Zm0 6.025c-.85-.85-1.433-1.436-1.812-1.933c-.367-.481-.473-.79-.473-1.08h-1.5c0 .749.312 1.375.78 1.99c.455.596 1.125 1.263 1.945 2.083l1.06-1.06Zm-1.06-7.086c-.82.82-1.49 1.488-1.945 2.084c-.468.614-.78 1.24-.78 1.99h1.5c0-.29.106-.6.473-1.08c.38-.498.962-1.083 1.812-1.933l-1.06-1.06Zm7.085 7.086c-.85.85-1.435 1.433-1.933 1.813c-.48.366-.79.472-1.08.472v1.5c.75 0 1.376-.312 1.99-.78c.596-.455 1.264-1.125 2.084-1.945l-1.06-1.06Zm-7.085 1.06c.82.82 1.487 1.49 2.084 1.945c.614.468 1.24.78 1.989.78v-1.5c-.29 0-.599-.106-1.08-.473c-.497-.38-1.083-.962-1.933-1.812l-1.06 1.06Zm12.99-12.99c.85.85 1.433 1.436 1.813 1.933c.366.481.472.79.472 1.08h1.5c0-.749-.312-1.375-.78-1.99c-.455-.596-1.125-1.263-1.945-2.083l-1.06 1.06Zm1.06 7.086c.82-.82 1.49-1.488 1.945-2.084c.468-.614.78-1.24.78-1.99h-1.5c0 .29-.106.6-.473 1.08c-.38.498-.962 1.083-1.812 1.933l1.06 1.06Zm0-8.146c-.82-.82-1.487-1.49-2.084-1.945c-.614-.468-1.24-.78-1.989-.78v1.5c.29 0 .599.106 1.08.473c.497.38 1.083.962 1.933 1.812l1.06-1.06Zm-7.085 1.06c.85-.85 1.435-1.433 1.933-1.812c.48-.367.79-.473 1.08-.473v-1.5c-.75 0-1.376.312-1.99.78c-.596.455-1.264 1.125-2.084 1.945l1.06 1.06Zm2.362 10.749L7.216 9.698l-1.06 1.061l7.085 7.085l1.06-1.06Z"}),a.jsx("path",{stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.5,d:"M9 21h12"})]})}),Ts={tool:"draw",pencilColor:"#356be1ff",brushSize:20,shape:"ellipse",shapeColor:"#356be1ff",backgroundColor:"#ffffffff",canUndo:!1,canRedo:!1},[de,Ps]=We(Ts);de.displayName="LCMRealtimeCanvasContext";const[je,Bs]=We({editorRef:{current:void 0}}),ae=["#282828","#585858","#D8D8D8","#F8F8F8","#AB4642","#DC9656","#F7CA88","#A1B56C","#86C1B9","#7CAFC2","#BA8BAF","#A16946"],Ue={circle:{radius:65,fill:"#F7CA88",left:50,top:50},triangle:{width:200,height:215,fill:"#282828",left:250,top:200}},Ms=({editorRef:e,onImageChange:t,loading:r})=>{const[s,n]=m.useContext(de),[,l]=m.useContext(je),{t:c}=q(["generation","action","common"]),d=m.useRef(null),i=m.useRef(null),o=m.useRef(),[u,f]=m.useState(null),{pencilColor:x,brushSize:h,shape:C,shapeColor:y,backgroundColor:v,tool:g}=s,p=m.useRef(v),b=async(R=!1)=>{if(!t)return;if(R){if(p.current===v)return;p.current=v}const E=o.current?.toCanvas();if(!E)return;const T=document.createElement("canvas");T.width=E.width,T.height=E.height;const D=T.getContext("2d");D.fillStyle=v,D.fillRect(0,0,E.width,E.height),D.drawImage(E,0,0),T.toBlob(U=>{t?.(U)})},[,S]=kt(async()=>{o.current&&(o.current.dispose(),o.current=void 0,l({editorRef:{current:void 0}}));const R=d.current;if(!R)return;const E=i.current;if(!E)return;const T=new Wr(R,E);if(o.current=T,await T.init({width:512,height:512,baseImage:s.baseImage}),T.setMode(g),T.setPencilColor(x),T.setBrushSize(h),T.setShape(C),T.setShapeColor(y),T.setBackgroundColor(v),T.on("editModeChange",D=>n(U=>({...U,mode:D}))),T.on("stateChange",()=>{n(D=>({...D,canRedo:T.canRedo(),canUndo:T.canUndo()})),b()}),T.canvas.on("selection:created",()=>f(T?.canvas.getActiveObject())),T.canvas.on("selection:updated",()=>f(T?.canvas.getActiveObject())),T.canvas.on("selection:cleared",()=>f(null)),f(T?.canvas.getActiveObject()),!s.baseImage){const D=new _.fabric.Triangle(Ue.triangle),U=new _.fabric.Circle(Ue.circle);T.canvas.add(D,U),T.setDrawGroup(D),T.setDrawGroup(U)}b()},[s.baseImage,g,x,h,C,y,v]);m.useEffect(()=>(S(),l({editorRef:o}),()=>{o.current&&(o.current.dispose(),o.current=void 0,l({editorRef:{current:void 0}}))}),[s.baseImage]),m.useEffect(()=>{if(!i.current)return;const R=new ResizeObserver(()=>{o.current?.setSize(512,512)});return R.observe(i.current),()=>R.disconnect()},[]);const P=o.current,j=u?(u instanceof _.fabric.ActiveSelection?u.getObjects():[u]).reduce((R,E)=>{if("_element"in E)return R;const T=E.get("fill")||E.get("stroke");return typeof T!="string"?R:R?T===R?T:"#000":T},null):null,k=R=>{if(u){for(const E of u instanceof _.fabric.ActiveSelection?u.getObjects():[u])"_element"in E||(E.get("fill")?E.set("fill",R):E.get("stroke")&&E.set("stroke",R));P?.canvas.requestRenderAll(),P?.recordHistory()}};return me(()=>b(!0),100,[v]),m.useImperativeHandle(e,()=>P,[P]),a.jsxs("div",{className:O("flex focus:outline-none relative w-full max-h-full sm:[&>.canvas-container]:ml-auto bg-neutral-100 dark:bg-neutral-700"),ref:i,tabIndex:1e3,children:[a.jsx("canvas",{ref:d,className:"h-full w-full"}),u&&a.jsx("div",{className:"absolute bottom-2 left-0 right-0 grid place-items-center pointer-events-none",children:a.jsxs(Qe,{variant:"outlined",className:"bg-background pointer-events-auto",children:[a.jsx(N,{title:c("generation:image-edit.bring-forward"),children:a.jsx(A,{className:"px-0",onClick:()=>{u.bringForward(),P?.recordHistory()},children:a.jsx(xs,{className:"size-6"})})}),a.jsx(N,{title:c("generation:image-edit.send-backward"),children:a.jsx(A,{className:"px-0",onClick:()=>{u.sendBackwards(),P?.recordHistory()},children:a.jsx(lr,{className:"size-6"})})}),a.jsx(N,{title:c("generation:image-edit.bring-to-front"),children:a.jsx(A,{className:"px-0",onClick:()=>{u.bringToFront(),P?.recordHistory()},children:a.jsx(_s,{className:"size-6"})})}),a.jsx(N,{title:c("generation:image-edit.send-to-back"),children:a.jsx(A,{className:"px-0",onClick:()=>{u.sendToBack(),P?.recordHistory()},children:a.jsx(Cs,{className:"size-6"})})}),j&&a.jsx(N,{title:c("generation:image-edit.selection-color"),children:a.jsx(se,{className:"min-w-0 w-10",swatches:ae,hex:j,onChange:R=>k(R),popoverProps:{anchorOrigin:{vertical:"top",horizontal:"center"},transformOrigin:{vertical:"bottom",horizontal:"center"}}})}),a.jsx(N,{title:c("generation:image-edit.clone"),children:a.jsx(A,{className:"px-0",onClick:()=>P?.cloneSelection(),children:a.jsx(Et,{className:"size-6"})})}),a.jsx(N,{title:c("generation:image-edit.delete"),children:a.jsx(A,{className:"px-0",onClick:()=>P?.deleteSelection(),children:a.jsx(Rt,{className:"size-6"})})})]})}),r&&a.jsx("div",{className:"bg-background absolute inset-0 flex justify-center items-center",children:a.jsx(Tt,{})})]})};function Ns(e){const t=m.useRef(null),[r,s]=m.useContext(de),[n,l]=m.useContext(je),{editorRef:c}=n,d=c.current,{pencilColor:i,brushSize:o,shape:u,shapeColor:f,backgroundColor:x,tool:h,canRedo:C,canUndo:y}=r,{t:v}=q(["generation","action","common"]),g=re({variant:"popover",popupId:"lcm-popover-draw"}),p=re({variant:"popover",popupId:"lcm-popover-erase"}),b=re({variant:"popover",popupId:"lcm-popover-shape"}),S={draw:{icon:a.jsx(Pt,{className:O("size-6","stroke-background-secondary")}),color:i,popupState:g,popover:a.jsxs("div",{className:"flex flex-col gap-4 w-[240px] px-6 py-4",children:[a.jsx("div",{children:a.jsx(ge,{value:o,onChange:j=>{s(k=>({...k,brushSize:j})),d?.setBrushSize(j)}})}),a.jsxs("div",{className:"flex justify-between items-center w-full",children:[a.jsx("div",{className:"text-sm text-primary-light",children:v("generation:image-edit.brush-color")}),a.jsx(se,{className:"w-20 h-8",parentPopupState:g,swatches:ae,hex:i,onChange:j=>{s(k=>({...k,pencilColor:j})),d?.setPencilColor(j)}})]})]})},erase:{icon:a.jsx(Rs,{className:"size-6"}),popupState:p,popover:a.jsx("div",{className:"w-[240px] px-6 py-4",children:a.jsx(ge,{value:o,onChange:j=>{s(k=>({...k,brushSize:j})),d?.setBrushSize(j)}})})},select:{icon:a.jsx(Ss,{className:"w-6 h-6"})},shape:{icon:u==="ellipse"?a.jsx(ke,{className:"stroke-background-secondary size-6"}):u==="rect"?a.jsx(He,{className:"stroke-background-secondary size-6"}):u==="triangle"?a.jsx(qe,{className:"stroke-background-secondary size-6"}):a.jsx(Es,{className:"stroke-background-secondary size-6"}),color:f,popupState:b,popover:a.jsxs("div",{className:"flex flex-col gap-4 w-[240px] px-6 py-4",children:[a.jsxs("div",{className:"flex justify-between items-center w-full",children:[a.jsx("div",{className:"text-sm text-primary-light",children:v("generation:image-edit.shape-color")}),a.jsx(se,{className:"w-20 h-8",parentPopupState:b,swatches:ae,hex:f,onChange:j=>{s(k=>({...k,shapeColor:j})),d?.setShapeColor(j)}})]}),a.jsxs("div",{className:"flex justify-between items-center w-full",children:[a.jsx("div",{className:"text-sm text-primary-light",children:v("generation:image-edit.shapes.label")}),a.jsxs(Te,{size:"small",exclusive:!0,value:u,onChange:(j,k)=>{k&&(s(R=>({...R,shape:k})),d?.setShape(k))},children:[a.jsx(J,{value:"ellipse",children:a.jsx(N,{title:v("generation:image-edit.shapes.ellipse"),children:a.jsx(ke,{className:"size-6"})})}),a.jsx(J,{value:"rect",children:a.jsx(N,{title:v("generation:image-edit.shapes.rectangle"),children:a.jsx(He,{className:"size-6"})})}),a.jsx(J,{value:"triangle",children:a.jsx(N,{title:v("generation:image-edit.shapes.triangle"),children:a.jsx("div",{children:a.jsx(qe,{className:"size-6"})})})})]})]})]})}},P=()=>{const j=t.current;j&&j.click()};return a.jsxs(a.Fragment,{children:[a.jsx(Te,{size:"small",exclusive:!0,orientation:e.orientation,value:h,onChange:(j,k)=>{k&&(s(R=>({...R,tool:k})),d?.setMode(k))},children:Object.entries(S).flatMap(([j,k],R)=>{if(!k)return null;const E=a.jsx(J,{...k.popupState?Ur(k.popupState):{},value:j,style:{backgroundColor:h===j?k.color:void 0},className:"dark:bg-neutral-600 dark:hover:bg-neutral-500",children:a.jsx(N,{title:v(`generation:image-edit.${j}`),arrow:!0,placement:"right",children:a.jsx("div",{children:k.icon})})},j);if(k.popover){const T=a.jsx(Dr,{...k.popupState&&h===j?ht(k.popupState):{open:!1},keepMounted:!0,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"},children:k.popover},`${j}-popover`);return R===0?[E,T]:[T,E]}return[E]})}),a.jsx(A,{variant:"outlined",onClick:P,className:"px-0 min-w-10 dark:bg-neutral-600 dark:hover:bg-neutral-500",children:a.jsx(N,{title:v("generation:image-edit.upload-image"),arrow:!0,placement:"right",children:a.jsx(js,{className:"size-[28px]"})})}),a.jsxs(Qe,{orientation:e.orientation,variant:"outlined",children:[a.jsx(A,{className:"px-0 dark:bg-neutral-600 dark:hover:bg-neutral-500",disabled:!y,onClick:()=>d?.undo(),children:a.jsx(N,{title:v("generation:image-edit.undo"),arrow:!0,placement:"right",children:a.jsx(ys,{className:"size-[28px]"})})}),a.jsx(A,{className:"px-0 dark:bg-neutral-600 dark:hover:bg-neutral-500",disabled:!C,onClick:()=>d?.redo(),children:a.jsx(N,{title:v("generation:image-edit.redo"),arrow:!0,placement:"right",children:a.jsx(ws,{className:"size-[28px]"})})}),a.jsx(A,{className:"px-0 dark:bg-neutral-600 dark:hover:bg-neutral-500",onClick:async()=>{try{await Ze({title:v("generation:image-edit.clear-confirm.title"),description:v("generation:image-edit.clear-confirm.content")})}catch{return}d?.clearDrawings(),d?.resetHistory(),d?.canvas.discardActiveObject(),s(j=>({...j,baseImage:void 0}))},children:a.jsx(N,{title:v("generation:image-edit.clear"),arrow:!0,placement:"right",children:a.jsx(ks,{className:"size-[28px]"})})})]}),a.jsx(N,{title:v("generation:image-edit.background-color"),arrow:!0,placement:"right",children:a.jsx(se,{className:"flex-shrink-0 min-w-0 w-10 h-10",swatches:ae,hex:x,alpha:!1,onChange:j=>{s(k=>({...k,backgroundColor:j})),d?.setBackgroundColor(j)}})}),a.jsx("input",{ref:t,type:"file",accept:"image/*",hidden:!0,onChange:async j=>{const[k]=j.target.files||[];if(!k||!d)return;const R=await d.addDrawImage(ie.fromFile(k));d.selectObject(R),j.target.value=""}})]})}const Ge=e=>e.status==="completed"||e.status==="failed",ve=async(e,t)=>{if(t){const s=(await Lt({id:e})).data.task;return s&&Ge(s)?s:(await Re(3e3),ve(e,t))}if(Mt()){const r=Nt.pipe(Ee(s=>s.id===e),Ee(s=>Ge(s)));return hr(r)}return await Re(3e3),ve(e,!0)},Ls=async e=>{const r=(await Bt({parameters:e})).data?.createGenerationTask;if(r?.id)return ve(r.id)},Se=cr.create({baseURL:"https://inference.pixai.art/lcm/v1"});Se.interceptors.request.use(e=>{const t=At();return t&&e.headers.set("Authorization",`Bearer ${t}`),e});function As(e,t){const r={prompt:e.prompts,negative_prompt:e.negativePrompts,seed:e.seed,strength:e.strength,image:e.image,user_id:e.userId};return Se.postForm("/img2img",r,{...t})}function sa(e,t){const r={prompt:e.prompts,image:e.image,negative_prompt:e.negativePrompts,seed:e.seed,num_outputs:e.numOutputs,height:e.height,width:e.width,user_id:e.userId};return Se.postForm("/pose2image",r,{...t})}const Os=e=>a.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:a.jsx("path",{fill:"currentColor",d:"m10 19l-2.5-5.5L2 11l5.5-2.5L10 3l2.5 5.5L18 11l-5.5 2.5L10 19Zm8 2l-1.25-2.75L14 17l2.75-1.25L18 13l1.25 2.75L22 17l-2.75 1.25L18 21Z"})}),Is=3;function Ve(){return Math.floor(Math.random()*1e10)}const Ds=()=>{const[e,t]=m.useState(()=>Ve()),r=m.useCallback(()=>{t(Ve())},[]);return[e,r]},zs="worst quality, low quality, jpeg artifacts, blurry, monochrome, extra digits, bad anatomy",Fs="masterpiece, best quality, 1girl, moon in the sky, dark skirt, umbrella",Hs=.65,aa=()=>{const e=m.useMemo(()=>a.jsx(a.Fragment,{children:a.jsx(Bs,{children:a.jsx(Ps,{children:a.jsx(qs,{})})})}),[]);return a.jsx(Ot,{scene:"realtime",headerSlot:a.jsx(dr,{value:It.Realtime}),main:a.jsx("div",{className:"px-3 msm:pl-[72px] lg:pr-[72px] mlg:overflow-y-auto",children:e})})};function qs(){const{data:e,loading:t}=Xe(),[r,s]=m.useState(Hs),[n,l]=m.useState(Fs),[c,d]=m.useState(zs),[i,o]=Ds(),u=m.useRef(null),[f,x]=m.useState(null),[h,C]=m.useState(),y=Dt(h),v=m.useRef(null),[g,p]=m.useState("idle"),[b,S]=zt({key:"generator::lcm-anonymous-generated-times",defaultValue:0}),P=m.useRef({open:()=>{},close:()=>{}}),j=Ft("msm"),k=m.useCallback(async()=>{if(!f||!n){p("idle");return}try{v.current&&v.current.abort();const R=new AbortController;v.current=R,p("rendering"),G("lcm_inference_start",{prompts:n,negativePrompts:c,strength:r,seed:i},{destinations:["getway"]});const D=`data:image/webp;base64,${(await As({prompts:n,negativePrompts:c,seed:i,strength:r.toString(),image:f,userId:e?.id},{signal:R.signal})).data.data[0].b64_image}`,U=await Ht(D),xt=new File([U],`pixai-realtime_${Date.now()}.webp`,{type:"image/webp"});C(ie.fromFile(xt)),e?.id||S(wt=>wt+1)}catch(R){if(R.name==="CanceledError")return;he.error("Something went wrong: "+R);return}finally{p("idle"),v.current=null}},[f,n,c,r,i,e?.id]);return me(k,500,[f,n,c,r,i,e?.id]),m.useEffect(()=>{n&&p("debouncing")},[f,n,c,r,i]),m.useEffect(()=>{!e?.id&&b>Is&&P.current.open(),e?.id&&P.current.close()},[b,e?.id,t]),a.jsxs(a.Fragment,{children:[a.jsxs("section",{className:"w-full flex flex-wrap gap-2 msm:pb-3 pt-4",children:[a.jsx("div",{className:"rounded-t-xl grow",children:a.jsx(Mr,{value:n,onChange:R=>l(R.target.value)})}),a.jsxs("div",{className:"px-2 flex gap-4 basis-[480px] grow md:grow-0 self-start md:pt-2",children:[a.jsx(Lr,{value:r,onChange:(R,E)=>{typeof E=="number"&&E>=.25&&s(E)}}),a.jsx("div",{className:"ml-auto shrink-0",children:a.jsx(Nr,{value:i,onClick:()=>{o(),G("lcm_regenerate_seed",void 0,{destinations:["getway"]})}})})]}),a.jsx("div",{className:"msm:fixed w-full msm:w-auto left-1 top-[132px] p-2 rounded-t-md msm:rounded-b-md",children:a.jsx("div",{className:"flex msm:flex-col gap-2 overflow-x-auto max-w-[calc(100vw-40px)]",children:a.jsx(Ns,{orientation:j?"horizontal":"vertical"})})})]}),a.jsxs("div",{className:"flex flex-col msm:flex-row w-[calc(100vw-24px)] sm:w-full sm:h-[calc(100vh-48px-84px-114px)] items-start",children:[a.jsx("div",{className:O("min-w-0 w-full max-h-full","border border-gray-300 dark:border-gray-500 aspect-square grow-1 basis-1/2 flex"),children:a.jsx(Ms,{editorRef:u,onImageChange:x})}),a.jsxs("div",{className:"w-full max-h-full aspect-square grow-1 basis-1/2 relative flex",children:[a.jsxs("div",{className:"border bg-neutral-100 dark:bg-neutral-700 border-gray-300 dark:border-gray-500 w-full flex",children:[y?a.jsx(qt,{scene:"realtime",imgClassName:O("w-auto h-full object-contain sm:object-[0%_center]"),fileName:h.name,originalUrl:y,thumbnailUrl:y,width:512,height:512,pswpOptions:{initialZoomLevel:1.5,showHideAnimationType:"fade"}}):g==="idle"?a.jsx("div",{className:"w-full h-full bg-neutral-100 dark:bg-neutral-700"}):a.jsx("div",{className:O("bg-contain bg-no-repeat bg-center sm:bg-[0%_center] bg-neutral-100 h-full w-full",g==="rendering"&&"animate-pulse")}),y&&a.jsx(Us,{className:"absolute bottom-0 right-0 justify-end",output:h,setOutput:C,parameters:{prompts:n,strength:r,seed:i}})]}),a.jsx(Ar,{status:g})]})]}),a.jsx(Ut,{ref:P,disableClose:!0})]})}const $e={negativePrompts:"worst quality, large head, low quality, extra digits, bad eye,  EasyNegativeV2,  ng_deepnegative_v1_75t",samplingSteps:20,samplingMethod:"DPM++ 2M Karras",cfgScale:6,width:512,height:512,clipSkip:2,modelId:"1648918127446573124",mediaId:"STUB",strength:.55,upscale:1.5,enableTile:!1,controlNets:[]};function Us(e){const{data:t}=Xe(),{t:r}=q(["generation"]),{output:s,setOutput:n,parameters:l}=e,[,c]=m.useContext(de),[d]=m.useContext(je),i=m.useCallback(async()=>{G("lcm_use_base_click");try{if(await Ze({title:r("generation:image-edit.clear-confirm.title"),description:r("generation:image-edit.clear-confirm.content")}),G("lcm_use_base_confirm_click"),d.editorRef.current&&s)c(p=>({...p,baseImage:s}));else throw new Error("Editor not found")}catch(g){if(g===Gt)return;he.error(g.message);return}},[s]),o=m.useCallback(()=>{s&&(G("lcm_download",{...l},{destinations:["getway"]}),Vt(s,g=>$t(g,s.name)))},[s,l]),{value:u}=Wt(async()=>{if(!s)return;const g=await s.getDimensions();return Zt({...g,maxEdge:768})},[s]),{data:f,isValidating:x}=Xt({...$e,...u}),h=async()=>{if(!s)return"no output image";if(!u)return"failed to get dimensions";const g=await s.toMedia({onCompressed(S){n(S)}});if(!g)return"failed to upload media";const p=await Ls({...$e,...u,prompts:l?.prompts,mediaId:g.id});if(!p?.id)return"failed to create task";if(!p.outputs.mediaId)return"no output media id";const b=(await tr({id:p.outputs.mediaId})).data.media;if(!b)return"failed to get output media";n(ie.fromMedia(b))},[C,y]=m.useState(!1),v=async()=>{if(!C){if(!t)return er(null,{fromPath:"lcm_enhance"});G("lcm_enhance_click");try{y(!0);const g=await h();if(g)throw new Error(g)}catch(g){g instanceof Error&&he.error(g.message)}finally{y(!1)}G("lcm_enhance_success")}};return a.jsxs("section",{className:O("flex flex-wrap items-center gap-4 p-2",e.className),children:[a.jsxs(ue,{className:O("p-2 text-black rounded-lg bg-gray-100 rounded-tl-lg hover:bg-gray-200 font-semibold text-xs","transition-colors duration-200 ease-in-out shadow"),onClick:i,children:[a.jsx(Yt,{className:"mr-2"}),r("generation:image-operation.use-base-image")]}),a.jsxs(ue,{className:O("p-2 text-black bg-gray-100  rounded-lg bg-gray-10 hover:bg-gray-200 font-semibold text-xs","transition-colors duration-200 ease-in-out shadow"),onClick:o,children:[a.jsx(Kt,{className:"mr-2"}),r("generation:image-operation.download-image")]}),a.jsxs(ue,{className:O("flex",C?"text-black/60 cursor-default":"text-black","p-2 bg-gray-100  rounded-lg bg-gray-10 hover:bg-gray-200 font-semibold text-xs","transition-colors duration-200 ease-in-out shadow"),onClick:v,children:[C?a.jsx("span",{className:"pr-2 flex items-center",children:a.jsx(ir,{size:"12px"})}):a.jsx(Os,{className:"mr-2"}),r("generation:image-operation.enhance.label"),t&&a.jsx(Qt,{className:"pl-2",children:a.jsx(Jt,{value:f?.actualPrice??0,loading:x,className:"!text-inherit font-normal text-xs",iconClassName:"hidden"})})]})]})}export{Er as B,se as C,wr as E,Ar as L,Wr as N,ws as a,ra as b,aa as c,Ve as g,le as h,ys as i,Rr as m,sa as p};
