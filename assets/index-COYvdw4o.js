var R_=Object.defineProperty;var j_=(e,t,n)=>t in e?R_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>j_(e,typeof t!="symbol"?t+"":t,n);import{Z as D_,f as Eh,hP as N_,gg as L_,e as g,R as Z,c as Ue,g as As,j as h,cP as F_,hQ as B_,hR as z_,cR as Eo,e8 as Qi,hS as _h,hT as Ih,hU as kh,hV as Th,hW as rt,hX as Ms,hY as $h,hZ as Ah,h_ as kl,hp as Os,hv as Mt,h$ as Ri,i0 as U_,hs as Rt,ai as me,ht as Pe,i1 as Nr,i2 as Yb,hw as uf,hq as Mh,hr as ji,hu as Tl,i3 as V_,i4 as K_,i5 as Xb,t as ku,$ as W_,i6 as H_,i as G_,C as Vc,ho as $r,da as Y_,c4 as X_,cz as q_,u as Oh,K as At,i7 as Z_,ad as Q_,d8 as J_,fy as eI,Q as qb,fj as hm}from"./index-BTMYyhc6.js";import{a as tI,c as Yr}from"./contextState-BhHzyxk5.js";import{r as nI}from"./___vite-browser-external_commonjs-proxy-DtbFeITm.js";import{L as rI,N as oI,b as sI}from"./AppLayout-Bx68cLmY.js";import{h as iI}from"./artwork-D9vxumxJ.js";import{L as aI}from"./Logo-BmlVHmIW.js";import{m as pm}from"./QuotaBalance-DP6pnxJ0.js";import{i as cI}from"./baseline-keyboard-arrow-right-BlgxAuax.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="8f647619-9b5f-42c1-9262-8a4d9999a949",e._sentryDebugIdIdentifier="sentry-dbid-8f647619-9b5f-42c1-9262-8a4d9999a949")}catch{}})();{var Ma=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};Ma._sentryModuleMetadata=Ma._sentryModuleMetadata||{},Ma._sentryModuleMetadata[new Error().stack]=Object.assign({},Ma._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}var gm=(e,t)=>(e/t<<0)*t,Zb={prepaid:"prepaid",postpaid:"postpaid"},mm=()=>{const e=[];return{type:Zb.prepaid,items:e,curPrice:0,discount:0,exp:"",addItem(t,{explanation:n,name:r,spec:o,...s}={}){const i=t(this.curPrice)-this.curPrice<<0;r!=null&&o!=null&&e.push({name:r,spec:o,...s,totalPrice:i}),n&&(this.exp=n(this.exp)),this.curPrice+=i,i<0&&(this.discount-=i)},toPriceInfo(){return{type:this.type,items:e,originalPrice:Math.max(0,this.curPrice+this.discount),actualPrice:Math.max(0,this.curPrice)}}}},ym=(e,t)=>{const n={...t};for(const r in e)n[r]==null&&(n[r]=e[r]);return n},vm=e=>JSON.parse(JSON.stringify(e)),Tu={TurboModePriority:500,HighPriority:1e3,XHighPriority:1500},lI=class{constructor(e,t){I(this,"parameters");I(this,"config");this.parameters=ym({width:512,height:512,samplingSteps:28,samplingMethod:"Euler a",priority:Tu.HighPriority,strength:.7,upscale:1,batchSize:1,enableTile:!1,controlNets:[],enlarge:0,mediaId:!1},e),this.config=ym({baseStep:20,baseWidth:512,baseHeight:512,basePrice:400,maxDiscount:800,samplerMultiple:{},sdxlMultiple:1.25,sd3MediumMultiple:1.625,minPrice:0,highPriority:Tu.HighPriority,xHighPriority:Tu.XHighPriority,shouldDiscount:!1,isSDXL:!1,isSD3Medium:!1,modelType:""},t)}_getMeterWithBasePrice(e){const{basePrice:t}={...this.config,...e},n=mm();return n.addItem(()=>t,{key:"generate-image",name:"generate image",spec:"",explanation:()=>`${t}_{\\text{ base price }}`,description:"base price",expression:`+${t}`}),n}_animateDiffPrice(e,t,n){const{width:r,height:o,animateDiff:s}=t,{baseWidth:i,baseHeight:a}={...this.config,...n},c=Math.min(1,768/Math.max(o,r)),l=r*o*c*c/i/a;if(l!==1&&e.addItem(u=>u*l,{key:"size",name:"size",spec:`x${l.toFixed(2)}`,explanation:u=>`${u} \\times {${l}}_{\\text{ size power }}`,expression:`x${l.toFixed(2)}`,description:"size power"}),s.v2)e.addItem(u=>u*16,{key:"animate-v2",name:"animate-v2",spec:"x16",expression:"x16",description:"animate v2 power"});else{const u=s.smooth?25:10;e.addItem(f=>f*u,{key:"animate",name:"animate",spec:"x${animatePower}",expression:`x${u}`,description:"animate power"});const d=s.long?3:1;d!==1&&e.addItem(f=>f*d,{key:"animate-long",name:"long animation",spec:`x${d}`,expression:`x${d}`,description:"animate long"})}return e}_diffusePrice(e,t,n){let{width:r,height:o,samplingSteps:s,upscaleDenoisingSteps:i=s,samplingMethod:a,mediaId:c,strength:l,upscale:u,batchSize:d,enableTile:f,controlNets:p,lightning:v}=t;const{baseStep:m,baseWidth:y,baseHeight:b,samplerMultiple:x,floorBeforeTimesBatchSize:w,sdxlMultiple:S,sd3MediumMultiple:C,isSDXL:P,isSD3Medium:E,modelType:_}={...this.config,...n};v&&(s=14,i=14,a="");const $=f?1:r*o*u*u/y/b,T=(c!=null&&c!==!1?1+l*s:u>1?i:s)/m,M=x[a]??1;return P||_==="SDXL_MODEL"?e.addItem(O=>O*S,{key:"sdxl",name:"sdxl",spec:`x${S}`,explanation:O=>`${O} \\times {${S}}_{\\text{ sdxl }}`,expression:`x${S}`,description:"sdxl multiple"}):(E||_==="SD3_MEDIUM_MODEL")&&e.addItem(O=>O*C,{key:"sd3m",name:"sd3m",spec:`x${C}`,explanation:O=>`${O} \\times {${C}}_{\\text{ sd3m }}`,expression:`x${C}`,description:"sd3 medium multiple"}),$!==1&&e.addItem(O=>O*$,{key:"size",name:"size",spec:`x${$.toFixed(2)}`,explanation:O=>`${O} \\times {${$}}_{\\text{ size power }}`,expression:`x${$.toFixed(2)}`,description:"size power"}),T!==1&&e.addItem(O=>O*T,{key:"sampling-steps",name:"sampling steps",spec:`x${T.toFixed(2)}`,explanation:O=>`${O} \\times {${T}}_{\\text{ step power }}`,expression:`x${T.toFixed(2)}`,description:"step power"}),M!==1&&e.addItem(O=>O*M,{key:"sampling-method",name:"sampling method",spec:`x${M}`,explanation:O=>`${O} \\times {${M}}_{\\text{ sampler power }}`,expression:`x${M.toFixed(2)}`,description:"sampler power"}),Array.isArray(p)&&p.length&&e.addItem(O=>O*Math.pow(1.4,p.length-1),{key:"control-nets",name:"control nets",spec:`x${p.length}`,explanation:O=>`${O} \\times {1.4^{${p.length-1}}} {\\text{ control nets }}`,expression:`x1.4^${p.length-1}`,description:"control nets"}),w&&e.addItem(O=>gm(O,100),{key:"floor",name:"floor",spec:"",explanation:O=>`\\lfloor{${O}}\\rfloor`,description:"round down to 100",hidden:!0}),d!==1&&e.addItem(O=>O*d,{key:"batch-size",name:"batch size",spec:`x${d}`,explanation:O=>`(${O}) \\times {${d}}_{\\text{ batch size }}`,expression:`x${d}`,description:"batch size"}),e}_priorityChannelPrice(e,t){const{priority:n}=this.parameters,{highPriority:r,xHighPriority:o}={...this.config,...t};(n===r||n===o)&&e.addItem(s=>s+n,{key:"task-priority",name:"priority channel",spec:"",explanation:s=>`${s} + ${n}_{\\text{ priority }}`,expression:`+${n}`,description:"priority"})}_pricingBaseParameters(e,t,n){const{height:r,width:o,enlarge:s,upscale:i,enableTile:a,batchSize:c,enableADetailer:l,animateDiff:u,modelId:d,ipAdapter:f}=t,{baseHeight:p,baseWidth:v,basePrice:m,maxDiscount:y,shouldDiscount:b,modelVersionDiscount:x,minPrice:w}={...this.config,...n};if(u&&u.enabled){this._animateDiffPrice(e,t,n);const S=.5;e.addItem(C=>C*S,{key:"animate-discount",name:"animate discount",spec:`x${S*100}%`,explanation:C=>`${C} \\times {${S}}_{\\text{ discount }}`,expression:`x${S.toFixed(2)}`,description:"animate discount"})}else if(!(s>1))if(a&&i>1){const S=this._getMeterWithBasePrice(),C=Math.ceil(r*o*i*i/p/v);this._diffusePrice(S,t,n);const P=S.toPriceInfo();e.addItem(E=>E+P.actualPrice*C,{key:"tile",name:"tile",unitPrice:P.actualPrice,spec:`x${C}`,items:P.items,explanation:E=>`\\def\\tilePrice{${E}} tilePrice \\times ${C}_{\\text{ tile times }}`,expression:`+${P.actualPrice}x${C}`,description:"tile"})}else if(i>1){this._diffusePrice(e,{...t,upscale:1},n);const S=this._getMeterWithBasePrice();this._diffusePrice(S,t,n);const C=S.toPriceInfo(),P=.5;e.addItem(E=>E+C.actualPrice,{key:"upscale",name:"upscale",spec:`x${i}`,items:C.items,explanation:E=>`${E} \\times {${i}}_{\\text{ upscale }}`,expression:`+${C.actualPrice<<0}`,description:"upscale (hires fix)"}),e.addItem(E=>E-C.actualPrice*P,{key:"upscale-discount",name:"upscale discount",spec:`-${P*100}%`,explanation:E=>`${E} - {${i}}_{\\text{ upscale }} \\times {${P}}_{\\text{ discount }}`,expression:`-${(C.actualPrice*P).toFixed(2)}`,description:"upscale (hires fix) discount"})}else this._diffusePrice(e,t,{...n,floorBeforeTimesBatchSize:!0,baseStep:28});if(l){const S=this._getMeterWithBasePrice();this._diffusePrice(S,{...t,height:512,width:512,upscale:1,enlarge:1,strength:.8,mediaId:"1",controlNets:[]},n);const C=S.toPriceInfo();e.addItem(P=>P+C.actualPrice,{key:"adetailer",name:"adetailer",unitPrice:C.actualPrice,spec:"x1",explanation:P=>`${P} + {${C.actualPrice}}_{\\text{ adetailer }}`,expression:`+${C.actualPrice}`,description:"adetailer"})}if(e.addItem(S=>gm(S-m*c,100),{key:"minus-base-price",name:"minus base price",spec:"",explanation:S=>`${S} - ${m}_{\\text{ base price }} \\times ${c}_{\\text{ batch size }}`,expression:`-${m}x${c}`,description:"minus base price",hidden:!0}),c>1&&e.curPrice>0&&b&&e.addItem(S=>S*.5,{key:"email-verification-discount",name:"email verification discount",spec:"-50%",explanation:S=>`${S} \\times {0.5}_{\\text{ discount }}`,expression:"x0.5",description:"email verification discount"}),f&&f.enabled&&e.addItem(S=>S+500,{key:"wdtagger",name:"wdtagger",unitPrice:500,spec:"x1",explanation:S=>`${S} + {500}_{\\text{ wdtagger }}`,expression:"+500",description:"wdtagger"}),d&&x&&x[d]){const S=x[d]/100;e.addItem(C=>C*S,{key:"model-discount",name:"model discount",spec:`-${100-x[d]}%`,explanation:C=>`${C} \\times {${S}}_{\\text{ discount }}`,expression:`x${S}`,description:"model discount: {modelVersionId}"})}return e.curPrice<-y&&e.addItem(()=>-y,{key:"max-discount",name:"max discount",spec:"",explanation:S=>`\\max(-${y}, ${S})`,expression:`=${-y}`,description:"max discount"}),this._priorityChannelPrice(e,n),w>0&&e.curPrice<w&&e.addItem(()=>w,{key:"min-price",name:"min price",spec:"",explanation:S=>`\\max(${w}, ${S})`,expression:`=${w}`,description:"min price"}),e}_pricingPrepaidWorkflow(e,t,n){const{basePrice:r,workflowPrepaidPrice:o}={...this.config,...n},s=o[t];return e.addItem(i=>i-r,{key:"minus-base-price",name:"minus base price",spec:"",explanation:i=>`${i} - ${r}_{\\text{ base price }}`,description:"minus base price",expression:`-${r}`}),e.addItem(i=>i+s,{key:"workflow-prepaid-fixed",name:"workflow prepaid fixed",spec:"",explanation:i=>`${i} + ${s}_{\\text{ workflow_${t} }}`,expression:`+${s}`,description:"workflow prepaid fixed"}),e}_pricingI2vPro(e,t){e.addItem(o=>o-this.config.basePrice,{key:"minus-base-price",name:"minus base price",spec:"",explanation:o=>`${o} - ${this.config.basePrice}_{\\text{ base price }}`,description:"minus base price",expression:`-${this.config.basePrice}`});const n=vm(t.i2vPro);if(n.model){const[o]=(n.model??"").split("-");n.model=o}const r=vm(this.config.i2vProPriceList??[]);r.push({id:"unknown",parameters:{},price:5e4});for(const{id:o,parameters:s,sceneId:i,price:a}of r)if(!(i&&i!==n.sceneId)&&Object.entries(s).every(([c,l])=>n[c]===l))return e.addItem(c=>c+a,{key:`i2v-pro-${o}`,name:`i2v pro ${o}`,spec:"",explanation:c=>`${c} + ${a}_{\\text{ i2v_pro_${o} }}`,expression:`+${a}`,description:`i2v pro ${o}`}),e;return e}_pricing(){const{workflow:e,workflowName:t,inputs:n,i2vPro:r}=this.parameters,{highPriority:o}=this.config,s=this._getMeterWithBasePrice();if(t!=null&&t.startsWith("a/ipa"))return this._pricingBaseParameters(s,n||{});if(t!=null&&t.startsWith("komiyama/inpaint-"))return this._pricingBaseParameters(s,this.parameters,{isSDXL:!0});if(r)return this._pricingI2vPro(s,this.parameters);if(this.config.workflowPrepaidPrice&&t){const[i]=t.split(":");if(t in this.config.workflowPrepaidPrice)return this._pricingPrepaidWorkflow(s,t);if(i in this.config.workflowPrepaidPrice)return this._pricingPrepaidWorkflow(s,i)}if(e){const i=mm();return i.type=Zb.postpaid,this._priorityChannelPrice(i),i.addItem(a=>a-o,{key:"workflow-priority-discount",name:"workflow priority discount",spec:"",explanation:a=>`${a} - ${o}_{\\text{ workflow discount }}`,expression:`-${o}`,description:"workflow discount"}),i}return this._pricingBaseParameters(s,this.parameters)}toPriceInfo(){return this._pricing().toPriceInfo()}};const GG=(e,t=n=>n)=>{const{data:n,isValidating:r}=D_("jslib",{revalidateIfStale:!0,revalidateOnFocus:!1}),{data:o}=Eh(),s=N_(o),i=t(e),a=typeof i.modelId=="string"?i.modelId:void 0,c=L_(a),l=JSON.stringify(i),u=n==null?void 0:n.config;return{data:g.useMemo(()=>new lI(i,{...u,shouldDiscount:s,modelType:c==null?void 0:c.modelType}),[l,u,s,c==null?void 0:c.modelType]).toPriceInfo(),isValidating:r}};function Qb(e){return e&&typeof e=="object"&&"parents"in e}function Jb(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}const Kc=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&Qb(e))for(let n=0,r=e.parents.length;n<r;n++)Kc(e.parents[n],e)},Rh=(e,t)=>{if(e.children.add(t)&&Qb(e))for(let n=0,r=e.parents.length;n<r;n++)Rh(e.parents[n],e)};function eS(e,t){return e===t||Object.is(e,t)||!!(e&&t&&typeof e.equals=="function"&&e.equals(t))}function Xr(e,t){const n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??(r[n]=t()),r[n]}const nr=Xr("empty_array",()=>Object.freeze([])),bm=8;class tS{constructor(){I(this,"arraySize",0);I(this,"array",Array(bm));I(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(t){if(this.array)return this.array.indexOf(t)!==-1?!1:this.arraySize<bm?(this.array[this.arraySize]=t,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(t),!0);if(this.set)return this.set.has(t)?!1:(this.set.add(t),!0);throw new Error("no set or array")}remove(t){if(this.array){const n=this.array.indexOf(t);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(t)?(this.set.delete(t),!0):!1;throw new Error("no set or array")}visit(t){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&t(r)}return}if(this.set){this.set.forEach(t);return}throw new Error("no set or array")}}const Gt=Symbol.for("com.tldraw.state/RESET_VALUE");class nS{constructor(t){I(this,"index",0);I(this,"buffer");this.capacity=t,this.buffer=new Array(t)}pushEntry(t,n,r){if(r!==void 0){if(r===Gt){this.clear();return}this.buffer[this.index]=[t,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(t){const{index:n,capacity:r,buffer:o}=this;for(let s=0;s<r;s++){const i=(n-1+r-s)%r,a=o[i];if(!a)return Gt;const[c,l]=a;if(s===0&&t>=l)return[];if(c<=t&&t<l){const u=s+1,d=new Array(u);for(let f=0;f<u;f++)d[f]=o[(i+f)%r][2];return d}}return Gt}}class uI{constructor(t,n){I(this,"offset",0);I(this,"numNewParents",0);I(this,"maybeRemoved");this.below=t,this.child=n}}const Le=Xr("capture",()=>({stack:null}));function rS(e){Le.stack=new uI(Le.stack,e)}function oS(){var n;const e=Le.stack;if(Le.stack=e.below,e.numNewParents>0||e.offset!==e.child.parents.length){for(let r=e.offset;r<e.child.parents.length;r++){const o=e.child.parents[r];e.child.parents.indexOf(o)>=e.offset&&Kc(o,e.child)}if(e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset,(n=Le.stack)!=null&&n.maybeRemoved)for(let r=0;r<Le.stack.maybeRemoved.length;r++){const o=Le.stack.maybeRemoved[r];e.child.parents.indexOf(o)===-1&&Kc(o,e.child)}}}function df(e){if(Le.stack){const t=Le.stack.child.parents.indexOf(e);if(t<0&&(Le.stack.numNewParents++,Le.stack.child.isActivelyListening&&Rh(e,Le.stack.child)),t<0||t>=Le.stack.offset){if(t!==Le.stack.offset&&t>0){const n=Le.stack.child.parents[Le.stack.offset];Le.stack.maybeRemoved?Le.stack.maybeRemoved.indexOf(n)===-1&&Le.stack.maybeRemoved.push(n):Le.stack.maybeRemoved=[n]}Le.stack.child.parents[Le.stack.offset]=e,Le.stack.child.parentEpochs[Le.stack.offset]=e.lastChangedEpoch,Le.stack.offset++}}}const po=-1;class dI{constructor(t,n,r){I(this,"_isActivelyListening",!1);I(this,"lastTraversedEpoch",po);I(this,"lastReactedEpoch",po);I(this,"_scheduleCount",0);I(this,"parentEpochs",[]);I(this,"parents",[]);I(this,"_scheduleEffect");I(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=t,this.runEffect=n,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==zt()){if(this.parents.length&&!Jb(this)){this.lastReactedEpoch=zt();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let t=0,n=this.parents.length;t<n;t++)Rh(this.parents[t],this)}detach(){this._isActivelyListening=!1;for(let t=0,n=this.parents.length;t<n;t++)Kc(this.parents[t],this)}execute(){try{rS(this);const t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=zt(),t}finally{oS()}}}const Rs=Xr("EffectScheduler",()=>dI);function Ji(e,t,n){const r=new Rs(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function fI(e,t,n){const r=new Rs(e,t,n);return{scheduler:r,start:o=>{const s=(o==null?void 0:o.force)??!1;r.attach(),s?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class hI{constructor(t){I(this,"initialAtomValues",new Map);this.parent=t}get isRoot(){return this.parent===null}commit(){if(this.isRoot){const t=this.initialAtomValues;this.initialAtomValues=new Map,sS(t.keys())}else this.initialAtomValues.forEach((t,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,t)})}abort(){mt.globalEpoch++,this.initialAtomValues.forEach((t,n)=>{var r;n.set(t),(r=n.historyBuffer)==null||r.clear()}),this.commit()}}const mt=Xr("transactions",()=>({globalEpoch:po+1,globalIsReacting:!1,currentTransaction:null}));function zt(){return mt.globalEpoch}function sS(e){if(mt.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{mt.globalIsReacting=!0;const t=new Set,n=r=>{r.lastTraversedEpoch!==mt.globalEpoch&&(r.lastTraversedEpoch=mt.globalEpoch,r instanceof Rs?t.add(r):r.children.visit(n))};for(const r of e)r.children.visit(n);for(const r of t)r.maybeScheduleEffect()}finally{mt.globalIsReacting=!1}}function pI(e,t){mt.currentTransaction?mt.currentTransaction.initialAtomValues.has(e)||mt.currentTransaction.initialAtomValues.set(e,t):sS([e])}function gI(){mt.globalEpoch++}function mI(e){const t=new hI(mt.currentTransaction);mt.currentTransaction=t;try{let n=!1;const r=e(()=>n=!0);return n?t.abort():t.commit(),r}catch(n){throw t.abort(),n}finally{mt.currentTransaction=mt.currentTransaction.parent}}function an(e){return mt.currentTransaction?e():mI(e)}class yI{constructor(t,n,r){I(this,"isEqual");I(this,"computeDiff");I(this,"lastChangedEpoch",zt());I(this,"children",new tS);I(this,"historyBuffer");this.name=t,this.current=n,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new nS(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get(){return df(this),this.current}set(t,n){var o,s;if(((o=this.isEqual)==null?void 0:o.call(this,this.current,t))??eS(this.current,t))return this.current;gI(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,zt(),n??((s=this.computeDiff)==null?void 0:s.call(this,this.current,t,this.lastChangedEpoch,zt()))??Gt),this.lastChangedEpoch=zt();const r=this.current;return this.current=t,pI(this,r),t}update(t){return this.set(t(this.current))}getDiffSince(t){var n;return df(this),t>=this.lastChangedEpoch?nr:((n=this.historyBuffer)==null?void 0:n.getChangesSince(t))??Gt}}const vI=Xr("Atom",()=>yI);function wt(e,t,n){return new vI(e,t,n)}let Sm=!1;function bI(){Sm||(Sm=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const ff=Symbol.for("com.tldraw.state/UNINITIALIZED"),ls=e=>e===ff,hf=Xr("WithDiff",()=>class{constructor(t,n){this.value=t,this.diff=n}});function wi(e,t){return new hf(e,t)}class SI{constructor(t,n,r){I(this,"lastChangedEpoch",po);I(this,"lastTraversedEpoch",po);I(this,"lastCheckedEpoch",po);I(this,"parents",[]);I(this,"parentEpochs",[]);I(this,"children",new tS);I(this,"historyBuffer");I(this,"state",ff);I(this,"computeDiff");I(this,"isEqual");this.name=t,this.derive=n,r!=null&&r.historyLength&&(this.historyBuffer=new nS(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??eS}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){var n;const t=this.lastChangedEpoch===po;if(!t&&(this.lastCheckedEpoch===zt()||!Jb(this)))return this.lastCheckedEpoch=zt(),this.state;try{rS(this);const r=this.derive(this.state,this.lastCheckedEpoch),o=r instanceof hf?r.value:r;if(this.state===ff||!this.isEqual(o,this.state)){if(this.historyBuffer&&!t){const s=r instanceof hf?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,zt(),s??((n=this.computeDiff)==null?void 0:n.call(this,this.state,o,this.lastCheckedEpoch,zt()))??Gt)}this.lastChangedEpoch=zt(),this.state=o}return this.lastCheckedEpoch=zt(),this.state}finally{oS()}}get(){const t=this.__unsafe__getWithoutCapture();return df(this),t}getDiffSince(t){var n;return this.get(),t>=this.lastChangedEpoch?nr:((n=this.historyBuffer)==null?void 0:n.getChangesSince(t))??Gt}}const jh=Xr("Computed",()=>SI);function xI(e={},t,n,r){const o=r.value,s=Symbol.for("__@troph-team/tldraw-state__computed__"+n);return r.value=function(){let i=this[s];return i||(i=new jh(n,o.bind(this),e),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()},r.value[CI]=!0,r}function xm(e={},t,n,r){return r.get?(bI(),wI(e,t,n,r)):xI(e,t,n,r)}function wI(e={},t,n,r){const o=r.get,s=Symbol.for("__@troph-team/tldraw-state__computed__"+n);return r.get=function(){let i=this[s];return i||(i=new jh(n,o.bind(this),e),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()},r}const CI="@@__isComputedMethod__@@";function X(){if(arguments.length===1){const e=arguments[0];return(t,n,r)=>xm(e,t,n,r)}else return typeof arguments[0]=="string"?new jh(arguments[0],arguments[1],arguments[2]):xm(void 0,arguments[0],arguments[1],arguments[2])}const iS=1,PI=Xr("apiVersion",()=>iS);if(PI!==iS)throw new Error("You have multiple incompatible versions of @troph-team/tldraw-state in your app. Please deduplicate the package.");function $l(e,t){const n=Z.useRef(t);n.current=t;const[r,o,s]=Z.useMemo(()=>{let i=null;const a=u=>(i=u,()=>{i=null}),c=new Rs(`useStateTracking(${e})`,()=>{var u;return(u=n.current)==null?void 0:u.call(n)},{scheduleEffect(){i==null||i()}});return[c,a,()=>c.scheduleCount]},[e]);return Z.useSyncExternalStore(o,s,s),Z.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const wm={apply(e,t,n){return $l(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))}},EI=Symbol.for("react.memo"),_I=Symbol.for("react.forward_ref");function Te(e){let t=null;const n=e.$$typeof;return n===EI&&(e=e.type,t=e.compare),n===_I?g.memo(g.forwardRef(new Proxy(e.render,wm))):g.memo(new Proxy(e,wm),t)}function aS(){const e=arguments[0],t=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return g.useMemo(()=>X(`useComputed(${e})`,t,n),r)}function mo(e,t,n=nr){g.useEffect(()=>{const r=new Rs(e,t);return r.attach(),r.execute(),()=>{r.detach()}},n)}function Y(){const e=arguments,t=e.length===3?e[2]:[e[0]],n=e.length===3?e[0]:`useValue(${e[0].name})`,r=g.useRef(!0);r.current=!0;const o=g.useMemo(()=>e.length===1?e[0]:X(n,()=>{if(r.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{const{subscribe:s,getSnapshot:i}=g.useMemo(()=>({subscribe:a=>Ji(`useValue(${n})`,()=>{o.get(),a()}),getSnapshot:()=>o.get()}),[o]);return g.useSyncExternalStore(s,i,i)}finally{r.current=!1}}class _c{constructor(t){I(this,"nextValue");I(this,"diff");this.previousValue=t}get(){var r,o,s,i;const t=((o=(r=this.diff)==null?void 0:r.removed)==null?void 0:o.size)??0,n=((i=(s=this.diff)==null?void 0:s.added)==null?void 0:i.size)??0;if(!(t===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(t,n){var r,o;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(t),this.diff??(this.diff={}),n?(r=this.diff.removed)==null||r.delete(t):((o=this.diff).added??(o.added=new Set),this.diff.added.add(t))}add(t){var o,s,i;const n=this.previousValue.has(t);if(n)return((s=(o=this.diff)==null?void 0:o.removed)==null?void 0:s.has(t))?this._add(t,n):void 0;(i=this.nextValue)!=null&&i.has(t)||this._add(t,n)}_remove(t,n){var r,o;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(t),this.diff??(this.diff={}),n?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(t)):(o=this.diff.added)==null||o.delete(t)}remove(t){var o,s,i,a;const n=this.previousValue.has(t);if(!n)return((s=(o=this.diff)==null?void 0:o.added)==null?void 0:s.has(t))?this._remove(t,n):void 0;(a=(i=this.diff)==null?void 0:i.removed)!=null&&a.has(t)||this._remove(t,n)}}function Wc(e,t){const n=[];e:for(const r of e){for(const o of n)if(t?t(r,o):r===o)continue e;n.push(r)}return n}function fe(e){return e.filter(t=>t!=null)}function XG(e){return e[e.length-1]}function II(e,t){let n,r=1/0;for(const o of e){const s=t(o);s<r&&(n=o,r=s)}return n}function qG(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function cS(e){const t=(...n)=>{try{return e(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,t),r}};return t}function Dh(e,t){const n=t&&e&&typeof e=="object"&&t in e?e[t]:e;throw new Error(`Unknown switch case ${n}`)}const Nh=cS((e,t)=>{if(!e)throw new Error(t||"Assertion Error")}),kI=cS((e,t)=>{if(e==null)throw new Error(t??"value must be defined");return e});function lS(e,t){let n;const r=(...o)=>(n||(n={},n.promise=new Promise((s,i)=>{n.resolve=s,n.reject=i})),clearTimeout(n.timeout),n.latestArgs=o,n.timeout=setTimeout(()=>{const s=n;n=void 0;try{s.resolve(e(...s.latestArgs))}catch(i){s.reject(i)}},t),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const Cm=new WeakMap;function Lh(e,t){if(typeof e!="object"||e===null)return;let n=Cm.get(e);n||(n={tags:{},extras:{}},Cm.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}function TI(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t+""}let pf=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(pf=new Int32Array(pf));const Pm=(e,t)=>{let n=t===0?0:~~t^-1;for(let r=0;r<e.length;r++)n=pf[(n^e[r])&255]^n>>>8;return n^-1},Em=4,_m=4;class Rn{static isPng(t,n){return t.getUint8(n+0)===137&&t.getUint8(n+1)===80&&t.getUint8(n+2)===78&&t.getUint8(n+3)===71&&t.getUint8(n+4)===13&&t.getUint8(n+5)===10&&t.getUint8(n+6)===26&&t.getUint8(n+7)===10}static getChunkType(t,n){return[String.fromCharCode(t.getUint8(n)),String.fromCharCode(t.getUint8(n+1)),String.fromCharCode(t.getUint8(n+2)),String.fromCharCode(t.getUint8(n+3))].join("")}static readChunks(t,n=0){const r={};if(!Rn.isPng(t,n))throw new Error("Not a PNG");for(n+=8;n<=t.buffer.byteLength;){const o=n,s=t.getInt32(n);n+=4;const i=Rn.getChunkType(t,n);if(i==="IDAT"&&r[i]){n+=s+Em+_m;continue}if(i==="IEND")break;r[i]={start:o,dataOffset:n+4,size:s},n+=s+Em+_m}return r}static parsePhys(t,n){return{ppux:t.getUint32(n),ppuy:t.getUint32(n+4),unit:t.getUint8(n+4)}}static findChunk(t,n){return Rn.readChunks(t)[n]}static setPhysChunk(t,n=1,r){let o=46,s=0;const i=Rn.findChunk(t,"pHYs");i&&(o=i.start,s=i.size);const a=Rn.findChunk(t,"IDAT");a&&(o=a.start,s=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115);const u=2835.5;l.setInt32(8,u*n),l.setInt32(12,u*n),l.setInt8(16,1);const d=new Uint8Array(c.slice(4,17));l.setInt32(17,Pm(d));const f=t.buffer.slice(0,o),p=t.buffer.slice(o+s);return new Blob([f,c,p],r)}static setItxtChunk(t,n,r){let o=46,s=0;const i=Rn.findChunk(t,"iTXt");i&&(o=i.start,s=i.size);const a=Rn.findChunk(t,"IDAT");a&&(o=a.start,s=0);const c=new TextEncoder().encode(n),l=new TextEncoder().encode(r),u=c.length+1+2+1+1+l.length,d=new ArrayBuffer(8+u+4),f=new DataView(d);f.setUint32(0,u),f.setUint8(4,105),f.setUint8(5,84),f.setUint8(6,88),f.setUint8(7,116);let p=8;for(let x=0;x<c.length;x++)f.setUint8(p++,c[x]);f.setUint8(p++,0),f.setUint8(p++,0),f.setUint8(p++,0),f.setUint8(p++,0),f.setUint8(p++,0);for(let x=0;x<l.length;x++)f.setUint8(p++,l[x]);const v=new Uint8Array(d.slice(4,8+u)),m=Pm(v,0);f.setUint32(8+u,m);const y=t.buffer.slice(0,o),b=t.buffer.slice(o+s);return new Blob([y,d,b])}}function ZG(e,t,n){return e+(t-e)*n}function Fh(e=""){let t=0,n=0,r=0,o=0;function s(){const i=t^t<<11;return t=n,n=r,r=o,o^=(o>>>19^i^i>>>8)>>>0,o/4294967296*2}for(let i=0;i<e.length+64;i++)t^=e.charCodeAt(i)|0,s();return s}function Hc(e,t,n,r=!1){const[o,s]=t,[i,a]=n,c=i+(e-o)/(s-o)*(a-i);return r?i<a?Math.max(Math.min(c,a),i):Math.max(Math.min(c,i),a):c}function Al(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function yo(e,t){if(Al(e,t))return e[t]}function Or(e){if(!e)return e;if(Array.isArray(e)){const t=[],n=e.length;for(let r=0;r<n;r++)t.push(Or(e[r]));return t}else if(typeof e=="object"){const t=Object.keys(e),n=t.length,r={};for(let o=0;o<n;o++){const s=t[o];r[s]=Or(e[s])}return r}return e}function Im(e){return Object.keys(e)}function qe(e){return Object.values(e)}function rr(e){return Object.entries(e)}function uS(e){return Object.fromEntries(e)}function $u(e,t){const n={};let r=!1;for(const[o,s]of rr(e))t(o,s)?n[o]=s:r=!0;return r?n:e}function km(e,t){const n={};for(const[r,o]of rr(e)){const s=t(r,o);n[r]=s}return n}function $I(e,t){if(e===t)return!0;const n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(const o of n)if(!r.has(o)||!Object.is(e[o],t[o]))return!1;return!0}const Gc=[],AI=()=>{const e=Gc.splice(0,Gc.length);for(const t of e)t()};let Au;function MI(){Au||(Au=requestAnimationFrame(()=>{Au=void 0,AI()}))}function OI(e){Gc.includes(e)||(Gc.push(e),MI())}function RI(e,t){return e.id>t.id?1:-1}const jI=new RegExp(/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i);function gf(e){return jI.test(e)}function DI(e){return e!==null}const vo=typeof window<"u"&&window.structuredClone?window.structuredClone:e=>e&&JSON.parse(JSON.stringify(e));let dS=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");class Bh{constructor(t,n){I(this,"createDefaultProperties");I(this,"migrations");I(this,"validator");I(this,"scope");I(this,"isInstance",t=>(t==null?void 0:t.typeName)===this.typeName);this.typeName=t,this.createDefaultProperties=n.createDefaultProperties,this.migrations=n.migrations,this.validator=n.validator??{validate:r=>r},this.scope=n.scope??"document"}create(t){const n={...this.createDefaultProperties(),id:this.createId()};for(const[r,o]of Object.entries(t))o!==void 0&&(n[r]=o);return n.typeName=this.typeName,n}clone(t){return{...vo(t),id:this.createId()}}createId(t){return this.typeName+":"+(t??dS())}createCustomId(t){return this.typeName+":"+t}parseId(t){if(!this.isId(t))throw new Error(`ID "${t}" is not a valid ID for type "${this.typeName}"`);return t.slice(this.typeName.length+1)}isId(t){if(!t)return!1;for(let n=0;n<this.typeName.length;n++)if(t[n]!==this.typeName[n])return!1;return t[this.typeName.length]===":"}withDefaultProperties(t){return new Bh(this.typeName,{createDefaultProperties:t,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(t){return this.validator.validate(t)}}function dr(e,t){return new Bh(e,{createDefaultProperties:()=>({}),migrations:t.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}class Tm{constructor(){I(this,"items",new WeakMap)}get(t,n){return this.items.has(t)||this.items.set(t,n(t)),this.items.get(t)}}var Yc={exports:{}};Yc.exports;(function(e,t){var n=200,r="__lodash_hash_undefined__",o=1,s=2,i=9007199254740991,a="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",f="[object Error]",p="[object Function]",v="[object GeneratorFunction]",m="[object Map]",y="[object Number]",b="[object Null]",x="[object Object]",w="[object Promise]",S="[object Proxy]",C="[object RegExp]",P="[object Set]",E="[object String]",_="[object Symbol]",$="[object Undefined]",T="[object WeakMap]",M="[object ArrayBuffer]",O="[object DataView]",j="[object Float32Array]",N="[object Float64Array]",B="[object Int8Array]",D="[object Int16Array]",G="[object Int32Array]",V="[object Uint8Array]",z="[object Uint8ClampedArray]",W="[object Uint16Array]",Q="[object Uint32Array]",oe=/[\\^$.*+?()[\]{}|]/g,se=/^\[object .+?Constructor\]$/,ye=/^(?:0|[1-9]\d*)$/,ee={};ee[j]=ee[N]=ee[B]=ee[D]=ee[G]=ee[V]=ee[z]=ee[W]=ee[Q]=!0,ee[a]=ee[c]=ee[M]=ee[u]=ee[O]=ee[d]=ee[f]=ee[p]=ee[m]=ee[y]=ee[x]=ee[C]=ee[P]=ee[E]=ee[T]=!1;var be=typeof Ue=="object"&&Ue&&Ue.Object===Object&&Ue,Se=typeof self=="object"&&self&&self.Object===Object&&self,Ie=be||Se||Function("return this")(),de=t&&!t.nodeType&&t,Ee=de&&!0&&e&&!e.nodeType&&e,xe=Ee&&Ee.exports===de,Qe=xe&&be.process,Fe=function(){try{return Qe&&Qe.binding&&Qe.binding("util")}catch{}}(),et=Fe&&Fe.isTypedArray;function Oe(A,R){for(var K=-1,J=A==null?0:A.length,Ne=0,pe=[];++K<J;){var Xe=A[K];R(Xe,K,A)&&(pe[Ne++]=Xe)}return pe}function tt(A,R){for(var K=-1,J=R.length,Ne=A.length;++K<J;)A[Ne+K]=R[K];return A}function kn(A,R){for(var K=-1,J=A==null?0:A.length;++K<J;)if(R(A[K],K,A))return!0;return!1}function vn(A,R){for(var K=-1,J=Array(A);++K<A;)J[K]=R(K);return J}function Je(A){return function(R){return A(R)}}function Yn(A,R){return A.has(R)}function br(A,R){return A==null?void 0:A[R]}function Tn(A){var R=-1,K=Array(A.size);return A.forEach(function(J,Ne){K[++R]=[Ne,J]}),K}function ME(A,R){return function(K){return A(R(K))}}function OE(A){var R=-1,K=Array(A.size);return A.forEach(function(J){K[++R]=J}),K}var RE=Array.prototype,jE=Function.prototype,Pa=Object.prototype,xu=Ie["__core-js_shared__"],Xg=jE.toString,$n=Pa.hasOwnProperty,qg=function(){var A=/[^.]+$/.exec(xu&&xu.keys&&xu.keys.IE_PROTO||"");return A?"Symbol(src)_1."+A:""}(),Zg=Pa.toString,DE=RegExp("^"+Xg.call($n).replace(oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qg=xe?Ie.Buffer:void 0,Ea=Ie.Symbol,Jg=Ie.Uint8Array,em=Pa.propertyIsEnumerable,NE=RE.splice,ro=Ea?Ea.toStringTag:void 0,tm=Object.getOwnPropertySymbols,LE=Qg?Qg.isBuffer:void 0,FE=ME(Object.keys,Object),wu=jo(Ie,"DataView"),qs=jo(Ie,"Map"),Cu=jo(Ie,"Promise"),Pu=jo(Ie,"Set"),Eu=jo(Ie,"WeakMap"),Zs=jo(Object,"create"),BE=io(wu),zE=io(qs),UE=io(Cu),VE=io(Pu),KE=io(Eu),nm=Ea?Ea.prototype:void 0,_u=nm?nm.valueOf:void 0;function oo(A){var R=-1,K=A==null?0:A.length;for(this.clear();++R<K;){var J=A[R];this.set(J[0],J[1])}}function WE(){this.__data__=Zs?Zs(null):{},this.size=0}function HE(A){var R=this.has(A)&&delete this.__data__[A];return this.size-=R?1:0,R}function GE(A){var R=this.__data__;if(Zs){var K=R[A];return K===r?void 0:K}return $n.call(R,A)?R[A]:void 0}function YE(A){var R=this.__data__;return Zs?R[A]!==void 0:$n.call(R,A)}function XE(A,R){var K=this.__data__;return this.size+=this.has(A)?0:1,K[A]=Zs&&R===void 0?r:R,this}oo.prototype.clear=WE,oo.prototype.delete=HE,oo.prototype.get=GE,oo.prototype.has=YE,oo.prototype.set=XE;function Xn(A){var R=-1,K=A==null?0:A.length;for(this.clear();++R<K;){var J=A[R];this.set(J[0],J[1])}}function qE(){this.__data__=[],this.size=0}function ZE(A){var R=this.__data__,K=Ia(R,A);if(K<0)return!1;var J=R.length-1;return K==J?R.pop():NE.call(R,K,1),--this.size,!0}function QE(A){var R=this.__data__,K=Ia(R,A);return K<0?void 0:R[K][1]}function JE(A){return Ia(this.__data__,A)>-1}function e_(A,R){var K=this.__data__,J=Ia(K,A);return J<0?(++this.size,K.push([A,R])):K[J][1]=R,this}Xn.prototype.clear=qE,Xn.prototype.delete=ZE,Xn.prototype.get=QE,Xn.prototype.has=JE,Xn.prototype.set=e_;function so(A){var R=-1,K=A==null?0:A.length;for(this.clear();++R<K;){var J=A[R];this.set(J[0],J[1])}}function t_(){this.size=0,this.__data__={hash:new oo,map:new(qs||Xn),string:new oo}}function n_(A){var R=ka(this,A).delete(A);return this.size-=R?1:0,R}function r_(A){return ka(this,A).get(A)}function o_(A){return ka(this,A).has(A)}function s_(A,R){var K=ka(this,A),J=K.size;return K.set(A,R),this.size+=K.size==J?0:1,this}so.prototype.clear=t_,so.prototype.delete=n_,so.prototype.get=r_,so.prototype.has=o_,so.prototype.set=s_;function _a(A){var R=-1,K=A==null?0:A.length;for(this.__data__=new so;++R<K;)this.add(A[R])}function i_(A){return this.__data__.set(A,r),this}function a_(A){return this.__data__.has(A)}_a.prototype.add=_a.prototype.push=i_,_a.prototype.has=a_;function Sr(A){var R=this.__data__=new Xn(A);this.size=R.size}function c_(){this.__data__=new Xn,this.size=0}function l_(A){var R=this.__data__,K=R.delete(A);return this.size=R.size,K}function u_(A){return this.__data__.get(A)}function d_(A){return this.__data__.has(A)}function f_(A,R){var K=this.__data__;if(K instanceof Xn){var J=K.__data__;if(!qs||J.length<n-1)return J.push([A,R]),this.size=++K.size,this;K=this.__data__=new so(J)}return K.set(A,R),this.size=K.size,this}Sr.prototype.clear=c_,Sr.prototype.delete=l_,Sr.prototype.get=u_,Sr.prototype.has=d_,Sr.prototype.set=f_;function h_(A,R){var K=Ta(A),J=!K&&k_(A),Ne=!K&&!J&&Iu(A),pe=!K&&!J&&!Ne&&dm(A),Xe=K||J||Ne||pe,nt=Xe?vn(A.length,String):[],it=nt.length;for(var Ke in A)$n.call(A,Ke)&&!(Xe&&(Ke=="length"||Ne&&(Ke=="offset"||Ke=="parent")||pe&&(Ke=="buffer"||Ke=="byteLength"||Ke=="byteOffset")||C_(Ke,it)))&&nt.push(Ke);return nt}function Ia(A,R){for(var K=A.length;K--;)if(am(A[K][0],R))return K;return-1}function p_(A,R,K){var J=R(A);return Ta(A)?J:tt(J,K(A))}function Qs(A){return A==null?A===void 0?$:b:ro&&ro in Object(A)?x_(A):I_(A)}function rm(A){return Js(A)&&Qs(A)==a}function om(A,R,K,J,Ne){return A===R?!0:A==null||R==null||!Js(A)&&!Js(R)?A!==A&&R!==R:g_(A,R,K,J,om,Ne)}function g_(A,R,K,J,Ne,pe){var Xe=Ta(A),nt=Ta(R),it=Xe?c:xr(A),Ke=nt?c:xr(R);it=it==a?x:it,Ke=Ke==a?x:Ke;var jt=it==x,bn=Ke==x,dt=it==Ke;if(dt&&Iu(A)){if(!Iu(R))return!1;Xe=!0,jt=!1}if(dt&&!jt)return pe||(pe=new Sr),Xe||dm(A)?sm(A,R,K,J,Ne,pe):b_(A,R,it,K,J,Ne,pe);if(!(K&o)){var rn=jt&&$n.call(A,"__wrapped__"),on=bn&&$n.call(R,"__wrapped__");if(rn||on){var wr=rn?A.value():A,qn=on?R.value():R;return pe||(pe=new Sr),Ne(wr,qn,K,J,pe)}}return dt?(pe||(pe=new Sr),S_(A,R,K,J,Ne,pe)):!1}function m_(A){if(!um(A)||E_(A))return!1;var R=cm(A)?DE:se;return R.test(io(A))}function y_(A){return Js(A)&&lm(A.length)&&!!ee[Qs(A)]}function v_(A){if(!__(A))return FE(A);var R=[];for(var K in Object(A))$n.call(A,K)&&K!="constructor"&&R.push(K);return R}function sm(A,R,K,J,Ne,pe){var Xe=K&o,nt=A.length,it=R.length;if(nt!=it&&!(Xe&&it>nt))return!1;var Ke=pe.get(A);if(Ke&&pe.get(R))return Ke==R;var jt=-1,bn=!0,dt=K&s?new _a:void 0;for(pe.set(A,R),pe.set(R,A);++jt<nt;){var rn=A[jt],on=R[jt];if(J)var wr=Xe?J(on,rn,jt,R,A,pe):J(rn,on,jt,A,R,pe);if(wr!==void 0){if(wr)continue;bn=!1;break}if(dt){if(!kn(R,function(qn,ao){if(!Yn(dt,ao)&&(rn===qn||Ne(rn,qn,K,J,pe)))return dt.push(ao)})){bn=!1;break}}else if(!(rn===on||Ne(rn,on,K,J,pe))){bn=!1;break}}return pe.delete(A),pe.delete(R),bn}function b_(A,R,K,J,Ne,pe,Xe){switch(K){case O:if(A.byteLength!=R.byteLength||A.byteOffset!=R.byteOffset)return!1;A=A.buffer,R=R.buffer;case M:return!(A.byteLength!=R.byteLength||!pe(new Jg(A),new Jg(R)));case u:case d:case y:return am(+A,+R);case f:return A.name==R.name&&A.message==R.message;case C:case E:return A==R+"";case m:var nt=Tn;case P:var it=J&o;if(nt||(nt=OE),A.size!=R.size&&!it)return!1;var Ke=Xe.get(A);if(Ke)return Ke==R;J|=s,Xe.set(A,R);var jt=sm(nt(A),nt(R),J,Ne,pe,Xe);return Xe.delete(A),jt;case _:if(_u)return _u.call(A)==_u.call(R)}return!1}function S_(A,R,K,J,Ne,pe){var Xe=K&o,nt=im(A),it=nt.length,Ke=im(R),jt=Ke.length;if(it!=jt&&!Xe)return!1;for(var bn=it;bn--;){var dt=nt[bn];if(!(Xe?dt in R:$n.call(R,dt)))return!1}var rn=pe.get(A);if(rn&&pe.get(R))return rn==R;var on=!0;pe.set(A,R),pe.set(R,A);for(var wr=Xe;++bn<it;){dt=nt[bn];var qn=A[dt],ao=R[dt];if(J)var fm=Xe?J(ao,qn,dt,R,A,pe):J(qn,ao,dt,A,R,pe);if(!(fm===void 0?qn===ao||Ne(qn,ao,K,J,pe):fm)){on=!1;break}wr||(wr=dt=="constructor")}if(on&&!wr){var $a=A.constructor,Aa=R.constructor;$a!=Aa&&"constructor"in A&&"constructor"in R&&!(typeof $a=="function"&&$a instanceof $a&&typeof Aa=="function"&&Aa instanceof Aa)&&(on=!1)}return pe.delete(A),pe.delete(R),on}function im(A){return p_(A,A_,w_)}function ka(A,R){var K=A.__data__;return P_(R)?K[typeof R=="string"?"string":"hash"]:K.map}function jo(A,R){var K=br(A,R);return m_(K)?K:void 0}function x_(A){var R=$n.call(A,ro),K=A[ro];try{A[ro]=void 0;var J=!0}catch{}var Ne=Zg.call(A);return J&&(R?A[ro]=K:delete A[ro]),Ne}var w_=tm?function(A){return A==null?[]:(A=Object(A),Oe(tm(A),function(R){return em.call(A,R)}))}:M_,xr=Qs;(wu&&xr(new wu(new ArrayBuffer(1)))!=O||qs&&xr(new qs)!=m||Cu&&xr(Cu.resolve())!=w||Pu&&xr(new Pu)!=P||Eu&&xr(new Eu)!=T)&&(xr=function(A){var R=Qs(A),K=R==x?A.constructor:void 0,J=K?io(K):"";if(J)switch(J){case BE:return O;case zE:return m;case UE:return w;case VE:return P;case KE:return T}return R});function C_(A,R){return R=R??i,!!R&&(typeof A=="number"||ye.test(A))&&A>-1&&A%1==0&&A<R}function P_(A){var R=typeof A;return R=="string"||R=="number"||R=="symbol"||R=="boolean"?A!=="__proto__":A===null}function E_(A){return!!qg&&qg in A}function __(A){var R=A&&A.constructor,K=typeof R=="function"&&R.prototype||Pa;return A===K}function I_(A){return Zg.call(A)}function io(A){if(A!=null){try{return Xg.call(A)}catch{}try{return A+""}catch{}}return""}function am(A,R){return A===R||A!==A&&R!==R}var k_=rm(function(){return arguments}())?rm:function(A){return Js(A)&&$n.call(A,"callee")&&!em.call(A,"callee")},Ta=Array.isArray;function T_(A){return A!=null&&lm(A.length)&&!cm(A)}var Iu=LE||O_;function $_(A,R){return om(A,R)}function cm(A){if(!um(A))return!1;var R=Qs(A);return R==p||R==v||R==l||R==S}function lm(A){return typeof A=="number"&&A>-1&&A%1==0&&A<=i}function um(A){var R=typeof A;return A!=null&&(R=="object"||R=="function")}function Js(A){return A!=null&&typeof A=="object"}var dm=et?Je(et):y_;function A_(A){return T_(A)?h_(A):v_(A)}function M_(){return[]}function O_(){return!1}e.exports=$_})(Yc,Yc.exports);var NI=Yc.exports;const LI=As(NI);function FI(e){if(e.length===0)return new Set;const t=e[0],n=e.slice(1),r=new Set;for(const o of t)n.every(s=>s.has(o))&&r.add(o);return r}function BI(e,t){const n={};for(const r of t)e.has(r)||(n.added??(n.added=new Set),n.added.add(r));for(const r of e)t.has(r)||(n.removed??(n.removed=new Set),n.removed.add(r));return n.added||n.removed?n:void 0}function $m(e,t){for(const[n,r]of Object.entries(e)){const o=r,s=t[n];if("eq"in o&&s!==o.eq||"neq"in o&&s===o.neq||"gt"in o&&(typeof s!="number"||s<=o.gt))return!1}return!0}function Am(e,t,n){const r=Object.fromEntries(Object.keys(n).map(o=>[o,new Set]));for(const[o,s]of Object.entries(n))if("eq"in s){const a=e.index(t,o).get().get(s.eq);if(a)for(const c of a)r[o].add(c)}else if("neq"in s){const i=e.index(t,o);for(const[a,c]of i.get())if(a!==s.neq)for(const l of c)r[o].add(l)}else if("gt"in s){const i=e.index(t,o);for(const[a,c]of i.get())if(a>s.gt)for(const l of c)r[o].add(l)}return FI(Object.values(r))}class zI{constructor(t,n){I(this,"indexCache",new Map);I(this,"historyCache",new Map);this.atoms=t,this.history=n}filterHistory(t){if(this.historyCache.has(t))return this.historyCache.get(t);const n=X("filterHistory:"+t,(r,o)=>{if(ls(r))return this.history.get();const s=this.history.getDiffSince(o);if(s===Gt)return this.history.get();const i={added:{},removed:{},updated:{}};let a=0,c=0,l=0;for(const u of s){for(const d of qe(u.added))if(d.typeName===t)if(i.removed[d.id]){const f=i.removed[d.id];delete i.removed[d.id],c--,f!==d&&(i.updated[d.id]=[f,d],l++)}else i.added[d.id]=d,a++;for(const[d,f]of qe(u.updated))f.typeName===t&&(i.added[f.id]?i.added[f.id]=f:i.updated[f.id]?i.updated[f.id]=[i.updated[f.id][0],f]:(i.updated[f.id]=[d,f],l++));for(const d of qe(u.removed))d.typeName===t&&(i.added[d.id]?(delete i.added[d.id],a--):i.updated[d.id]?(i.removed[d.id]=i.updated[d.id][0],delete i.updated[d.id],l--,c++):(i.removed[d.id]=d,c++))}return a||c||l?wi(this.history.get(),i):r},{historyLength:100});return this.historyCache.set(t,n),n}index(t,n){const r=t+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const o=this.__uncached_createIndex(t,n);return this.indexCache.set(r,o),o}__uncached_createIndex(t,n){const r=this.filterHistory(t),o=()=>{r.get();const s=new Map;for(const i of qe(this.atoms.get())){const a=i.get();if(a.typeName===t){const c=a[n];s.has(c)||s.set(c,new Set),s.get(c).add(a.id)}}return s};return X("index:"+t+":"+n,(s,i)=>{if(ls(s))return o();const a=r.getDiffSince(i);if(a===Gt)return o();const c=new Map,l=(p,v)=>{let m=c.get(p);m||(m=new _c(s.get(p)??new Set)),m.add(v),c.set(p,m)},u=(p,v)=>{let m=c.get(p);m||(m=new _c(s.get(p)??new Set)),m.remove(v),c.set(p,m)};for(const p of a){for(const v of qe(p.added))if(v.typeName===t){const m=v[n];l(m,v.id)}for(const[v,m]of qe(p.updated))if(m.typeName===t){const y=v[n],b=m[n];y!==b&&(u(y,m.id),l(b,m.id))}for(const v of qe(p.removed))if(v.typeName===t){const m=v[n];u(m,v.id)}}let d,f;for(const[p,v]of c){const m=v.get();m&&(d||(d=new Map(s)),f||(f=new Map),m.value.size===0?d.delete(p):d.set(p,m.value),f.set(p,m.diff))}return d&&f?wi(d,f):s},{historyLength:100})}record(t,n=()=>({}),r="record:"+t+(n?":"+n.toString():"")){const o=this.ids(t,n,r);return X(r,()=>{var s;for(const i of o.get())return(s=this.atoms.get()[i])==null?void 0:s.get()})}records(t,n=()=>({}),r="records:"+t+(n?":"+n.toString():"")){const o=this.ids(t,n,"ids:"+r);return X(r,()=>[...o.get()].map(s=>{const i=this.atoms.get()[s];if(!i)throw new Error("no atom found for record id: "+s);return i.get()}))}ids(t,n=()=>({}),r="ids:"+t+(n?":"+n.toString():"")){const o=this.filterHistory(t),s=()=>{o.get();const c=n();return Object.keys(c).length===0?new Set(qe(this.atoms.get()).flatMap(l=>{const u=l.get();return u.typeName===t?u.id:[]})):Am(this,t,c)},i=c=>{const l=s(),u=BI(c,l);return u?wi(l,u):c},a=X("ids_query:"+r,n,{isEqual:LI});return X("query:"+r,(c,l)=>{const u=a.get();if(ls(c))return s();if(l<a.lastChangedEpoch)return i(c);const d=o.getDiffSince(l);if(d===Gt)return i(c);const f=new _c(c);for(const v of d){for(const m of qe(v.added))m.typeName===t&&$m(u,m)&&f.add(m.id);for(const[m,y]of qe(v.updated))y.typeName===t&&($m(u,y)?f.add(y.id):f.remove(y.id));for(const m of qe(v.removed))m.typeName===t&&f.remove(m.id)}const p=f.get();return p?wi(p.value,p.diff):c},{historyLength:50})}exec(t,n){const r=Am(this,t,n);if(r.size===0)return nr;const o=this.atoms.get();return[...r].map(s=>o[s].get())}}class fS{constructor(t){I(this,"id",dS());I(this,"atoms",wt("store_atoms",{}));I(this,"history",wt("history",0,{historyLength:1e3}));I(this,"query",new zI(this.atoms,this.history));I(this,"listeners",new Set);I(this,"historyAccumulator",new VI);I(this,"historyReactor");I(this,"schema");I(this,"props");I(this,"scopedTypes");I(this,"onBeforeCreate");I(this,"onAfterCreate");I(this,"onBeforeChange");I(this,"onAfterChange");I(this,"onBeforeDelete");I(this,"onAfterDelete");I(this,"_runCallbacks",!0);I(this,"put",(t,n)=>{an(()=>{const r={},o={},s=this.atoms.__unsafe__getWithoutCapture();let i=null,a,c=!1;const l=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,u=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,d=this.isMergingRemoteChanges?"remote":"user";for(let f=0,p=t.length;f<p;f++){a=t[f];const v=(i??s)[a.id];if(v){u&&(a=u(v.get(),a,d));const m=v.__unsafe__getWithoutCapture();a=this.schema.validateRecord(this,a,n??"updateRecord",m),v.set(a);const y=v.__unsafe__getWithoutCapture();m!==y&&(c=!0,r[a.id]=[m,y])}else l&&(a=l(a,d)),c=!0,a=this.schema.validateRecord(this,a,n??"createRecord",null),o[a.id]=a,i||(i={...s}),i[a.id]=wt("atom:"+a.id,a)}if(i&&this.atoms.set(i),!!c&&(this.updateHistory({added:o,updated:r,removed:{}}),this._runCallbacks)){const{onAfterCreate:f,onAfterChange:p}=this;f&&Object.values(o).forEach(v=>{f(v,d)}),p&&Object.values(r).forEach(([v,m])=>{p(v,m,d)})}})});I(this,"remove",t=>{an(()=>{const n=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const s of t){const i=this.atoms.__unsafe__getWithoutCapture()[s];i&&this.onBeforeDelete(i.get(),r)===!1&&n.push(s)}let o;if(this.atoms.update(s=>{let i;for(const a of t)n.includes(a)||a in s&&(i||(i={...s}),o||(o={}),delete i[a],o[a]=s[a].get());return i??s}),!!o&&(this.updateHistory({added:{},updated:{},removed:o}),this.onAfterDelete&&this._runCallbacks)){let s;for(let i=0,a=t.length;i<a;i++)s=o[t[i]],s&&this.onAfterDelete(s,r)}})});I(this,"get",t=>{var n;return(n=this.atoms.get()[t])==null?void 0:n.get()});I(this,"unsafeGetWithoutCapture",t=>{var n;return(n=this.atoms.get()[t])==null?void 0:n.__unsafe__getWithoutCapture()});I(this,"serialize",(t="document")=>{const n={};for(const[r,o]of rr(this.atoms.get())){const s=o.get();(t==="all"||this.scopedTypes[t].has(s.typeName))&&(n[r]=s)}return n});I(this,"loadSnapshotAsync",t=>new Promise((n,r)=>{an(()=>{const o=this.schema.migrateStoreSnapshot(t);if(o.type==="error"){r(new Error(`Failed to migrate snapshot: ${o.reason}`));return}this.clear(),this.put(Object.values(o.value)),this.ensureStoreIsUsable(),n()})}));I(this,"allRecords",()=>qe(this.atoms.get()).map(t=>t.get()));I(this,"clear",()=>{this.remove(Im(this.atoms.get()))});I(this,"update",(t,n)=>{const r=this.atoms.get()[t];if(!r){console.error(`Record ${t} not found. This is probably an error`);return}this.put([n(r.__unsafe__getWithoutCapture())])});I(this,"has",t=>!!this.atoms.get()[t]);I(this,"listen",(t,n)=>{this._flushHistory();const r={onHistory:t,filters:{source:(n==null?void 0:n.source)??"all",scope:(n==null?void 0:n.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});I(this,"isMergingRemoteChanges",!1);I(this,"mergeRemoteChanges",t=>{if(this.isMergingRemoteChanges)return t();try{this.isMergingRemoteChanges=!0,an(t)}finally{this.isMergingRemoteChanges=!1}});I(this,"createComputedCache",(t,n,r)=>{const o=new Tm;return{get:s=>{const i=this.atoms.get()[s];if(i)return o.get(i,()=>{const a=r?X(i.name+":equals",()=>i.get(),{isEqual:r}):i;return X(t+":"+s,()=>n(a.get()))}).get()}}});I(this,"createSelectedComputedCache",(t,n,r)=>{const o=new Tm;return{get:s=>{const i=this.atoms.get()[s];if(!i)return;const a=X(t+":"+s+":selector",()=>n(i.get()));return o.get(i,()=>X(t+":"+s,()=>r(a.get()))).get()}}});I(this,"getRecordType",t=>{const n=this.schema.types[t.typeName];if(!n)throw new Error(`Record type ${t.typeName} not found`);return n});I(this,"_integrityChecker");I(this,"_isPossiblyCorrupted",!1);const{initialData:n,schema:r}=t;this.schema=r,this.props=t.props,n&&this.atoms.set(uS(rr(n).map(([o,s])=>[o,wt("atom:"+o,this.schema.validateRecord(this,s,"initialize",null))]))),this.historyReactor=fI("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:o=>OI(o)}),this.scopedTypes={document:new Set(qe(this.schema.types).filter(o=>o.scope==="document").map(o=>o.typeName)),session:new Set(qe(this.schema.types).filter(o=>o.scope==="session").map(o=>o.typeName)),presence:new Set(qe(this.schema.types).filter(o=>o.scope==="presence").map(o=>o.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const t=this.historyAccumulator.flush();for(const{changes:n,source:r}of t){let o=null,s=null,i=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(s??(s=this.filterChangesByScope(n,"document")),!s)continue;a({changes:s,source:r})}else if(c.scope==="session"){if(o??(o=this.filterChangesByScope(n,"session")),!o)continue;a({changes:o,source:r})}else{if(i??(i=this.filterChangesByScope(n,"presence")),!i)continue;a({changes:i,source:r})}else a({changes:n,source:r})}}}filterChangesByScope(t,n){const r={added:$u(t.added,(o,s)=>this.scopedTypes[n].has(s.typeName)),updated:$u(t.updated,(o,s)=>this.scopedTypes[n].has(s[1].typeName)),removed:$u(t.removed,(o,s)=>this.scopedTypes[n].has(s.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(t){this.historyAccumulator.add({changes:t,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,t)}validate(t){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,t,null))}getSnapshot(t="document"){return{store:this.serialize(t),schema:this.schema.serialize()}}migrateSnapshot(t){const n=this.schema.migrateStoreSnapshot(t);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadSnapshot(t){const n=this.schema.migrateStoreSnapshot(t);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);an(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}extractingChanges(t){const n=[],r=this.historyAccumulator.intercepting(o=>n.push(o.changes));try{return an(t),Ml(n)}finally{r()}}applyDiff(t,n=!0){const r=this._runCallbacks;try{this._runCallbacks=n,an(()=>{const o=qe(t.added).concat(qe(t.updated).map(([i,a])=>a)),s=Im(t.removed);o.length&&this.put(o),s.length&&this.remove(s)})}finally{this._runCallbacks=r}}ensureStoreIsUsable(){var t;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(t=this._integrityChecker)==null||t.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function Ml(e){const t={added:{},removed:{},updated:{}};for(const n of e){for(const[r,o]of rr(n.added))if(t.removed[r]){const s=t.removed[r];delete t.removed[r],s!==o&&(t.updated[r]=[s,o])}else t.added[r]=o;for(const[r,[o,s]]of rr(n.updated)){if(t.added[r]){t.added[r]=s,delete t.updated[r],delete t.removed[r];continue}if(t.updated[r]){t.updated[r]=[t.updated[r][0],s],delete t.removed[r];continue}t.updated[r]=n.updated[r],delete t.removed[r]}for(const[r,o]of rr(n.removed))t.added[r]?delete t.added[r]:t.updated[r]?(t.removed[r]=t.updated[r][0],delete t.updated[r]):t.removed[r]=o}return t}function UI(e){const t=[];let n=e[0],r;for(let o=1,s=e.length;o<s;o++)r=e[o],n.source!==r.source?(t.push(n),n=r):n={source:n.source,changes:Ml([n.changes,r.changes])};return t.push(n),t}class VI{constructor(){I(this,"_history",[]);I(this,"_interceptors",new Set)}intercepting(t){return this._interceptors.add(t),()=>{this._interceptors.delete(t)}}add(t){this._history.push(t);for(const n of this._interceptors)n(t)}flush(){const t=UI(this._history);return this._history=[],t}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function KI(e){return typeof e=="object"&&e!==null&&"id"in e&&"typeName"in e}function he(e){const{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:o,subTypeMigrations:s}=e;if(typeof t=="number"&&typeof n=="number"){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:t??0,migrators:r,subTypeKey:o,subTypeMigrations:s}}var Ci=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(Ci||{});function Oa({record:e,migrations:t,fromVersion:n,toVersion:r}){let o=n;if(!KI(e))throw new Error("[migrateRecord] object is not a record");const{typeName:s,id:i,...a}=e;let c=a;for(;o<r;){const l=o+1,u=t.migrators[l];if(!u)return{type:"error",reason:"target-version-too-new"};c=u.up(c),o=l}for(;o>r;){const l=o-1,u=t.migrators[o];if(!u)return{type:"error",reason:"target-version-too-old"};c=u.down(c),o=l}return{type:"success",value:{...c,id:i,typeName:s}}}function zh({value:e,migrations:t,fromVersion:n,toVersion:r}){let o=n;for(;o<r;){const s=o+1,i=t.migrators[s];if(!i)return{type:"error",reason:"target-version-too-new"};e=i.up(e),o=s}for(;o>r;){const s=o-1,i=t.migrators[o];if(!i)return{type:"error",reason:"target-version-too-old"};e=i.down(e),o=s}return{type:"success",value:e}}class Uh{constructor(t,n){this.types=t,this.options=n}static create(t,n){return new Uh(t,n??{})}get currentStoreVersion(){var t;return((t=this.options.snapshotMigrations)==null?void 0:t.currentVersion)??0}validateRecord(t,n,r,o){try{const s=yo(this.types,n.typeName);if(!s)throw new Error(`Missing definition for record type ${n.typeName}`);return s.validate(n)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:t,record:n,phase:r,recordBefore:o,error:s});throw s}}migratePersistedRecord(t,n,r="up"){var d;const o=yo(this.types,t.typeName),s=n.recordVersions[t.typeName];if(!s||!o)return{type:"error",reason:Ci.UnknownType};const i=o.migrations.currentVersion,a=s.version;if(i!==a){const f=Oa(r==="up"?{record:t,migrations:o.migrations,fromVersion:a,toVersion:i}:{record:t,migrations:o.migrations,fromVersion:i,toVersion:a});if(f.type==="error")return f;t=f.value}if(!o.migrations.subTypeKey)return{type:"success",value:t};const c=(d=o.migrations.subTypeMigrations)==null?void 0:d[t[o.migrations.subTypeKey]],l="subTypeVersions"in s?s.subTypeVersions[t[o.migrations.subTypeKey]]:void 0;if(c===void 0)return{type:"error",reason:Ci.UnrecognizedSubtype};if(l===void 0)return{type:"error",reason:Ci.IncompatibleSubtype};const u=Oa(r==="up"?{record:t,migrations:c,fromVersion:l,toVersion:c.currentVersion}:{record:t,migrations:c,fromVersion:c.currentVersion,toVersion:l});return u.type==="error"?u:{type:"success",value:u.value}}migrateStoreSnapshot(t){let{store:n}=t;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:n};const o=r.currentVersion,s=t.schema.storeVersion??0;if(o<s)return{type:"error",reason:Ci.TargetVersionTooOld};if(o>s){const a=zh({value:n,migrations:r,fromVersion:s,toVersion:o});if(a.type==="error")return a;n=a.value}const i=[];for(const a of qe(n)){const c=this.migratePersistedRecord(a,t.schema);if(c.type==="error")return c;c.value&&c.value!==a&&i.push(c.value)}if(i.length){n={...n};for(const a of i)n[a.id]=a}return{type:"success",value:n}}createIntegrityChecker(t){var n,r;return((r=(n=this.options).createIntegrityChecker)==null?void 0:r.call(n,t))??void 0}serialize(){var t;return{schemaVersion:1,storeVersion:((t=this.options.snapshotMigrations)==null?void 0:t.currentVersion)??0,recordVersions:Object.fromEntries(qe(this.types).map(n=>[n.typeName,n.migrations.subTypeKey&&n.migrations.subTypeMigrations?{version:n.migrations.currentVersion,subTypeKey:n.migrations.subTypeKey,subTypeVersions:n.migrations.subTypeMigrations?Object.fromEntries(Object.entries(n.migrations.subTypeMigrations).map(([r,o])=>[r,o.currentVersion])):void 0}:{version:n.migrations.currentVersion}]))}}serializeEarliestVersion(){var t;return{schemaVersion:1,storeVersion:((t=this.options.snapshotMigrations)==null?void 0:t.firstVersion)??0,recordVersions:Object.fromEntries(qe(this.types).map(n=>[n.typeName,n.migrations.subTypeKey&&n.migrations.subTypeMigrations?{version:n.migrations.firstVersion,subTypeKey:n.migrations.subTypeKey,subTypeVersions:n.migrations.subTypeMigrations?Object.fromEntries(Object.entries(n.migrations.subTypeMigrations).map(([r,o])=>[r,o.firstVersion])):void 0}:{version:n.migrations.firstVersion}]))}}}const WI=(e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return-1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return-1;for(const n of Object.keys(e.recordVersions)){const r=e.recordVersions[n],o=t.recordVersions[n];if(r.version>o.version)return 1;if(r.version<o.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in o))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in o)return-1;if(!(!("subTypeVersions"in r)||!("subTypeVersions"in o)))for(const s of Object.keys(r.subTypeVersions)){const i=r.subTypeVersions[s],a=o.subTypeVersions[s];if(i>a)return 1;if(i<a)return-1}}return 0};function HI(e){if(!e.length)return null;let t="";for(const n of e)typeof n=="number"?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return t.startsWith(".")?t.slice(1):t}class Me extends Error{constructor(n,r=[]){const o=HI(r),s=n.split(`
`).map((i,a)=>a===0?i:`  ${i}`).join(`
`);super(r?`At ${o}: ${s}`:s);I(this,"name","ValidationError");this.rawMessage=n,this.path=r}}function js(e,t){try{return t()}catch(n){throw n instanceof Me?new Me(n.rawMessage,[e,...n.path]):new Me(n.toString(),[e])}}function vs(e){if(e===null)return"null";if(Array.isArray(e))return"an array";const t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:Dh(t)}}class Pt{constructor(t){this.validationFn=t}validate(t){return this.validationFn(t)}nullable(){return _i(this)}optional(){return qt(this)}refine(t){return new Pt(n=>t(this.validate(n)))}check(t,n){return typeof t=="string"?this.refine(r=>(js(`(check ${t})`,()=>n(r)),r)):this.refine(r=>(t(r),r))}}class GI extends Pt{constructor(t){super(n=>{const r=ZI.validate(n);for(let o=0;o<r.length;o++)js(o,()=>t.validate(r[o]));return r}),this.itemValidator=t}nonEmpty(){return this.check(t=>{if(t.length===0)throw new Me("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(t=>{if(t.length<=1)throw new Me("Expected an array with length greater than 1")})}}class Xc extends Pt{constructor(t,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Me(`Expected object, got ${vs(r)}`);for(const[o,s]of Object.entries(t))js(o,()=>{s.validate(yo(r,o))});if(!n){for(const o of Object.keys(r))if(!Al(t,o))throw new Me("Unexpected property",[o])}return r}),this.config=t,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new Xc(this.config,!0)}extend(t){return new Xc({...this.config,...t})}}class Vh extends Pt{constructor(t,n,r){super(o=>{if(typeof o!="object"||o===null)throw new Me(`Expected an object, got ${vs(o)}`,[]);const s=yo(o,t);if(typeof s!="string")throw new Me(`Expected a string for key "${t}", got ${vs(s)}`);const i=Al(n,s)?n[s]:void 0;return i===void 0?this.unknownValueValidation(o,s):js(`(${t} = ${s})`,()=>i.validate(o))}),this.key=t,this.config=n,this.unknownValueValidation=r}validateUnknownVariants(t){return new Vh(this.key,this.config,t)}}class YI extends Pt{constructor(t,n){super(r=>{if(typeof r!="object"||r===null)throw new Me(`Expected object, got ${vs(r)}`);for(const[o,s]of Object.entries(r))js(o,()=>{t.validate(o),n.validate(s)});return r}),this.keyValidator=t,this.valueValidator=n}}function Kh(e){return new Pt(t=>{if(typeof t!==e)throw new Me(`Expected ${e}, got ${vs(t)}`);return t})}const XI=new Pt(e=>e),q=Kh("string"),H=Kh("number").check(e=>{if(Number.isNaN(e))throw new Me("Expected a number, got NaN");if(!Number.isFinite(e))throw new Me(`Expected a finite number, got ${e}`)}),Ar=H.check(e=>{if(e<0)throw new Me(`Expected a positive number, got ${e}`)}),Ve=H.check(e=>{if(e<=0)throw new Me(`Expected a non-zero positive number, got ${e}`)}),hS=H.check(e=>{if(!Number.isInteger(e))throw new Me(`Expected an integer, got ${e}`)}),Ra=hS.check(e=>{if(e<0)throw new Me(`Expected a positive integer, got ${e}`)}),qI=hS.check(e=>{if(e<=0)throw new Me(`Expected a non-zero positive integer, got ${e}`)}),le=Kh("boolean");function Ot(e){return new Pt(t=>{if(t!==e)throw new Me(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}const ZI=new Pt(e=>{if(!Array.isArray(e))throw new Me(`Expected an array, got ${vs(e)}`);return e});function Ze(e){return new GI(e)}function ge(e){return new Xc(e)}function mf(e){return e===null||typeof e=="number"||typeof e=="string"||typeof e=="boolean"?!0:Array.isArray(e)?e.every(mf):typeof e=="object"?Object.values(e).every(mf):!1}const ir=new Pt(e=>{if(mf(e))return e;throw new Me(`Expected json serializable value, got ${typeof e}`)});function bs(e,t){return new YI(e,t)}function Wh(e,t){return new Vh(e,t,(n,r)=>{throw new Me(`Expected one of ${Object.keys(t).map(o=>JSON.stringify(o)).join(" or ")}, got ${JSON.stringify(r)}`,[e])})}function fr(e,t){return new Pt(n=>{const r=n&&typeof n=="object"&&"id"in n&&typeof n.id=="string"?`${e}(id = ${n.id})`:e;return js(r,()=>t.validate(n))})}function ea(e){return new Pt(t=>{if(!e.has(t)){const n=Array.from(e,r=>JSON.stringify(r)).join(" or ");throw new Me(`Expected ${n}, got ${t}`)}return t})}function qt(e){return new Pt(t=>{if(t!==void 0)return e.validate(t)})}function _i(e){return new Pt(t=>t===null?null:e.validate(t))}function Ds(...e){return ea(new Set(e))}function En(e){return q.refine(t=>{if(!t.startsWith(`${e}:`))throw new Error(`${e} ID must start with "${e}:"`);return t})}const Ss=En("asset");function Hh(e,t){return ge({id:Ss,typeName:Ot("asset"),type:Ot(e),props:t,meta:ir})}const QI=fr("camera",ge({typeName:Ot("camera"),id:En("camera"),x:H,y:H,z:H,meta:ir})),Mm={AddMeta:1},JI=he({currentVersion:Mm.AddMeta,migrators:{[Mm.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),pt=dr("camera",{validator:QI,migrations:JI,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),hn=ge({x:H,y:H,z:H.optional()}),Ii=ge({x:H,y:H,w:H,h:H}),ek=new Set(["none","default","pointer","cross","grab","grabbing","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out","custom"]),pS=ea(ek),tk=ge({type:pS,rotation:H,custom:qt(q)}),gS=H.check(e=>{if(e<0||e>1)throw new Me("Opacity must be between 0 and 1")}),nk=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),rk=ea(nk),ok=new Set(["starting","paused","active","stopping"]),mS=ge({id:q,points:Ze(hn),size:Ar,color:rk,opacity:H,state:ea(ok),delay:H,shrink:H,taper:le}),Di=En("page"),sk=fr("page",ge({typeName:Ot("page"),id:Di,name:q,index:q,meta:ge({type:Ds("freeform","manga","webtoon")})})),Mu={AddMeta:1,AddType:2},ik=he({currentVersion:Mu.AddType,migrators:{[Mu.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[Mu.AddType]:{up:e=>({...e,meta:{type:"freeform"}}),down:({meta:e,...t})=>({...t})}}}),Lr=dr("page",{validator:sk,migrations:ik,scope:"document"}).withDefaultProperties(()=>({meta:{type:"freeform"}}));function Lt(e){return Lr.isId(e)}En("instance");function ak(e){const t={};for(const[r,o]of e)t[r]=qt(o);const n=fr("instance",ge({typeName:Ot("instance"),id:En("instance"),currentPageId:Di,followingUserId:q.nullable(),brush:Ii.nullable(),opacityForNextShape:gS,stylesForNextShape:ge(t),cursor:tk,scribbles:Ze(mS),isFocusMode:le,isDebugMode:le,isToolLocked:le,exportBackground:le,screenBounds:Ii,zoomBrush:Ii.nullable(),isPenMode:le,isGridMode:le,chatMessage:q,isChatting:le,highlightedUserIds:Ze(q),canMoveCamera:le,isFocused:le,devicePixelRatio:H,isCoarsePointer:le,isHoveringCanvas:le.nullable(),openMenus:Ze(q),isChangingStyle:le,isReadonly:le,meta:ir}));return dr("instance",{migrations:ck,validator:n,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}const We={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22},ck=he({currentVersion:We.AddScribbles,migrators:{[We.AddTransparentExportBgs]:{up:e=>({...e,exportBackground:!0}),down:({exportBackground:e,...t})=>t},[We.RemoveDialog]:{up:({dialog:e,...t})=>t,down:e=>({...e,dialog:null})},[We.AddToolLockMode]:{up:e=>({...e,isToolLocked:!1}),down:({isToolLocked:e,...t})=>t},[We.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))}),down:e=>e},[We.AddLabelColor]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:{...n}}}},[We.AddFollowingUserId]:{up:e=>({...e,followingUserId:null}),down:({followingUserId:e,...t})=>t},[We.RemoveAlignJustify]:{up:e=>{let t=e.propsForNextShape.align;return t==="justify"&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},[We.AddZoom]:{up:e=>({...e,zoomBrush:null}),down:({zoomBrush:e,...t})=>t},[We.AddVerticalAlign]:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:n}}},[We.AddScribbleDelay]:{up:e=>e.scribble!==null?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(e.scribble!==null){const{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[We.RemoveUserId]:{up:({userId:e,...t})=>t,down:e=>({...e,userId:"user:none"})},[We.AddIsPenModeAndIsGridMode]:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:({isPenMode:e,isGridMode:t,...n})=>n},[We.HoistOpacity]:{up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t}),down:({opacityForNextShape:e,...t})=>({...t,propsForNextShape:{...t.propsForNextShape,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[We.AddChat]:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:({chatMessage:e,isChatting:t,...n})=>n},[We.AddHighlightedUserIds]:{up:e=>({...e,highlightedUserIds:[]}),down:({highlightedUserIds:e,...t})=>t},[We.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}}),down:({stylesForNextShape:e,...t})=>({...t,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[We.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[We.RemoveCursorColor]:{up:e=>{const{color:t,...n}=e.cursor;return{...e,cursor:n}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},[We.AddLonelyProperties]:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:e,isFocused:t,devicePixelRatio:n,isCoarsePointer:r,openMenus:o,isChangingStyle:s,isReadOnly:i,...a})=>({...a})},[We.ReadOnlyReadonly]:{up:({isReadOnly:e,...t})=>({...t,isReadonly:e}),down:({isReadonly:e,...t})=>({...t,isReadOnly:e})},[We.AddHoveringCanvas]:{up:e=>({...e,isHoveringCanvas:null}),down:({isHoveringCanvas:e,...t})=>({...t})},[We.AddScribbles]:{up:({scribble:e,...t})=>({...t,scribbles:[]}),down:({scribbles:e,...t})=>({...t,scribble:null})}}}),yt="instance:instance",lk=q.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return e}),Tt=En("shape");function uk(e,t,n){return ge({id:Tt,typeName:Ot("shape"),x:H,y:H,rotation:H,index:q,parentId:lk,type:Ot(e),isLocked:le,opacity:gS,props:t?ge(t):ir,meta:n?ge(n):ir})}const dk=fr("instance_page_state",ge({typeName:Ot("instance_page_state"),id:En("instance_page_state"),pageId:Di,selectedShapeIds:Ze(Tt),hintingShapeIds:Ze(Tt),erasingShapeIds:Ze(Tt),hoveredShapeId:Tt.nullable(),editingShapeId:Tt.nullable(),croppingShapeId:Tt.nullable(),focusedGroupId:Tt.nullable(),meta:ir})),Do={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},fk=he({currentVersion:Do.RenamePropertiesAgain,migrators:{[Do.AddCroppingId]:{up(e){return{...e,croppingShapeId:null}},down({croppingShapeId:e,...t}){return t}},[Do.RemoveInstanceIdAndCameraId]:{up({instanceId:e,cameraId:t,...n}){return n},down(e){return{...e,instanceId:yt,cameraId:pt.createId("void")}}},[Do.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[Do.RenameProperties]:{up:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:o,editingShapeId:s,croppingShapeId:i,focusedGroupId:a,...c}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:o,editingShapeId:s,croppingShapeId:i,focusedGroupId:a,...c}},down:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:o,editingShapeId:s,croppingShapeId:i,focusedGroupId:a,...c}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:o,editingShapeId:s,croppingShapeId:i,focusedGroupId:a,...c}}},[Do.RenamePropertiesAgain]:{up:e=>{const{selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:o,editingId:s,croppingShapeId:i,croppingId:a,focusLayerId:c,...l}=e;return{...l,selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:o,editingShapeId:s,croppingShapeId:i??a??null,focusedGroupId:c}},down:e=>{const{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:o,editingShapeId:s,croppingShapeId:i,focusedGroupId:a,...c}=e;return{...c,selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:o,editingId:s,croppingId:i,focusLayerId:a}}}}}),gt=dr("instance_page_state",{migrations:fk,validator:dk,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),hk=fr("pointer",ge({typeName:Ot("pointer"),id:En("pointer"),x:H,y:H,lastActivityTimestamp:H,meta:ir})),Om={AddMeta:1},pk=he({currentVersion:Om.AddMeta,migrators:{[Om.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),Gh=dr("pointer",{validator:hk,migrations:pk,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),qc=Gh.createId("pointer"),gk=fr("instance_presence",ge({typeName:Ot("instance_presence"),id:En("instance_presence"),userId:q,userName:q,lastActivityTimestamp:H,followingUserId:q.nullable(),cursor:ge({x:H,y:H,type:pS,rotation:H}),color:q,camera:ge({x:H,y:H,z:H}),screenBounds:Ii,selectedShapeIds:Ze(En("shape")),currentPageId:En("page"),brush:Ii.nullable(),scribbles:Ze(mS),chatMessage:q,meta:ir})),No={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},mk=he({currentVersion:No.RenameSelectedShapeIds,migrators:{[No.AddScribbleDelay]:{up:e=>e.scribble!==null?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(e.scribble!==null){const{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[No.RemoveInstanceId]:{up:({instanceId:e,...t})=>t,down:e=>({...e,instanceId:yt})},[No.AddChatMessage]:{up:e=>({...e,chatMessage:""}),down:({chatMessage:e,...t})=>t},[No.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[No.RenameSelectedShapeIds]:{up:e=>{const{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}},down:e=>{const{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}}}}}),yk=dr("instance_presence",{migrations:mk,validator:gk,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),vk=fr("document",ge({typeName:Ot("document"),id:Ot("document:document"),gridSize:H,name:q,meta:ir})),Ou={AddName:1,AddMeta:2},bk=he({currentVersion:Ou.AddMeta,migrators:{[Ou.AddName]:{up:e=>({...e,name:""}),down:({name:e,...t})=>t},[Ou.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),Yh=dr("document",{migrations:bk,validator:vk,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),yf=Yh.createId("document");function Sk(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function Rm(e){e.typeName==="asset"&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}const xk=({error:e,phase:t,record:n,recordBefore:r})=>{throw Lh(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:t==="initialize"},extras:{recordBefore:r?Rm(vo(r)):void 0,recordAfter:Rm(vo(n))}}),e};function wk(){return[Lr.create({id:"page:page",name:"Workspace 1",index:"a1",meta:{type:"freeform"}})]}function Ck(e){const t=e.query.ids("page"),n=()=>{if(!e.has(yf))return e.put([Yh.create({id:yf,name:e.props.defaultName})]),n();if(!e.has(qc))return e.put([Gh.create({id:qc})]),n();const r=t.get();if(r.size===0)return e.put(wk()),n();const o=()=>[...r].map(c=>e.get(c)).sort(Sk)[0].id,s=e.get(yt);if(s){if(!r.has(s.currentPageId))return e.put([{...s,currentPageId:o()}]),n()}else return e.put([e.schema.types.instance.create({id:yt,currentPageId:o(),exportBackground:!0})]),n();const i=new Set,a=new Set;for(const c of r){const l=gt.createId(c);e.has(l)||i.add(l);const u=pt.createId(c);e.has(u)||a.add(u)}i.size>0&&e.put([...i].map(c=>gt.create({id:c,pageId:gt.parseId(c)}))),a.size>0&&e.put([...a].map(c=>pt.create({id:c})))};return n}const Pk=Hh("bookmark",ge({title:q,description:q,image:q,src:q.nullable()})),Ek=he({}),_k=Hh("image",ge({w:H,h:H,name:q,isAnimated:le,mimeType:q.nullable(),src:q.nullable()})),Ru={AddIsAnimated:1,RenameWidthHeight:2},Ik=he({currentVersion:Ru.RenameWidthHeight,migrators:{[Ru.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{const{isAnimated:t,...n}=e.props;return{...e,props:n}}},[Ru.RenameWidthHeight]:{up:e=>{const{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{const{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}}}}),kk=Hh("video",ge({w:H,h:H,name:q,isAnimated:le,mimeType:q.nullable(),src:q.nullable()})),ju={AddIsAnimated:1,RenameWidthHeight:2},Tk=he({currentVersion:ju.RenameWidthHeight,migrators:{[ju.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{const{isAnimated:t,...n}=e.props;return{...e,props:n}}},[ju.RenameWidthHeight]:{up:e=>{const{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{const{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}}}}),$k=fr("asset",Wh("type",{image:_k,video:kk,bookmark:Pk})),jm={AddMeta:1},Ak=he({subTypeKey:"type",subTypeMigrations:{image:Ik,video:Tk,bookmark:Ek},currentVersion:jm.AddMeta,migrators:{[jm.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),Ol=dr("asset",{migrations:Ak,validator:$k,scope:"document"}).withDefaultProperties(()=>({meta:{}}));let Mk=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");class De{constructor(t,n,r){this.id=t,this.defaultValue=n,this.type=r}static define(t,n){const{defaultValue:r,type:o=XI}=n;return new De(t,r,o)}static defineEnum(t,n){const{defaultValue:r,values:o}=n;return new Ok(t,r,o)}validate(t){return this.type.validate(t)}}class Ok extends De{constructor(t,n,r){super(t,n,Ds(...r)),this.values=r}}const ja={AddIsLocked:1,HoistOpacity:2,AddMeta:3},Du=he({currentVersion:ja.AddMeta,migrators:{[ja.AddIsLocked]:{up:e=>({...e,isLocked:!1}),down:e=>{const{isLocked:t,...n}=e;return{...n}}},[ja.HoistOpacity]:{up:({props:{opacity:e,...t},...n})=>({...n,opacity:Number(e??"1"),props:t}),down:({opacity:e,...t})=>({...t,props:{...t.props,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[ja.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}});function go(e){return e?e.typeName==="shape":!1}function Sn(e){return e?e.startsWith("shape:"):!1}function Ln(e){return`shape:${e??Mk()}`}function yS(e){const t=new Map;for(const[n,r]of Object.entries(e))if(r instanceof De){if(t.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}function Rk(e){return dr("shape",{migrations:he({currentVersion:Du.currentVersion,firstVersion:Du.firstVersion,migrators:Du.migrators,subTypeKey:"type",subTypeMigrations:km(e,(t,n)=>n.migrations??he({}))}),scope:"document",validator:fr("shape",Wh("type",km(e,(t,{props:n,meta:r})=>uk(t,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}const ei={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},jk=he({currentVersion:ei.RemoveUserDocument,migrators:{[ei.RemoveCodeAndIconShapeTypes]:{up:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n.typeName!=="shape"||n.type!=="icon"&&n.type!=="code")),down:e=>e},[ei.AddInstancePresenceType]:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n.typeName!=="instance_presence"))},[ei.RemoveTLUserAndPresenceAndAddPointer]:{up:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>!n.typeName.match(/^(user|user_presence)$/))),down:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>n.typeName!=="pointer"))},[ei.RemoveUserDocument]:{up:e=>Object.fromEntries(Object.entries(e).filter(([t,n])=>!n.typeName.match("user_document"))),down:e=>e}}});function Dk({shapes:e}){const t=new Map;for(const o of qe(e))for(const s of yS(o.props??{}).keys()){if(t.has(s.id)&&t.get(s.id)!==s)throw new Error(`Multiple StyleProp instances with the same id: ${s.id}`);t.set(s.id,s)}const n=Rk(e),r=ak(t);return Uh.create({asset:Ol,camera:pt,document:Yh,instance:r,instance_page_state:gt,page:Lr,shape:n,instance_presence:yk,pointer:Gh},{snapshotMigrations:jk,onValidationFailure:xk,createIntegrityChecker:Ck})}const vS=ge({tl:Ar,tr:Ar,br:Ar,bl:Ar}),Nk=new Set(["vertex","virtual","create"]),Rl=ge({id:q,type:ea(Nk),canBind:le.optional(),canSnap:le.optional(),index:q,x:H,y:H}),jl=De.define("ps:borderWidth",{type:H,defaultValue:3.5}),Xh=De.define("ps:fontSize",{type:H,defaultValue:24}),Nu=De.defineEnum("ps:richFont",{defaultValue:"YasashisaAntique",values:["YasashisaAntique"]}),Ni=De.defineEnum("ps:writingMode",{defaultValue:"horizontal-tb",values:["horizontal-tb","vertical-lr","vertical-rl"]}),bS=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],Dm={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function Dl(e){return e.isDarkMode?Dm.darkMode:Dm.lightMode}const Zt=De.defineEnum("tldraw:color",{defaultValue:"black",values:bS}),Lk=De.defineEnum("tldraw:labelColor",{defaultValue:"black",values:bS}),Fn=De.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Bn=De.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),QG={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},xs=De.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),ws=De.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Fk={s:2,m:3.5,l:5,xl:10},Bk={s:18,m:24,l:36,xl:44},qh=()=>({up:e=>{const t=e.props.size||"m",n=Bk[t],r=Fk[t],{size:o,...s}=e.props;return{...e,props:{...s,fontSize:n,strokeWidth:r}}},down:e=>({...e,props:{...e.props,size:"m"}})}),JG={w:H,h:H,fontSize:Xh,strokeWidth:jl,font:Bn,strokeColor:q,backgroundColor:q,textColor:q,textStrokeColor:q,writingMode:Ni,align:xs,verticalAlign:ws,growY:Ar,text:q,tail:hn,dash:Fn,cornerRadius:vS,outline:Ds("rect"),handles:bs(q,Rl)},Zn={ChangeFontToRichFont:1,AddWritingMode:2,AddCornerRadius:3,FixWritingMode:4,ChangeRichFontDefaultFont:5,MigrateDedicatedSizeStyle:6,ChangeBackToFont:7,AddColorControls:8},eY=he({currentVersion:Zn.AddColorControls,migrators:{[Zn.ChangeFontToRichFont]:{up:e=>{const{font:t,...n}=e.props;return{...e,props:{...n,richFont:Nu.defaultValue}}},down:e=>{const{richFont:t,...n}=e.props;return{...e,props:{...n,font:Bn.defaultValue}}}},[Zn.AddWritingMode]:{up:e=>{const{writingMode:t,...n}=e.props;return{...e,props:{...n,writingMode:Ni.defaultValue}}},down:e=>{const{writingMode:t,...n}=e.props;return{...e,props:{...n,writingMode:void 0}}}},[Zn.AddCornerRadius]:{up:e=>{const{cornerRadius:t,...n}=e.props;return{...e,props:{...n,cornerRadius:{tl:0,tr:0,br:0,bl:0}}}},down:e=>{const{cornerRadius:t,...n}=e.props;return{...e,props:{...n,cornerRadius:void 0}}}},[Zn.FixWritingMode]:{up:e=>{const{writingMode:t,...n}=e.props;return{...e,props:{...n,writingMode:Ni.defaultValue}}},down:e=>{const{writingMode:t,...n}=e.props;return{...e,props:{...n,writingMode:void 0}}}},[Zn.ChangeRichFontDefaultFont]:{up:e=>{const{richFont:t,...n}=e.props;return{...e,props:{...n,richFont:Nu.defaultValue}}},down:e=>{const{richFont:t,...n}=e.props;return{...e,props:{...n,richFont:"07YasashisaAntique"}}}},[Zn.MigrateDedicatedSizeStyle]:qh(),[Zn.ChangeBackToFont]:{up:e=>{const{richFont:t,...n}=e.props;return{...e,props:{...n,font:Bn.defaultValue}}},down:e=>{const{font:t,...n}=e.props;return{...e,props:{...n,richFont:Nu.defaultValue}}}},[Zn.AddColorControls]:{up:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,strokeColor:"#000000",backgroundColor:"#ffffff",textColor:"#000000",textStrokeColor:"#ffffff"}}},down:e=>{const{strokeColor:t,backgroundColor:n,textColor:r,textStrokeColor:o,...s}=e.props;return{...e,props:{...s,color:Zt.defaultValue}}}}}}),tY={w:H,h:H,fadeFrom:H,fadeFromOpacity:H,minStrokeWidth:H,maxStrokeWidth:H,minSpaceWidth:H,maxSpaceWidth:H,color:q,seed:H,centerX:H,centerY:H,centerWidth:H,centerHeight:H},nY=he({}),Nm=ge({x:H,y:H,i:H}),rY={start:Nm,end:Nm,frame1:Tt,frame2:qt(Tt)},oY=he({}),sY={w:Ve,h:Ve,pending:le},iY=he({}),SS=De.defineEnum("ps:flip",{defaultValue:"none",values:["none","x","y","both"]}),zk=ge({topLeft:hn,bottomRight:hn}),aY={w:Ve,h:Ve,playing:le,pending:q.nullable(),alert:q.nullable(),currentAssetId:Ss.nullable(),crop:zk.nullable(),prompts:q.nullable(),shouldReceiveMarker:le,isInpaint:le,derivationOfShape:Tt.nullable(),blurIntensity:qt(H),blurDirection:qt(H),flip:SS,assetIds:Ze(Ss)},Cr={AddAlert:1,AddPrompts:2,AddShouldReceiveMarker:3,AddIsInpaint:4,ChangePendingToString:5,AddDerivationOfShape:6,AddFlip:7},cY=he({currentVersion:Cr.AddFlip,migrators:{[Cr.AddAlert]:{up:e=>({...e,props:{...e.props,alert:null}}),down:e=>{const{alert:t,...n}=e.props;return{...e,props:n}}},[Cr.AddPrompts]:{up:e=>({...e,props:{...e.props,prompts:null}}),down:e=>{const{prompts:t,...n}=e.props;return{...e,props:n}}},[Cr.AddShouldReceiveMarker]:{up:e=>({...e,props:{...e.props,shouldReceiveMarker:!0}}),down:e=>{const{shouldReceiveMarker:t,...n}=e.props;return{...e,props:n}}},[Cr.AddIsInpaint]:{up:e=>{var t;return{...e,props:{...e.props,isInpaint:!!((t=e.meta)!=null&&t.inpaintOfShape)}}},down:e=>{const{isInpaint:t,...n}=e.props;return{...e,props:n}}},[Cr.ChangePendingToString]:{up:e=>({...e,props:{...e.props,pending:e.props.pending===!0?"PENDING":null}}),down:e=>({...e,props:{...e.props,pending:!!e.props.pending}})},[Cr.AddDerivationOfShape]:{up:e=>({...e,props:{...e.props,derivationOfShape:null}}),down:e=>{const{derivationOfShape:t,...n}=e.props;return{...e,props:n}}},[Cr.AddFlip]:{up:e=>({...e,props:{...e.props,flip:"none"}}),down:e=>{const{flip:t,...n}=e.props;return{...e,props:n}}}}}),lY={isComplete:le,w:Ve,h:Ve,handles:bs(q,Rl)},Lu={AddHandles:1,RemoveName:2},uY=he({currentVersion:Lu.RemoveName,migrators:{[Lu.AddHandles]:{up:e=>{const{points:t,...n}=e.props,r=t.map((o,s)=>({id:`point-${s}`,type:"vertex",canBind:!0,canSnap:!0,index:`a${s}`,x:o.x,y:o.y}));return{...e,props:{...n,handles:r}}},down:e=>{const{handles:t,...n}=e.props;return{...e,props:n}}},[Lu.RemoveName]:{up:e=>{const{name:t,...n}=e.props;return{...e,props:n}},down:e=>{const{...t}=e.props;return{...e,props:{...t,name:"Polygon Frame"}}}}}}),Ns=De.define("ps:markerColor",{type:q,defaultValue:"#FDDD00B4"}),Zh=De.define("ps:markerIsPaint",{type:le,defaultValue:!1}),Uk=De.defineEnum("ps:markerGeo",{defaultValue:"rectangle",values:["rectangle","ellipse","oval"]}),dY={geo:Uk,w:Ve,h:Ve,color:Ns,isPaint:Zh},Fu={ColorPen:1,AddIsPaint:2},fY=he({currentVersion:Fu.AddIsPaint,migrators:{[Fu.AddIsPaint]:{up:e=>{const{isPen:t,...n}=e.props;return{...e,props:{...n,isPaint:!1}}},down:e=>{const{isPaint:t,...n}=e.props;return{...e,props:{...n,isPen:!1}}}},[Fu.ColorPen]:{up:e=>{const{...t}=e.props;return{...e,props:{...t,color:Ns.defaultValue,isPen:!1}}},down:e=>{const{color:t,isPen:n,...r}=e.props;return{...e,props:r}}}}}),hY={color:Ns,points:Ze(hn),isComplete:le,isPaint:Zh},Bu={MarkerColor:1,AddIsPaint:2},pY=he({currentVersion:Bu.AddIsPaint,migrators:{[Bu.AddIsPaint]:{up:e=>{const{...t}=e.props;return{...e,props:{...t,isPaint:!1}}},down:e=>{const{isPaint:t,...n}=e.props;return{...e,props:n}}},[Bu.MarkerColor]:{up:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,color:Ns.defaultValue}}},down:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,color:"yellow"}}}}}}),Cs=De.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),Fr=De.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Qh=ge({type:Ds("free","straight"),points:Ze(hn)}),gY={color:Zt,fill:Cs,dash:Fn,size:Fr,segments:Ze(Qh),isComplete:le,isClosed:le,isPen:le},Lm={AddInPen:1},mY=he({currentVersion:Lm.AddInPen,migrators:{[Lm.AddInPen]:{up:e=>{const{points:t}=e.props.segments[0];if(t.length===0)return{...e,props:{...e.props,isPen:!1}};let n=!(t[0].z===0||t[0].z===.5);return t[1]&&(n=n&&!(t[1].z===0||t[1].z===.5)),{...e,props:{...e.props,isPen:n}}},down:e=>{const{isPen:t,...n}=e.props;return{...e,props:{...n}}}}}}),Vk=De.define("ps:markerWidth",{type:H,defaultValue:50}),yY={color:Ns,width:Vk,segments:Ze(Qh),isComplete:le,isPaint:Zh,isPen:le},ti={ReplaceSizeToWidth:1,AnyColor:2,RemoveOpacity:3,AddIsPaint:4},vY=he({currentVersion:ti.AddIsPaint,migrators:{[ti.AddIsPaint]:{up:e=>{const{...t}=e.props;return{...e,props:{...t,isPaint:!1}}},down:e=>{const{isPaint:t,...n}=e.props;return{...e,props:n}}},[ti.RemoveOpacity]:{up:e=>{const{opacity:t,...n}=e.props;return{...e,props:n}},down:e=>({...e,props:{...e.props,opacity:.7}})},[ti.AnyColor]:{up:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,color:Ns.defaultValue}}},down:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,color:"yellow"}}}},[ti.ReplaceSizeToWidth]:{up:e=>{const{size:t,...n}=e.props;return{...e,props:{...n,width:50}}},down:e=>{const{width:t,...n}=e.props;return{...e,props:{...n,size:"m"}}}}}}),Kk=["nose","neck","right_shoulder","right_elbow","right_wrist","left_shoulder","left_elbow","left_wrist","right_hip","right_knee","right_ankle","left_hip","left_knee","left_ankle","right_eye","left_eye","right_ear","left_ear"],Fm=["thumb","index","middle","ring","pinky"].flatMap(e=>Array.from({length:4},(t,n)=>e+"_"+(n+1))),Wk=[...[["face_outline",17],["left_eyebrow",5],["right_eyebrow",5],["nose_bridge",4],["nose_bottom",5],["left_eye_outline",6],["right_eye_outline",6],["mouth_outer_bound",12],["mouth_inner_bound",8]].flatMap(([e,t])=>Array.from({length:t},(n,r)=>e+"_"+(r+1)))],Da=ge({x:H,y:H,c:H}),Hk={body:Ze(Da).check(e=>{if(e.length!==Kk.length)throw new Me("Body keypoints length is not correct")}),handLeft:_i(Ze(Da).check(e=>{if(e.length!==Fm.length)throw new Me("Left hand keypoints length is not correct")})),handRight:_i(Ze(Da).check(e=>{if(e.length!==Fm.length)throw new Me("Right hand keypoints length is not correct")})),face:_i(Ze(Da).check(e=>{if(e.length!==Wk.length)throw new Me("Face keypoints length is not correct")}))},Gk=he({}),bY={w:H,h:H,backgroundColor:q,strokeColor:q,strokeWidth:jl,writingMode:qt(q),data:q,tail:hn,dash:Fn,cornerRadius:vS,outline:Ds("rect"),handles:bs(q,Rl)},zu={RemoveSvgProp:1,AddColorControls:2},SY=he({currentVersion:zu.AddColorControls,migrators:{[zu.RemoveSvgProp]:{up:e=>{const{svg:t,...n}=e.props;return{...e,props:n}},down:e=>{const{...t}=e.props;return{...e,props:{...t,svg:""}}}},[zu.AddColorControls]:{up:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,backgroundColor:"#ffffff",strokeColor:"#000000"}}},down:e=>{const{textColor:t,textStrokeColor:n,backgroundColor:r,strokeColor:o,...s}=e.props;return{...e,props:{...s,color:Zt.defaultValue}}}}}}),xY={w:H,h:H,data:q,writingMode:qt(q),background:_i(ge({flipped:le,strokeColor:q,strokeWidth:H,backgroundColor:q,shapeType:Ds("dialog","geo"),shapeName:q,dash:qt(Fn)}))},Uu={RemoveSvgProp:1,AddBackgroundProp:2},wY=he({currentVersion:Uu.AddBackgroundProp,migrators:{[Uu.RemoveSvgProp]:{up:e=>{const{svg:t,...n}=e.props;return{...e,props:n}},down:e=>{const{...t}=e.props;return{...e,props:{...t,svg:""}}}},[Uu.AddBackgroundProp]:{up:e=>({...e,props:{...e.props,background:null}}),down:e=>{const{background:t,...n}=e.props;return{...e,props:n}}}}}),CY={w:H,h:H,length:H,fadeFrom:H,minStrokeWidth:H,maxStrokeWidth:H,minSpaceWidth:H,maxSpaceWidth:H,color:q,seed:H},PY=he({}),xS=De.defineEnum("ps:svgType",{defaultValue:"dialog",values:["dialog","onomatopoeia"]}),Yk=ge({topLeft:hn,bottomRight:hn}),EY={w:Ve,h:Ve,shapeType:q,crop:Yk.nullable(),blurIntensity:qt(H),blurDirection:qt(H),flipped:le,strokeColor:q,strokeWidth:H,backgroundColor:q,type:xS},Vu={FixTypoOfFlipped:1,AddType:2},_Y=he({currentVersion:Vu.AddType,migrators:{[Vu.FixTypoOfFlipped]:{up:e=>{const{fliped:t,...n}=e.props;return{...e,props:{...n,flipped:t}}},down:e=>{const{flipped:t,...n}=e.props;return{...e,props:{...n,fliped:t}}}},[Vu.AddType]:{up:e=>({...e,props:{...e.props,type:"dialog"}}),down:e=>{const{type:t,...n}=e.props;return{...e,props:{...n}}}}}}),wS=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Zc=De.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:wS}),Qc=De.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:wS}),Bm=Wh("type",{binding:ge({type:Ot("binding"),boundShapeId:Tt,normalizedAnchor:hn,isExact:le,isPrecise:le}),point:ge({type:Ot("point"),x:H,y:H})}),IY={labelColor:Lk,color:Zt,fill:Cs,dash:Fn,size:Fr,arrowheadStart:Zc,arrowheadEnd:Qc,font:Bn,start:Bm,end:Bm,bend:H,text:q},Ku={AddLabelColor:1,AddIsPrecise:2},kY=he({currentVersion:Ku.AddIsPrecise,migrators:{[Ku.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.props;return{...e,props:n}}},[Ku.AddIsPrecise]:{up:e=>{const{start:t,end:n}=e.props;return{...e,props:{...e.props,start:t.type==="binding"?{...t,isPrecise:!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)}:t,end:n.type==="binding"?{...n,isPrecise:!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)}:n}}},down:e=>{const{start:t,end:n}=e.props,r={...t},o={...n};return r.type==="binding"&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),o.type==="binding"&&(o.isPrecise||(o.normalizedAnchor={x:.5,y:.5}),delete o.isPrecise),{...e,props:{...e.props,start:r,end:o}}}}}}),Xk={w:Ve,h:Ve,assetId:Ss.nullable(),url:q},zm={NullAssetId:1},qk=he({currentVersion:zm.NullAssetId,migrators:{[zm.NullAssetId]:{up:e=>e.props.assetId===void 0?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(e.props.assetId===null){const{assetId:t,...n}=e.props;return{...e,props:n}}return e}}}});var Zk={};const Um=/(^\/r\/[^/]+\/?$)/,Ae=e=>{try{return new URL(e)}catch{return}},Ps=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(Um))return e},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(Um))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/embed\/?$/)){const n=t.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){const t=e.match(/@(.*),(.*),(.*)z/);let n;if(t){const[,r,o,s]=t;n=`https://${new URL(e).host.replace("www.","")}/maps/embed/v1/view?key=${Zk.NEXT_PUBLIC_GC_API_KEY}&center=${r},${o}&zoom=${s}`}else n="";return n}},fromEmbedUrl:e=>{const t=Ae(e);if(!t)return;if(t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){const r=t.searchParams.get("zoom"),[o,s]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${s},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ae(e),n=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{const t=Ae(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ae(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{const t=Ae(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=e.match(t);if(n){const[r,o,s]=n;return`https://codepen.io/${o}/embed/${s}`}},fromEmbedUrl:e=>{const t=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=e.match(t);if(n){const[r,o,s]=n;return`https://codepen.io/${o}/pen/${s}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{const t=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=e.match(t);if(n){const[r,o]=n;return`https://scratch.mit.edu/projects/embed/${o}`}},fromEmbedUrl:e=>{const t=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=e.match(t);if(n){const[r,o]=n;return`https://scratch.mit.edu/projects/${o}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Ae(e);if(!t)return;const n=t.hostname.replace(/^www./,"");if(n==="youtu.be")return`https://www.youtube.com/embed/${t.pathname.split("/").filter(Boolean)[0]}`;if((n==="youtube.com"||n==="m.youtube.com")&&t.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${t.searchParams.get("v")}`},fromEmbedUrl:e=>{const t=Ae(e);if(!t)return;if(t.hostname.replace(/^www./,"")==="youtube.com"){const r=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{const t=Ae(e),n=t==null?void 0:t.searchParams.get("cid");if(t!=null&&t.pathname.match(/\/calendar\/u\/0/)&&n){t.pathname="/calendar/embed";const r=Array.from(t.searchParams.keys());for(const o of r)t.searchParams.delete(o);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{const t=Ae(e),n=t==null?void 0:t.searchParams.get("src");if(t!=null&&t.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";const r=Array.from(t.searchParams.keys());for(const o of r)t.searchParams.delete(o);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ae(e);if(t!=null&&t.pathname.match(/^\/presentation/)&&(t!=null&&t.pathname.match(/\/pub\/?$/))){t.pathname=t.pathname.replace(/\/pub$/,"/embed");const n=Array.from(t.searchParams.keys());for(const r of n)t.searchParams.delete(r);return t.href}},fromEmbedUrl:e=>{const t=Ae(e);if(t!=null&&t.pathname.match(/^\/presentation/)&&(t!=null&&t.pathname.match(/\/embed\/?$/))){t.pathname=t.pathname.replace(/\/embed$/,"/pub");const n=Array.from(t.searchParams.keys());for(const r of n)t.searchParams.delete(r);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return e.split("/").pop()?e:void 0},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/))return e.split("/").pop()?e:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.hostname==="vimeo.com"&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.hostname==="player.vimeo.com"){const n=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{const t=Ae(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${n}?cell=*`}},fromEmbedUrl:e=>{const t=Ae(e);if(t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","")}#cell-*`;if(t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`}}],TY={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},$Y={w:Ve,h:Ve,url:q},ni={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},AY=he({currentVersion:ni.RemovePermissionOverrides,migrators:{[ni.GenOriginalUrlInEmbed]:{up:e=>{const t=e.props.url,n=new URL(t).host.replace("www.","");let r;for(const o of Ps)if(o.hostnames.includes(n))try{r=o.fromEmbedUrl(t)}catch(s){console.warn(s)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:r??""}}},down:e=>{let t=e.props.tmpOldUrl;if(!t||t===""){const o=e.props.url,s=new URL(o).host.replace("www.","");for(const i of Ps)if(i.hostnames.includes(s))try{t=i.toEmbedUrl(o)}catch(a){console.warn(a)}}const{tmpOldUrl:n,...r}=e.props;return{...e,props:{...r,url:t??""}}}},[ni.RemoveDoesResize]:{up:e=>{const{doesResize:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},[ni.RemoveTmpOldUrl]:{up:e=>{const{tmpOldUrl:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})},[ni.RemovePermissionOverrides]:{up:e=>{const{overridePermissions:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})}}}),MY={w:Ve,h:Ve,name:q},OY=he({}),Es=De.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),RY={geo:Es,fill:Cs,dash:Fn,fontSize:Xh,strokeWidth:jl,backgroundColor:q,strokeColor:q,textColor:q,textStrokeColor:q,font:Bn,align:xs,verticalAlign:ws,url:q,w:Ve,h:Ve,growY:Ar,text:q,writingMode:Ni},sn={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MigrateDedicatedSizeStyle:8,ColorRename:9,AddTextStrokeColor:10,AddWritingMode:11},jY=he({currentVersion:sn.AddWritingMode,migrators:{[sn.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[sn.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{const{labelColor:t,...n}=e.props;return{...e,props:n}}},[sn.RemoveJustify]:{up:e=>{let t=e.props.align;return t==="justify"&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[sn.AddCheckBox]:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:e.props.geo==="check-box"?"rectangle":e.props.geo}})},[sn.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[sn.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy";break}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[sn.AddCloud]:{up:e=>e,down:e=>{if(e.props.geo==="cloud")return{...e,props:{...e.props,geo:"rectangle"}}}},[sn.MigrateDedicatedSizeStyle]:qh(),[sn.ColorRename]:{up:e=>{const{color:t,labelColor:n,...r}=e.props;return{...e,props:{...r,backgroundColor:"#ffffff",strokeColor:"black",textColor:n}}},down:e=>({...e,props:{...e.props,color:e.props.backgroundColor,labelColor:e.props.textColor}})},[sn.AddTextStrokeColor]:{up:e=>({...e,props:{...e.props,textStrokeColor:"#ffffff"}}),down:e=>{const{textStrokeColor:t,...n}=e.props;return{...e,props:n}}},[sn.AddWritingMode]:{up:e=>({...e,props:{...e.props,writingMode:"horizontal-tb"}}),down:e=>{const{writingMode:t,...n}=e.props;return{...e,props:n}}}}}),Qk={},Jk=he({}),DY={color:Zt,size:Fr,segments:Ze(Qh),isComplete:le,isPen:le},NY=he({}),eT=ge({topLeft:hn,bottomRight:hn}),LY={w:Ve,h:Ve,playing:le,pending:le,url:q,assetId:Ss.nullable(),crop:eT.nullable(),blurIntensity:qt(H),blurDirection:qt(H),flip:SS},Na={AddUrlProp:1,AddCropProp:2,AddFlip:3},FY=he({currentVersion:Na.AddFlip,migrators:{[Na.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[Na.AddCropProp]:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{const{crop:t,...n}=e.props;return{...e,props:n}}},[Na.AddFlip]:{up:e=>({...e,props:{...e.props,flip:"none"}}),down:e=>{const{flip:t,...n}=e.props;return{...e,props:n}}}}}),Jc=De.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),BY={color:Zt,dash:Fn,size:Fr,spline:Jc,handles:bs(q,Rl)},Vm={AddSnapHandles:1},zY=he({currentVersion:Vm.AddSnapHandles,migrators:{[Vm.AddSnapHandles]:{up:e=>{const t=Or(e.props.handles);for(const n in t)t[n].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{const t=Or(e.props.handles);for(const n in t)delete t[n].canSnap;return{...e,props:{...e.props,handles:t}}}}}}),UY={color:Zt,size:Fr,font:Bn,align:xs,verticalAlign:ws,growY:Ar,url:q,text:q},ri={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4},VY=he({currentVersion:ri.AddVerticalAlign,migrators:{[ri.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}},[ri.RemoveJustify]:{up:e=>{let t=e.props.align;return t==="justify"&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[ri.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy";break}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[ri.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{const{verticalAlign:t,...n}=e.props;return{...e,props:n}}}}}),KY={textColor:q,textStrokeColor:q,fontSize:Xh,strokeWidth:jl,font:Bn,align:xs,w:Ve,text:q,scale:Ve,autoSize:le,writingMode:Ni,verticalAlign:ws},oi={RemoveJustify:1,MigrateDedicatedSizeStyle:2,AddColorControlls:3,AddWritingModeAndVerticalAlign:4},WY=he({currentVersion:oi.AddWritingModeAndVerticalAlign,migrators:{[oi.RemoveJustify]:{up:e=>{let t=e.props.align;return t==="justify"&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[oi.MigrateDedicatedSizeStyle]:qh(),[oi.AddColorControlls]:{up:e=>{const{color:t,...n}=e.props;return{...e,props:{...n,textColor:"#000000",textStrokeColor:"#ffffff"}}},down:e=>{const{textColor:t,textStrokeColor:n,...r}=e.props;return{...e,props:{...r,color:Zt.defaultValue}}}},[oi.AddWritingModeAndVerticalAlign]:{up:e=>({...e,props:{...e.props,writingMode:"horizontal-tb",verticalAlign:"start"}}),down:e=>{const{writingMode:t,verticalAlign:n,...r}=e.props;return{...e,props:{...r}}}}}}),tT={w:Ve,h:Ve,time:H,playing:le,url:q,assetId:Ss.nullable()},Km={AddUrlProp:1},nT=he({currentVersion:Km.AddUrlProp,migrators:{[Km.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{const{url:t,...n}=e.props;return{...e,props:n}}}}}),Li=[{locale:"ar",label:"عربي"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"fa",label:"فارسی"},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"he",label:"עברית"},{locale:"it",label:"Italiano"},{locale:"ja",label:"日本語"},{locale:"ko-kr",label:"한국어"},{locale:"ku",label:"کوردی"},{locale:"hi-in",label:"हिन्दी"},{locale:"hu",label:"Magyar"},{locale:"my",label:"မြန်မာစာ"},{locale:"ne",label:"नेपाली"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"tr",label:"Türkçe"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Tiếng Việt"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function rT(){const e=typeof window<"u"?window.navigator.languages??["en"]:["en"];return oT(e)}function oT(e){for(const t of e){const n=sT(t);if(n)return n}return"en"}const Wm={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function sT(e){const t=Li.find(o=>o.locale===e.toLowerCase());if(t)return t.locale;const[n,r]=e.split(/[-_]/).map(o=>o.toLowerCase());if(r){const o=Li.find(s=>s.locale===n);if(o)return o.locale}return n in Wm?Wm[n]:null}var CS={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(e){(function(){var t={}.hasOwnProperty;function n(){for(var s="",i=0;i<arguments.length;i++){var a=arguments[i];a&&(s=o(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return n.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var i="";for(var a in s)t.call(s,a)&&s[a]&&(i=o(i,a));return i}function o(s,i){return i?s?s+" "+i:s+i:s}e.exports?(n.default=n,e.exports=n):window.classNames=n})()})(CS);var iT=CS.exports;const ue=As(iT);var Wu={};const aT={},ze={preventDefaultLogging:Dt("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:Dt("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:Dt("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:Dt("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:Dt("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:Dt("debugSvg",{defaults:{all:!1}}),throwToBlob:Dt("throwToBlob",{defaults:{all:!1}}),logMessages:Dt("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:Dt("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:Dt("debugCursors",{defaults:{all:!1}}),forceSrgb:Dt("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Dt("debugGeometry",{defaults:{all:!1}}),hideShapes:Dt("hideShapes",{defaults:{all:!1}})};typeof window<"u"&&(window.tldrawLog=e=>{ze.logMessages.set(ze.logMessages.get().concat(e))});if(typeof Element<"u"){const e=Element.prototype.removeChild;Ji("element removal logging",()=>{ze.elementRemovalLogging.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function Dt(e,{defaults:t,shouldStoreForSession:n=!0}){return cT({name:e,defaults:t,shouldStoreForSession:n})}function cT(e){const t=uT(e),n=e.shouldStoreForSession?lT(e.name):null,r=wt(`debug:${e.name}`,n??t);return typeof window<"u"&&(e.shouldStoreForSession&&Ji(`debug:${e.name}`,()=>{const o=r.get();try{o===t?window.sessionStorage.removeItem(`tldraw_debug:${e.name}`):window.sessionStorage.setItem(`tldraw_debug:${e.name}`,JSON.stringify(o))}catch{}}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,o=>o.toUpperCase())}`,{get(){return r.get()},set(o){r.set(o)},configurable:!0})),Object.assign(r,e)}function lT(e){try{return JSON.parse((window==null?void 0:window.sessionStorage.getItem(`tldraw_debug:${e}`))??"null")}catch{return null}}function Hu(e){try{return e()}catch{return null}}function uT(e){switch(Hu(()=>Wu.TLDRAW_ENV)??Hu(()=>Wu.VERCEL_PUBLIC_TLDRAW_ENV)??Hu(()=>Wu.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}function el(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return el(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function _e(e){e.preventDefault(),ze.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",e)}function ta(e,t){if(e.setPointerCapture(t.pointerId),ze.pointerCaptureTracking.get()){const n=ze.pointerCaptureTrackingObject.get();n.set(e,(n.get(e)??0)+1)}ze.pointerCaptureLogging.get()&&console.warn("setPointerCapture called on element:",e,t)}function na(e,t){if(e.hasPointerCapture(t.pointerId)){if(e.releasePointerCapture(t.pointerId),ze.pointerCaptureTracking.get()){const n=ze.pointerCaptureTrackingObject.get();n.get(e)===1?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture")}ze.pointerCaptureLogging.get()&&console.warn("releasePointerCapture called on element:",e,t)}}const Ct=e=>e.stopPropagation();function Ht(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:e.pointerType==="pen"}}const Jh=Z.createContext({}),U=()=>Z.useContext(Jh);function dT(){const e=U();return g.useMemo(function(){let r,o;function s(m){if(!m.isKilled){if(m.button===2){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...Ht(m)});return}m.button!==0&&m.button!==1&&m.button!==5||(ta(m.currentTarget,m),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Ht(m)}),e.getOpenMenus().length>0&&(e.updateInstanceState({openMenus:[]}),document.body.click(),e.getContainer().focus()))}}function i(m){m.isKilled||m.clientX===r&&m.clientY===o||(r=m.clientX,o=m.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Ht(m)}))}function a(m){m.isKilled||m.button!==0&&m.button!==1&&m.button!==2&&m.button!==5||(r=m.clientX,o=m.clientY,na(m.currentTarget,m),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Ht(m)}))}function c(m){if(m.isKilled||e.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const y=m.pointerType==="mouse"||m.pointerType==="pen";e.updateInstanceState({isHoveringCanvas:y?!0:null})}function l(m){if(m.isKilled||e.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const y=m.pointerType==="mouse"||m.pointerType==="pen";e.updateInstanceState({isHoveringCanvas:y?!1:null})}function u(m){m.isKilled=!0,document.body.click(),_e(m)}function d(m){m.isKilled=!0,m.target.tagName!=="A"&&m.target.tagName!=="TEXTAREA"&&_e(m)}function f(m){_e(m)}async function p(m){var b,x;if(_e(m),!((x=(b=m.dataTransfer)==null?void 0:b.files)!=null&&x.length))return;const y=Array.from(m.dataTransfer.files);await e.putExternalContent({type:"files",files:y,point:e.screenToPage({x:m.clientX,y:m.clientY}),ignoreParent:!1})}function v(m){Ct(m)}return{onPointerDown:s,onPointerMove:i,onPointerUp:a,onPointerEnter:c,onPointerLeave:l,onDragOver:f,onDrop:p,onTouchStart:u,onTouchEnd:d,onClick:v}},[e])}function fT(){const e=U();g.useEffect(()=>{if(e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos){e.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){const t=window.matchMedia("(pointer: coarse)"),n=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(n(),t)return t.addEventListener("change",n),()=>t.removeEventListener("change",n)}},[e])}const PS=g.createContext(null);function hT({container:e,children:t}){return h.jsx(PS.Provider,{value:e,children:t})}function ut(){return kI(g.useContext(PS),"useContainer used outside of <Tldraw />")}function pT(){const e=U(),t=ut(),n=Y("isFocused",()=>e.getInstanceState().isFocused,[e]);g.useEffect(()=>{if(typeof matchMedia===void 0)return;let r=null;const o=()=>{r!=null&&r();const s=`(resolution: ${window.devicePixelRatio}dppx)`,i=matchMedia(s),a=c=>{c.type==="change"&&o()};i.addEventListener?i.addEventListener("change",o):i.addListener&&i.addListener(a),r=()=>{i.removeEventListener?i.removeEventListener("change",o):i.removeListener&&i.removeListener(a)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return o(),()=>{r==null||r()}},[e]),g.useEffect(()=>{if(!n)return;const r=a=>{if(a.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!si()&&_e(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){_e(a);return}break}case"Tab":{if(si()||e.getIsMenuOpen())return;break}case",":{if(!si()&&(_e(a),!e.inputs.keys.has("Comma"))){const{x:l,y:u,z:d}=e.inputs.currentScreenPoint;e.inputs.keys.add("Comma");const f={type:"pointer",name:"pointer_down",point:{x:l,y:u,z:d},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(f);return}break}case"Escape":{if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&a.preventDefault(),e.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return}default:if(si()||e.getIsMenuOpen())return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};e.dispatch(c)},o=a=>{var l;if(a.isKilled||(a.isKilled=!0,si()||e.getIsMenuOpen()))return;if(a.key===","&&((l=document.activeElement)!=null&&l.ELEMENT_NODE&&_e(a),e.inputs.keys.has(a.code))){const{x:u,y:d,z:f}=e.inputs.currentScreenPoint;e.inputs.keys.delete(a.code);const p={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:f},shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(p);return}const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey};e.dispatch(c)};function s(a){var c,l;if(t.contains(a.target)){const u=a.touches[0].pageX,d=a.touches[0].radiusX||0;(u-d<10||u+d>e.getViewportScreenBounds().width-10)&&(((c=a.target)==null?void 0:c.tagName)==="BUTTON"&&((l=a.target)==null||l.click()),_e(a))}}const i=a=>{t.contains(a.target)&&(a.ctrlKey||a.metaKey)&&_e(a)};return t.addEventListener("touchstart",s,{passive:!1}),t.addEventListener("wheel",i,{passive:!1}),document.addEventListener("gesturestart",_e),document.addEventListener("gesturechange",_e),document.addEventListener("gestureend",_e),t.addEventListener("keydown",r),t.addEventListener("keyup",o),()=>{t.removeEventListener("touchstart",s),t.removeEventListener("wheel",i),document.removeEventListener("gesturestart",_e),document.removeEventListener("gesturechange",_e),document.removeEventListener("gestureend",_e),t.removeEventListener("keydown",r),t.removeEventListener("keyup",o)}},[e,t,n])}const gT=["input","select","button","textarea"];function si(){const{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||gT.indexOf(e.tagName.toLowerCase())>-1))}function mT(){return h.jsx("div",{className:"tl-background"})}function Ls(e,t,n,r,o,s){g.useLayoutEffect(()=>{const i=e.current;if(!i||t===void 0)return;let a=`translate(${t}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),o!==void 0&&(a+=` rotate(${o}rad)`),s&&(a+=` translate(${s.x}px, ${s.y}px)`),i.style.transform=a})}const Br={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2};class k{constructor(t=0,n=0,r=1){this.x=t,this.y=n,this.z=r}get pressure(){return this.z}set(t=this.x,n=this.y,r=this.z){return this.x=t,this.y=n,this.z=r,this}setTo({x:t=0,y:n=0,z:r=1}){return this.x=t,this.y=n,this.z=r,this}rot(t){if(t===0)return this;const{x:n,y:r}=this,o=Math.sin(t),s=Math.cos(t);return this.x=n*s-r*o,this.y=n*o+r*s,this}rotWith(t,n){if(n===0)return this;const r=this.x-t.x,o=this.y-t.y,s=Math.sin(n),i=Math.cos(n);return this.x=t.x+(r*i-o*s),this.y=t.y+(r*s+o*i),this}clone(){const{x:t,y:n,z:r}=this;return new k(t,n,r)}sub(t){return this.x-=t.x,this.y-=t.y,this}subXY(t,n){return this.x-=t,this.y-=n,this}subScalar(t){return this.x-=t,this.y-=t,this}add(t){return this.x+=t.x,this.y+=t.y,this}addXY(t,n){return this.x+=t,this.y+=n,this}addScalar(t){return this.x+=t,this.y+=t,this}clamp(t,n){return this.x=Math.max(this.x,t),this.y=Math.max(this.y,t),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(t){return this.x/=t,this.y/=t,this}divV(t){return this.x/=t.x,this.y/=t.y,this}mul(t){return this.x*=t,this.y*=t,this}mulV(t){return this.x*=t.x,this.y*=t.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(t,n){const r=k.Tan(t,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(t){return this.x=this.y*t.z-this.z*t.y,this.y=this.z*t.x-this.x*t.z,this}dpr(t){return k.Dpr(this,t)}cpr(t){return k.Cpr(this,t)}len2(){return k.Len2(this)}len(){return k.Len(this)}pry(t){return k.Pry(this,t)}per(){const{x:t,y:n}=this;return this.x=n,this.y=-t,this}uni(){return k.Uni(this)}tan(t){return k.Tan(this,t)}dist(t){return k.Dist(this,t)}distanceToLineSegment(t,n){return k.DistanceToLineSegment(t,n,this)}slope(t){return k.Slope(this,t)}snapToGrid(t){return this.x=Math.round(this.x/t)*t,this.y=Math.round(this.y/t)*t,this}angle(t){return k.Angle(this,t)}toAngle(){return k.ToAngle(this)}lrp(t,n){return this.x=this.x+(t.x-this.x)*n,this.y=this.y+(t.y-this.y)*n,this}equals(t){return k.Equals(this,t)}equalsXY(t,n){return k.EqualsXY(this,t,n)}norm(){const t=this.len();return this.x=t===0?0:this.x/t,this.y=t===0?0:this.y/t,this}toFixed(){return k.ToFixed(this)}toString(){return k.ToString(k.ToFixed(this))}toJson(){return k.ToJson(this)}toArray(){return k.ToArray(this)}static Add(t,n){return new k(t.x+n.x,t.y+n.y)}static AddXY(t,n,r){return new k(t.x+n,t.y+r)}static Sub(t,n){return new k(t.x-n.x,t.y-n.y)}static SubXY(t,n,r){return new k(t.x-n,t.y-r)}static AddScalar(t,n){return new k(t.x+n,t.y+n)}static SubScalar(t,n){return new k(t.x-n,t.y-n)}static Div(t,n){return new k(t.x/n,t.y/n)}static Mul(t,n){return new k(t.x*n,t.y*n)}static DivV(t,n){return new k(t.x/n.x,t.y/n.y)}static MulV(t,n){return new k(t.x*n.x,t.y*n.y)}static Neg(t){return new k(-t.x,-t.y)}static Per(t){return new k(t.y,-t.x)}static Dist2(t,n){return k.Sub(t,n).len2()}static Abs(t){return new k(Math.abs(t.x),Math.abs(t.y))}static Dist(t,n){return Math.hypot(t.y-n.y,t.x-n.x)}static Dpr(t,n){return t.x*n.x+t.y*n.y}static Cross(t,n){return new k(t.y*n.z-t.z*n.y,t.z*n.x-t.x*n.z)}static Cpr(t,n){return t.x*n.y-n.x*t.y}static Len2(t){return t.x*t.x+t.y*t.y}static Len(t){return Math.hypot(t.x,t.y)}static Pry(t,n){return k.Dpr(t,n)/k.Len(n)}static Uni(t){return k.Div(t,k.Len(t))}static Tan(t,n){return k.Uni(k.Sub(t,n))}static Min(t,n){return new k(Math.min(t.x,n.x),Math.min(t.y,n.y))}static Max(t,n){return new k(Math.max(t.x,n.x),Math.max(t.y,n.y))}static From({x:t,y:n,z:r=1}){return new k(t,n,r)}static FromArray(t){return new k(t[0],t[1])}static Rot(t,n=0){const r=Math.sin(n),o=Math.cos(n);return new k(t.x*o-t.y*r,t.x*r+t.y*o)}static RotWith(t,n,r){const o=t.x-n.x,s=t.y-n.y,i=Math.sin(r),a=Math.cos(r);return new k(n.x+(o*a-s*i),n.y+(o*i+s*a))}static NearestPointOnLineThroughPoint(t,n,r){return k.Mul(n,k.Sub(r,t).pry(n)).add(t)}static NearestPointOnLineSegment(t,n,r,o=!0){const s=k.Tan(n,t),i=k.Add(t,k.Mul(s,k.Sub(r,t).pry(s)));if(o){if(i.x<Math.min(t.x,n.x))return k.Cast(t.x<n.x?t:n);if(i.x>Math.max(t.x,n.x))return k.Cast(t.x>n.x?t:n);if(i.y<Math.min(t.y,n.y))return k.Cast(t.y<n.y?t:n);if(i.y>Math.max(t.y,n.y))return k.Cast(t.y>n.y?t:n)}return i}static DistanceToLineThroughPoint(t,n,r){return k.Dist(r,k.NearestPointOnLineThroughPoint(t,n,r))}static DistanceToLineSegment(t,n,r,o=!0){return k.Dist(r,k.NearestPointOnLineSegment(t,n,r,o))}static Snap(t,n=1){return new k(Math.round(t.x/n)*n,Math.round(t.y/n)*n)}static Cast(t){return t instanceof k?t:k.From(t)}static Slope(t,n){return t.x===n.y?NaN:(t.y-n.y)/(t.x-n.x)}static Angle(t,n){return Math.atan2(n.y-t.y,n.x-t.x)}static Lrp(t,n,r){return k.Sub(n,t).mul(r).add(t)}static Med(t,n){return new k((t.x+n.x)/2,(t.y+n.y)/2)}static Equals(t,n){return Math.abs(t.x-n.x)<1e-4&&Math.abs(t.y-n.y)<1e-4}static EqualsXY(t,n,r){return t.x===n&&t.y===r}static Clockwise(t,n,r){return(r.x-t.x)*(n.y-t.y)-(n.x-t.x)*(r.y-t.y)<0}static Rescale(t,n){const r=k.Len(t);return new k(n*t.x/r,n*t.y/r)}static ScaleWithOrigin(t,n,r){return k.Sub(t,r).mul(n).add(r)}static ToFixed(t,n=2){return new k(+t.x.toFixed(n),+t.y.toFixed(n),+t.z.toFixed(n))}static Nudge(t,n,r){return k.Add(t,k.Tan(n,t).mul(r))}static ToString(t){return`${t.x}, ${t.y}`}static ToAngle(t){let n=Math.atan2(t.y,t.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(t,n=1){return new k(Math.cos(t)*n,Math.sin(t)*n)}static ToArray(t){return[t.x,t.y,t.z]}static ToJson(t){const{x:n,y:r,z:o}=t;return{x:n,y:r,z:o}}static Average(t){const n=t.length,r=new k(0,0);for(let o=0;o<n;o++)r.add(t[o]);return r.div(n)}static Clamp(t,n,r){return r===void 0?new k(Math.min(Math.max(t.x,n)),Math.min(Math.max(t.y,n))):new k(Math.min(Math.max(t.x,n),r),Math.min(Math.max(t.y,n),r))}static PointsBetween(t,n,r=6){const o=[];for(let s=0;s<r;s++){const i=Br.easeInQuad(s/(r-1)),a=k.Lrp(t,n,i);a.z=Math.min(1,.5+Math.abs(.5-yT(i))*.65),o.push(a)}return o}static SnapToGrid(t,n=8){return new k(Math.round(t.x/n)*n,Math.round(t.y/n)*n)}}const yT=e=>e<.5?2*e*e:-1+(4-2*e)*e,Be=class Be{constructor(t=0,n=0,r=0,o=0){I(this,"x",0);I(this,"y",0);I(this,"w",0);I(this,"h",0);this.x=t,this.y=n,this.w=r,this.h=o}get point(){return new k(this.x,this.y)}set point(t){this.x=t.x,this.y=t.y}get minX(){return this.x}set minX(t){this.x=t}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(t){this.y=t}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(t){this.w=t}get height(){return this.h}set height(t){this.h=t}get aspectRatio(){return this.width/this.height}get center(){return new k(this.midX,this.midY)}set center(t){this.minX=t.x-this.width/2,this.minY=t.y-this.height/2}get corners(){return[new k(this.minX,this.minY),new k(this.maxX,this.minY),new k(this.maxX,this.maxY),new k(this.minX,this.maxY)]}get snapPoints(){return[new k(this.minX,this.minY),new k(this.maxX,this.minY),new k(this.maxX,this.maxY),new k(this.minX,this.maxY),this.center]}get sides(){const{corners:t}=this;return[[t[0],t[1]],[t[1],t[2]],[t[2],t[3]],[t[3],t[0]]]}get size(){return new k(this.w,this.h)}toFixed(){return this.x=La(this.x),this.y=La(this.y),this.w=La(this.w),this.h=La(this.h),this}setTo(t){return this.x=t.x,this.y=t.y,this.w=t.w,this.h=t.h,this}set(t=0,n=0,r=0,o=0){return this.x=t,this.y=n,this.w=r,this.h=o,this}expand(t){const n=Math.min(this.minX,t.minX),r=Math.min(this.minY,t.minY),o=Math.max(this.maxX,t.maxX),s=Math.max(this.maxY,t.maxY);return this.x=n,this.y=r,this.w=o-n,this.h=s-r,this}expandBy(t){return this.x-=t,this.y-=t,this.w+=t*2,this.h+=t*2,this}scale(t){return this.x/=t,this.y/=t,this.w/=t,this.h/=t,this}clone(){const{x:t,y:n,w:r,h:o}=this;return new Be(t,n,r,o)}translate(t){return this.x+=t.x,this.y+=t.y,this}snapToGrid(t){const n=Math.round(this.minX/t)*t,r=Math.round(this.minY/t)*t,o=Math.round(this.maxX/t)*t,s=Math.round(this.maxY/t)*t;this.minX=n,this.minY=r,this.width=Math.max(1,o-n),this.height=Math.max(1,s-r)}collides(t){return Be.Collides(this,t)}contains(t){return Be.Contains(this,t)}includes(t){return Be.Includes(this,t)}containsPoint(t,n=0){return Be.ContainsPoint(this,t,n)}getHandlePoint(t){switch(t){case"top_left":return new k(this.minX,this.minY);case"top_right":return new k(this.maxX,this.minY);case"bottom_left":return new k(this.minX,this.maxY);case"bottom_right":return new k(this.maxX,this.maxY);case"top":return new k(this.midX,this.minY);case"right":return new k(this.maxX,this.midY);case"bottom":return new k(this.midX,this.maxY);case"left":return new k(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(t,n,r){const{minX:o,minY:s,maxX:i,maxY:a}=this;let{minX:c,minY:l,maxX:u,maxY:d}=this;switch(t){case"left":case"top_left":case"bottom_left":{c+=n;break}case"right":case"top_right":case"bottom_right":{u+=n;break}}switch(t){case"top":case"top_left":case"top_right":{l+=r;break}case"bottom":case"bottom_left":case"bottom_right":{d+=r;break}}const f=(u-c)/(i-o),p=(d-l)/(a-s),v=f<0,m=p<0;if(v){const y=u;u=c,c=y}if(m){const y=d;d=l,l=y}this.minX=c,this.minY=l,this.width=Math.abs(u-c),this.height=Math.abs(d-l)}union(t){const n=Math.min(this.minX,t.x),r=Math.min(this.minY,t.y),o=Math.max(this.maxX,t.w+t.x),s=Math.max(this.maxY,t.h+t.y);return this.x=n,this.y=r,this.width=o-n,this.height=s-r,this}static From(t){return new Be(t.x,t.y,t.w,t.h)}static FromPoints(t){if(t.length===0)return new Be;let n=1/0,r=1/0,o=-1/0,s=-1/0,i;for(let a=0,c=t.length;a<c;a++)i=t[a],n=Math.min(i.x,n),r=Math.min(i.y,r),o=Math.max(i.x,o),s=Math.max(i.y,s);return new Be(n,r,o-n,s-r)}static Expand(t,n){const r=Math.min(n.minX,t.minX),o=Math.min(n.minY,t.minY),s=Math.max(n.maxX,t.maxX),i=Math.max(n.maxY,t.maxY);return new Be(r,o,s-r,i-o)}static ExpandBy(t,n){return new Be(t.minX-n,t.minY-n,t.width+n*2,t.height+n*2)}static Resize(t,n,r,o,s=!1){const{minX:i,minY:a,maxX:c,maxY:l}=t;let{minX:u,minY:d,maxX:f,maxY:p}=t;switch(n){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{f+=r;break}}switch(n){case"top":case"top_left":case"top_right":{d+=o;break}case"bottom":case"bottom_left":case"bottom_right":{p+=o;break}}const v=(f-u)/(c-i),m=(p-d)/(l-a),y=v<0,b=m<0;if(s){const w=(c-i)/(l-a),S=Math.abs(f-u),C=Math.abs(p-d),P=S*(m<0?1:-1)*(1/w),E=C*(v<0?1:-1)*w,_=w<S/C;switch(n){case"top_left":{_?d=p+P:u=f+E;break}case"top_right":{_?d=p+P:f=u-E;break}case"bottom_right":{_?p=d-P:f=u-E;break}case"bottom_left":{_?p=d-P:u=f+E;break}case"bottom":case"top":{const $=(u+f)/2,T=C*w;u=$-T/2,f=$+T/2;break}case"left":case"right":{const $=(d+p)/2,T=S/w;d=$-T/2,p=$+T/2;break}}}if(y){const w=f;f=u,u=w}if(b){const w=p;p=d,d=w}const x=new Be(u,d,Math.abs(f-u),Math.abs(p-d));return{box:x,scaleX:+(x.width/t.width*(v>0?1:-1)).toFixed(5),scaleY:+(x.height/t.height*(m>0?1:-1)).toFixed(5)}}equals(t){return Be.Equals(this,t)}static Equals(t,n){return n.x===t.x&&n.y===t.y&&n.w===t.w&&n.h===t.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(t){return new Be(t.x,t.y,Math.max(1,t.w),Math.max(1,t.h))}};I(Be,"Collides",(t,n)=>!(t.maxX<n.minX||t.minX>n.maxX||t.maxY<n.minY||t.minY>n.maxY)),I(Be,"Contains",(t,n)=>t.minX<n.minX&&t.minY<n.minY&&t.maxY>n.maxY&&t.maxX>n.maxX),I(Be,"Includes",(t,n)=>Be.Collides(t,n)||Be.Contains(t,n)),I(Be,"ContainsPoint",(t,n,r=0)=>!(n.x<t.minX-r||n.y<t.minY-r||n.x>t.maxX+r||n.y>t.maxY+r)),I(Be,"Common",t=>{let n=1/0,r=1/0,o=-1/0,s=-1/0;for(let i=0;i<t.length;i++){const a=t[i];n=Math.min(n,a.minX),r=Math.min(r,a.minY),o=Math.max(o,a.maxX),s=Math.max(s,a.maxY)}return new Be(n,r,o-n,s-r)}),I(Be,"Sides",(t,n=0)=>{const{corners:r}=t;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let ce=Be;function vT(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}function bT(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}function ST(e){return e==="top_left"||e==="top_right"||e==="bottom_right"||e==="bottom_left"}function cn(e){return`${L(e.x)},${L(e.y)} `}function ln(e,t){return`${L((e.x+t.x)/2)},${L((e.y+t.y)/2)} `}const xt=Math.PI,$t=xt/2,He=xt*2,HY=Math.PI/180,GY=Math.sin;function jn(e,t,n){return Math.max(t,typeof n<"u"?Math.min(e,n):e)}function La(e,t=1e10){return e?Math.round(e*t)/t:0}function ki(e,t,n=1e-6){return Math.abs(e-t)<=n}function Fi(e,t){const n=Math.pow(e-t,2)/Math.pow(e+t,2);return xt*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function or(e){return e=e%He,e<0?e=e+He:e===0&&(e=0),e}function Nl(e,t){return e=or(e),t=or(t),e>t&&(t+=He),t-e}function xT(e,t){return He-Nl(e,t)}function wT(e,t){const n=(t-e)%He;return 2*n%He-n}function YY(e,t){return wT(e,t)}function vf(e){return(He+e)%He}function XY(e,t){const n=He/t;let r=Math.floor((vf(e)+n/2)/n)*n%He;return r<xt&&(r+=He),r>xt&&(r-=He),r}function CT(e,t){return e===t||ki(e%(Math.PI/2)-t%(Math.PI/2),0)}function qY(e){return e*xt/180}function PT(e){return e*180/xt}function ES(e,t,n,r){return new k(e+n*Math.cos(r),t+n*Math.sin(r))}function ZY(e,t,n){const r=e/2,o=t/2,s=[];let i=1/0,a=1/0;for(let c=0;c<n;c++){const l=He/n,u=-$t+c*l,d=r+r*Math.cos(u),f=o+o*Math.sin(u);d<i&&(i=d),f<a&&(a=f),s.push(new k(d,f))}if(i!==0||a!==0)for(let c=0;c<s.length;c++){const l=s[c];l.x-=i,l.y-=a}return s}function ii(e,t,n,r){return e<r&&n<t}function xn(e,t,n,r){const o=Math.max(e,n),s=Math.min(t,r);return o<=s?[o,s]:null}const QY=(e,t,n)=>{const r=He/e/2,o=Math.floor(e/4)*2,s=e*2-o,i=0,a=Math.floor(e/2)*2,c=Math.cos(-$t+o*r)*t/2,l=Math.cos(-$t+s*r)*t/2,u=Math.sin(-$t+i*r)*n/2,d=Math.sin(-$t+a*r)*n/2;return new ce(0,0,c-l,d-u)};function Hm(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function _s(e,t){let n=0,r,o;for(let s=0;s<t.length;s++)r=t[s],o=t[(s+1)%t.length],r.y<=e.y?o.y>e.y&&Hm(r,o,e)>0&&(n+=1):o.y<=e.y&&Hm(r,o,e)<0&&(n-=1);return n!==0}function L(e){return+e.toFixed(4)}function JY(e){return+e.toFixed(2)}const Gm=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER,Fa=({brush:e,color:t,opacity:n,className:r})=>{const o=g.useRef(null);Ls(o,e.x,e.y);const s=L(Math.max(1,e.w)),i=L(Math.max(1,e.h));return h.jsx("svg",{className:"tl-overlays__item",ref:o,children:t?h.jsxs("g",{className:"tl-brush",opacity:n,children:[h.jsx("rect",{width:s,height:i,fill:t,opacity:.75}),h.jsx("rect",{width:s,height:i,fill:"none",stroke:t,opacity:.1})]}):h.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:s,height:i})})},ET=({className:e,zoom:t,point:n,color:r,viewport:o,opacity:s=1})=>{const i=g.useRef(null);return Ls(i,jn(n.x,o.minX+5/t,o.maxX-5/t),jn(n.y,o.minY+5/t,o.maxY-5/t),1/t,k.Angle(o.center,n)),h.jsxs("svg",{ref:i,className:ue("tl-overlays__item",e),children:[h.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),h.jsx("use",{href:"#cursor_hint",color:r,opacity:s})]})},_T=({className:e,zoom:t,point:n,color:r,name:o,chatMessage:s})=>{const i=g.useRef(null);return Ls(i,n==null?void 0:n.x,n==null?void 0:n.y,1/t),n?h.jsxs("div",{ref:i,className:ue("tl-overlays__item",e),children:[h.jsx("svg",{className:"tl-cursor",children:h.jsx("use",{href:"#cursor",color:r})}),s?h.jsxs(h.Fragment,{children:[o&&h.jsx("div",{className:"tl-nametag-title",style:{color:r},children:o}),h.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:s})]}):o&&h.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:o})]}):null},Ym=g.memo(_T),ep={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var e;return await((e=window.__tldraw__hardReset)==null?void 0:e.call(window))}};function _S(){ep.hardReset()}function IT(){ep.refreshPage()}const kT={error:null};class IS extends g.Component{constructor(){super(...arguments);I(this,"state",kT)}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n){var r,o;(o=(r=this.props).onError)==null||o.call(r,n)}render(){const{error:n}=this.state;if(n!==null){const{fallback:r}=this.props;return h.jsx(r,{error:n})}return this.props.children}}function Bi({children:e,fallback:t,...n}){return t===null?h.jsx(h.Fragment,{children:e}):h.jsx(IS,{fallback:t,...n,children:e})}const TT="https://github.com/troph-team/tldraw/issues/new";function $T(){}const kS=({error:e,editor:t})=>{const n=g.useRef(null),[r,o]=g.useState(!1),[s,i]=g.useState(!1),[a,c]=g.useState(!1),l=e instanceof Error?e.message:String(e),u=e instanceof Error?e.stack:null,d=Y("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[f,p]=g.useState(null);g.useLayoutEffect(()=>{var S;d!==null&&p(d);let x=(S=n.current)==null?void 0:S.parentElement,w=!1;for(;x;){if(x.classList.contains("tl-theme__dark")||x.classList.contains("tl-theme__light")){w=!0;break}x=x.parentElement}if(w){p(null);return}p(window.matchMedia("(prefers-color-scheme: dark)").matches)},[d]),g.useEffect(()=>{if(s){const x=setTimeout(()=>{i(!1)},2e3);return()=>clearTimeout(x)}},[s]);const v=()=>{const x=document.createElement("textarea");x.value=u??l,document.body.appendChild(x),x.select(),document.execCommand("copy"),x.remove(),i(!0)},m=()=>{IT()},y=async()=>{_S()},b=new URL(TT);return b.searchParams.set("title",l),b.searchParams.set("labels","bug"),b.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??l}
\`\`\`

My browser: ${navigator.userAgent}`),h.jsxs("div",{ref:n,className:ue("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[h.jsx("div",{className:"tl-error-boundary__overlay"}),t&&h.jsx(IS,{onError:$T,fallback:()=>null,children:h.jsx(Jh.Provider,{value:t,children:h.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:h.jsx(ZS,{})})})}),h.jsx("div",{className:ue("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?h.jsxs(h.Fragment,{children:[h.jsx("h2",{children:"Are you sure?"}),h.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),h.jsxs("div",{className:"tl-error-boundary__content__actions",children:[h.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),h.jsx("button",{className:"tl-error-boundary__reset",onClick:y,children:"Reset data"})]})]}):h.jsxs(h.Fragment,{children:[h.jsx("h2",{children:"Something's gone wrong."}),h.jsx("p",{children:"Sorry, but we encountered an fatal error that is unrecoverable."}),h.jsx("p",{children:h.jsx("strong",{children:"Your data is still safely stored locally."})}),h.jsxs("p",{children:["Try refreshing the page, or if that doesn't work, please"," ",h.jsx("strong",{children:"backup your data (WIP)"})," and try resetting local state to see if that resolves the issue. If you're still having issues, feel free to contact us."]}),r&&h.jsxs("div",{className:"tl-error-boundary__content__error",children:[h.jsx("pre",{children:h.jsx("code",{children:u??l})}),h.jsx("button",{onClick:v,children:s?"Copied!":"Copy"})]}),h.jsxs("div",{className:"tl-error-boundary__content__actions",children:[h.jsx("button",{onClick:()=>o(!r),children:r?"Hide details":"Show details"}),h.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[h.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),h.jsx("button",{className:"tl-error-boundary__refresh",onClick:m,children:"Refresh Page"})]})]})]})})]})},Qn=2e3,tl=40,tr=320,Lo=[.05,.1,.25,.5,1,2,4,8],ai=.05,ts=8,AT=.5,MT=.1,OT=.2,RT=.005,jT=.05,DT=450,NT=200,bf=6,Sf=4,LT=0,Xm={};for(let e=1;e<=Math.ceil(ts);e++)Xm[e+"_dark"]=`hash_pattern_zoom_${e}_dark`,Xm[e+"_light"]=`hash_pattern_zoom_${e}_light`;const FT={duration:0,easing:Br.easeInOutCubic},Gu=.09,qm=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],BT=6e4,TS=3e3,zT=1200,Zm={CAMERA_MOVE:-10},UT=64,VT=620,KT=8,eX=20,WT=({x:e,y:t,z:n,size:r})=>h.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[h.jsx("defs",{children:qm.map(({min:o,mid:s,step:i},a)=>{const c=i*r*n,l=.5+e*n,u=.5+t*n,d=l>0?l%c:c+l%c,f=u>0?u%c:c+u%c,p=n<s?Hc(n,[o,s],[0,1]):1;return h.jsx("pattern",{id:`grid-${i}`,width:c,height:c,patternUnits:"userSpaceOnUse",children:h.jsx("circle",{className:"tl-grid-dot",cx:d,cy:f,r:1,opacity:p})},`grid-pattern-${a}`)})}),qm.map(({step:o},s)=>h.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${o})`},`grid-rect-${s}`))]}),HT=({handle:e,isCoarse:t,className:n,zoom:r})=>{const o=(t?20:12)/r,s=(e.type==="create"&&t?3:4)/r;return h.jsxs("g",{className:ue("tl-handle",{"tl-handle__virtual":e.type==="virtual","tl-handle__create":e.type==="create"},n),children:[h.jsx("circle",{className:"tl-handle__bg",r:o}),h.jsx("circle",{className:"tl-handle__fg",r:s})]})},GT=({children:e})=>h.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:e});class YT{constructor(t){this.shape=t}equals(t){var n,r,o,s,i,a;return((n=this.shape)==null?void 0:n.isLocked)===((r=t==null?void 0:t.shape)==null?void 0:r.isLocked)&&((o=this.shape)==null?void 0:o.props)===((s=t==null?void 0:t.shape)==null?void 0:s.props)&&((i=this.shape)==null?void 0:i.meta)===((a=t==null?void 0:t.shape)==null?void 0:a.meta)}}const XT=({shape:e,util:t})=>$l("Indicator:"+e.type,()=>t.indicator(e)),qT=({editor:e,id:t})=>{const n=Y("shape",()=>new YT(e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:r}=ot();return!n.shape||n.shape.isLocked?null:h.jsx(Bi,{fallback:r,onError:o=>e.annotateError(o,{origin:"react.shapeIndicator",willCrashApp:!1}),children:h.jsx(XT,{shape:n.shape,util:e.getShapeUtil(n.shape)},n.shape.id)})},ZT=({id:e,className:t,color:n,opacity:r})=>{const o=U(),s=Y("transform",()=>{const i=o.getShapePageTransform(e);return i?i.toCssString():""},[o,e]);return h.jsx("svg",{className:ue("tl-overlays__item",t),children:h.jsx("g",{className:"tl-shape-indicator",transform:s,stroke:n??"var(--color-selected)",opacity:r,children:h.jsx(qT,{editor:o,id:e})})})},Ll=g.memo(ZT),QT=({shapeId:e})=>h.jsx(Ll,{className:"tl-user-indicator__hovered",id:e});function $S(e,t=!0){const n=e.length;if(n<2)return"";let r=e[0],o=e[1];if(n===2)return`M${cn(r)}L${cn(o)}`;let s="";for(let i=2,a=n-1;i<a;i++)r=e[i],o=e[i+1],s+=ln(r,o);return t?`M${ln(e[0],e[1])}Q${cn(e[1])}${ln(e[1],e[2])}T${s}${ln(e[n-1],e[0])}${ln(e[0],e[1])}Z`:`M${cn(e[0])}Q${cn(e[1])}${ln(e[1],e[2])}${e.length>3?"T":""}${s}L${cn(e[n-1])}`}const Qm=({scribble:e,zoom:t,color:n,opacity:r,className:o})=>e.points.length?h.jsx("svg",{className:o&&ue("tl-overlays__item",o),children:h.jsx("path",{className:"tl-scribble",d:$S(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:r??e.opacity})}):null,JT=({bounds:e,rotation:t})=>{const n=g.useRef(null);return Ls(n,e.x,e.y,1,t),g.useLayoutEffect(()=>{const r=n.current;r&&(r.style.width=L(Math.max(1,e.width))+"px",r.style.height=L(Math.max(1,e.height))+"px")},[e.width,e.height]),h.jsx("div",{ref:n,className:"tl-selection__bg",draggable:!1})},e2=({bounds:e,rotation:t})=>{const n=U(),r=g.useRef(null),o=Y("only selected shape",()=>n.getOnlySelectedShape(),[n]),s=o?n.getShapeUtil(o).expandSelectionOutlinePx(o):0;return Ls(r,e==null?void 0:e.x,e==null?void 0:e.y,1,t,{x:-s,y:-s}),e=e.clone().expandBy(s).zeroFix(),h.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:h.jsx("rect",{className:ue("tl-selection__fg__outline"),width:L(e.width),height:L(e.height)})})},t2=()=>h.jsx("div",{className:"tl-shape-error-boundary"}),n2=()=>h.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function r2({points:e,zoom:t}){const n=2.5/t,r=e.reduce((f,p)=>Math.min(f,p.x),1/0),o=e.reduce((f,p)=>Math.max(f,p.x),-1/0),s=e.reduce((f,p)=>Math.min(f,p.y),1/0),i=e.reduce((f,p)=>Math.max(f,p.y),-1/0),a=e.some(f=>f.x===r&&f.y===s);let c,l,u,d;return a?(c=r,l=s,u=o,d=i):(c=r,l=i,u=o,d=s),h.jsxs("g",{className:"tl-snap-line",children:[h.jsx("line",{x1:c,y1:l,x2:u,y2:d}),e.map((f,p)=>h.jsx("g",{transform:`translate(${f.x},${f.y})`,children:h.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},p))]})}function o2({gaps:e,direction:t,zoom:n}){const r=3.5/n;let o=[-1/0,1/0],s=null;const i=t==="horizontal";for(const c of e){if(s=xn(o[0],o[1],i?c.startEdge[0].y:c.startEdge[0].x,i?c.startEdge[1].y:c.startEdge[1].x),s)o=s;else continue;if(s=xn(o[0],o[1],i?c.endEdge[0].y:c.endEdge[0].x,i?c.endEdge[1].y:c.endEdge[1].x),s)o=s;else continue}if(o===null)return null;const a=(o[0]+o[1])/2;return h.jsx("g",{className:"tl-snap-line",children:e.map(({startEdge:c,endEdge:l},u)=>h.jsx(g.Fragment,{children:i?h.jsxs(h.Fragment,{children:[h.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),h.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),h.jsx("line",{x1:c[0].x,y1:a,x2:l[0].x,y2:a}),h.jsx("line",{x1:(c[0].x+l[0].x)/2,y1:a-r,x2:(c[0].x+l[0].x)/2,y2:a+r})]}):h.jsxs(h.Fragment,{children:[h.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),h.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),h.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:l[0].y}),h.jsx("line",{x1:a-r,y1:(c[0].y+l[0].y)/2,x2:a+r,y2:(c[0].y+l[0].y)/2})]})},u))})}const s2=({className:e,line:t,zoom:n})=>h.jsx("svg",{className:ue("tl-overlays__item",e),children:t.type==="points"?h.jsx(r2,{...t,zoom:n}):t.type==="gaps"?h.jsx(o2,{...t,zoom:n}):null}),i2=()=>h.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:h.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[h.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),h.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:h.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),a2=()=>null,AS=g.createContext({});function c2({overrides:e,children:t}){return h.jsx(AS.Provider,{value:g.useMemo(()=>({Background:mT,SvgDefs:a2,Brush:Fa,ZoomBrush:Fa,ScreenshotBrush:Fa,CollaboratorBrush:Fa,Cursor:Ym,CollaboratorCursor:Ym,CollaboratorHint:ET,CollaboratorShapeIndicator:Ll,Grid:WT,Scribble:Qm,SnapLine:s2,Handles:GT,Handle:HT,CollaboratorScribble:Qm,ErrorFallback:kS,ShapeErrorFallback:t2,ShapeIndicatorErrorFallback:n2,Spinner:i2,SelectionBackground:JT,SelectionForeground:e2,HoveredShapeIndicator:QT,ErrorScreen:tR,OnTheCanvas:null,InFrontOfTheCanvas:null,...e}),[e]),children:t})}function ot(){return g.useContext(AS)}const l2=["textarea","input"];function u2(e){const t=U();g.useEffect(()=>{const n=e.current;if(!n)return;const r=o=>{var s;if(o instanceof PointerEvent&&o.pointerType==="pen"){o.isKilled=!0;const{target:i}=o;if(l2.includes((s=i.tagName)==null?void 0:s.toLocaleLowerCase())||t.isIn("select.editing_shape"))return;_e(o)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[t,e])}function d2(e,t,n){return Math.max(t,Math.min(e,n))}const lt={toVector(e,t){return e===void 0&&(e=t),Array.isArray(e)?e:[e,e]},add(e,t){return[e[0]+t[0],e[1]+t[1]]},sub(e,t){return[e[0]-t[0],e[1]-t[1]]},addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function Jm(e,t,n){return t===0||Math.abs(t)===1/0?Math.pow(e,n*5):e*t*n/(t+n*e)}function ey(e,t,n,r=.15){return r===0?d2(e,t,n):e<t?-Jm(t-e,n-t,r)+t:e>n?+Jm(e-n,n-t,r)+n:e}function f2(e,[t,n],[r,o]){const[[s,i],[a,c]]=e;return[ey(t,s,i,r),ey(n,a,c,o)]}function h2(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function p2(e){var t=h2(e,"string");return typeof t=="symbol"?t:String(t)}function ht(e,t,n){return t=p2(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ty(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ge(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ty(Object(n),!0).forEach(function(r){ht(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ty(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const MS={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function ny(e){return e?e[0].toUpperCase()+e.slice(1):""}const g2=["enter","leave"];function m2(e=!1,t){return e&&!g2.includes(t)}function y2(e,t="",n=!1){const r=MS[e],o=r&&r[t]||t;return"on"+ny(e)+ny(o)+(m2(n,o)?"Capture":"")}const v2=["gotpointercapture","lostpointercapture"];function b2(e){let t=e.substring(2).toLowerCase();const n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));const r=v2.includes(t)?"capturecapture":"capture",o=!!~t.indexOf(r);return o&&(t=t.replace("capture","")),{device:t,capture:o,passive:n}}function S2(e,t=""){const n=MS[e],r=n&&n[t]||t;return e+r}function OS(e){return"touches"in e}function x2(e){return OS(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function w2(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||((n=e.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,t.target))})}function xf(e,t){try{const n=t.clientX-e.clientX,r=t.clientY-e.clientY,o=(t.clientX+e.clientX)/2,s=(t.clientY+e.clientY)/2,i=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:i,origin:[o,s]}}catch{}return null}function C2(e){return w2(e).map(t=>t.identifier)}function ry(e,t){const[n,r]=Array.from(e.touches).filter(o=>t.includes(o.identifier));return xf(n,r)}const oy=40,sy=800;function RS(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return r===1?(t*=oy,n*=oy):r===2&&(t*=sy,n*=sy),[t,n]}function P2(e){const t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){const{shiftKey:n,altKey:r,metaKey:o,ctrlKey:s}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:o,ctrlKey:s})}return t}function nl(e,...t){return typeof e=="function"?e(...t):e}function E2(){}function _2(...e){return e.length===0?E2:e.length===1?e[0]:function(){let t;for(const n of e)t=n.apply(this,arguments)||t;return t}}function iy(e,t){return Object.assign({},t,e||{})}const I2=32;class jS{constructor(t,n,r){this.ctrl=t,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(t){this.ctrl.state[this.key]=t}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:t,shared:n,ingKey:r,args:o}=this;n[r]=t._active=t.active=t._blocked=t._force=!1,t._step=[!1,!1],t.intentional=!1,t._movement=[0,0],t._distance=[0,0],t._direction=[0,0],t._delta=[0,0],t._bounds=[[-1/0,1/0],[-1/0,1/0]],t.args=o,t.axis=void 0,t.memo=void 0,t.elapsedTime=t.timeDelta=0,t.direction=[0,0],t.distance=[0,0],t.overflow=[0,0],t._movementBound=[!1,!1],t.velocity=[0,0],t.movement=[0,0],t.delta=[0,0],t.timeStamp=0}start(t){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=t.target,n.currentTarget=t.currentTarget,n.lastOffset=r.from?nl(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=t.timeStamp)}computeValues(t){const n=this.state;n._values=t,n.values=this.config.transform(t)}computeInitial(){const t=this.state;t._initial=t._values,t.initial=t.values}compute(t){const{state:n,config:r,shared:o}=this;n.args=this.args;let s=0;if(t&&(n.event=t,r.preventDefault&&t.cancelable&&n.event.preventDefault(),n.type=t.type,o.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,o.locked=!!document.pointerLockElement,Object.assign(o,P2(t)),o.down=o.pressed=o.buttons%2===1||o.touches>0,s=t.timeStamp-n.timeStamp,n.timeStamp=t.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const P=n._delta.map(Math.abs);lt.addTo(n._distance,P)}this.axisIntent&&this.axisIntent(t);const[i,a]=n._movement,[c,l]=r.threshold,{_step:u,values:d}=n;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(i)>=c&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=l&&d[1])):(u[0]===!1&&(u[0]=Math.abs(i)>=c&&Math.sign(i)*c),u[1]===!1&&(u[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const f=[0,0];if(r.hasCustomTransform){const[P,E]=d;f[0]=u[0]!==!1?P-u[0]:0,f[1]=u[1]!==!1?E-u[1]:0}else f[0]=u[0]!==!1?i-u[0]:0,f[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(f);const p=n.offset,v=n._active&&!n._blocked||n.active;v&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=o[this.ingKey]=n._active,t&&(n.first&&("bounds"in r&&(n._bounds=nl(r.bounds,n)),this.setup&&this.setup()),n.movement=f,this.computeOffset()));const[m,y]=n.offset,[[b,x],[w,S]]=n._bounds;n.overflow=[m<b?-1:m>x?1:0,y<w?-1:y>S?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const C=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=f2(n._bounds,n.offset,C),n.delta=lt.sub(n.offset,p),this.computeMovement(),v&&(!n.last||s>I2)){n.delta=lt.sub(n.offset,p);const P=n.delta.map(Math.abs);lt.addTo(n.distance,P),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&s>0&&(n.velocity=[P[0]/s,P[1]/s],n.timeDelta=s)}}emit(){const t=this.state,n=this.shared,r=this.config;if(t._active||this.clean(),(t._blocked||!t.intentional)&&!t._force&&!r.triggerAllEvents)return;const o=this.handler(Ge(Ge(Ge({},n),t),{},{[this.aliasKey]:t.values}));o!==void 0&&(t.memo=o)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function k2([e,t],n){const r=Math.abs(e),o=Math.abs(t);if(r>o&&r>n)return"x";if(o>r&&o>n)return"y"}class T2 extends jS{constructor(...t){super(...t),ht(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=lt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=lt.sub(this.state.offset,this.state.lastOffset)}axisIntent(t){const n=this.state,r=this.config;if(!n.axis&&t){const o=typeof r.axisThreshold=="object"?r.axisThreshold[x2(t)]:r.axisThreshold;n.axis=k2(n._movement,o)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(t){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":t[1]=0;break;case"y":t[0]=0;break}}}const $2=e=>e,ay=.15,DS={enabled(e=!0){return e},eventOptions(e,t,n){return Ge(Ge({},n.shared.eventOptions),e)},preventDefault(e=!1){return e},triggerAllEvents(e=!1){return e},rubberband(e=0){switch(e){case!0:return[ay,ay];case!1:return[0,0];default:return lt.toVector(e)}},from(e){if(typeof e=="function")return e;if(e!=null)return lt.toVector(e)},transform(e,t,n){const r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||$2},threshold(e){return lt.toVector(e,0)}},A2=0,ra=Ge(Ge({},DS),{},{axis(e,t,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(e=A2){return e},bounds(e={}){if(typeof e=="function")return s=>ra.bounds(e(s));if("current"in e)return()=>e.current;if(typeof HTMLElement=="function"&&e instanceof HTMLElement)return e;const{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:o=1/0}=e;return[[t,n],[r,o]]}}),oa=typeof window<"u"&&window.document&&window.document.createElement;function NS(){return oa&&"ontouchstart"in window}function M2(){return NS()||oa&&window.navigator.maxTouchPoints>1}function O2(){return oa&&"onpointerdown"in window}function R2(){return oa&&"exitPointerLock"in window.document}function j2(){try{return"constructor"in GestureEvent}catch{return!1}}const un={isBrowser:oa,gesture:j2(),touch:NS(),touchscreen:M2(),pointer:O2(),pointerLock:R2()},D2=250,N2=180,L2=.5,F2=50,B2=250,z2=10,cy={mouse:0,touch:0,pen:8};Ge(Ge({},ra),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:o=!1}={}}){return this.pointerLock=r&&un.pointerLock,un.touch&&n?"touch":this.pointerLock?"mouse":un.pointer&&!o?"pointer":un.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&e?D2:void 0,!(!un.touchscreen||n===!1))return e||(n!==void 0?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:o=!0}={}}){return this.pointerButtons=r,this.keys=o,!this.pointerLock&&this.device==="pointer"&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:o=void 0}){const s=lt.toVector(e,n?r:o?1:0);return this.filterTaps=n,this.tapsThreshold=r,s},swipe({velocity:e=L2,distance:t=F2,duration:n=B2}={}){return{velocity:this.transform(lt.toVector(e)),distance:this.transform(lt.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return N2;case!1:return 0;default:return e}},axisThreshold(e){return e?Ge(Ge({},cy),e):cy},keyboardDisplacement(e=z2){return e}});function LS(e){const[t,n]=e.overflow,[r,o]=e._delta,[s,i]=e._direction;(t<0&&r>0&&s<0||t>0&&r<0&&s>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&o>0&&i<0||n>0&&o<0&&i>0)&&(e._movement[1]=e._movementBound[1])}const U2=30,V2=100;class K2 extends jS{constructor(...t){super(...t),ht(this,"ingKey","pinching"),ht(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const t=this.state;t._touchIds=[],t.canceled=!1,t.cancel=this.cancel.bind(this),t.turns=0}computeOffset(){const{type:t,movement:n,lastOffset:r}=this.state;t==="wheel"?this.state.offset=lt.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:t,lastOffset:n}=this.state;this.state.movement=[t[0]/n[0],t[1]-n[1]]}axisIntent(){const t=this.state,[n,r]=t._movement;if(!t.axis){const o=Math.abs(n)*U2-Math.abs(r);o<0?t.axis="angle":o>0&&(t.axis="scale")}}restrictToAxis(t){this.config.lockDirection&&(this.state.axis==="scale"?t[1]=0:this.state.axis==="angle"&&(t[0]=0))}cancel(){const t=this.state;t.canceled||setTimeout(()=>{t.canceled=!0,t._active=!1,this.compute(),this.emit()},0)}touchStart(t){this.ctrl.setEventIds(t);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(s=>r.has(s))||r.size<2)return;this.start(t),n._touchIds=Array.from(r).slice(0,2);const o=ry(t,n._touchIds);o&&this.pinchStart(t,o)}pointerStart(t){if(t.buttons!=null&&t.buttons%2!==1)return;this.ctrl.setEventIds(t),t.target.setPointerCapture(t.pointerId);const n=this.state,r=n._pointerEvents,o=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(i=>o.has(i))||(r.size<2&&r.set(t.pointerId,t),n._pointerEvents.size<2))return;this.start(t);const s=xf(...Array.from(r.values()));s&&this.pinchStart(t,s)}pinchStart(t,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(t),this.emit()}touchMove(t){if(!this.state._active)return;const n=ry(t,this.state._touchIds);n&&this.pinchMove(t,n)}pointerMove(t){const n=this.state._pointerEvents;if(n.has(t.pointerId)&&n.set(t.pointerId,t),!this.state._active)return;const r=xf(...Array.from(n.values()));r&&this.pinchMove(t,r)}pinchMove(t,n){const r=this.state,o=r._values[1],s=n.angle-o;let i=0;Math.abs(s)>270&&(i+=Math.sign(s)),this.computeValues([n.distance,n.angle-360*i]),r.origin=n.origin,r.turns=i,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(t),this.emit()}touchEnd(t){this.ctrl.setEventIds(t),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(t),this.emit())}pointerEnd(t){const n=this.state;this.ctrl.setEventIds(t);try{t.target.releasePointerCapture(t.pointerId)}catch{}n._pointerEvents.has(t.pointerId)&&n._pointerEvents.delete(t.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(t),this.emit())}gestureStart(t){t.cancelable&&t.preventDefault();const n=this.state;n._active||(this.start(t),this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY],this.compute(t),this.emit())}gestureMove(t){if(t.cancelable&&t.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([t.scale,t.rotation]),n.origin=[t.clientX,t.clientY];const r=n._movement;n._movement=[t.scale-1,t.rotation],n._delta=lt.sub(n._movement,r),this.compute(t),this.emit()}gestureEnd(t){this.state._active&&(this.state._active=!1,this.compute(t),this.emit())}wheel(t){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>t[r]):!t[n])||(this.state._active?this.wheelChange(t):this.wheelStart(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(t){this.start(t),this.wheelChange(t)}wheelChange(t){"uv"in t||t.cancelable&&t.preventDefault();const r=this.state;r._delta=[-RS(t)[1]/V2*r.offset[0],0],lt.addTo(r._movement,r._delta),LS(r),this.state.origin=[t.clientX,t.clientY],this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){const n=this.config.device;n&&(t(n,"start",this[n+"Start"].bind(this)),t(n,"change",this[n+"Move"].bind(this)),t(n,"end",this[n+"End"].bind(this)),t(n,"cancel",this[n+"End"].bind(this)),t("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&t("wheel","",this.wheel.bind(this),{passive:!1})}}const W2=Ge(Ge({},DS),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!un.touch&&un.gesture)return"gesture";if(un.touch&&r)return"touch";if(un.touchscreen){if(un.pointer)return"pointer";if(un.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){const o=i=>{const a=iy(nl(n,i),{min:-1/0,max:1/0});return[a.min,a.max]},s=i=>{const a=iy(nl(r,i),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[o(),s()]:i=>[o(i),s(i)]},threshold(e,t,n){return this.lockDirection=n.axis==="lock",lt.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey(e){return e===void 0?"ctrlKey":e},pinchOnWheel(e=!0){return e}});Ge(Ge({},ra),{},{mouseOnly:(e=!0)=>e});class H2 extends T2{constructor(...t){super(...t),ht(this,"ingKey","wheeling")}wheel(t){this.state._active||this.start(t),this.wheelChange(t),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(t){const n=this.state;n._delta=RS(t),lt.addTo(n._movement,n._delta),LS(n),this.compute(t),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(t){t("wheel","",this.wheel.bind(this))}}const G2=ra;Ge(Ge({},ra),{},{mouseOnly:(e=!0)=>e});const tp=new Map,wf=new Map;function Y2(e){tp.set(e.key,e.engine),wf.set(e.key,e.resolver)}const X2={key:"pinch",engine:K2,resolver:W2},q2={key:"wheel",engine:H2,resolver:G2};function Z2(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,s;for(s=0;s<r.length;s++)o=r[s],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function Q2(e,t){if(e==null)return{};var n=Z2(e,t),r,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)r=s[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}const J2={target(e){if(e)return()=>"current"in e?e.current:e},enabled(e=!0){return e},window(e=un.isBrowser?window:void 0){return e},eventOptions({passive:e=!0,capture:t=!1}={}){return{passive:e,capture:t}},transform(e){return e}},e$=["target","eventOptions","window","enabled","transform"];function Ic(e={},t){const n={};for(const[r,o]of Object.entries(t))switch(typeof o){case"function":n[r]=o.call(n,e[r],r,e);break;case"object":n[r]=Ic(e[r],o);break;case"boolean":o&&(n[r]=e[r]);break}return n}function t$(e,t,n={}){const r=e,{target:o,eventOptions:s,window:i,enabled:a,transform:c}=r,l=Q2(r,e$);if(n.shared=Ic({target:o,eventOptions:s,window:i,enabled:a,transform:c},J2),t){const u=wf.get(t);n[t]=Ic(Ge({shared:n.shared},l),u)}else for(const u in l){const d=wf.get(u);d&&(n[u]=Ic(Ge({shared:n.shared},l[u]),d))}return n}class FS{constructor(t,n){ht(this,"_listeners",new Set),this._ctrl=t,this._gestureKey=n}add(t,n,r,o,s){const i=this._listeners,a=S2(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=Ge(Ge({},c),s);t.addEventListener(a,o,l);const u=()=>{t.removeEventListener(a,o,l),i.delete(u)};return i.add(u),u}clean(){this._listeners.forEach(t=>t()),this._listeners.clear()}}class n${constructor(){ht(this,"_timeouts",new Map)}add(t,n,r=140,...o){this.remove(t),this._timeouts.set(t,window.setTimeout(n,r,...o))}remove(t){const n=this._timeouts.get(t);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(t=>void window.clearTimeout(t)),this._timeouts.clear()}}class r${constructor(t){ht(this,"gestures",new Set),ht(this,"_targetEventStore",new FS(this)),ht(this,"gestureEventStores",{}),ht(this,"gestureTimeoutStores",{}),ht(this,"handlers",{}),ht(this,"config",{}),ht(this,"pointerIds",new Set),ht(this,"touchIds",new Set),ht(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),o$(this,t)}setEventIds(t){if(OS(t))return this.touchIds=new Set(C2(t)),this.touchIds;if("pointerId"in t)return t.type==="pointerup"||t.type==="pointercancel"?this.pointerIds.delete(t.pointerId):t.type==="pointerdown"&&this.pointerIds.add(t.pointerId),this.pointerIds}applyHandlers(t,n){this.handlers=t,this.nativeHandlers=n}applyConfig(t,n){this.config=t$(t,n,this.config)}clean(){this._targetEventStore.clean();for(const t of this.gestures)this.gestureEventStores[t].clean(),this.gestureTimeoutStores[t].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...t){const n=this.config.shared,r={};let o;if(!(n.target&&(o=n.target(),!o))){if(n.enabled){for(const i of this.gestures){const a=this.config[i],c=ly(r,a.eventOptions,!!o);if(a.enabled){const l=tp.get(i);new l(this,t,i).bind(c)}}const s=ly(r,n.eventOptions,!!o);for(const i in this.nativeHandlers)s(i,"",a=>this.nativeHandlers[i](Ge(Ge({},this.state.shared),{},{event:a,args:t})),void 0,!0)}for(const s in r)r[s]=_2(...r[s]);if(!o)return r;for(const s in r){const{device:i,capture:a,passive:c}=b2(s);this._targetEventStore.add(o,i,"",r[s],{capture:a,passive:c})}}}}function Fo(e,t){e.gestures.add(t),e.gestureEventStores[t]=new FS(e,t),e.gestureTimeoutStores[t]=new n$}function o$(e,t){t.drag&&Fo(e,"drag"),t.wheel&&Fo(e,"wheel"),t.scroll&&Fo(e,"scroll"),t.move&&Fo(e,"move"),t.pinch&&Fo(e,"pinch"),t.hover&&Fo(e,"hover")}const ly=(e,t,n)=>(r,o,s,i={},a=!1)=>{var c,l;const u=(c=i.capture)!==null&&c!==void 0?c:t.capture,d=(l=i.passive)!==null&&l!==void 0?l:t.passive;let f=a?r:y2(r,o,u);n&&d&&(f+="Passive"),e[f]=e[f]||[],e[f].push(s)},s$=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function i$(e){const t={},n={},r=new Set;for(let o in e)s$.test(o)?(r.add(RegExp.lastMatch),n[o]=e[o]):t[o]=e[o];return[n,t,r]}function Bo(e,t,n,r,o,s){if(!e.has(n)||!tp.has(r))return;const i=n+"Start",a=n+"End",c=l=>{let u;return l.first&&i in t&&t[i](l),n in t&&(u=t[n](l)),l.last&&a in t&&t[a](l),u};o[r]=c,s[r]=s[r]||{}}function a$(e,t){const[n,r,o]=i$(e),s={};return Bo(o,n,"onDrag","drag",s,t),Bo(o,n,"onWheel","wheel",s,t),Bo(o,n,"onScroll","scroll",s,t),Bo(o,n,"onPinch","pinch",s,t),Bo(o,n,"onMove","move",s,t),Bo(o,n,"onHover","hover",s,t),{handlers:s,config:t,nativeHandlers:r}}function c$(e,t={},n,r){const o=Z.useMemo(()=>new r$(e),[]);if(o.applyHandlers(e,r),o.applyConfig(t,n),Z.useEffect(o.effect.bind(o)),Z.useEffect(()=>o.clean.bind(o),[]),t.target===void 0)return o.bind.bind(o)}function l$(e){return e.forEach(Y2),function(n,r){const{handlers:o,nativeHandlers:s,config:i}=a$(n,r||{});return c$(o,i,void 0,s)}}const uy=10,u$=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function BS(e){let{deltaY:t,deltaX:n}=e,r=0;if(e.ctrlKey||e.altKey||e.metaKey){const o=Math.sign(e.deltaY),s=Math.abs(e.deltaY);let i=t;s>uy&&(i=uy*o),r=i/100}else e.shiftKey&&!u$&&(n=t,t=0);return{x:-n,y:-t,z:-r}}const d$=l$([q2,X2]);let zo;const f$=e=>zo===void 0?(zo=e,!1):e-zo>120&&e-zo<160?(zo=e,!0):(zo=e,!1);function h$(e){const t=U(),n=g.useMemo(()=>{let r="not sure";const o=({event:m})=>{if(!t.getInstanceState().isFocused||(r="not sure",f$(Date.now())))return;const y=t.getEditingShapeId();if(y){const S=t.getShape(y);if(S&&t.getShapeUtil(S).canScroll(S)){const P=t.getShapePageBounds(y);if(P!=null&&P.containsPoint(t.inputs.currentPagePoint))return}}_e(m);const b=BS(m);if(b.x===0&&b.y===0)return;const x=t.getContainer().getBoundingClientRect(),w={type:"wheel",name:"wheel",delta:b,point:new k(m.clientX,m.clientY).sub({x:x.left,y:x.top}),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey};t.dispatch(w)};let s=1,i=1,a=1,c=0;const l=new k,u=new k,d=m=>{const y=e.current;r="not sure";const{event:b,origin:x,da:w}=m;b instanceof WheelEvent||(b.target===y||y!=null&&y.contains(b.target))&&(u.x=x[0],u.y=x[1],l.x=x[0],l.y=x[1],s=w[0],i=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:x[0],y:x[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey}))},f=m=>{if(m&&(r="zooming"),r==="zooming")return;const y=Math.abs(c-s),b=k.Dist(l,u);switch(r){case"not sure":{y>24?r="zooming":b>16&&(r="panning");break}case"panning":{y>64&&(r="zooming");break}}};return{onWheel:o,onPinchStart:d,onPinchEnd:m=>{const y=e.current,{event:b,origin:x,offset:w}=m;if(b instanceof WheelEvent||!(b.target===y||y!=null&&y.contains(b.target)))return;const S=w[0];r="not sure",requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:x[0],y:x[1],z:S},delta:{x:x[0],y:x[1]},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey})})},onPinch:m=>{const y=e.current,{event:b,origin:x,offset:w,da:S}=m;if(b instanceof WheelEvent||!(b.target===y||y!=null&&y.contains(b.target)))return;const C=m.type==="gesturechange"||m.type==="gestureend";c=S[0];const P=x[0]-u.x,E=x[1]-u.y;switch(u.x=x[0],u.y=x[1],f(C),r){case"zooming":{a=w[0],t.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:a},delta:{x:P,y:E},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey});break}case"panning":{t.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:i},delta:{x:P,y:E},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey});break}}}}},[t,e]);d$(n,{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}function Yu(e,t,n){const r=e.getShape(t),o=e.getShapeHandles(r);return{shape:r,handle:o.find(s=>s.id===n)}}function p$(e,t){const n=U();return g.useMemo(()=>{const r=c=>{if(c.isKilled)return;const l=el(c.currentTarget);ta(l,c);const{shape:u,handle:d}=Yu(n,e,t);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_down",...Ht(c)})};let o,s;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===o&&c.clientY===s)return;o=c.clientX,s=c.clientY;const{shape:l,handle:u}=Yu(n,e,t);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:l,name:"pointer_move",...Ht(c)})},onPointerUp:c=>{if(c.isKilled)return;const l=el(c.currentTarget);na(l,c);const{shape:u,handle:d}=Yu(n,e,t);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_up",...Ht(c)})}}},[n,e,t])}var zS="Expected a function",dy=NaN,g$="[object Symbol]",m$=/^\s+|\s+$/g,y$=/^[-+]0x[0-9a-f]+$/i,v$=/^0b[01]+$/i,b$=/^0o[0-7]+$/i,S$=parseInt,x$=typeof Ue=="object"&&Ue&&Ue.Object===Object&&Ue,w$=typeof self=="object"&&self&&self.Object===Object&&self,C$=x$||w$||Function("return this")(),P$=Object.prototype,E$=P$.toString,_$=Math.max,I$=Math.min,Xu=function(){return C$.Date.now()};function k$(e,t,n){var r,o,s,i,a,c,l=0,u=!1,d=!1,f=!0;if(typeof e!="function")throw new TypeError(zS);t=fy(t)||0,rl(n)&&(u=!!n.leading,d="maxWait"in n,s=d?_$(fy(n.maxWait)||0,t):s,f="trailing"in n?!!n.trailing:f);function p(P){var E=r,_=o;return r=o=void 0,l=P,i=e.apply(_,E),i}function v(P){return l=P,a=setTimeout(b,t),u?p(P):i}function m(P){var E=P-c,_=P-l,$=t-E;return d?I$($,s-_):$}function y(P){var E=P-c,_=P-l;return c===void 0||E>=t||E<0||d&&_>=s}function b(){var P=Xu();if(y(P))return x(P);a=setTimeout(b,m(P))}function x(P){return a=void 0,f&&r?p(P):(r=o=void 0,i)}function w(){a!==void 0&&clearTimeout(a),l=0,r=c=o=a=void 0}function S(){return a===void 0?i:x(Xu())}function C(){var P=Xu(),E=y(P);if(r=arguments,o=this,c=P,E){if(a===void 0)return v(c);if(d)return a=setTimeout(b,t),p(c)}return a===void 0&&(a=setTimeout(b,t)),i}return C.cancel=w,C.flush=S,C}function T$(e,t,n){var r=!0,o=!0;if(typeof e!="function")throw new TypeError(zS);return rl(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),k$(e,t,{leading:r,maxWait:t,trailing:o})}function rl(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function $$(e){return!!e&&typeof e=="object"}function A$(e){return typeof e=="symbol"||$$(e)&&E$.call(e)==g$}function fy(e){if(typeof e=="number")return e;if(A$(e))return dy;if(rl(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=rl(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(m$,"");var n=v$.test(e);return n||b$.test(e)?S$(e.slice(2),n?2:8):y$.test(e)?dy:+e}var M$=T$;const O$=As(M$);function R$(){const e=U();g.useLayoutEffect(()=>{const t=O$(()=>{e.updateViewportScreenBounds()},200,{trailing:!0});e.updateViewportScreenBounds();const n=setInterval(t,1e3);return window.addEventListener("resize",t),window.addEventListener("scroll",t),()=>{clearInterval(n),window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}},[e])}const ke=class ke{constructor(t,n,r,o,s,i){I(this,"a",1);I(this,"b",0);I(this,"c",0);I(this,"d",1);I(this,"e",0);I(this,"f",0);this.a=t,this.b=n,this.c=r,this.d=o,this.e=s,this.f=i}equals(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(t){const n=t,{a:r,b:o,c:s,d:i,e:a,f:c}=this;return this.a=r*n.a+s*n.b,this.c=r*n.c+s*n.d,this.e=r*n.e+s*n.f+a,this.b=o*n.a+i*n.b,this.d=o*n.c+i*n.d,this.f=o*n.e+i*n.f+c,this}rotate(t,n,r){return t===0?this:n===void 0?this.multiply(ke.Rotate(t)):this.translate(n,r).multiply(ke.Rotate(t)).translate(-n,-r)}translate(t,n){return this.multiply(ke.Translate(t,n))}scale(t,n){return this.multiply(ke.Scale(t,n))}invert(){const{a:t,b:n,c:r,d:o,e:s,f:i}=this,a=t*o-n*r;return this.a=o/a,this.b=n/-a,this.c=r/-a,this.d=t/a,this.e=(o*s-r*i)/-a,this.f=(n*s-t*i)/a,this}applyToPoint(t){return ke.applyToPoint(this,t)}applyToPoints(t){return ke.applyToPoints(this,t)}rotation(){return ke.Rotation(this)}point(){return ke.Point(this)}decomposed(){return ke.Decompose(this)}toCssString(){return ke.toCssString(this)}setTo(t){return Object.assign(this,t),this}decompose(){return ke.Decompose(this)}clone(){return new ke(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ke(1,0,0,1,0,0)}static Translate(t,n){return new ke(1,0,0,1,t,n)}static Rotate(t,n,r){if(t===0)return ke.Identity();const o=Math.cos(t),s=Math.sin(t),i=new ke(o,s,-s,o,0,0);return n===void 0?i:ke.Compose(ke.Translate(n,r),i,ke.Translate(-n,-r))}static Multiply(t,n){return{a:t.a*n.a+t.c*n.b,c:t.a*n.c+t.c*n.d,e:t.a*n.e+t.c*n.f+t.e,b:t.b*n.a+t.d*n.b,d:t.b*n.c+t.d*n.d,f:t.b*n.e+t.d*n.f+t.f}}static Inverse(t){const n=t.a*t.d-t.b*t.c;return{a:t.d/n,b:t.b/-n,c:t.c/-n,d:t.a/n,e:(t.d*t.e-t.c*t.f)/-n,f:(t.b*t.e-t.a*t.f)/n}}static Absolute(t){const n=t.a*t.d-t.b*t.c;return{a:t.d/n,b:t.b/-n,c:t.c/-n,d:t.a/n,e:(t.d*t.e-t.c*t.f)/n,f:(t.b*t.e-t.a*t.f)/-n}}static Compose(...t){const n=ke.Identity();for(let r=0,o=t.length;r<o;r++)n.multiply(t[r]);return n}static Point(t){return new k(t.e,t.f)}static Rotation(t){let n;if(t.a!==0||t.c!==0){const r=Math.hypot(t.a,t.c);n=Math.acos(t.a/r)*(t.c>0?-1:1)}else if(t.b!==0||t.d!==0){const r=Math.hypot(t.b,t.d);n=$t+Math.acos(t.b/r)*(t.d>0?-1:1)}else n=0;return vf(n)}static Decompose(t){let n,r,o;if(t.a!==0||t.c!==0){const s=Math.hypot(t.a,t.c);n=s,r=(t.a*t.d-t.b*t.c)/s,o=Math.acos(t.a/s)*(t.c>0?-1:1)}else if(t.b!==0||t.d!==0){const s=Math.hypot(t.b,t.d);n=(t.a*t.d-t.b*t.c)/s,r=s,o=$t+Math.acos(t.b/s)*(t.d>0?-1:1)}else n=0,r=0,o=0;return{x:t.e,y:t.f,scaleX:n,scaleY:r,rotation:vf(o)}}static Smooth(t,n=1e10){return t.a=Math.round(t.a*n)/n,t.b=Math.round(t.b*n)/n,t.c=Math.round(t.c*n)/n,t.d=Math.round(t.d*n)/n,t.e=Math.round(t.e*n)/n,t.f=Math.round(t.f*n)/n,t}static toCssString(t){return`matrix(${L(t.a)}, ${L(t.b)}, ${L(t.c)}, ${L(t.d)}, ${L(t.e)}, ${L(t.f)})`}static applyToPoint(t,n){return new k(t.a*n.x+t.c*n.y+t.e,t.b*n.x+t.d*n.y+t.f,n.z)}static applyToXY(t,n,r){return[t.a*n+t.c*r+t.e,t.b*n+t.d*r+t.f]}static applyToPoints(t,n){return n.map(r=>new k(t.a*r.x+t.c*r.y+t.e,t.b*r.x+t.d*r.y+t.f,r.z))}static applyToBounds(t,n){return new ce(t.e+n.minX,t.f+n.minY,n.width,n.height)}static From(t){return new ke(t.a,t.b,t.c,t.d,t.e,t.f)}static Cast(t){return t instanceof ke?t:ke.From(t)}};I(ke,"Scale",(t,n,r,o)=>{const s=new ke(t,0,0,0,n,0);return r===void 0?s:ke.Compose(ke.Translate(r,o),s,ke.Translate(-r,-o))});let ie=ke;function j$(e=!0){const[t,n]=g.useState(0),r=U();g.useEffect(()=>{if(!e)return;const o=()=>n(s=>s+1);return r.on("tick",o),()=>{r.off("tick",o)}},[r,e])}const D$=Te(function({showStroke:t=!0,showVertices:n=!0,showClosestPointOnOutline:r=!0}){const o=U();j$(r);const s=o.getZoomLevel(),i=o.getRenderingShapes(),{inputs:{currentPagePoint:a}}=o;return h.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:i.map(c=>{const l=o.getShape(c.id);if(l.type==="group")return null;const u=o.getShapeGeometry(l),d=o.getShapePageTransform(l),f=o.getPointInShapeSpace(l,a),p=u.nearestPoint(f),v=u.distanceToPoint(f,!0),m=Math.abs(v)*s,y=v<0,{vertices:b}=u;return h.jsxs("g",{transform:d.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[t&&h.jsx("path",{stroke:"red",strokeWidth:"2",fill:"none",opacity:"1",d:u.toSimpleSvgPath()}),n&&b.map((x,w)=>h.jsx("circle",{cx:x.x,cy:x.y,r:"2",fill:`hsl(${Hc(w,[0,b.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${w}`)),r&&m<150&&h.jsx("line",{x1:p.x,y1:p.y,x2:f.x,y2:f.y,opacity:1-m/150,stroke:y?"goldenrod":"dodgerblue",strokeWidth:"2"})]},c.id+"_outline")})})});var N$=200,np="__lodash_hash_undefined__",L$=1/0,F$="[object Function]",B$="[object GeneratorFunction]",z$=/[\\^$.*+?()[\]{}|]/g,U$=/^\[object .+?Constructor\]$/,V$=typeof Ue=="object"&&Ue&&Ue.Object===Object&&Ue,K$=typeof self=="object"&&self&&self.Object===Object&&self,rp=V$||K$||Function("return this")();function W$(e,t){var n=e?e.length:0;return!!n&&G$(e,t,0)>-1}function H$(e,t,n,r){for(var o=e.length,s=n+-1;++s<o;)if(t(e[s],s,e))return s;return-1}function G$(e,t,n){if(t!==t)return H$(e,Y$,n);for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}function Y$(e){return e!==e}function X$(e,t){return e.has(t)}function q$(e,t){return e==null?void 0:e[t]}function Z$(e){var t=!1;if(e!=null&&typeof e.toString!="function")try{t=!!(e+"")}catch{}return t}function US(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var Q$=Array.prototype,J$=Function.prototype,VS=Object.prototype,qu=rp["__core-js_shared__"],hy=function(){var e=/[^.]+$/.exec(qu&&qu.keys&&qu.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),KS=J$.toString,op=VS.hasOwnProperty,eA=VS.toString,tA=RegExp("^"+KS.call(op).replace(z$,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nA=Q$.splice,rA=sp(rp,"Map"),Zu=sp(rp,"Set"),zi=sp(Object,"create");function bo(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function oA(){this.__data__=zi?zi(null):{}}function sA(e){return this.has(e)&&delete this.__data__[e]}function iA(e){var t=this.__data__;if(zi){var n=t[e];return n===np?void 0:n}return op.call(t,e)?t[e]:void 0}function aA(e){var t=this.__data__;return zi?t[e]!==void 0:op.call(t,e)}function cA(e,t){var n=this.__data__;return n[e]=zi&&t===void 0?np:t,this}bo.prototype.clear=oA;bo.prototype.delete=sA;bo.prototype.get=iA;bo.prototype.has=aA;bo.prototype.set=cA;function Fs(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function lA(){this.__data__=[]}function uA(e){var t=this.__data__,n=Fl(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():nA.call(t,n,1),!0}function dA(e){var t=this.__data__,n=Fl(t,e);return n<0?void 0:t[n][1]}function fA(e){return Fl(this.__data__,e)>-1}function hA(e,t){var n=this.__data__,r=Fl(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}Fs.prototype.clear=lA;Fs.prototype.delete=uA;Fs.prototype.get=dA;Fs.prototype.has=fA;Fs.prototype.set=hA;function Bs(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function pA(){this.__data__={hash:new bo,map:new(rA||Fs),string:new bo}}function gA(e){return Bl(this,e).delete(e)}function mA(e){return Bl(this,e).get(e)}function yA(e){return Bl(this,e).has(e)}function vA(e,t){return Bl(this,e).set(e,t),this}Bs.prototype.clear=pA;Bs.prototype.delete=gA;Bs.prototype.get=mA;Bs.prototype.has=yA;Bs.prototype.set=vA;function ol(e){var t=-1,n=e?e.length:0;for(this.__data__=new Bs;++t<n;)this.add(e[t])}function bA(e){return this.__data__.set(e,np),this}function SA(e){return this.__data__.has(e)}ol.prototype.add=ol.prototype.push=bA;ol.prototype.has=SA;function Fl(e,t){for(var n=e.length;n--;)if(kA(e[n][0],t))return n;return-1}function xA(e){if(!WS(e)||EA(e))return!1;var t=TA(e)||Z$(e)?tA:U$;return t.test(_A(e))}function wA(e,t,n){var r=-1,o=W$,s=e.length,i=!0,a=[],c=a;if(s>=N$){var l=CA(e);if(l)return US(l);i=!1,o=X$,c=new ol}else c=a;e:for(;++r<s;){var u=e[r],d=u;if(u=u!==0?u:0,i&&d===d){for(var f=c.length;f--;)if(c[f]===d)continue e;a.push(u)}else o(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}var CA=Zu&&1/US(new Zu([,-0]))[1]==L$?function(e){return new Zu(e)}:$A;function Bl(e,t){var n=e.__data__;return PA(t)?n[typeof t=="string"?"string":"hash"]:n.map}function sp(e,t){var n=q$(e,t);return xA(n)?n:void 0}function PA(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function EA(e){return!!hy&&hy in e}function _A(e){if(e!=null){try{return KS.call(e)}catch{}try{return e+""}catch{}}return""}function IA(e){return e&&e.length?wA(e):[]}function kA(e,t){return e===t||e!==e&&t!==t}function TA(e){var t=WS(e)?eA.call(e):"";return t==F$||t==B$}function WS(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function $A(){}var AA=IA;const MA=As(AA);function HS(e){return MA(e)}function OA(){const e=U(),t=g.useMemo(()=>e.store.query.records("instance_presence",()=>({userId:{neq:e.user.getId()}})),[e]),n=aS("userIds",()=>HS(t.get().map(r=>r.userId)).sort(),{isEqual:(r,o)=>{var s;return r.join(",")===((s=o.join)==null?void 0:s.call(o,","))}},[t]);return Y(n)}function GS(e){const t=U(),n=g.useMemo(()=>t.store.query.records("instance_presence",()=>({userId:{eq:e}})),[t,e]);return Y(`latestPresence:${e}`,()=>n.get().slice().sort((o,s)=>s.lastActivityTimestamp-o.lastActivityTimestamp)[0],[])??null}const RA=Te(function(){const t=OA();return h.jsx(h.Fragment,{children:t.map(n=>h.jsx(jA,{collaboratorId:n},n))})}),jA=Te(function({collaboratorId:t}){const n=U(),r=GS(t),o=NA(r);if(!(r&&r.currentPageId===n.getCurrentPageId()))return null;switch(o){case"inactive":{const{followingUserId:s,highlightedUserIds:i}=n.getInstanceState();if(!(s===r.userId||i.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=n.getInstanceState();if(r.followingUserId===n.user.getId()&&!(r.chatMessage||s.includes(r.userId)))return null;break}}return h.jsx(DA,{latestPresence:r})}),DA=Te(function({latestPresence:t}){const n=U(),{CollaboratorBrush:r,CollaboratorScribble:o,CollaboratorCursor:s,CollaboratorHint:i,CollaboratorShapeIndicator:a}=ot(),c=n.getZoomLevel(),l=n.getViewportPageBounds(),{userId:u,chatMessage:d,brush:f,scribbles:p,selectedShapeIds:v,userName:m,cursor:y,color:b}=t,x=!(y.x<l.minX-12/c||y.y<l.minY-16/c||y.x>l.maxX-12/c||y.y>l.maxY-16/c);return h.jsxs(h.Fragment,{children:[f&&r?h.jsx(r,{className:"tl-collaborator__brush",brush:f,color:b,opacity:.1},u+"_brush"):null,x&&s?h.jsx(s,{className:"tl-collaborator__cursor",point:y,color:b,zoom:c,name:m!=="New User"?m:null,chatMessage:d},u+"_cursor"):i?h.jsx(i,{className:"tl-collaborator__cursor-hint",point:y,color:b,zoom:c,viewport:l},u+"_cursor_hint"):null,o&&p.length?h.jsx(h.Fragment,{children:p.map(w=>h.jsx(o,{className:"tl-collaborator__scribble",scribble:w,color:b,zoom:c,opacity:w.color==="laser"?.5:.1},u+"_scribble_"+w.id))}):null,a&&v.map(w=>h.jsx(a,{className:"tl-collaborator__shape-indicator",id:w,color:b,opacity:.5},u+"_"+w))]})});function py(e){return e>BT?"inactive":e>TS?"idle":"active"}function NA(e){const t=g.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[n,r]=g.useState(()=>py(Date.now()-t.current));return g.useEffect(()=>{const o=setInterval(()=>{r(py(Date.now()-t.current))},zT);return()=>clearInterval(o)},[]),e&&(t.current=e.lastActivityTimestamp),n}function YS(e,t){return t===0?e:YS(t,e%t)}function XS(e){const t=e.toString().split(".")[1];if(!t)return 1;const n=Math.pow(10,t.length),r=parseInt(t,10);return n/YS(r,n)}function LA(){const e=U(),t=ut();g.useEffect(()=>Ji("useDPRMultiple",()=>{const n=e.getInstanceState().devicePixelRatio;t.style.setProperty("--tl-dpr-multiple",XS(n).toString())}),[e,t])}const qS=Te(function({id:t,shape:n,util:r,index:o,backgroundIndex:s,opacity:i,isCulled:a}){const c=U(),{ShapeErrorFallback:l}=ot(),u=g.useRef(null),d=g.useRef(null),f=g.useCallback((v,m)=>{var y,b;(y=u.current)==null||y.style.setProperty(v,m),(b=d.current)==null||b.style.setProperty(v,m)},[]);mo("set shape container transform position",()=>{if(!c.getShape(t))return;const m=c.getShapePageTransform(t),y=ie.toCssString(m);f("transform",y)},[c,f]),mo("set shape container clip path",()=>{if(!c.getShape(t))return null;const m=c.getShapeClipPath(t);f("clip-path",m??"none")},[c,f]),mo("set shape height and width",()=>{const v=c.getShape(t);if(!v)return null;const m=c.getShapeGeometry(v).bounds,y=Math.floor(c.getInstanceState().devicePixelRatio*100)/100,b=XS(y),x=m.w%b,w=x===0?m.w:m.w+(b-x),S=m.h%b,C=S===0?m.h:m.h+(b-S);f("width",Math.max(w,b)+"px"),f("height",Math.max(C,b)+"px")},[c]),g.useLayoutEffect(()=>{var v,m;f("opacity",i+""),(v=u.current)==null||v.style.setProperty("z-index",o+""),(m=d.current)==null||m.style.setProperty("z-index",s+"")},[i,o,s,f]);const p=g.useCallback(v=>{c.annotateError(v,{origin:"react.shape",willCrashApp:!1})},[c]);return n?h.jsxs(h.Fragment,{children:[r.backgroundComponent&&h.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":n.type,draggable:!1,children:!a&&h.jsx(Bi,{fallback:l,onError:p,children:h.jsx(BA,{shape:n,util:r})})}),h.jsx("div",{ref:u,className:"tl-shape","data-shape-type":n.type,draggable:!1,children:a?h.jsx(zA,{shape:n}):h.jsx(Bi,{fallback:l,onError:p,children:h.jsx(FA,{shape:n,util:r})})})]}):null}),FA=g.memo(function({shape:t,util:n}){return $l("InnerShape:"+t.type,()=>n.component(t))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util),BA=g.memo(function({shape:t,util:n}){return $l("InnerShape:"+t.type,()=>{var r;return(r=n.backgroundComponent)==null?void 0:r.call(n,t)})},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),zA=g.memo(function({shape:t}){const r=U().getShapeGeometry(t).bounds;return h.jsx("div",{className:"tl-shape__culled",style:{transform:`translate(${L(r.minX)}px, ${L(r.minY)}px)`,width:Math.max(1,L(r.width)),height:Math.max(1,L(r.height))}})},()=>!0);function ZS({className:e}){const t=U(),{Background:n,SvgDefs:r}=ot(),o=Z.useRef(null),s=Z.useRef(null),i=Z.useRef(null);R$(),pT(),fT(),h$(o),u2(o),mo("position layers",()=>{const f=s.current;if(!f)return;const p=i.current;if(!p)return;const{x:v,y:m,z:y}=t.getCamera(),b=y>=1?Hc(y,[1,8],[.125,.5],!0):Hc(y,[.1,1],[-2,.125],!0),x=`scale(${L(y)}) translate(${L(v+b)}px,${L(m+b)}px)`;f.style.setProperty("transform",x),p.style.setProperty("transform",x)},[t]);const a=dT(),c=Y("shapeSvgDefs",()=>{const f=new Map;for(const p of qe(t.shapeUtils)){if(!p)return;const v=p.getCanvasSvgDefs();for(const{key:m,component:y}of v)f.has(m)||f.set(m,h.jsx(y,{},m))}return[...f.values()]},[t]),l=Y("debug_shapes",()=>ze.hideShapes.get(),[ze]),u=Y("debug_svg",()=>ze.debugSvg.get(),[ze]),d=Y("debug_geometry",()=>ze.debugGeometry.get(),[ze]);return h.jsxs("div",{ref:o,draggable:!1,className:ue("tl-canvas",e),"data-testid":"canvas",...a,children:[n&&h.jsx(n,{}),h.jsx(UA,{}),h.jsx(iM,{}),h.jsx("svg",{className:"tl-svg-context",children:h.jsxs("defs",{children:[c,h.jsx(tM,{}),h.jsx(nM,{}),h.jsx(rM,{}),h.jsx(oM,{}),r&&h.jsx(r,{})]})}),h.jsxs("div",{ref:s,className:"tl-html-layer tl-shapes",draggable:!1,children:[h.jsx(lM,{}),h.jsx(cM,{}),l?null:u?h.jsx(qA,{}):h.jsx(ZA,{})]}),h.jsxs("div",{className:"tl-fixed-layer tl-overlays",children:[h.jsxs("div",{ref:i,className:"tl-html-layer",children:[d?h.jsx(D$,{}):null,h.jsx(YA,{}),h.jsx(KA,{}),h.jsx(VA,{}),h.jsx(WA,{}),h.jsx(QA,{}),h.jsx(JA,{}),h.jsx(eM,{}),h.jsx(HA,{}),h.jsx(aM,{}),h.jsx(RA,{})]}),h.jsx(uM,{})]})]})}function UA(){const e=U(),t=Y("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:o}=Y("camera",()=>e.getCamera(),[e]),s=Y("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:i}=ot();return i&&s?h.jsx(i,{x:n,y:r,z:o,size:t}):null}function VA(){const e=U(),t=Y("scribbles",()=>e.getInstanceState().scribbles,[e]),n=Y("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=ot();return r&&t.length?h.jsx(h.Fragment,{children:t.map(o=>h.jsx(r,{className:"tl-user-scribble",scribble:o,zoom:n},o.id))}):null}function KA(){const e=U(),t=Y("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=ot();return n&&t?h.jsx(n,{className:"tl-user-brush",brush:t}):null}function WA(){const e=U(),t=Y("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=ot();return n&&t?h.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function HA(){const e=U(),t=Y("snapLines",()=>e.snaps.getLines(),[e]),n=Y("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapLine:r}=ot();return r&&t.length>0?h.jsx(h.Fragment,{children:t.map(o=>h.jsx(r,{className:"tl-user-snapline",line:o,zoom:n},o.id))}):null}const GA=48;function YA(){const e=U(),{Handles:t}=ot(),n=Y("zoomLevel",()=>e.getZoomLevel(),[e]),r=Y("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),o=Y("onlySelectedShape",()=>e.getOnlySelectedShape(),[e]),s=Y("isChangingStyle",()=>e.getInstanceState().isChangingStyle,[e]),i=Y("isChangingStyle",()=>e.getInstanceState().isReadonly,[e]),a=Y("handles",()=>{const u=e.getOnlySelectedShape();if(u)return e.getShapeHandles(u)},[e]),c=Y("transform",()=>{const u=e.getOnlySelectedShape();if(u)return e.getShapePageTransform(u)},[e]);if(!t||!o||s||i||!a||!c)return null;const l=[];for(let u=0,d=a[u];u<a.length;u++,d=a[u]){if(d.type!=="vertex"){const f=a[u-1],p=a[u+1];if(f&&p&&Math.hypot(f.y-p.y,f.x-p.x)<GA/n)continue}l.push(d)}return l.sort(u=>u.type==="vertex"?1:-1),h.jsx(t,{children:h.jsx("g",{transform:ie.toCssString(c),children:l.map(u=>h.jsx(XA,{shapeId:o.id,handle:u,zoom:n,isCoarse:r},u.id))})})}function XA({shapeId:e,handle:t,zoom:n,isCoarse:r}){const o=p$(e,t.id),{Handle:s}=ot();return s?h.jsx("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...o,children:h.jsx(s,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function qA(){const e=U(),t=Y("rendering shapes",()=>e.getRenderingShapes(),[e]);return h.jsx(h.Fragment,{children:t.map(n=>h.jsxs(Z.Fragment,{children:[h.jsx(qS,{...n}),h.jsx(sM,{id:n.id})]},n.id+"_fragment"))})}function ZA(){const e=U(),t=Y("rendering shapes",()=>e.getRenderingShapes(),[e]);return h.jsx(h.Fragment,{children:t.map(n=>h.jsx(qS,{...n},n.id+"_shape"))})}function QA(){const e=U(),t=Y("selectedShapeIds",()=>e.getCurrentPageState().selectedShapeIds,[e]);return Y("should display selected ids",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle,[e])?h.jsx(h.Fragment,{children:t.map(r=>h.jsx(Ll,{className:"tl-user-indicator__selected",id:r},r+"_indicator"))}):null}const JA=function(){const t=U(),{HoveredShapeIndicator:n}=ot(),r=Y("coarse pointer",()=>t.getInstanceState().isCoarsePointer,[t]),o=Y("hovering canvas",()=>t.getInstanceState().isHoveringCanvas,[t]),s=Y("hovered id",()=>t.getCurrentPageState().hoveredShapeId,[t]);return r||!o||!s||!n?null:h.jsx(n,{shapeId:s})},eM=Te(function(){const t=U(),n=Wc(t.getHintingShapeIds());return n.length?h.jsx(h.Fragment,{children:n.map(r=>h.jsx(Ll,{className:"tl-user-indicator__hint",id:r},r+"_hinting"))}):null});function tM(){return h.jsxs("g",{id:"cursor",children:[h.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[h.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),h.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),h.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[h.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),h.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),h.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[h.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),h.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function nM(){return h.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function rM(){return h.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:h.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function oM(){return h.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[h.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),h.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const sM=Te(function({id:t}){const n=U(),r=n.getShape(t),[o,s]=Z.useState(""),i=(r==null?void 0:r.parentId)===n.getCurrentPageId();return Z.useEffect(()=>{if(!i)return;let a=null;const c=Ji("shape to svg",async()=>{const l=Math.random();a=l;const u=n.getShapePageBounds(t),d=await n.getSvg([t],{padding:0});d&&u&&a===l&&(d.style.setProperty("overflow","visible"),d.setAttribute("preserveAspectRatio","xMidYMin slice"),d.style.setProperty("transform",`translate(${u.x}px, ${u.y+u.h+12}px)`),d.style.setProperty("border","1px solid black"),s(d==null?void 0:d.outerHTML))});return()=>{a=null,c()}},[n,t,i]),i?h.jsx("div",{style:{paddingTop:12,position:"absolute"},children:h.jsx("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:o}})}):null});function iM(){const e=Y("debugging ui log",()=>ze.logMessages.get(),[ze]);return e.length?h.jsx("div",{className:"debug__ui-logger",children:e.map((t,n)=>{const r=typeof t=="string"?t:JSON.stringify(t);return h.jsx("div",{className:"debug__ui-logger__line",children:r},n)})}):null}function aM(){const e=U(),t=Y("selection rotation",()=>e.getSelectionRotation(),[e]),n=Y("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=ot();return!n||!r?null:h.jsx(r,{bounds:n,rotation:t})}function cM(){const e=U(),t=Y("selection rotation",()=>e.getSelectionRotation(),[e]),n=Y("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=ot();return!n||!r?null:h.jsx(r,{bounds:n,rotation:t})}function lM(){const{OnTheCanvas:e}=ot();return e?h.jsx(e,{}):null}function uM(){const{InFrontOfTheCanvas:e}=ot();return e?h.jsx(e,{}):null}const dM=()=>h.jsx(eR,{children:"Connecting..."});let fM=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,n)=>(n&=63,n<36?t+=n.toString(36):n<62?t+=(n-26).toString(36).toUpperCase():n>62?t+="-":t+="_",t),"");function je(){return fM()}const QS="TLDRAW_USER_DATA_v3",JS=ge({id:q,name:q.nullable().optional(),locale:q.nullable().optional(),color:q.nullable().optional(),isDarkMode:le.nullable().optional(),animationSpeed:H.nullable().optional(),edgeScrollSpeed:H.nullable().optional(),isSnapMode:le.nullable().optional()}),ci={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4},sl=he({currentVersion:ci.AddEdgeScrollSpeed,migrators:{[ci.AddAnimationSpeed]:{up:e=>({...e,animationSpeed:1}),down:({animationSpeed:e,...t})=>t},[ci.AddIsSnapMode]:{up:e=>({...e,isSnapMode:!1}),down:({isSnapMode:e,...t})=>t},[ci.MakeFieldsNullable]:{up:e=>e,down:e=>({id:e.id,name:e.name??dn.name,locale:e.locale??dn.locale,color:e.color??dn.color,isDarkMode:e.isDarkMode??dn.isDarkMode,animationSpeed:e.animationSpeed??dn.animationSpeed,isSnapMode:e.isSnapMode??dn.isSnapMode})},[ci.AddEdgeScrollSpeed]:{up:e=>({...e,edgeScrollSpeed:1}),down:({edgeScrollSpeed:e,...t})=>t}}}),gy=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function hM(){return gy[Math.floor(Math.random()*gy.length)]}function pM(){var e,t;return typeof window>"u"?!1:((t=(e=window.matchMedia)==null?void 0:e.call(window,"(prefers-color-scheme: dark)"))==null?void 0:t.matches)??!1}function gM(){var e,t;return typeof window>"u"?!1:((t=(e=window.matchMedia)==null?void 0:e.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:t.matches)??!1}const dn=Object.freeze({name:"New User",locale:rT(),color:hM(),isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:gM()?0:1,isSnapMode:!1});function Ba(){return{id:je()}}function ex(e){if(e===null||typeof e!="object"||!("version"in e)||!("user"in e)||typeof e.version!="number")return Ba();const t=zh({value:e.user,fromVersion:e.version,toVersion:sl.currentVersion??0,migrations:sl});if(t.type==="error")return Ba();try{JS.validate(t.value)}catch{return Ba()}return t.value}function mM(){var t;const e=typeof window>"u"?null:JSON.parse(((t=window==null?void 0:window.localStorage)==null?void 0:t.getItem(QS))||"null")??null;return ex(e)}const sa=wt("globalUserData",mM());function yM(){typeof window<"u"&&window.localStorage&&window.localStorage.setItem(QS,JSON.stringify({version:sl.currentVersion,user:sa.get()}))}function vM(e){JS.validate(e),sa.set(e),yM(),SM()}const bM=typeof F_<"u"&&!1,us=typeof BroadcastChannel<"u"&&!bM?new BroadcastChannel("tldraw-user-sync"):null;us==null||us.addEventListener("message",e=>{const t=e.data;(t==null?void 0:t.type)===nx&&(t==null?void 0:t.origin)!==tx&&sa.set(ex(t.data))});const tx=je(),nx="tldraw-user-preferences-change";function SM(){us==null||us.postMessage({type:nx,origin:tx,data:{user:sa.get(),version:sl.currentVersion}})}function xM(){return sa.get()}function rx(e={}){return{derivePresenceState:e.derivePresenceState??(()=>X("presence",()=>null)),userPreferences:e.userPreferences??X("userPreferences",()=>xM()),setUserPreferences:e.setUserPreferences??vM}}var ox={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function o(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function s(c,l,u,d,f){if(typeof u!="function")throw new TypeError("The listener must be a function");var p=new o(u,d||c,f),v=n?n+l:l;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],p]:c._events[v].push(p):(c._events[v]=p,c._eventsCount++),c}function i(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)t.call(u,d)&&l.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=n?n+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,p=d.length,v=new Array(p);f<p;f++)v[f]=d[f].fn;return v},a.prototype.listenerCount=function(l){var u=n?n+l:l,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,u,d,f,p,v){var m=n?n+l:l;if(!this._events[m])return!1;var y=this._events[m],b=arguments.length,x,w;if(y.fn){switch(y.once&&this.removeListener(l,y.fn,void 0,!0),b){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,u),!0;case 3:return y.fn.call(y.context,u,d),!0;case 4:return y.fn.call(y.context,u,d,f),!0;case 5:return y.fn.call(y.context,u,d,f,p),!0;case 6:return y.fn.call(y.context,u,d,f,p,v),!0}for(w=1,x=new Array(b-1);w<b;w++)x[w-1]=arguments[w];y.fn.apply(y.context,x)}else{var S=y.length,C;for(w=0;w<S;w++)switch(y[w].once&&this.removeListener(l,y[w].fn,void 0,!0),b){case 1:y[w].fn.call(y[w].context);break;case 2:y[w].fn.call(y[w].context,u);break;case 3:y[w].fn.call(y[w].context,u,d);break;case 4:y[w].fn.call(y[w].context,u,d,f);break;default:if(!x)for(C=1,x=new Array(b-1);C<b;C++)x[C-1]=arguments[C];y[w].fn.apply(y[w].context,x)}}return!0},a.prototype.on=function(l,u,d){return s(this,l,u,d,!1)},a.prototype.once=function(l,u,d){return s(this,l,u,d,!0)},a.prototype.removeListener=function(l,u,d,f){var p=n?n+l:l;if(!this._events[p])return this;if(!u)return i(this,p),this;var v=this._events[p];if(v.fn)v.fn===u&&(!f||v.once)&&(!d||v.context===d)&&i(this,p);else{for(var m=0,y=[],b=v.length;m<b;m++)(v[m].fn!==u||f&&!v[m].once||d&&v[m].context!==d)&&y.push(v[m]);y.length?this._events[p]=y.length===1?y[0]:y:i(this,p)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=n?n+l:l,this._events[u]&&i(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a})(ox);var wM=ox.exports;function sx({children:e,className:t="",...n}){return h.jsx("svg",{...n,className:`tl-svg-container ${t}`,children:e})}class zl{constructor(t){I(this,"isFilled",!1);I(this,"isClosed",!0);I(this,"isLabel",!1);I(this,"isSnappable",!0);I(this,"_vertices");I(this,"_bounds");I(this,"_snapPoints");I(this,"_area");this.isFilled=t.isFilled,this.isClosed=t.isClosed,this.isSnappable=t.isSnappable??!1,this.isLabel=t.isLabel??!1}hitTestPoint(t,n=0,r=!1){return this.distanceToPoint(t,r)<=n}distanceToPoint(t,n=!1){const r=t.dist(this.nearestPoint(t));return this.isClosed&&(this.isFilled||n)&&_s(t,this.vertices)?-r:r}distanceToLineSegment(t,n){const r=this.nearestPointOnLineSegment(t,n),o=k.DistanceToLineSegment(t,n,r);return this.isClosed&&this.isFilled&&_s(r,this.vertices)?-o:o}hitTestLineSegment(t,n,r=0){return this.distanceToLineSegment(t,n)<=r}nearestPointOnLineSegment(t,n){let r=1/0,o;for(let s=0;s<this.vertices.length;s++){const i=this.vertices[s],a=k.DistanceToLineSegment(t,n,i);a<r&&(r=a,o=i)}if(!o)throw Error("nearest point not found");return o}isPointInBounds(t,n=0){const{bounds:r}=this;return!(t.x<r.minX-n||t.y<r.minY-n||t.x>r.maxX+n||t.y>r.maxY+n)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return ce.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:t}=this;let n=0;for(let r=0,o=t.length;r<o;r++){const s=t[r],i=t[(r+1)%o];n+=s.x*i.y-i.x*s.y}return n/2}toSimpleSvgPath(){let t="";const{vertices:n}=this,r=n.length;if(r===0)return t;t+=`M${n[0].x},${n[0].y}`;for(let o=1;o<r;o++)t+=`L${n[o].x},${n[o].y}`;return this.isClosed&&(t+="Z"),t}}class Ul extends zl{constructor(n){super({...n,isClosed:!0,isFilled:!1});I(this,"children");const{children:r}=n;if(r.length===0)throw Error("Group2d must have at least one child");this.children=r}getVertices(){return this.children.filter(n=>!n.isLabel).flatMap(n=>n.vertices)}nearestPoint(n){let r=1/0,o;const{children:s}=this;if(s.length===0)throw Error("no children");for(const i of s){const a=i.nearestPoint(n),c=a.dist(n);c<r&&(r=c,o=a)}if(!o)throw Error("nearest point not found");return o}distanceToPoint(n,r=!1){return Math.min(...this.children.map((o,s)=>o.distanceToPoint(n,r||s>0)))}hitTestPoint(n,r,o){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(n,r,o))}hitTestLineSegment(n,r,o){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(n,r,o))}getArea(){return this.children[0].area}toSimpleSvgPath(){let n="";for(const o of this.children)n+=o.toSimpleSvgPath();const r=ce.FromPoints(this.vertices).corners;for(let o=0,s=r.length;o<s;o++){const i=r[o],a=r[(o-1+s)%s],c=i.dist(a),l=r[(o+1)%s],u=i.dist(l),d=i.clone().lrp(a,4/c),f=i,p=i.clone().lrp(l,4/u);n+=`M${d.x},${d.y} L${f.x},${f.y} L${p.x},${p.y} `}return n}}function ip(e,t,n,r){const o=e.x-n.x,s=e.y-n.y,i=r.x-n.x,a=r.y-n.y,c=t.x-e.x,l=t.y-e.y,u=i*s-a*o,d=c*s-l*o,f=a*c-i*l;if(u===0||d===0||f===0)return null;if(f!==0){const p=u/f,v=d/f;if(0<=p&&p<=1&&0<=v&&v<=1)return k.AddXY(e,p*c,p*l)}return null}function ap(e,t,n,r){const o=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),s=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),i=n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r,a=s*s-4*o*i;if(a<0||a===0)return null;const c=Math.sqrt(a),l=(-s+c)/(2*o),u=(-s-c)/(2*o);if((l<0||l>1)&&(u<0||u>1))return null;const d=[];return 0<=l&&l<=1&&d.push(k.Lrp(e,t,l)),0<=u&&u<=1&&d.push(k.Lrp(e,t,u)),d.length===0?null:d}function CM(e,t,n){const r=[];let o;for(let s=0,i=n.length-1;s<i;s++)o=ip(e,t,n[s],n[s+1]),o&&r.push(o);return r.length===0?null:r}function PM(e,t,n){const r=[];let o;for(let s=1,i=n.length;s<i+1;s++)o=ip(e,t,n[s-1],n[s%n.length]),o&&r.push(o);return r.length===0?null:r}function tX(e,t,n,r){let o=n.x-e.x,s=n.y-e.y;const i=Math.sqrt(o*o+s*s),a=(i*i-r*r+t*t)/(2*i),c=Math.sqrt(t*t-a*a);return o/=i,s/=i,[new k(e.x+o*a-s*c,e.y+s*a+o*c),new k(e.x+o*a+s*c,e.y+s*a-o*c)]}function my(e,t,n){const r=[];let o,s,i;for(let a=0,c=n.length;a<c;a++)o=n[a],s=n[(a+1)%n.length],i=ap(o,s,e,t),i&&r.push(...i);return r.length===0?null:r}function yy(e,t,n){const r=[];let o,s,i;for(let a=1,c=n.length;a<c;a++)o=n[a-1],s=n[a],i=ap(o,s,e,t),i&&r.push(...i);return r.length===0?null:r}function za(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function ix(e,t,n,r){return za(e,n,r)!==za(t,n,r)&&za(e,t,n)!==za(e,t,r)}function Cf(e,t){const n=[];let r,o,s,i;for(let a=0,c=e.length;a<c;a++)r=e[a],_s(r,t)&&n.push(r);for(let a=0,c=t.length;a<c;a++)r=t[a],_s(r,e)&&n.push(r);for(let a=0,c=e.length;a<c;a++){r=e[a],o=e[(a+1)%e.length];for(let l=0,u=t.length;l<u;l++){s=t[l],i=t[(l+1)%t.length];const d=ip(r,o,s,i);d!==null&&n.push(d)}}return n.length===0?null:EM(n)}function EM(e){const t=k.Average(e);return e.sort((n,r)=>k.Angle(t,n)-k.Angle(t,r))}function nX(e,t){let n,r,o,s;for(let i=0,a=e.length;i<a;i++){n=e[i],r=e[(i+1)%a];for(let c=0,l=t.length;c<l;c++)if(o=t[c],s=t[(c+1)%l],ix(n,r,o,s))return!0}return!1}class Pf extends zl{constructor(n){super({...n,isClosed:!1,isFilled:!1});I(this,"start");I(this,"end");I(this,"d");I(this,"u");I(this,"ul");I(this,"_length");const{start:r,end:o}=n;this.start=r,this.end=o,this.d=r.clone().sub(o),this.u=this.d.clone().uni(),this.ul=this.u.len()}get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(n){const{start:r,end:o,u:s,ul:i}=this;if(i===0)return r;const a=k.Sub(n,r).dpr(s)/i,c=r.x+s.x*a;if(c<Math.min(r.x,o.x))return r.x<o.x?r:o;if(c>Math.max(r.x,o.x))return r.x>o.x?r:o;const l=r.y+s.y*a;return l<Math.min(r.y,o.y)?r.y<o.y?r:o:l>Math.max(r.y,o.y)?r.y>o.y?r:o:new k(c,l)}hitTestLineSegment(n,r,o){return ix(n,r,this.start,this.end)}}class ax extends zl{constructor(n){super({isClosed:!1,isFilled:!1,...n});I(this,"points");I(this,"_segments");I(this,"_length");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:n}=this;for(let r=0,o=n.length-1;r<o;r++){const s=n[r],i=n[r+1];this._segments.push(new Pf({start:s,end:i}))}this.isClosed&&this._segments.push(new Pf({start:n[n.length-1],end:n[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((n,r)=>n+r.length,0)),this._length}getVertices(){return this.points}nearestPoint(n){const{segments:r}=this;let o=this.points[0],s=1/0,i,a;for(let c=0;c<r.length;c++)i=r[c].nearestPoint(n),a=i.dist(n),a<s&&(o=i,s=a);return o}hitTestLineSegment(n,r,o){return this.segments.some(s=>s.hitTestLineSegment(n,r,o))}}class cx extends ax{constructor(t){super({...t}),this.isClosed=!0}}class lx extends cx{constructor(n){const{x:r=0,y:o=0,width:s,height:i}=n;super({...n,points:[new k(r,o),new k(r+s,o),new k(r+s,o+i),new k(r,o+i)]});I(this,"x");I(this,"y");I(this,"w");I(this,"h");this.x=r,this.y=o,this.w=s,this.h=i}getBounds(){return new ce(this.x,this.y,this.w,this.h)}}class ds{constructor(t){I(this,"canSnap",()=>!0);I(this,"canScroll",()=>!1);I(this,"canUnmount",()=>!0);I(this,"canBind",(t,n)=>!0);I(this,"canEdit",()=>!1);I(this,"canResize",()=>!0);I(this,"canTranslate",()=>!0);I(this,"canEditInReadOnly",()=>!1);I(this,"canCrop",()=>!1);I(this,"hideResizeHandles",()=>!1);I(this,"hideRotateHandle",()=>!1);I(this,"hideSelectionBoundsBg",()=>!1);I(this,"hideSelectionBoundsFg",()=>!1);I(this,"isAspectRatioLocked",()=>!1);I(this,"onBeforeCreate");I(this,"onBeforeUpdate");I(this,"onDragShapesOver");I(this,"onDragShapesOut");I(this,"onDropShapesOver");I(this,"onResizeStart");I(this,"onResize");I(this,"onResizeEnd");I(this,"onTranslateStart");I(this,"onTranslate");I(this,"onTranslateEnd");I(this,"onRotateStart");I(this,"onRotate");I(this,"onRotateEnd");I(this,"onHandleChange");I(this,"onBindingChange");I(this,"onChildrenChange");I(this,"onDoubleClickHandle");I(this,"onDoubleClickEdge");I(this,"onDoubleClick");I(this,"onClick");I(this,"onEditEnd");this.editor=t}providesBackgroundForChildren(t){return!1}getOutlineSegments(t){return[this.editor.getShapeGeometry(t).vertices]}canReceiveNewChildrenOfType(t,n){return!1}canDropShapes(t,n){return!1}expandSelectionOutlinePx(t){return 0}getCanvasSvgDefs(){return[]}}I(ds,"props"),I(ds,"migrations"),I(ds,"type");function _M(e,t,n={}){const{closed:r=!1,snap:o=1,start:s="outset",end:i="outset",lengthRatio:a=2,style:c="dashed"}=n;let l=0,u=0,d=1,f=0,p=0;switch(c){case"dashed":{d=1,l=Math.min(t*a,e/4);break}case"dotted":{d=100,l=t/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(e+=l/2,p+=l/2):s==="skip"&&(e-=l,p-=l),i==="outset"?e+=l/2:i==="skip"&&(e-=l)),u=Math.floor(e/l/(2*d)),u-=u%o,u<3&&c==="dashed"?e/t<5?(l=e,u=1,f=0):(l=e*.333,f=e*.333):(u=Math.max(u,3),l=e/u/(2*d),r?(p=l/2,f=(e-u*l)/u):f=(e-u*l)/Math.max(1,u-1)),{strokeDasharray:[l,f].join(" "),strokeDashoffset:p.toString()}}function vy({bounds:e,className:t}){const n=U(),r=Y("zoom level",()=>n.getZoomLevel(),[n]);return h.jsx("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((o,s)=>{const{strokeDasharray:i,strokeDashoffset:a}=_M(o[0].dist(o[1]),1/r,{style:"dashed",lengthRatio:4});return h.jsx("line",{x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y,strokeDasharray:i,strokeDashoffset:a},s)})})}class kc extends ds{constructor(){super(...arguments);I(this,"hideSelectionBoundsFg",()=>!0);I(this,"canBind",()=>!1);I(this,"onChildrenChange",n=>{const r=this.editor.getSortedChildIdsForParent(n.id);if(r.length===0){this.editor.getCurrentPageState().focusedGroupId===n.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([n.id]);return}else if(r.length===1){this.editor.getCurrentPageState().focusedGroupId===n.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(r,n.parentId),this.editor.deleteShapes([n.id]);return}})}getDefaultProps(){return{}}getGeometry(n){const r=this.editor.getSortedChildIdsForParent(n.id);return r.length===0?new lx({width:1,height:1,isFilled:!1}):new Ul({children:r.map(o=>{const s=this.editor.getShape(o),i=this.editor.getShapeGeometry(o),a=this.editor.getShapeLocalTransform(s).applyToPoints(i.vertices);return i.isClosed?new cx({points:a,isFilled:!0}):new ax({points:a})})})}component(n){const r=this.editor.getErasingShapeIds().includes(n.id),{hintingShapeIds:o}=this.editor.getCurrentPageState(),s=o.length>0&&o.some(c=>c!==n.id&&this.editor.isShapeOfType(this.editor.getShape(c),"group")),i=this.editor.getCurrentPageState().focusedGroupId!==n.id;if(!r&&(i||s))return null;const a=this.editor.getShapeGeometry(n).bounds;return h.jsx(sx,{id:n.id,children:h.jsx(vy,{className:"tl-group",bounds:a})})}indicator(n){const r=this.editor.getShapeGeometry(n).bounds;return h.jsx(vy,{className:"",bounds:r})}}I(kc,"type","group"),I(kc,"props",Qk),I(kc,"migrations",Jk);const ux=[kc],IM=new Set(ux.map(e=>e.type));function dx(e){const t=[...ux],n=new Set;for(const r of e){if(IM.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}function by(e,t){if(!t)return!1;switch(e.type){case"mixed":return t.type==="mixed";case"shared":return t.type==="shared"&&e.value===t.value;default:throw Dh(e)}}class kM{constructor(t){I(this,"map");this.map=new Map(t)}get(t){return this.map.get(t)}getAsKnownValue(t){const n=this.get(t);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(t){if(this.size!==t.size)return!1;const n=new Set;for(const[r,o]of this){if(!by(o,t.get(r)))return!1;n.add(r)}for(const[r,o]of t)if(!n.has(r)&&!by(o,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Ef extends kM{set(t,n){this.map.set(t,n)}applyValue(t,n){const r=this.get(t);if(!r){this.set(t,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(t,{type:"mixed"});return;default:Dh(r,"type")}}}class TM{constructor(){I(this,"items",new WeakMap)}get(t,n){return this.items.has(t)||this.items.set(t,n(t)),this.items.get(t)}access(t){return this.items.get(t)}set(t,n){this.items.set(t,n)}has(t){return this.items.has(t)}invalidate(t){this.items.delete(t)}bust(){this.items=new WeakMap}}function $M(e,t,n){return fetch(e).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],t,{type:n})})}function AM(e,t){var o;let n=e;const r=new Set(t);for(;r.has(n);)n=(o=/^.*(\d+)$/.exec(n))!=null&&o[1]?n.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${n} 1`;return n}const Kt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",MM="a0",fx="A00000000000000000000000000";function hx(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw new Error("Invalid index key head: "+e)}function px(e){if(e.length!==hx(e.charAt(0)))throw new Error("invalid integer part of index key: "+e)}function Sy(e){if(e===void 0)throw Error("n is undefined")}function xy(e){px(e);const[t,...n]=e.split("");let r=!0;for(let o=n.length-1;r&&o>=0;o--){const s=Kt.indexOf(n[o])+1;s===Kt.length?n[o]="0":(n[o]=Kt.charAt(s),r=!1)}if(r){if(t==="Z")return"a0";if(t==="z")return;const o=String.fromCharCode(t.charCodeAt(0)+1);return o>"a"?n.push("0"):n.pop(),o+n.join("")}else return t+n.join("")}function OM(e){px(e);const[t,...n]=e.split("");let r=!0;for(let o=n.length-1;r&&o>=0;o--){const s=Kt.indexOf(n[o])-1;s===-1?n[o]=Kt.slice(-1):(n[o]=Kt.charAt(s),r=!1)}if(r){if(t==="a")return"Z"+Kt.slice(-1);if(t==="A")return;const o=String.fromCharCode(t.charCodeAt(0)-1);return o<"Z"?n.push(Kt.slice(-1)):n.pop(),o+n.join("")}else return t+n.join("")}function ns(e,t){if(t!==void 0&&e>=t)throw new Error(e+" >= "+t);if(e.slice(-1)==="0"||t&&t.slice(-1)==="0")throw new Error("trailing zero");if(t){let o=0;for(;(e.charAt(o)||"0")===t.charAt(o);)o++;if(o>0)return t.slice(0,o)+ns(e.slice(o),t.slice(o))}const n=e?Kt.indexOf(e.charAt(0)):0,r=t!==void 0?Kt.indexOf(t.charAt(0)):Kt.length;if(r-n>1){const o=Math.round(.5*(n+r));return Kt.charAt(o)}else return t&&t.length>1?t.slice(0,1):Kt.charAt(n)+ns(e.slice(1),void 0)}function Pi(e){const t=hx(e.charAt(0));if(t>e.length)throw new Error("invalid index: "+e);return e.slice(0,t)}function wy(e){if(e===fx)throw new Error("invalid index: "+e);const t=Pi(e);if(e.slice(t.length).slice(-1)==="0")throw new Error("invalid index: "+e)}function Uo(e,t){if(e!==void 0&&wy(e),t!==void 0&&wy(t),e!==void 0&&t!==void 0&&e>=t)throw new Error(e+" >= "+t);if(e===void 0&&t===void 0)return MM;if(e===void 0){if(t===void 0)throw Error("b is undefined");const a=Pi(t),c=t.slice(a.length);if(a===fx)return a+ns("",c);if(a<t)return a;const l=OM(a);return Sy(l),l}if(t===void 0){const a=Pi(e),c=e.slice(a.length),l=xy(a);return l===void 0?a+ns(c,void 0):l}const n=Pi(e),r=e.slice(n.length),o=Pi(t),s=t.slice(o.length);if(n===o)return n+ns(r,s);const i=xy(n);return Sy(i),i<t?i:n+ns(r,void 0)}function zr(e,t,n){if(n===0)return[];if(n===1)return[Uo(e,t)];if(t===void 0){let s=Uo(e,t);const i=[s];for(let a=0;a<n-1;a++)s=Uo(s,t),i.push(s);return i}if(e===void 0){let s=Uo(e,t);const i=[s];for(let a=0;a<n-1;a++)s=Uo(e,s),i.push(s);return i.reverse(),i}const r=Math.floor(n/2),o=Uo(e,t);return[...zr(e,o,r),o,...zr(o,t,n-r-1)]}function Is(e,t,n){return zr(e,t,n)}function Qu(e,t){return zr(e,void 0,t)}function Tc(e,t){return zr(e,t,1)[0]}function Tr(e){return zr(e,void 0,1)[0]}function RM(e){return zr(void 0,e,1)[0]}function gx(e,t="a1"){return[t,...zr(t,void 0,e)]}function Dn(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function Ua(e,t,n){if(n.length===0)return[];const r=new Map;for(const s of fe(n.map(i=>e.getShape(i)))){const{parentId:i}=s;r.has(i)||r.set(i,{children:fe(e.getSortedChildIdsForParent(i).map(a=>e.getShape(a))),moving:new Set}),r.get(i).moving.add(s)}const o=[];switch(t){case"toBack":{r.forEach(({moving:s,children:i})=>jM(s,i,o));break}case"toFront":{r.forEach(({moving:s,children:i})=>DM(s,i,o));break}case"forward":{r.forEach(({moving:s,children:i})=>NM(s,i,o));break}case"backward":{r.forEach(({moving:s,children:i})=>LM(s,i,o));break}}return o}function jM(e,t,n){const r=t.length;if(e.size===r)return;let o,s;for(let i=0;i<r;i++){const a=t[i];if(e.has(a))o=a.index,e.delete(a);else{s=a.index;break}}if(e.size!==0){const i=Is(o,s,e.size);n.push(...Array.from(e.values()).sort(Dn).map((a,c)=>({...a,index:i[c]})))}}function DM(e,t,n){const r=t.length;if(e.size===r)return;let o,s;for(let i=r-1;i>-1;i--){const a=t[i];if(e.has(a))s=a.index,e.delete(a);else{o=a.index;break}}if(e.size!==0){const i=Is(o,s,e.size);n.push(...Array.from(e.values()).sort(Dn).map((a,c)=>({...a,index:i[c]})))}}function NM(e,t,n){var s;const r=t.length;if(e.size===r)return;let o={name:"skipping"};for(let i=0;i<r;i++){const a=e.has(t[i]);switch(o.name){case"skipping":{if(!a)continue;o={name:"selecting",selectIndex:i};break}case"selecting":{if(a)continue;const{selectIndex:c}=o;Is(t[i].index,(s=t[i+1])==null?void 0:s.index,i-c).forEach((l,u)=>n.push({...t[c+u],index:l})),o={name:"skipping"};break}}}}function LM(e,t,n){var s;const r=t.length;if(e.size===r)return;let o={name:"skipping"};for(let i=r-1;i>-1;i--){const a=e.has(t[i]);switch(o.name){case"skipping":{if(!a)continue;o={name:"selecting",selectIndex:i};break}case"selecting":{if(a)continue;Is((s=t[i-1])==null?void 0:s.index,t[i].index,o.selectIndex-i).forEach((c,l)=>{n.push({...t[i+l+1],index:c})}),o={name:"skipping"};break}}}}function FM({editor:e}){const t=e.getSelectedShapes(),n=e.getSelectionRotation(),r=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:o}}=e;if(!r)return null;const s=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:s,initialCursorAngle:s.angle(o),initialSelectionRotation:n,shapeSnapshots:t.map(i=>({shape:vo(i),initialPagePoint:e.getShapePageTransform(i.id).point()}))}}function BM({delta:e,editor:t,snapshot:n,stage:r}){const{selectionPageCenter:o,shapeSnapshots:s}=n;t.updateShapes(s.map(({shape:a,initialPagePoint:c})=>{const l=Sn(a.parentId)?t.getShapePageTransform(a.parentId):ie.Identity(),u=k.RotWith(c,o,e),d=ie.applyToPoint(ie.Inverse(l),u),f=or(a.rotation+e);return{id:a.id,type:a.type,x:d.x,y:d.y,rotation:f}}));const i=[];s.forEach(({shape:a})=>{var d,f,p;const c=t.getShape(a.id);if(!c)return;const l=t.getShapeUtil(a);if(r==="start"||r==="one-off"){const v=(d=l.onRotateStart)==null?void 0:d.call(l,a);v&&i.push(v)}const u=(f=l.onRotate)==null?void 0:f.call(l,a,c);if(u&&i.push(u),r==="end"||r==="one-off"){const v=(p=l.onRotateEnd)==null?void 0:p.call(l,a,c);v&&i.push(v)}}),i.length>0&&t.updateShapes(i)}const zM=e=>{const{store:t}=e,n=t.query.filterHistory("shape"),r=t.query.records("shape",()=>({type:{eq:"arrow"}}));function o(){const s=r.get(),i={};for(const a of s){const{start:c,end:l}=a.props;if(c.type==="binding"){const u=i[c.boundShapeId];u?u.push({arrowId:a.id,handleId:"start"}):i[c.boundShapeId]=[{arrowId:a.id,handleId:"start"}]}if(l.type==="binding"){const u=i[l.boundShapeId];u?u.push({arrowId:a.id,handleId:"end"}):i[l.boundShapeId]=[{arrowId:a.id,handleId:"end"}]}}return i}return X("arrowBindingsIndex",(s,i)=>{if(ls(s))return o();const a=s,c=n.getDiffSince(i);if(c===Gt)return o();let l;function u(p){l||(l={...a}),l[p]?l[p]===a[p]&&(l[p]=[...l[p]]):l[p]=[]}function d(p,v,m){u(p),l[p]=l[p].filter(y=>y.arrowId!==v||y.handleId!==m),l[p].length===0&&delete l[p]}function f(p,v,m){u(p),l[p].push({arrowId:v,handleId:m})}for(const p of c){for(const v of Object.values(p.added))if(e.isShapeOfType(v,"arrow")){const{start:m,end:y}=v.props;m.type==="binding"&&f(m.boundShapeId,v.id,"start"),y.type==="binding"&&f(y.boundShapeId,v.id,"end")}for(const[v,m]of Object.values(p.updated))if(!(!e.isShapeOfType(v,"arrow")||!e.isShapeOfType(m,"arrow")))for(const y of["start","end"]){const b=v.props[y],x=m.props[y];b.type==="binding"&&x.type==="point"?d(b.boundShapeId,v.id,y):b.type==="point"&&x.type==="binding"?f(x.boundShapeId,m.id,y):b.type==="binding"&&x.type==="binding"&&b.boundShapeId!==x.boundShapeId&&(d(b.boundShapeId,v.id,y),f(x.boundShapeId,m.id,y))}for(const v of Object.values(p.removed))if(e.isShapeOfType(v,"arrow")){const{start:m,end:y}=v.props;m.type==="binding"&&d(m.boundShapeId,v.id,"start"),y.type==="binding"&&d(y.boundShapeId,v.id,"end")}}return l??a})},UM=e=>{const t=e.query.ids("shape");function n(){const r={},o=t.get(),s=Array(o.size);return o.forEach(i=>s.push(e.get(i))),s.sort(Dn),s.forEach(i=>{r[i.parentId]||(r[i.parentId]=[]),r[i.parentId].push(i.id)}),r}return X("parentsToChildrenWithIndexes",(r,o)=>{if(ls(r))return n();const s=e.history.getDiffSince(o);if(s===Gt)return n();if(s.length===0)return r;let i=null;const a=u=>{i||(i={...r}),i[u]?i[u]===r[u]&&(i[u]=[...i[u]]):i[u]=[]},c=new Set;let l;for(let u=0,d=s.length;u<d;u++){l=s[u];for(const f of Object.values(l.added))go(f)&&(a(f.parentId),i[f.parentId].push(f.id),c.add(i[f.parentId]));for(const[f,p]of Object.values(l.updated))if(go(p)&&go(f)){if(f.parentId!==p.parentId)a(f.parentId),a(p.parentId),i[f.parentId].splice(i[f.parentId].indexOf(p.id),1),i[p.parentId].push(p.id),c.add(i[p.parentId]);else if(f.index!==p.index){a(p.parentId);const v=i[p.parentId].indexOf(p.id);i[p.parentId][v]=p.id,c.add(i[p.parentId])}}for(const f of Object.values(l.removed))go(f)&&(a(f.parentId),i[f.parentId].splice(i[f.parentId].indexOf(f.id),1))}for(const u of c){const d=fe(u.map(f=>e.get(f)));d.sort(Dn),u.splice(0,u.length,...d.map(f=>f.id))}return i??r})},Ju=(e,t,n)=>{for(;!Lt(n.parentId);){const r=e.get(n.parentId);if(!r)return!1;n=r}return n.parentId===t},VM=(e,t)=>{const n=e.query.ids("shape");let r=null;function o(){const s=t();return r=s,new Set([...n.get()].filter(i=>Ju(e,s,e.get(i))))}return X("_shapeIdsInCurrentPage",(s,i)=>{if(ls(s))return o();const a=t();if(a!==r)return o();const c=e.history.getDiffSince(i);if(c===Gt)return o();const l=new _c(s);for(const d of c){for(const f of Object.values(d.added))go(f)&&Ju(e,a,f)&&l.add(f.id);for(const[f,p]of Object.values(d.updated))go(p)&&(Ju(e,a,p)?l.add(p.id):l.remove(p.id));for(const f of Object.keys(d.removed))Sn(f)&&l.remove(f)}const u=l.get();return u?wi(u.value,u.diff):s})},KM=40;class WM{constructor(t){I(this,"_clickId","");I(this,"_clickTimeout");I(this,"_clickScreenPoint");I(this,"_previousScreenPoint");I(this,"_getClickTimeout",(t,n=je())=>{this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===t&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},t==="idle"||t==="pendingDouble"?DT:NT)});I(this,"_clickState","idle");I(this,"lastPointerInfo",{});I(this,"transformPointerDownEvent",t=>{if(!this._clickState)return t;switch(this._clickScreenPoint=k.From(t.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>KM&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=t,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),t;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...t,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),t;default:return this._clickTimeout=this._getClickTimeout(this._clickState),t}});I(this,"transformPointerUpEvent",t=>{if(!this._clickState)return t;switch(this._clickScreenPoint=k.From(t.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return t}});I(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});I(this,"handleMove",()=>{this._clickState!=="idle"&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?bf:Sf)&&this.cancelDoubleClickTimeout()});this.editor=t}get clickState(){return this._clickState}}class HM{constructor(t){I(this,"isSafari");I(this,"isIos");I(this,"isChromeForIos");I(this,"isFirefox");I(this,"isAndroid");this.editor=t,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}function co(e){return YM}class GM{constructor(){I(this,"length",0);I(this,"head",null);I(this,"tail",this)}push(t){return new cp(t,this)}toArray(){return nr}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const YM=new GM;class cp{constructor(t,n){I(this,"length");this.head=t,this.tail=n,this.length=n.length+1}push(t){return new cp(t,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let t=this;return{next(){if(t.length){const n=t.head;return t=t.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class XM{constructor(t,n){I(this,"_undos",wt("HistoryManager.undos",co()));I(this,"_redos",wt("HistoryManager.redos",co()));I(this,"_batchDepth",0);I(this,"onBatchComplete",()=>{});I(this,"_commands",{});I(this,"createCommand",(t,n,r)=>{if(this._commands[t])throw new Error(`Duplicate command: ${t}`);this._commands[t]=r;const o=(...s)=>{if(!this._batchDepth)return this.batch(()=>o(...s)),this.ctx;const i=n(...s);if(!i)return this.ctx;const{data:a,ephemeral:c,squashing:l,preservesRedoStack:u}=i;if(this.ignoringUpdates((d,f)=>(r.do(a),{undos:d,redos:f})),!c){const d=this._undos.get().head;l&&d&&d.type==="command"&&d.name===t&&d.preservesRedoStack===u?this._undos.update(f=>f.tail.push({...d,id:je(),data:r.squash(d.data,a)})):this._undos.update(f=>f.push({type:"command",name:t,data:a,id:je(),preservesRedoStack:u})),i.preservesRedoStack||this._redos.set(co()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return o});I(this,"batch",t=>{try{this._batchDepth++,this._batchDepth===1?an(()=>{var r,o;const n=(r=this._undos.get().head)==null?void 0:r.id;t(),n!==((o=this._undos.get().head)==null?void 0:o.id)&&this.onBatchComplete()}):t()}catch(n){throw this.annotateError(n),n}finally{this._batchDepth--}return this});I(this,"ignoringUpdates",t=>{let n=this._undos.get(),r=this._redos.get();this._undos.set(co()),this._redos.set(co());try{({undos:n,redos:r}=an(()=>t(n,r)))}finally{this._undos.set(n),this._redos.set(r)}});I(this,"_undo",({pushToRedoStack:t,toMark:n=void 0})=>(this.ignoringUpdates((r,o)=>{var s;if(r.length===0)return{undos:r,redos:o};for(;((s=r.head)==null?void 0:s.type)==="STOP";){const i=r.head;if(r=r.tail,t&&(o=o.push(i)),i.id===n)return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:o}}if(r.length===0)return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:o};for(;r.head;){const i=r.head;if(r=r.tail,t&&(o=o.push(i)),i.type==="STOP"){if(i.onUndo&&(!n||i.id===n))return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:o}}else this._commands[i.name].undo(i.data)}return this.ctx.emit("change-history",t?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:o}}),this));I(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));I(this,"redo",()=>(this.ignoringUpdates((t,n)=>{var r;if(n.length===0)return{undos:t,redos:n};for(;((r=n.head)==null?void 0:r.type)==="STOP";)t=t.push(n.head),n=n.tail;if(n.length===0)return this.ctx.emit("change-history",{reason:"redo"}),{undos:t,redos:n};for(;n.head;){const o=n.head;if(t=t.push(n.head),n=n.tail,o.type==="STOP"){if(o.onRedo)break}else{const s=this._commands[o.name];s.redo?s.redo(o.data):s.do(o.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:t,redos:n}}),this));I(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));I(this,"bailToMark",t=>(this._undo({pushToRedoStack:!1,toMark:t}),this));I(this,"mark",(t=je(),n=!0,r=!0)=>{const o=this._undos.get().head;return o&&o.type==="STOP"&&o.id===t&&o.onUndo===n&&o.onRedo===r?o.id:(this._undos.update(s=>s.push({type:"STOP",id:t,onUndo:n,onRedo:r})),this.ctx.emit("mark-history",{id:t}),t)});this.ctx=t,this.annotateError=n}getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}clear(){this._undos.set(co()),this._redos.set(co())}}class qM{constructor(t){I(this,"scribbleItems",new Map);I(this,"state","paused");I(this,"addScribble",(t,n=je())=>{const r={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...t,state:"starting"},timeoutMs:0,delayRemaining:t.delay??0,prev:null,next:null};return this.scribbleItems.set(n,r),this.state==="paused"&&this.resume(),r});I(this,"stop",t=>{const n=this.scribbleItems.get(t);if(!n)throw Error(`Scribble with id ${t} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n});I(this,"addPoint",(t,n,r)=>{const o=this.scribbleItems.get(t);if(!o)throw Error(`Scribble with id ${t} not found`);const{prev:s}=o,i={x:n,y:r,z:.5};return(!s||k.Dist(s,i)>=1)&&(o.next=i),o});I(this,"tick",t=>{this.editor.batch(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:c,prev:l}=n;c&&c!==l&&(n.prev=c,n.scribble.points.push(c)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-t)),n.timeoutMs+=t,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:r,timeoutMs:o,prev:s,next:i,scribble:a}=n;switch(a.state){case"active":{i&&i!==s?(n.prev=i,a.points.push(i),r===0&&a.points.length>8&&a.points.shift()):o===0&&(a.points.length>1?a.points.shift():n.delayRemaining=a.delay);break}case"stopping":{if(n.delayRemaining===0&&o===0){if(a.points.length===1){this.scribbleItems.delete(n.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)}),this.scribbleItems.size===0&&this.pause()})});this.editor=t}resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}}class ZM{constructor(t){I(this,"_beforeCreateHandlers",{});I(this,"_afterCreateHandlers",{});I(this,"_beforeChangeHandlers",{});I(this,"_afterChangeHandlers",{});I(this,"_beforeDeleteHandlers",{});I(this,"_afterDeleteHandlers",{});I(this,"_batchCompleteHandlers",[]);this.editor=t,t.store.onBeforeCreate=(r,o)=>{const s=this._beforeCreateHandlers[r.typeName];if(s){let i=r;for(const a of s)i=a(i,o);return i}return r},t.store.onAfterCreate=(r,o)=>{const s=this._afterCreateHandlers[r.typeName];if(s)for(const i of s)i(r,o)},t.store.onBeforeChange=(r,o,s)=>{const i=this._beforeChangeHandlers[o.typeName];if(i){let a=o;for(const c of i)a=c(r,a,s);return a}return o};let n=0;t.store.onAfterChange=(r,o,s)=>{if(n++,n>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const i=this._afterChangeHandlers[o.typeName];if(i)for(const a of i)a(r,o,s)}n--},t.store.onBeforeDelete=(r,o)=>{const s=this._beforeDeleteHandlers[r.typeName];if(s){for(const i of s)if(i(r,o)===!1)return!1}},t.store.onAfterDelete=(r,o)=>{const s=this._afterDeleteHandlers[r.typeName];if(s)for(const i of s)i(r,o)},t.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(r=>r())}}registerBeforeCreateHandler(t,n){return this._beforeCreateHandlers[t]||(this._beforeCreateHandlers[t]=[]),this._beforeCreateHandlers[t].push(n),()=>lo(this._beforeCreateHandlers[t],n)}registerAfterCreateHandler(t,n){return this._afterCreateHandlers[t]||(this._afterCreateHandlers[t]=[]),this._afterCreateHandlers[t].push(n),()=>lo(this._afterCreateHandlers[t],n)}registerBeforeChangeHandler(t,n){return this._beforeChangeHandlers[t]||(this._beforeChangeHandlers[t]=[]),this._beforeChangeHandlers[t].push(n),()=>lo(this._beforeChangeHandlers[t],n)}registerAfterChangeHandler(t,n){return this._afterChangeHandlers[t]||(this._afterChangeHandlers[t]=[]),this._afterChangeHandlers[t].push(n),()=>lo(this._afterChangeHandlers[t],n)}registerBeforeDeleteHandler(t,n){return this._beforeDeleteHandlers[t]||(this._beforeDeleteHandlers[t]=[]),this._beforeDeleteHandlers[t].push(n),()=>lo(this._beforeDeleteHandlers[t],n)}registerAfterDeleteHandler(t,n){return this._afterDeleteHandlers[t]||(this._afterDeleteHandlers[t]=[]),this._afterDeleteHandlers[t].push(n),()=>lo(this._afterDeleteHandlers[t],n)}registerBatchCompleteHandler(t){return this._batchCompleteHandlers.push(t),()=>lo(this._batchCompleteHandlers,t)}}function lo(e,t){const n=e.indexOf(t);n>=0&&e.splice(n,1)}var QM=Object.defineProperty,JM=Object.getOwnPropertyDescriptor,_o=(e,t,n,r)=>{for(var o=JM(t,n),s=e.length-1,i;s>=0;s--)(i=e[s])&&(o=i(t,n,o)||o);return o&&QM(t,n,o),o};const ae=e=>Math.round(e*10**8)/10**8;function Jn(e,t,n,r,o){const s=e.filter(a=>(r==="forward"?a.startNode.id===t:a.endNode.id===t)&&ae(a.length)===ae(n)&&xn(a.breadthIntersection[0],a.breadthIntersection[1],o[0],o[1]));if(s.length===0)return[];const i=new Set;return s.forEach(a=>{const c=r==="forward"?a.endNode.id:a.startNode.id;if(!i.has(c)){i.add(c);const l=Jn(e,c,n,r,xn(a.breadthIntersection[0],a.breadthIntersection[1],o[0],o[1]));s.push(...l)}}),s}function eO(e){e.sort((t,n)=>n.gaps.length-t.gaps.length);for(let t=e.length-1;t>0;t--){const n=e[t];for(let r=t-1;r>=0;r--){const o=e[r];if(o.direction===n.direction&&n.gaps.every(s=>o.gaps.some(i=>ae(s.startEdge[0].x)===ae(i.startEdge[0].x)&&ae(s.startEdge[0].y)===ae(i.startEdge[0].y)&&ae(s.startEdge[1].x)===ae(i.startEdge[1].x)&&ae(s.startEdge[1].y)===ae(i.startEdge[1].y))&&o.gaps.some(i=>ae(s.endEdge[0].x)===ae(i.endEdge[0].x)&&ae(s.endEdge[0].y)===ae(i.endEdge[0].y)&&ae(s.endEdge[1].x)===ae(i.endEdge[1].x)&&ae(s.endEdge[1].y)===ae(i.endEdge[1].y)))){e.splice(t,1);break}}}}class qr{constructor(t){I(this,"_snapLines",wt("snapLines",void 0));this.editor=t}getLines(){return this._snapLines.get()??nr}clear(){this.getLines().length&&this._snapLines.set(void 0)}setLines(t){this._snapLines.set(t)}getSnapPointsCache(){const{editor:t}=this;return t.store.createComputedCache("snapPoints",n=>{const r=t.getShapePageTransform(n.id);return r?this.editor.getShapeGeometry(n).snapPoints.map((s,i)=>{const{x:a,y:c}=ie.applyToPoint(r,s);return{x:a,y:c,id:`${n.id}:${i}`}}):void 0})}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:t}=this,n=t.getRenderingBounds(),r=t.getSelectedShapeIds(),o=[],s=i=>{const a=t.getSortedChildIdsForParent(i);for(const c of a){if(r.includes(c))continue;const l=t.getShape(c);if(!l||!t.getShapeUtil(l).canSnap(l))continue;const d=t.getShapePageBounds(c);if(d&&n.includes(d)){if(t.isShapeOfType(l,"group")){s(c);continue}o.push({id:c,pageBounds:d,isClosed:t.getShapeGeometry(l).isClosed})}}};return s(this.getCurrentCommonAncestor()??t.getCurrentPageId()),o}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}getSnappablePoints(){const t=this.getSnapPointsCache(),n=this.getSnappableShapes(),r=[];return n.forEach(o=>{const s=t.get(o.id);s&&r.push(...s)}),r}getVisibleGaps(){const t=[],n=[];let r,o;const s=this.getSnappableShapes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<s.length;a++){r=s[a];for(let c=a+1;c<s.length;c++)o=s[c],r.pageBounds.maxX<o.pageBounds.minX&&ii(r.pageBounds.minY,r.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)&&t.push({startNode:r,endNode:o,startEdge:[new k(r.pageBounds.maxX,r.pageBounds.minY),new k(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new k(o.pageBounds.minX,o.pageBounds.minY),new k(o.pageBounds.minX,o.pageBounds.maxY)],length:o.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:xn(r.pageBounds.minY,r.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)})}const i=s.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<i.length;a++){r=i[a];for(let c=a+1;c<i.length;c++)o=i[c],r.pageBounds.maxY<o.pageBounds.minY&&ii(r.pageBounds.minX,r.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)&&n.push({startNode:r,endNode:o,startEdge:[new k(r.pageBounds.minX,r.pageBounds.maxY),new k(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new k(o.pageBounds.minX,o.pageBounds.minY),new k(o.pageBounds.maxX,o.pageBounds.minY)],length:o.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:xn(r.pageBounds.minX,r.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)})}return{horizontal:t,vertical:n}}snapTranslate({lockedAxis:t,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:o}){var y,b;const s=this.getSnapThreshold(),i=this.getSnappablePoints(),a=n.clone().translate(o),c=r.map(({x,y:w},S)=>({id:"selection:"+S,x:x+o.x,y:w+o.y})),l=i,u=[],d=[],f=new k(s,s);this.collectPointSnaps({minOffset:f,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:f});const p=new k(t==="x"?0:((y=u[0])==null?void 0:y.nudge)??0,t==="y"?0:((b=d[0])==null?void 0:b.nudge)??0);f.x=0,f.y=0,u.length=0,d.length=0,c.forEach(x=>{x.x+=p.x,x.y+=p.y}),a.translate(p),this.collectPointSnaps({minOffset:f,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:f});const v=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this._snapLines.set([...m,...v]),{nudge:p}}getOutlinesInPageSpace(){return this.getSnappableShapes().map(({id:t,isClosed:n})=>{const r=Or(this.editor.getShapeGeometry(t).vertices);n&&r.push(r[0]);const o=this.editor.getShapePageTransform(t);if(!o)throw Error("No page transform");return ie.applyToPoints(o,r)})}getSnappingHandleDelta({handlePoint:t,additionalSegments:n}){const r=this.getSnapThreshold(),o=this.getOutlinesInPageSpace();let s=r,i=null,a,c,l,u;const d=[...o,...n];for(const f of d)for(let p=0;p<f.length-1;p++)a=f[p],c=f[p+1],l=k.NearestPointOnLineSegment(a,c,t),u=k.Dist(t,l),!isNaN(u)&&u<s&&(s=u,i=l);return i?(this._snapLines.set([{id:je(),type:"points",points:[i]}]),k.Sub(i,t)):null}snapResize({initialSelectionPageBounds:t,dragDelta:n,handle:r,isAspectRatioLocked:o,isResizingFromCenter:s}){var E,_;const i=this.getSnapThreshold(),{box:a,scaleX:c,scaleY:l}=ce.Resize(t,r,s?n.x*2:n.x,s?n.y*2:n.y,o);let u=r;c<0&&(u=bT(u)),l<0&&(u=vT(u)),s&&(a.center=t.center);const d=u==="top"||u==="bottom",f=u==="left"||u==="right",p=Cy(u,a),v=this.getSnappablePoints(),m=[],y=[],b=new k(i,i);this.collectPointSnaps({minOffset:b,nearestSnapsX:m,nearestSnapsY:y,otherNodeSnapPoints:v,selectionSnapPoints:p});const x=new k(d?0:((E=m[0])==null?void 0:E.nudge)??0,f?0:((_=y[0])==null?void 0:_.nudge)??0);if(o&&ST(u)&&x.len()!==0){const $=m.length&&y.length?Math.abs(x.x)<Math.abs(x.y)?"x":"y":m.length?"x":"y",T=t.aspectRatio;$==="x"?(y.length=0,x.y=x.x/T,(u==="bottom_left"||u==="top_right")&&(x.y=-x.y)):(m.length=0,x.x=x.y*T,(u==="bottom_left"||u==="top_right")&&(x.x=-x.x))}const w=k.Add(n,x),{box:S}=ce.Resize(t,r,s?w.x*2:w.x,s?w.y*2:w.y,o);s&&(S.center=t.center);const C=Cy("any",S);m.length=0,y.length=0,b.x=0,b.y=0,this.collectPointSnaps({minOffset:b,nearestSnapsX:m,nearestSnapsY:y,otherNodeSnapPoints:v,selectionSnapPoints:C});const P=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:y});return this._snapLines.set([...P]),{nudge:x}}collectPointSnaps({selectionSnapPoints:t,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:o,nearestSnapsY:s}){for(const i of t)for(const a of n){const c=k.Sub(i,a),l=Math.abs(c.x),u=Math.abs(c.y);ae(l)<=ae(r.x)&&(ae(l)<ae(r.x)&&(o.length=0),o.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.x-i.x}),r.x=l),ae(u)<=ae(r.y)&&(ae(u)<ae(r.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.y-i.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:o}){const{horizontal:s,vertical:i}=this.getVisibleGaps();for(const a of s){if(!ii(a.breadthIntersection[0],a.breadthIntersection[1],t.minY,t.maxY))continue;const l=a.startEdge[0].x+a.length/2-t.center.x;if(a.length>t.width&&ae(Math.abs(l))<=ae(n.x)){ae(Math.abs(l))<ae(n.x)&&(r.length=0),n.x=Math.abs(l);const b={type:"gap_center",gap:a,nudge:l},x=r.find(({type:S})=>S==="gap_center"),w=x&&xn(a.breadthIntersection[0],a.breadthIntersection[1],x.gap.breadthIntersection[0],x.gap.breadthIntersection[1]);x&&x.gap.length>a.length&&w?r[r.indexOf(x)]=b:(!x||!w)&&r.push(b)}const d=a.startNode.pageBounds.minX-a.length,f=t.maxX,p=d-f;ae(Math.abs(p))<=ae(n.x)&&(ae(Math.abs(p))<ae(n.x)&&(r.length=0),n.x=Math.abs(p),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:p}));const v=a.endNode.pageBounds.maxX+a.length,m=t.minX,y=v-m;ae(Math.abs(y))<=ae(n.x)&&(ae(Math.abs(y))<ae(n.x)&&(r.length=0),n.x=Math.abs(y),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:y}))}for(const a of i){if(!ii(a.breadthIntersection[0],a.breadthIntersection[1],t.minX,t.maxX))continue;const l=a.startEdge[0].y+a.length/2-t.center.y;if(a.length>t.height&&ae(Math.abs(l))<=ae(n.y)){ae(Math.abs(l))<ae(n.y)&&(o.length=0),n.y=Math.abs(l);const b={type:"gap_center",gap:a,nudge:l},x=o.find(({type:S})=>S==="gap_center"),w=x&&ii(x.gap.breadthIntersection[0],x.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);x&&x.gap.length>a.length&&w?o[o.indexOf(x)]=b:(!x||!w)&&o.push(b);continue}const d=a.startNode.pageBounds.minY-a.length,f=t.maxY,p=d-f;ae(Math.abs(p))<=ae(n.y)&&(ae(Math.abs(p))<ae(n.y)&&(o.length=0),n.y=Math.abs(p),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:p}));const v=a.endNode.pageBounds.maxY+a.length,m=t.minY,y=v-m;ae(Math.abs(y))<=ae(n.y)&&(ae(Math.abs(y))<ae(n.y)&&(o.length=0),n.y=Math.abs(y),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:y}))}}getPointSnapLines({nearestSnapsX:t,nearestSnapsY:n}){const r={},o={};if(t.length>0){for(const s of t)if(s.type==="points"){const i=ae(s.points.otherPoint.x);r[i]||(r[i]=[]),r[i].push(s.points)}}if(n.length>0){for(const s of n)if(s.type==="points"){const i=ae(s.points.otherPoint.y);o[i]||(o[i]=[]),o[i].push(s.points)}}return Object.values(r).concat(Object.values(o)).map(s=>({id:je(),type:"points",points:Wc(s.map(i=>k.From(i.otherPoint)).concat(s.map(i=>k.From(i.thisPoint))),(i,a)=>i.equals(a))}))}getGapSnapLines({selectionPageBounds:t,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:o,horizontal:s}=this.getVisibleGaps(),i={top:t.sides[0],right:t.sides[1],bottom:[t.corners[3],t.corners[2]],left:[t.corners[0],t.corners[3]]},a=[];if(n.length>0)for(const c of n){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:u,startNode:d,endNode:f,length:p,endEdge:v}}=c;switch(c.type){case"gap_center":{const m=(p-t.width)/2,y=xn(l[0],l[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:je(),gaps:[...Jn(s,d.id,m,"backward",y),{startEdge:u,endEdge:i.left},{startEdge:i.right,endEdge:v},...Jn(s,f.id,m,"forward",y)]});break}case"gap_duplicate":{const m=xn(l[0],l[1],t.minY,t.maxY);a.push({type:"gaps",direction:"horizontal",id:je(),gaps:c.protrusionDirection==="left"?[{startEdge:i.right,endEdge:u.map(y=>y.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:v},...Jn(s,f.id,p,"forward",m)]:[...Jn(s,d.id,p,"backward",m),{startEdge:u,endEdge:v},{startEdge:v.map(y=>y.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:i.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:u,startNode:d,endNode:f,length:p,endEdge:v}}=c;switch(c.type){case"gap_center":{const m=(p-t.height)/2,y=xn(l[0],l[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:je(),gaps:[...Jn(o,d.id,m,"backward",y),{startEdge:u,endEdge:i.top},{startEdge:i.bottom,endEdge:v},...Jn(o,c.gap.endNode.id,m,"forward",y)]});break}case"gap_duplicate":{const m=xn(l[0],l[1],t.minX,t.maxX);a.push({type:"gaps",direction:"vertical",id:je(),gaps:c.protrusionDirection==="top"?[{startEdge:i.bottom,endEdge:u.map(y=>y.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:v},...Jn(o,f.id,p,"forward",m)]:[...Jn(o,d.id,p,"backward",m),{startEdge:u,endEdge:v},{startEdge:v.map(y=>y.clone().addXY(0,f.pageBounds.height)),endEdge:i.top}]})}break}}return eO(a),a}}_o([X],qr.prototype,"getSnapPointsCache");_o([X],qr.prototype,"getSnapThreshold");_o([X],qr.prototype,"getSnappableShapes");_o([X],qr.prototype,"getCurrentCommonAncestor");_o([X],qr.prototype,"getSnappablePoints");_o([X],qr.prototype,"getVisibleGaps");_o([X],qr.prototype,"getOutlinesInPageSpace");function Cy(e,t){const{minX:n,maxX:r,minY:o,maxY:s}=t,i=[];switch(e){case"top":case"left":case"top_left":case"any":i.push({id:"top_left",handle:"top_left",x:n,y:o})}switch(e){case"top":case"right":case"top_right":case"any":i.push({id:"top_right",handle:"top_right",x:r,y:o})}switch(e){case"bottom":case"right":case"bottom_right":case"any":i.push({id:"bottom_right",handle:"bottom_right",x:r,y:s})}switch(e){case"bottom":case"left":case"bottom_left":case"any":i.push({id:"bottom_left",handle:"bottom_left",x:n,y:s})}return i}const tO=/\r?\n|\r/g;function Py(e){return e.replace(tO,`
`).split(`
`).map(t=>t||" ").join(`
`)}const nO={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},rO=/\s/;class oO{constructor(t){I(this,"measureText",(t,n)=>{const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-style",n.fontStyle),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("font-size",n.fontSize+"px"),r.style.setProperty("line-height",n.lineHeight*n.fontSize+"px"),r.style.setProperty("max-width",n.maxWidth===null?null:n.maxWidth+"px"),r.style.setProperty("min-width",n.minWidth??null),r.style.setProperty("padding",n.padding),r.textContent=Py(t);const o=r.getBoundingClientRect();return{x:0,y:0,w:o.width,h:o.height}});this.editor=t}getTextElement(){const t=document.querySelector(".tl-text-measure");t==null||t.remove();const n=document.createElement("div");return this.editor.getContainer().appendChild(n),n.id=`__textMeasure_${je()}`,n.classList.add("tl-text"),n.classList.add("tl-text-measure"),n.tabIndex=-1,n}measureElementTextNodeSpans(t,{shouldTruncateToFirstLine:n=!1}={}){const r=[],o=t.getBoundingClientRect(),s=-o.left,i=-o.top,a=new Range,c=t.childNodes[0];let l=0,u=null,d=null,f=0,p=!1;for(const v of t.childNodes)if(v.nodeType===Node.TEXT_NODE)for(const m of v.textContent??""){a.setStart(c,l),a.setEnd(c,l+m.length);const y=a.getClientRects(),b=y[y.length-1],x=b.top+i,w=b.left+s,S=b.right+s,C=rO.test(m);if(C!==d||x!==f||!u){if(u){if(n&&x!==f){p=!0;break}r.push(u)}u={box:{x:w,y:x,w:b.width,h:b.height},text:m}}else u.box.w=S-u.box.x,u.text+=m;d=C,f=x,l+=m.length}return u&&r.push(u),{spans:r,didTruncate:p}}measureTextSpans(t,n){if(t==="")return[];const r=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip",o=this.getTextElement(),s=Math.ceil(n.width-n.padding*2);o.style.setProperty("width",`${s}px`),o.style.setProperty("height","min-content"),o.style.setProperty("dir","ltr"),o.style.setProperty("font-size",`${n.fontSize}px`),o.style.setProperty("font-family",n.fontFamily),o.style.setProperty("font-weight",n.fontWeight),o.style.setProperty("line-height",`${n.lineHeight*n.fontSize}px`),o.style.setProperty("text-align",nO[n.textAlign]),r&&(o.style.setProperty("overflow-wrap","anywhere"),o.style.setProperty("word-break","break-all")),t=Py(t),o.textContent=t;const{spans:i,didTruncate:a}=this.measureElementTextNodeSpans(o,{shouldTruncateToFirstLine:r});if(n.overflow==="truncate-ellipsis"&&a){o.textContent="…";const c=Math.ceil(this.measureElementTextNodeSpans(o).spans[0].box.w);o.style.setProperty("width",`${s-c}px`),o.textContent=t;const l=this.measureElementTextNodeSpans(o,{shouldTruncateToFirstLine:!0}).spans,u=l[l.length-1];return l.push({text:"…",box:{x:Math.min(u.box.x+u.box.w,n.width-n.padding-c),y:u.box.y,w:c,h:u.box.h}}),l}return o.remove(),i}}class sO{constructor(t){I(this,"raf");I(this,"isPaused",!0);I(this,"last",0);I(this,"t",0);I(this,"start",()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()});I(this,"tick",()=>{if(this.isPaused)return;const t=Date.now(),n=t-this.last;if(this.last=t,this.t+=n,this.editor.emit("frame",n),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(n),this.editor.emit("tick",n),this.raf=requestAnimationFrame(this.tick)});I(this,"dispose",()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)});I(this,"prevPoint",new k);I(this,"updatePointerVelocity",t=>{const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:o}}}=this;if(t===0)return;const s=k.Sub(r,n);this.prevPoint=r.clone();const i=s.len(),a=i?s.div(i):new k(0,0),c=o.clone().lrp(a.mul(i/t),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),o.equals(c)||(this.editor.inputs.pointerVelocity=c)});this.editor=t,this.editor.disposables.add(this.dispose),this.start()}}var iO=Object.defineProperty,aO=Object.getOwnPropertyDescriptor,hr=(e,t,n,r)=>{for(var o=aO(t,n),s=e.length-1,i;s>=0;s--)(i=e[s])&&(o=i(t,n,o)||o);return o&&iO(t,n,o),o};class Wn{constructor(t,n){I(this,"updateUserPreferences",t=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...t})});this.user=t,this.inferDarkMode=n}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),isDarkMode:this.getIsDarkMode(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(this.inferDarkMode?pM():!1)}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??dn.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??dn.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??dn.name}getLocale(){return this.user.userPreferences.get().locale??dn.locale}getColor(){return this.user.userPreferences.get().color??dn.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??dn.isSnapMode}}hr([X],Wn.prototype,"getUserPreferences");hr([X],Wn.prototype,"getIsDarkMode");hr([X],Wn.prototype,"getEdgeScrollSpeed");hr([X],Wn.prototype,"getAnimationSpeed");hr([X],Wn.prototype,"getId");hr([X],Wn.prototype,"getName");hr([X],Wn.prototype,"getLocale");hr([X],Wn.prototype,"getColor");hr([X],Wn.prototype,"getIsSnapMode");function li(e){return Math.abs(e.props.bend)<8}function il(e,t){if(t.type==="point")return;const n=e.getShape(t.boundShapeId),r=e.getShapePageTransform(n),o=e.getShapeGeometry(n),s=o instanceof Ul?o.children[0].vertices:o.vertices;return{shape:n,transform:r,isClosed:o.isClosed,isExact:t.isExact,didIntersect:!1,outline:s}}function Ey(e,t,n,r){if(n.type==="point")return k.From(n);const o=e.getShape(n.boundShapeId);if(o){const{point:s,size:i}=e.getShapeGeometry(o).bounds,a=k.Add(s,k.MulV(n.isPrecise||r?n.normalizedAnchor:{x:.5,y:.5},i)),c=ie.applyToPoint(e.getShapePageTransform(o),a);return ie.applyToPoint(ie.Inverse(t),c)}else return new k(0,0)}function fo(e,t){const n=e.getShapePageTransform(t);let r,o;t.props.start.type==="binding"&&t.props.end.type==="binding"&&(r=t.props.start.boundShapeId,o=t.props.end.boundShapeId);const s=lp(e,r,o),i=Ey(e,n,t.props.start,s==="double-bound"||s==="start-contains-end"),a=Ey(e,n,t.props.end,s==="double-bound"||s==="end-contains-start");return{start:i,end:a}}const Ti=10,al=10,cO=10,Mr={s:2,m:3.5,l:5,xl:10};function lp(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";const r=e.getShapePageBounds(t),o=e.getShapePageBounds(n);if(r&&o){if(r.contains(o))return"start-contains-end";if(o.contains(r))return"end-contains-start"}return"safe"}function $i(e,t){const{start:n,end:r,arrowheadStart:o,arrowheadEnd:s}=t.props,i=fo(e,t),a=i.start.clone(),c=i.end.clone(),l=k.Med(a,c);if(k.Equals(a,c))return{isStraight:!0,start:{handle:a,point:a,arrowhead:t.props.arrowheadStart},end:{handle:c,point:c,arrowhead:t.props.arrowheadEnd},middle:l,isValid:!1,length:0};const u=k.Sub(c,a).uni(),d=il(e,n),f=il(e,r),p=e.getShapePageTransform(t);_y(c,i.start,p,f),_y(a,i.end,p,d);let v=0,m=0,y=0,b=0,x=Ti;const w=d&&f&&d.shape===f.shape,S=d&&f?lp(e,d.shape.id,f.shape.id):"safe";S==="safe"&&d&&f&&!w&&!d.isExact&&!f.isExact&&(f.didIntersect&&!d.didIntersect?d.isClosed&&a.setTo(c.clone().add(u.clone().mul(Ti))):f.didIntersect||f.isClosed&&c.setTo(a.clone().sub(u.clone().mul(Ti))));const C=k.Sub(c,a).uni(),P=!k.Equals(C,u);w||(S!=="start-contains-end"&&d&&o!=="none"&&!d.isExact&&(y=Mr[t.props.size]/2+("size"in d.shape.props?Mr[d.shape.props.size]/2:0),v=al+y,x+=y),S!=="end-contains-start"&&f&&s!=="none"&&!f.isExact&&(b=Mr[t.props.size]/2+("size"in f.shape.props?Mr[f.shape.props.size]/2:0),m=al+b,x+=b));const E=a.clone().add(C.clone().mul(v*(P?-1:1))),_=c.clone().sub(C.clone().mul(m*(P?-1:1)));k.Dist(E,_)<x&&(v!==0&&m!==0?(v*=-1.5,m*=-1.5):v!==0?v*=-1:m!==0&&(m*=-1)),a.add(C.clone().mul(v*(P?-1:1))),c.sub(C.clone().mul(m*(P?-1:1))),P?(d&&f&&c.setTo(k.Add(a,C.clone().mul(-10))),l.setTo(k.Med(i.start,i.end))):l.setTo(k.Med(a,c));const T=k.Dist(a,c);return{isStraight:!0,start:{handle:i.start,point:a,arrowhead:t.props.arrowheadStart},end:{handle:i.end,point:c,arrowhead:t.props.arrowheadEnd},middle:l,isValid:T>0,length:T}}function _y(e,t,n,r){if(r===void 0||r.isExact)return;const o=ie.applyToPoint(n,t),s=ie.applyToPoint(n,e),i=ie.applyToPoint(ie.Inverse(r.transform),o),a=ie.applyToPoint(ie.Inverse(r.transform),s),c=r.isClosed,u=(c?PM:CM)(i,a,r.outline);let d;if(u!==null&&(d=u.sort((v,m)=>k.Dist(v,i)-k.Dist(m,i))[0]??(c?void 0:a)),d===void 0)return;const f=ie.applyToPoint(r.transform,d),p=ie.applyToPoint(ie.Inverse(n),f);e.setTo(p),r.didIntersect=!0}function rX(e){return mx(e.start.handle,e.end.handle)}function oX(e){return mx(e.start.point,e.end.point)}function mx(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function ed(e,t,n=0){const{arrowheadEnd:r,arrowheadStart:o}=t.props,s=t.props.bend+n;if(Math.abs(s)>Math.abs(t.props.bend*cO))return $i(e,t);const i=fo(e,t),a=k.Med(i.start,i.end),c=k.Sub(i.end,i.start).uni(),l=k.Add(a,c.per().mul(-s)),u=il(e,t.props.start),d=il(e,t.props.end),f=i.start.clone(),p=i.end.clone(),v=l.clone();if(k.Equals(f,p))return{isStraight:!0,start:{handle:f,point:f,arrowhead:t.props.arrowheadStart},end:{handle:p,point:p,arrowhead:t.props.arrowheadEnd},middle:v,isValid:!1,length:0};const m=t.props.bend<0,y=m?Nl:xT,b=Iy(f,p,v),x=k.Angle(b.center,f),w=k.Angle(b.center,p),S=y(x,w);if(b.length===0||b.size===0||!Gm(b.length)||!Gm(b.size))return $i(e,t);const C=f.clone(),P=p.clone(),E=v.clone(),_=e.getShapePageTransform(t);let $=0,T=0,M=Ti;if(u&&!u.isExact){const W=ie.applyToPoint(_,C),Q=ie.applyToPoint(_,b.center),oe=ie.applyToPoint(_,P),se=ie.Inverse(u.transform),ye=ie.applyToPoint(se,W),ee=ie.applyToPoint(se,Q),be=ie.applyToPoint(se,oe),{isClosed:Se}=u,Ie=Se?my:yy;let de,Ee=Ie(ee,b.radius,u.outline);if(Ee){const xe=ee.angle(ye),Qe=ee.angle(be),Fe=y(xe,Qe);Ee=Ee.filter(Oe=>y(xe,ee.angle(Oe))<=Fe);const et=Fe*.25;Ee.sort(Se?(Oe,tt)=>Math.abs(y(xe,ee.angle(Oe))-et)<Math.abs(y(xe,ee.angle(tt))-et)?-1:1:(Oe,tt)=>y(xe,ee.angle(Oe))<y(xe,ee.angle(tt))?-1:1),de=Ee[0]??(Se?void 0:ye)}else de=Se?void 0:ye;if(de&&(C.setTo(e.getPointInShapeSpace(t,ie.applyToPoint(u.transform,de))),u.didIntersect=!0,o!=="none")){const xe=Mr[t.props.size]/2+("size"in u.shape.props?Mr[u.shape.props.size]/2:0);$=al+xe,M+=xe}}if(d&&!d.isExact){const W=ie.applyToPoint(_,C),Q=ie.applyToPoint(_,P),oe=ie.applyToPoint(_,b.center),se=ie.Inverse(d.transform),ye=ie.applyToPoint(se,W),ee=ie.applyToPoint(se,oe),be=ie.applyToPoint(se,Q),Se=d.isClosed,Ie=Se?my:yy;let de,Ee=Ie(ee,b.radius,d.outline);if(Ee){const xe=ee.angle(ye),Qe=ee.angle(be),Fe=y(xe,Qe),et=Fe*.75;Ee=Ee.filter(Oe=>y(xe,ee.angle(Oe))<=Fe),Ee.sort(Se?(Oe,tt)=>Math.abs(y(xe,ee.angle(Oe))-et)<Math.abs(y(xe,ee.angle(tt))-et)?-1:1:(Oe,tt)=>y(xe,ee.angle(Oe))<y(xe,ee.angle(tt))?-1:1),Ee[0]?de=Ee[0]:de=Se?void 0:be}else de=Se?void 0:be;if(de&&(P.setTo(e.getPointInShapeSpace(t,ie.applyToPoint(d.transform,de))),d.didIntersect=!0,r!=="none")){const xe=Mr[t.props.size]/2+("size"in d.shape.props?Mr[d.shape.props.size]/2:0);T=al+xe,M+=xe}}let O=k.Angle(b.center,C),j=k.Angle(b.center,P),N=y(O,j),B=N*b.radius;const D=C.clone(),G=P.clone();if($!==0){const W=$/B*(m?1:-1),Q=k.FromAngle(O+N*W);D.setTo(b.center).add(Q.mul(b.radius))}if(T!==0){const W=T/B*(m?-1:1),Q=k.FromAngle(j+N*W);G.setTo(b.center).add(Q.mul(b.radius))}if(k.Dist(D,G)<M&&($!==0&&T!==0?($*=-1.5,T*=-1.5):$!==0?$*=-2:T!==0&&(T*=-2)),$!==0){const W=$/B*(m?1:-1),Q=k.FromAngle(O+N*W);C.setTo(b.center).add(Q.mul(b.radius))}if(T!==0){const W=T/B*(m?-1:1),Q=k.FromAngle(j+N*W);P.setTo(b.center).add(Q.mul(b.radius))}if(u&&d&&!u.isExact&&!d.isExact){O=k.Angle(b.center,C),j=k.Angle(b.center,P),N=y(O,j),B=N*b.radius;const W=lp(e,u.shape.id,d.shape.id);if(W==="double-bound"&&B<30)C.setTo(f),P.setTo(p),E.setTo(v);else if(W==="safe"&&(u&&!u.didIntersect&&C.setTo(f),d&&!d.didIntersect||y(x,O)>y(x,j))){const Q=Math.min(.9,Ti/B)*(m?1:-1),oe=k.FromAngle(O+N*Q);P.setTo(b.center).add(oe.mul(b.radius))}}lO(b.center,b.radius,C,P,E,S,m),C.equals(P)&&(C.setTo(E.clone().addXY(1,1)),P.setTo(E.clone().subXY(1,1))),f.setTo(C),p.setTo(P),v.setTo(E);const z=Iy(f,p,v);return{isStraight:!1,start:{point:f,handle:i.start,arrowhead:t.props.arrowheadStart},end:{point:p,handle:i.end,arrowhead:t.props.arrowheadEnd},middle:v,handleArc:b,bodyArc:z,isValid:z.length!==0&&isFinite(z.center.x)&&isFinite(z.center.y)}}function sX(e){const{start:t,end:n,handleArc:{radius:r,largeArcFlag:o,sweepFlag:s}}=e;return`M${t.handle.x},${t.handle.y} A${r} ${r} 0 ${o} ${s} ${n.handle.x},${n.handle.y}`}function iX(e){const{start:t,end:n,bodyArc:{radius:r,largeArcFlag:o,sweepFlag:s}}=e;return`M${t.point.x},${t.point.y} A${r} ${r} 0 ${o} ${s} ${n.point.x},${n.point.y}`}function Iy(e,t,n){const r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),o={x:((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,y:((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r},s=k.Dist(o,e),i=+k.Clockwise(e,n,t),a=Math.hypot(e.y-t.y,e.x-t.x),c=Math.hypot(t.y-n.y,t.x-n.x),l=Math.hypot(n.y-e.y,n.x-e.x),u=Math.acos((c*c+l*l-a*a)/(2*c*l))*2,d=+(xt>u),f=(He-u)*(i?1:-1),p=f*s;return{center:o,radius:s,size:f,length:p,largeArcFlag:d,sweepFlag:i}}function lO(e,t,n,r,o,s,i){const a=k.Angle(e,n),c=k.Angle(e,r);let l=Nl(a,c);i||(l=He-l);const u=.5*(i?1:-1),d=k.FromAngle(a+l*u);if(o.setTo(e).add(d.mul(t)),l>s){o.rotWith(e,xt);const f=r.clone();r.setTo(n),n.setTo(f)}}const uO={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};class $c{constructor(t,n){I(this,"id");I(this,"type");I(this,"shapeType");I(this,"initial");I(this,"children");I(this,"parent");I(this,"_path");I(this,"_current");I(this,"_isActive");I(this,"transition",(t,n={})=>{var s;const r=t.split(".");let o=this;for(let i=0;i<r.length;i++){const a=r[i],c=o.getCurrent(),l=(s=o.children)==null?void 0:s[a];if(!l)throw Error(`${o.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==l.id&&(c==null||c.exit(n,a),o._current.set(l),l.enter(n,(c==null?void 0:c.id)||"initial"),!l.getIsActive()))break;o=l}return this});I(this,"handleEvent",t=>{var o;const n=uO[t.name],r=this.getCurrent();(o=this[n])==null||o.call(this,t),this.getCurrent()===r&&this.getIsActive()&&(r==null||r.handleEvent(t))});I(this,"enter",(t,n)=>{var r;if(this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,t,n),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){const o=this.children[this.initial];this._current.set(o),o.enter(t,n)}});I(this,"exit",(t,n)=>{var r,o;this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),(r=this.onExit)==null||r.call(this,t,n),this.getIsActive()||(o=this.getCurrent())==null||o.exit(t,n)});I(this,"_currentToolIdMask",wt("curent tool id mask",void 0));I(this,"onWheel");I(this,"onPointerDown");I(this,"onPointerMove");I(this,"onPointerUp");I(this,"onDoubleClick");I(this,"onTripleClick");I(this,"onQuadrupleClick");I(this,"onRightClick");I(this,"onMiddleClick");I(this,"onKeyDown");I(this,"onKeyUp");I(this,"onKeyRepeat");I(this,"onCancel");I(this,"onComplete");I(this,"onInterrupt");I(this,"onEnter");I(this,"onExit");I(this,"onTick");this.editor=t;const{id:r,children:o,initial:s}=this.constructor;this.id=r,this._isActive=wt("toolIsActive"+this.id,!1),this._current=wt("toolState"+this.id,void 0),this._path=X("toolPath"+this.id,()=>{const i=this.getCurrent();return this.id+(i?`.${i.getPath()}`:"")}),this.parent=n??{},this.parent?o&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(o().map(i=>[i.id,new i(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",o&&s&&(this.initial=s,this.children=Object.fromEntries(o().map(i=>[i.id,new i(this.editor,this)])),this._current.set(this.children[this.initial])))}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(t){this._currentToolIdMask.set(t)}}I($c,"id"),I($c,"initial"),I($c,"children");class Ac extends $c{constructor(){super(...arguments);I(this,"onKeyDown",n=>{var r;switch(n.code){case"KeyZ":{if(!(n.shiftKey||n.ctrlKey)){const o=this.getCurrent();o&&((r=o.getCurrent())==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...n,onInteractionEnd:o.id})}break}}})}}I(Ac,"id","root"),I(Ac,"initial",""),I(Ac,"children",()=>[]);var dO=Object.defineProperty,fO=Object.getOwnPropertyDescriptor,re=(e,t,n,r)=>{for(var o=fO(t,n),s=e.length-1,i;s>=0;s--)(i=e[s])&&(o=i(t,n,o)||o);return o&&dO(t,n,o),o};class ne extends wM.EventEmitter{constructor({store:n,user:r,shapeUtils:o,tools:s,getContainer:i,initialState:a,inferDarkMode:c}){super();I(this,"store");I(this,"root");I(this,"disposables",new Set);I(this,"_tickManager",new sO(this));I(this,"snaps");I(this,"user");I(this,"textMeasure");I(this,"environment");I(this,"scribbles");I(this,"getContainer");I(this,"sideEffects");I(this,"shapeUtils");I(this,"styleProps");I(this,"history",new XM(this,n=>{this.annotateError(n,{origin:"history.batch",willCrashApp:!0}),this.crash(n)}));I(this,"_crashingError",null);I(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",(n,r)=>{const o=this.store.get(this.getInstanceState().id),s={...o,...n};return{data:{prev:o,next:s},ephemeral:!1,squashing:!1,...r}},{do:({next:n})=>{this.store.put([n])},undo:({prev:n})=>{this.store.put([n])},squash({prev:n},{next:r}){return{prev:n,next:r}}}));I(this,"_isChangingStyleTimeout",-1);I(this,"setCursor",n=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...n}},{ephemeral:!0}),this));I(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",(n,r)=>({data:{prev:this.store.get(n.id??this.getCurrentPageState().id),partial:n},...r}),{do:({prev:n,partial:r})=>{this.store.update(n.id,o=>({...o,...r}))},undo:({prev:n})=>{this.store.update(n.id,()=>n)}}));I(this,"_setSelectedShapes",this.history.createCommand("setSelectedShapes",(n,r)=>{const{selectedShapeIds:o}=this.getCurrentPageState(),s=new Set(o);return n.length===s.size&&n.every(i=>s.has(i))?null:{data:{selectedShapeIds:n,prevSelectedShapeIds:o},preservesRedoStack:!0,...r}},{do:({selectedShapeIds:n})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},undo:({prevSelectedShapeIds:n})=>{this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},squash({prevSelectedShapeIds:n},{selectedShapeIds:r}){return{selectedShapeIds:r,prevSelectedShapeIds:n}}}));I(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",n=>{const r=this.getCurrentPageState().focusedGroupId;if(r!==n)return{data:{prev:r,next:n},preservesRedoStack:!0,squashing:!0}},{do:({next:n})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},undo:({prev:n})=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},squash({prev:n},{next:r}){return{prev:n,next:r}}}));I(this,"_viewportAnimation",null);I(this,"_willSetInitialBounds",!0);I(this,"_cameraState",wt("camera state","idle"));I(this,"_cameraStateTimeoutRemaining",0);I(this,"_lastUpdateRenderingBoundsTimestamp",Date.now());I(this,"_decayCameraStateTimeout",n=>{this._cameraStateTimeoutRemaining-=n,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())});I(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=UT;const n=Date.now();this._cameraState.__unsafe__getWithoutCapture()==="idle"?(this._lastUpdateRenderingBoundsTimestamp=n,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):n-this._lastUpdateRenderingBoundsTimestamp>VT&&this.updateRenderingBounds()});I(this,"_renderingBounds",wt("rendering viewport",new ce));I(this,"_renderingBoundsExpanded",wt("rendering viewport expanded",new ce));I(this,"renderingBoundsMargin",100);I(this,"_currentPageShapeIds");I(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",(n,r)=>{if(!this.store.has(n)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return this.stopFollowingUser(),{data:{toId:n,fromId:this.getCurrentPageId()},squashing:!0,preservesRedoStack:!0,...r}},{do:({toId:n})=>{if(this.store.has(n)){if(!this.getPageStates().find(r=>r.pageId===n)){const r=pt.create({id:pt.createId(n)});this.store.put([r,gt.create({id:gt.createId(n),pageId:n})])}this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.updateRenderingBounds()}},undo:({fromId:n})=>{this.store.has(n)&&(this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.updateRenderingBounds())},squash:({fromId:n},{toId:r})=>({toId:r,fromId:n})}));I(this,"_updatePage",this.history.createCommand("updatePage",(n,r)=>{if(this.getInstanceState().isReadonly)return null;const o=this.getPage(n.id);return o?{data:{prev:o,partial:n},...r}:null},{do:({partial:n})=>{this.store.update(n.id,r=>({...r,...n}))},undo:({prev:n,partial:r})=>{this.store.update(r.id,()=>n)},squash(n,r){return{prev:{...n.prev,...r.prev},partial:r.partial}}}));I(this,"_createPage",this.history.createCommand("createPage",n=>{if(this.getInstanceState().isReadonly||this.getPages().length>=tl)return null;const r=this.getPages(),o=AM(n.name??"Workspace 1",r.map(l=>l.name));let s=n.index;(!s||r.some(l=>l.index===s))&&(s=Tr(r[r.length-1].index));const i=Lr.create({meta:{type:"freeform"},...n,name:o,index:s}),a=pt.create({id:pt.createId(i.id)}),c=gt.create({id:gt.createId(i.id),pageId:i.id});return{data:{newPage:i,newTabPageState:c,newCamera:a}}},{do:({newPage:n,newTabPageState:r,newCamera:o})=>{this.store.put([n,o,r])},undo:({newPage:n,newTabPageState:r,newCamera:o})=>{this.getPages().length!==1&&this.store.remove([r.id,n.id,o.id])}}));I(this,"_deletePage",this.history.createCommand("delete_page",n=>{if(this.getInstanceState().isReadonly)return null;const r=this.getPages();if(r.length===1)return null;const o=this.getPage(n),s=this.getPageStates().filter(i=>i.pageId===n);if(!o)return null;if(n===this.getCurrentPageId()){const i=r.findIndex(c=>c.id===n),a=r[i-1]??r[i+1];this.setCurrentPage(a.id)}return{data:{id:n,deletedPage:o,deletedPageStates:s}}},{do:({deletedPage:n,deletedPageStates:r})=>{const o=this.getPages();if(o.length!==1){if(n.id===this.getCurrentPageId()){const s=o.findIndex(a=>a.id===n.id),i=o[s-1]??o[s+1];this.setCurrentPage(i.id)}this.store.remove(r.map(s=>s.id)),this.store.remove([n.id]),this.updateRenderingBounds()}},undo:({deletedPage:n,deletedPageStates:r})=>{this.store.put([n]),this.store.put(r),this.updateRenderingBounds()}}));I(this,"_createAssets",this.history.createCommand("createAssets",n=>this.getInstanceState().isReadonly||n.length<=0?null:{data:{assets:n}},{do:({assets:n})=>{this.store.put(n)},undo:({assets:n})=>{this.store.remove(n.map(r=>r.id))}}));I(this,"_updateAssets",this.history.createCommand("updateAssets",n=>this.getInstanceState().isReadonly||n.length<=0?void 0:{data:{snapshots:{},assets:n}},{do:({assets:n,snapshots:r})=>{this.store.put(n.map(o=>{const s=this.store.get(o.id);return r[o.id]=s,{...s,...o}}))},undo:({snapshots:n})=>{this.store.put(Object.values(n))}}));I(this,"_deleteAssets",this.history.createCommand("deleteAssets",n=>{if(this.getInstanceState().isReadonly||n.length<=0)return;const r=fe(n.map(o=>this.store.get(o)));return{data:{ids:n,prev:r}}},{do:({ids:n})=>{this.store.remove(n)},undo:({prev:n})=>{this.store.put(n)}}));I(this,"_parentIdsToChildIds");I(this,"_childIdsCache",new TM);I(this,"_createShapes",this.history.createCommand("createShapes",n=>{if(this.getInstanceState().isReadonly||n.length<=0)return null;const r=this.getCurrentPageShapeIds();if(n.length+r.size>Qn){Va(this);return}return n.length===0?null:{data:{currentPageId:this.getCurrentPageId(),partials:n.map(s=>s.id?s:{...s,id:Ln()})}}},{do:({partials:n})=>{var a,c;const r=this.getFocusedGroupId(),o=this.getCurrentPageShapesSorted();n=n.map(l=>{if(!l.parentId||!(this.store.has(l.parentId)||n.some(u=>u.id===l.parentId))){let u=this.getFocusedGroupId();for(let f=o.length-1;f>=0;f--){const p=o[f];if(this.getShapeUtil(p).canReceiveNewChildrenOfType(p,l.type)&&this.isPointInShape(p,{x:l.x??0,y:l.y??0},{margin:0,hitInside:!0})){u=p.id;break}}const d=l.parentId;if(u===l.id&&(u=r),u!==d&&(l={...l},l.parentId=u,Sn(u))){const f=this.getPointInShapeSpace(this.getShape(u),{x:l.x??0,y:l.y??0});l.x=f.x,l.y=f.y,l.rotation=-this.getShapePageTransform(u).rotation()+(l.rotation??0)}}return l});const s=new Map,i=[];for(const l of n){const u=this.getShapeUtil(l);let d=l.index;if(!d){const m=l.parentId??r;s.has(m)||s.set(m,this.getHighestIndexForParent(m)),d=s.get(m),s.set(m,Tr(d))}const f=u.getDefaultProps();for(const[m,y]of this.styleProps[l.type])f[y]=this.getStyleForNextShape(m);let p=this.store.schema.types.shape.create({...l,index:d,opacity:l.opacity??this.getInstanceState().opacityForNextShape,parentId:l.parentId??r,props:"props"in l?{...f,...l.props}:f});if(p.index===void 0)throw Error("no index!");const v=(c=(a=this.getShapeUtil(p)).onBeforeCreate)==null?void 0:c.call(a,p);v&&(p=v),i.push(p)}i.forEach(l=>{l.meta={...this.getInitialMetaForShape(l),...l.meta}}),this.store.put(i)},undo:({partials:n})=>{this.store.remove(n.map(r=>r.id))}}));I(this,"animatingShapes",new Map);I(this,"_updateShapes",this.history.createCommand("updateShapes",(n,r)=>{if(this.getInstanceState().isReadonly)return null;const o=fe(n),s=Object.fromEntries(fe(o.map(({id:c})=>this.getShape(c))).map(c=>[c.id,c]));if(o.length<=0)return null;const i=fe(o.map(c=>{const l=s[c.id];if(!l)return null;let u=null;for(const[d,f]of Object.entries(c))if(f!==void 0)switch(d){case"id":case"type":continue;default:if(f!==l[d])if(u||(u={...l}),d==="props"){const p={...l.props};for(const[v,m]of Object.entries(f))m!==void 0&&(p[v]=m);u.props=p}else if(d==="meta"){const p={...l.meta};for(const[v,m]of Object.entries(f))m!==void 0&&(p[v]=m);u.meta=p}else u[d]=f}return u??l})),a=Object.fromEntries(i.map(c=>[c.id,c]));return{data:{snapshots:s,updates:a},...r}},{do:({updates:n})=>{var o,s;const r=Object.values(n);for(let i=0;i<r.length;i++){const a=r[i],c=this.store.get(a.id);if(!c)continue;const l=(s=(o=this.getShapeUtil(a)).onBeforeUpdate)==null?void 0:s.call(o,c,a);l&&(r[i]=l)}this.store.put(r)},undo:({snapshots:n})=>{this.store.put(Object.values(n))},squash(n,r){return{snapshots:{...r.snapshots,...n.snapshots},updates:{...n.updates,...r.updates}}}}));I(this,"_deleteShapes",this.history.createCommand("delete_shapes",n=>{if(this.getInstanceState().isReadonly||n.length===0)return null;const r=[...this.getCurrentPageState().selectedShapeIds],o=new Set(n);for(const l of n)this.visitDescendants(l,u=>{o.add(u)});const s=[...o],i=this._getArrowBindingsIndex().get(),a=fe(s.flatMap(l=>{const u=this.getShape(l),d=i[l];return d&&d.length>0?d.map(({arrowId:f})=>this.getShape(f)).concat(u):u})),c=r.filter(l=>!o.has(l));return{data:{deletedIds:s,snapshots:a,prevSelectedShapeIds:r,postSelectedShapeIds:c}}},{do:({deletedIds:n,postSelectedShapeIds:r})=>{this.store.remove(n),this.store.update(this.getCurrentPageState().id,o=>({...o,selectedShapeIds:r}))},undo:({snapshots:n,prevSelectedShapeIds:r})=>{this.store.put(n),this.store.update(this.getCurrentPageState().id,o=>({...o,selectedShapeIds:r}))}}));I(this,"_selectionSharedStyles",X("_selectionSharedStyles",()=>{const n=this.getSelectedShapes(),r=new Ef;for(const o of n)this._extractSharedStyles(o,r);return r}));I(this,"externalAssetContentHandlers",{file:null,url:null});I(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});I(this,"inputs",{originPagePoint:new k,originScreenPoint:new k,previousPagePoint:new k,previousScreenPoint:new k,currentPagePoint:new k,currentScreenPoint:new k,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new k});I(this,"_clickManager",new WM(this));I(this,"_prevCursor","default");I(this,"_shiftKeyTimeout",-1);I(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});I(this,"_altKeyTimeout",-1);I(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});I(this,"_ctrlKeyTimeout",-1);I(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});I(this,"_restoreToolId","select");I(this,"_pinchStart",1);I(this,"_didPinch",!1);I(this,"_selectedShapeIdsAtPointerDown",[]);I(this,"capturedPointerId",null);I(this,"dispatch",n=>{if(this.getCrashingError())return this;const{inputs:r}=this,{type:o}=n;return this.batch(()=>{if(n.type==="misc"){(n.name==="cancel"||n.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(n);return}n.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!n.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),n.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!n.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),n.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!n.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:s,originScreenPoint:i,currentPagePoint:a,currentScreenPoint:c}=r;switch(r.isPointing||(r.isDragging=!1),o){case"pinch":{if(!this.getInstanceState().canMoveCamera)return;switch(this._updateInputsFromEvent(n),n.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds()),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{x:l,y:u,z:d=1},delta:{x:f,y:p}}=n,{x:v,y:m,z:y}=this.getCamera(),b=Math.min(ts,Math.max(ai,d));this.setCamera({x:v+f/y-l/y+l/b,y:m+p/y-u/y+u/b,z:b});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:l}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown,{squashing:!0}),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapes(l,{squashing:!0})}));return}}}case"wheel":{if(!this.getInstanceState().canMoveCamera)break;if(this._updateInputsFromEvent(n),!this.getIsMenuOpen()){if(r.ctrlKey){const{x:l,y:u}=this.inputs.currentScreenPoint,{x:d,y:f,z:p}=this.getCamera(),v=Math.min(ts,Math.max(ai,p+(n.delta.z??0)*p));this.setCamera({x:d+(l/v-l)-(l/p-l),y:f+(u/v-u)-(u/p-u),z:v});return}this.pan(n.delta),!r.isDragging&&r.isPointing&&s.dist(a)>(this.getInstanceState().isCoarsePointer?bf:Sf)/this.getZoomLevel()&&(r.isDragging=!0)}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(n);const{isPen:l}=n;switch(n.name){case"pointer_down":{if(this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),n.button===0&&(this.capturedPointerId=n.pointerId),r.buttons.add(n.button),r.isPointing=!0,r.isDragging=!1,this.getInstanceState().isPenMode){if(!l)return}else l&&this.updateInstanceState({isPenMode:!0});if(n.button===5?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):n.button===1&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;i.setTo(c),s.setTo(a);break}case"pointer_move":{if(!l&&this.getInstanceState().isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:u,previousScreenPoint:d}=this.inputs;this.pan(k.Sub(u,d));return}!r.isDragging&&r.isPointing&&s.dist(a)>(this.getInstanceState().isCoarsePointer?bf:Sf)/this.getZoomLevel()&&(r.isDragging=!0);break}case"pointer_up":{if(r.buttons.delete(n.button),r.isPointing=!1,r.isDragging=!1,this.getIsMenuOpen()||!l&&this.getInstanceState().isPenMode)return;this.capturedPointerId===n.pointerId&&(this.capturedPointerId=null,n.button=0),r.isPanning?n.button===1?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Gu}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(r.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Gu}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):n.button===0&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Gu}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):n.button===5&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(n.key==="ShiftRight"&&(n.key="ShiftLeft"),n.key==="AltRight"&&(n.key="AltLeft"),n.code==="ControlRight"&&(n.code="ControlLeft"),n.name){case"key_down":{r.keys.add(n.code),!n.ctrlKey&&n.code==="Space"&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break}case"key_up":{r.keys.delete(n.code),n.code==="Space"&&!this.inputs.buttons.has(1)&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}));break}}break}}if(n.type==="pointer"&&(n.button===1?n.name="middle_click":n.button===2&&(n.name="right_click"),n.isPen===this.getInstanceState().isPenMode))switch(n.name){case"pointer_down":{const l=this._clickManager.transformPointerDownEvent(n);if(n.name!==l.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(l),this.emit("event",l);return}break}case"pointer_up":{const l=this._clickManager.transformPointerUpEvent(n);if(n.name!==l.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(l),this.emit("event",l);return}break}case"pointer_move":{this._clickManager.handleMove();break}}this.root.handleEvent(n),this.emit("event",n)}),this});this.store=n,this.snaps=new qr(this),this.user=new Wn(r??rx(),c??!1),this.getContainer=i??(()=>document.body),this.textMeasure=new oO(this);class l extends Ac{}I(l,"initial",a??""),this.root=new l(this),this.root.children={};const u=dx(o),d=new Set(Object.keys(n.schema.types.shape.migrations.subTypeMigrations));for(const S of u){if(!d.has(S.type))throw Error(`Editor and store have different shapes: "${S.type}" was passed into the editor but not the schema`);d.delete(S.type)}if(d.size>0)throw Error(`Editor and store have different shapes: "${[...d][0]}" is present in the store schema but not provided to the editor`);const f={},p={},v=new Map;for(const S of u){const C=new S(this);f[S.type]=C;const P=yS(S.props??{});p[S.type]=P;for(const E of P.keys())if(!v.has(E.id))v.set(E.id,E);else if(v.get(E.id)!==E)throw Error(`Multiple style props with id "${E.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=f,this.styleProps=p;for(const S of[...s]){if(Al(this.root.children,S.id))throw Error(`Can't override tool with id "${S.id}"`);this.root.children[S.id]=new S(this,this.root)}this.environment=new HM(this),this.scribbles=new qM(this);const m=new Set,y=S=>{var V;const C=this.getShape(S);if(!C)return;const{start:P,end:E}=C.props,_=P.type==="binding"?this.getShape(P.boundShapeId):void 0,$=E.type==="binding"?this.getShape(E.boundShapeId):void 0,T=this.getAncestorPageId(C);if(!T)return;let M;if(_&&$)M=this.findCommonAncestor([_,$])??T;else if(_||$){const z=(V=_||$)==null?void 0:V.parentId;z&&z===C.parentId?M=C.parentId:M=T}else return;M&&M!==C.parentId&&this.reparentShapes([S],M);const O=this.getShape(S);if(!O)throw Error("no reparented arrow");const j=this.getShapeNearestSibling(O,_),N=this.getShapeNearestSibling(O,$);let B;if(j&&N)B=j.index>N.index?j:N;else if(j&&!N)B=j;else if(N&&!j)B=N;else return;let D;const G=this.getSortedChildIdsForParent(B.parentId).map(z=>this.getShape(z)).filter(z=>z.index>B.index);if(G.length){const z=G.find(W=>W.type!=="arrow");if(O.index>B.index&&(!z||O.index<z.index))return;D=Tc(B.index,G[0].index)}else D=Tr(B.index);D!==O.index&&this.updateShapes([{id:S,type:"arrow",index:D}])},b=(S,C)=>{const{x:P,y:E}=fo(this,S)[C];this.store.put([{...S,props:{...S.props,[C]:{type:"point",x:P,y:E}}}])},x=S=>{for(const C of["start","end"]){const P=S.props[C];if(P.type!=="binding")continue;const E=this.getShape(P.boundShapeId),_=this.getAncestorPageId(S)===this.getAncestorPageId(E);(!E||!_)&&b(S,C)}y(S.id)},w=(S,C)=>{let P=null;const E=S.selectedShapeIds.filter(T=>!C.has(T));E.length!==S.selectedShapeIds.length&&(P||(P={...S}),P.selectedShapeIds=E);const _=S.erasingShapeIds.filter(T=>!C.has(T));_.length!==S.erasingShapeIds.length&&(P||(P={...S}),P.erasingShapeIds=_),S.hoveredShapeId&&C.has(S.hoveredShapeId)&&(P||(P={...S}),P.hoveredShapeId=null),S.editingShapeId&&C.has(S.editingShapeId)&&(P||(P={...S}),P.editingShapeId=null);const $=S.hintingShapeIds.filter(T=>!C.has(T));return $.length!==S.hintingShapeIds.length&&(P||(P={...S}),P.hintingShapeIds=$),S.focusedGroupId&&C.has(S.focusedGroupId)&&(P||(P={...S}),P.focusedGroupId=null),P};if(this.sideEffects=new ZM(this),this.sideEffects.registerBatchCompleteHandler(()=>{var S;for(const C of m){m.delete(C);const P=this.getShape(C);if(!P)continue;const E=this.getShapeUtil(P),_=(S=E.onChildrenChange)==null?void 0:S.call(E,P);_!=null&&_.length&&this.updateShapes(_,{squashing:!0})}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",S=>{S.parentId&&Sn(S.parentId)&&m.add(S.parentId);const C=this._getArrowBindingsIndex().get()[S.id];if(C!=null&&C.length)for(const{arrowId:_,handleId:$}of C){const T=this.getShape(_);T&&b(T,$)}const P=new Set([S.id]),E=fe(this.getPageStates().map(_=>w(_,P)));E.length&&this.store.put(E)}),this.sideEffects.registerBeforeDeleteHandler("page",S=>{var _;if(this.getInstanceState().currentPageId!==S.id)return;const C=(_=this.getPages().find($=>$.id!==S.id))==null?void 0:_.id;if(!C)return;this.store.put([{...this.getInstanceState(),currentPageId:C}]);const P=pt.createId(S.id),E=gt.createId(S.id);this.store.remove([P,E])}),this.sideEffects.registerAfterChangeHandler("shape",(S,C)=>{if(this.isShapeOfType(C,"arrow")&&x(C),S.parentId!==C.parentId){const P=E=>{const _=this._getArrowBindingsIndex().get()[E];if(_!=null&&_.length)for(const $ of _)y($.arrowId)};P(C.id),this.visitDescendants(C.id,P)}if(S.parentId!==C.parentId&&Lt(C.parentId)){const P=new Set([S.id]);this.visitDescendants(S.id,E=>{P.add(E)});for(const E of this.getPageStates()){if(E.pageId===C.parentId)continue;const _=w(E,P);_&&this.store.put([_])}}S.parentId&&Sn(S.parentId)&&m.add(S.parentId),C.parentId!==S.parentId&&Sn(C.parentId)&&m.add(C.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(S,C)=>{if((S==null?void 0:S.selectedShapeIds)!==(C==null?void 0:C.selectedShapeIds)){const P=C.selectedShapeIds.filter(_=>{var T,M;let $=(T=this.getShape(_))==null?void 0:T.parentId;for(;Sn($);){if(C.selectedShapeIds.includes($))return!1;$=(M=this.getShape($))==null?void 0:M.parentId}return!0});let E=null;if(P.length>0){const _=this.findCommonAncestor(fe(P.map($=>this.getShape($))),$=>this.isShapeOfType($,"group"));_&&(E=_)}else C!=null&&C.focusedGroupId&&(E=C.focusedGroupId);(P.length!==C.selectedShapeIds.length||E!==C.focusedGroupId)&&this.store.put([{...C,selectedShapeIds:P,focusedGroupId:E??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",S=>{this.isShapeOfType(S,"arrow")&&x(S)}),this.sideEffects.registerAfterCreateHandler("page",S=>{const C=pt.createId(S.id),P=gt.createId(S.id);this.store.has(C)||this.store.put([pt.create({id:C})]),this.store.has(P)||this.store.put([gt.create({id:P,pageId:S.id})])}),this._currentPageShapeIds=VM(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=UM(this.store),this.disposables.add(this.store.listen(S=>{this.emit("change",S)})),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},{ephemeral:!0}),a&&this.root.children[a]===void 0)throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}dispose(){this.disposables.forEach(n=>n()),this.disposables.clear()}getShapeUtil(n){const r=typeof n=="string"?n:n.type,o=yo(this.shapeUtils,r);return Nh(o,`No shape util found for type "${r}"`),o}undo(){return this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this.history.redo(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(n,r,o){return this.history.mark(n,r,o),this}bail(){return this.history.bail(),this}bailToMark(n){return this.history.bailToMark(n),this}batch(n){return this.history.batch(n),this}_getArrowBindingsIndex(){return zM(this)}getArrowsBoundTo(n){return this._getArrowBindingsIndex().get()[n]||nr}getArrowInfoCache(){return this.store.createComputedCache("arrow infoCache",n=>li(n)?$i(this,n):ed(this,n))}getArrowInfo(n){const r=typeof n=="string"?n:n.id;return this.getArrowInfoCache().get(r)}annotateError(n,{origin:r,willCrashApp:o,tags:s,extras:i}){const a=this.createErrorAnnotations(r,o);return Lh(n,{tags:{...a.tags,...s},extras:{...a.extras,...i}}),o&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(n,r){try{const o=this.getEditingShapeId();return{tags:{origin:n,willCrashApp:r},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:o?this.getShape(o):void 0,inputs:this.inputs}}}catch{return{tags:{origin:n,willCrashApp:r},extras:{}}}}getCrashingError(){return this._crashingError}crash(n){return this._crashingError=n,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:n}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(n){const r=n.split(".").reverse();let o=this.root;for(;r.length>0;){const s=r.pop();if(!s)return!0;const i=o.getCurrent();if((i==null?void 0:i.id)===s){if(r.length===0)return!0;o=i;continue}else return!1}return!1}isInAny(...n){return n.some(r=>this.isIn(r))}setCurrentTool(n,r={}){return this.root.transition(n,r),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const n=this.getCurrentTool();return n?n.getCurrentToolIdMask()??n.id:""}getStateDescendant(n){var s;const r=n.split(".").reverse();let o=this.root;for(;r.length>0;){const i=r.pop();if(!i)return o;const a=(s=o.children)==null?void 0:s[i];if(!a)return;o=a}return o}getDocumentSettings(){return this.store.get(yf)}updateDocumentSettings(n){return this.store.put([{...this.getDocumentSettings(),...n}]),this}getInstanceState(){return this.store.get(yt)}updateInstanceState(n,r){return this._updateInstanceState(n,{ephemeral:!0,squashing:!0,...r}),n.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),n.isChangingStyle===!0&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(n){const r=new Set(this.getOpenMenus());return r.has(n)||(r.add(n),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(n){const r=new Set(this.getOpenMenus());return r.has(n)&&(r.delete(n),this.updateInstanceState({openMenus:[...r]})),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return gt.createId(this.getCurrentPageId())}updateCurrentPageState(n,r){return this._setInstancePageState(n,r),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:n}=this.getCurrentPageState();return fe(n.map(r=>this.store.get(r)))}setSelectedShapes(n,r){const o=n.map(s=>typeof s=="string"?s:s.id);return this._setSelectedShapes(o,r),this}isAncestorSelected(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null,o=this.getShape(r);if(!o)return!1;const s=this.getSelectedShapeIds();return!!this.findShapeAncestor(o,i=>s.includes(i.id))}select(...n){const r=typeof n[0]=="string"?n:n.map(o=>o.id);return this.setSelectedShapes(r),this}deselect(...n){const r=typeof n[0]=="string"?n:n.map(s=>s.id),o=this.getSelectedShapeIds();return o.length>0&&r.length>0&&this.setSelectedShapes(o.filter(s=>!r.includes(s))),this}selectAll(){const n=this.getSortedChildIdsForParent(this.getCurrentPageId());return n.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(n)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShape(){const n=this.getSelectedShapes();return n.length===1?n[0]:null}getSelectionPageBounds(){const n=this.getCurrentPageState().selectedShapeIds;return n.length===0?null:ce.Common(fe(n.map(r=>this.getShapePageBounds(r))))}getSelectionRotation(){const n=this.getSelectedShapeIds();if(n.length===0)return 0;if(n.length===1)return this.getShapePageTransform(this.getSelectedShapeIds()[0]).rotation();const r=n.map(o=>this.getShapePageTransform(o).rotation());return r.every(o=>Math.abs(o-r[0])<Math.PI/180)?this.getShapePageTransform(n[0]).rotation():0}getSelectionRotatedPageBounds(){const n=this.getSelectedShapeIds();if(n.length===0)return;const r=this.getSelectionRotation();if(r===0)return this.getSelectionPageBounds();if(n.length===1){const s=this.getShapeGeometry(n[0]).bounds.clone(),i=this.getShapePageTransform(n[0]);return s.point=i.applyToPoint(s.point),s}const o=ce.FromPoints(this.getSelectedShapeIds().flatMap(s=>{const i=this.getShapePageTransform(s);return i?i.applyToPoints(this.getShapeGeometry(s).vertices):[]}).map(s=>k.Rot(s,-r)));return o.point=o.point.rot(r),o}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const n=this.getFocusedGroupId();return n?this.getShape(n):void 0}setFocusedGroup(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(r!==null){const o=this.getShape(r);if(!o)throw Error(`Editor.setFocusedGroup: Shape with id ${r} does not exist`);if(!this.isShapeOfType(o,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${o.type}`)}return r===this.getFocusedGroupId()?this:(this._setFocusedGroupId(r),this)}popFocusedGroupId(){const n=this.getFocusedGroup();if(n){const r=this.findShapeAncestor(n,o=>this.isShapeOfType(o,"group"));this.setFocusedGroup((r==null?void 0:r.id)??null),this.select(n.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const n=this.getEditingShapeId();return n?this.getShape(n):void 0}setEditingShape(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(r!==this.getEditingShapeId()){if(r){const o=this.getShape(r);if(o&&this.getShapeUtil(o).canEdit(o))return this._setInstancePageState({editingShapeId:r}),this}this._setInstancePageState({editingShapeId:null})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const n=this.getHoveredShapeId();return n?this.getShape(n):void 0}setHoveredShape(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;return r===this.getHoveredShapeId()?this:(this.updateCurrentPageState({hoveredShapeId:r},{ephemeral:!0}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const n=this.getHintingShapeIds();return fe(n.map(r=>this.getShape(r)))}setHintingShapes(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id);return this.updateCurrentPageState({hintingShapeIds:Wc(r)},{ephemeral:!0}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const n=this.getErasingShapeIds();return fe(n.map(r=>this.getShape(r)))}setErasingShapes(n){const r=typeof n[0]=="string"?n:n.map(s=>s.id);r.sort();const o=this.getErasingShapeIds();if(r.length===o.length){for(let s=0;s<r.length;s++)if(r[s]!==o[s]){this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});break}}else this._setInstancePageState({erasingShapeIds:r},{ephemeral:!0});return this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(n){const r=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(r!==this.getCroppingShapeId())if(!r)this.updateCurrentPageState({croppingShapeId:null});else{const o=this.getShape(r),s=this.getShapeUtil(o);o&&s.canCrop(o)&&this.updateCurrentPageState({croppingShapeId:r})}return this}getCameraId(){return pt.createId(this.getCurrentPageId())}getCamera(){return this.store.get(this.getCameraId())}getZoomLevel(){return this.getCamera().z}_setCamera(n){const r=this.getCamera();return r.x===n.x&&r.y===n.y&&r.z===n.z?this:(this.batch(()=>{this.store.put([{...r,...n}]);const{currentScreenPoint:o}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:o,pointerId:Zm.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1}),this._tickCameraState()}),this)}setCamera(n,r){const o=Number.isFinite(n.x)?n.x:0,s=Number.isFinite(n.y)?n.y:0,i=Number.isFinite(n.z)?n.z:this.getZoomLevel();if(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),r){const{width:a,height:c}=this.getViewportScreenBounds();return this._animateToViewport(new ce(-o,-s,a/i,c/i),r)}else this._setCamera({x:o,y:s,z:i});return this}centerOnPoint(n,r){if(!this.getInstanceState().canMoveCamera)return this;const{width:o,height:s}=this.getViewportPageBounds();return this.setCamera({x:-(n.x-o/2),y:-(n.y-s/2),z:this.getCamera().z},r),this}zoomToContent(){const n=this.getSelectionPageBounds()??this.getCurrentPageBounds();return n&&this.zoomToBounds(n,Math.min(1,this.getZoomLevel()),{duration:220}),this}zoomToFit(n){if(!this.getInstanceState().canMoveCamera)return this;const r=[...this.getCurrentPageShapeIds()];if(r.length<=0)return this;const o=ce.Common(fe(r.map(s=>this.getShapePageBounds(s))));return this.zoomToBounds(o,void 0,n),this}resetZoom(n=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:o,y:s,z:i}=this.getCamera(),{x:a,y:c}=n;return this.setCamera({x:o+(a/1-a)-(a/i-a),y:s+(c/1-c)-(c/i-c),z:1},r),this}zoomIn(n=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:o,y:s,z:i}=this.getCamera();let a=ts;for(let u=1;u<Lo.length;u++){const d=Lo[u-1],f=Lo[u];if(!(f-i<=(f-d)/2)){a=f;break}}const{x:c,y:l}=n;return this.setCamera({x:o+(c/a-c)-(c/i-c),y:s+(l/a-l)-(l/i-l),z:a},r),this}zoomOut(n=this.getViewportScreenCenter(),r){if(!this.getInstanceState().canMoveCamera)return this;const{x:o,y:s,z:i}=this.getCamera();let a=ai;for(let u=Lo.length-1;u>0;u--){const d=Lo[u-1],f=Lo[u];if(!(f-i>=(f-d)/2)){a=d;break}}const{x:c,y:l}=n;return this.setCamera({x:o+(c/a-c)-(c/i-c),y:s+(l/a-l)-(l/i-l),z:a},r),this}zoomToSelection(n){if(!this.getInstanceState().canMoveCamera)return this;const r=this.getSelectionPageBounds();return r?(this.zoomToBounds(r,Math.max(1,this.getZoomLevel()),n),this):this}panZoomIntoView(n,r){if(!this.getInstanceState().canMoveCamera)return this;if(n.length<=0)return this;const o=ce.Common(fe(n.map(i=>this.getShapePageBounds(i)))),s=this.getViewportPageBounds();if(s.h<o.h||s.w<o.w)return this.zoomToBounds(o,this.getCamera().z,r),this;{const i=this.getViewportPageBounds().clone().expandBy(-32/this.getZoomLevel());let a=0,c=0;i.maxY<o.maxY?c=i.maxY-o.maxY:i.minY>o.minY&&(c=i.minY-o.minY),i.maxX<o.maxX?a=i.maxX-o.maxX:i.minX>o.minX&&(a=i.minX-o.minX);const l=this.getCamera();this.setCamera({x:l.x+a,y:l.y+c,z:l.z},r)}return this}zoomToBounds(n,r,o){if(!this.getInstanceState().canMoveCamera)return this;const s=this.getViewportScreenBounds(),i=Math.min(256,s.width*.28);let a=jn(Math.min((s.width-i)/n.width,(s.height-i)/n.height),ai,ts);return r!==void 0&&(a=Math.min(r,a)),this.setCamera({x:-n.minX+(s.width-n.width*a)/2/a,y:-n.minY+(s.height-n.height*a)/2/a,z:a},o),this}pan(n,r){if(!this.getInstanceState().canMoveCamera)return this;const{x:o,y:s,z:i}=this.getCamera();return this.setCamera({x:o+n.x/i,y:s+n.y/i,z:i},r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(n){if(!this._viewportAnimation)return;const r=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",r),this._viewportAnimation=null};this.once("stop-camera-animation",r),this._viewportAnimation.elapsed+=n;const{elapsed:o,easing:s,duration:i,start:a,end:c}=this._viewportAnimation;if(o>i){this._setCamera({x:-c.x,y:-c.y,z:this.getViewportScreenBounds().width/c.width}),r();return}const l=i-o,u=s(1-l/i),d=a.minX+(c.minX-a.minX)*u,f=a.minY+(c.minY-a.minY)*u,p=a.maxX+(c.maxX-a.maxX)*u;this._setCamera({x:-d,y:-f,z:this.getViewportScreenBounds().width/(p-d)})}_animateToViewport(n,r={}){const{duration:o=0,easing:s=Br.easeInOutCubic}=r,i=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||i===0?this._setCamera({x:-n.x,y:-n.y,z:this.getViewportScreenBounds().width/n.width}):(this._viewportAnimation={elapsed:0,duration:o/i,easing:s,start:a.clone(),end:n.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(n={}){if(!this.getInstanceState().canMoveCamera)return this;if(this.stopCameraAnimation(),this.user.getAnimationSpeed()===0)return this;const{speed:o,friction:s,direction:i,speedThreshold:a=.01}=n;let c=Math.min(o,1);const l=()=>{this.removeListener("tick",u),this.removeListener("stop-camera-animation",l)};this.once("stop-camera-animation",l);const u=d=>{const{x:f,y:p,z:v}=this.getCamera(),m=k.Mul(i,c*d/v);c*=1-s,c<a?l():this._setCamera({x:f+m.x,y:p+m.y,z:v})};return this.addListener("tick",u),this}animateToUser(n){const o=[...this.store.query.records("instance_presence",()=>({userId:{eq:n}})).get()].sort((s,i)=>s.lastActivityTimestamp-i.lastActivityTimestamp).pop();return o?(this.batch(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=o.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(o.currentPageId);const i=s?{duration:500}:void 0;this.centerOnPoint(o.cursor,i);const{highlightedUserIds:a}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...a,n]}),setTimeout(()=>{const c=[...this.getInstanceState().highlightedUserIds],l=c.indexOf(n);l<0||(c.splice(l,1),this.updateInstanceState({highlightedUserIds:c}))},TS)}),this):this}animateToShape(n,r=FT){if(!this.getInstanceState().canMoveCamera)return this;const o=this.getViewportScreenBounds().clone().expandBy(-32),s=o.width/o.height,i=this.getShapePageBounds(n);if(!i)return this;const a=i.width/i.height,c=i.clone(),l=i.width/o.width;return c.width+=(o.minX+o.maxX)*l,c.height+=(o.minY+o.maxY)*l,c.x-=o.minX*l,c.y-=o.minY*l,a>s?(c.height=i.width/s,c.y-=(c.height-i.height)/2):(c.width=i.height*s,c.x-=(c.width-i.width)/2),this._animateToViewport(c,r)}updateViewportScreenBounds(n=!1){const r=this.getContainer();if(!r)return this;const o=r.getBoundingClientRect(),s=new ce(o.left||o.x,o.top||o.y,Math.max(o.width,1),Math.max(o.height,1)),i=s.equals(this.getViewportScreenBounds()),{_willSetInitialBounds:a}=this;if(i)this._willSetInitialBounds=!1;else if(a)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:s.toJson()},{squashing:!0,ephemeral:!0});else if(n&&!this.getInstanceState().followingUserId){const c=this.getViewportPageCenter();this.updateInstanceState({screenBounds:s.toJson()},{squashing:!0,ephemeral:!0}),this.centerOnPoint(c)}else this.updateInstanceState({screenBounds:s.toJson()},{squashing:!0,ephemeral:!0});return this._tickCameraState(),this.updateRenderingBounds(),this}getViewportScreenBounds(){const{x:n,y:r,w:o,h:s}=this.getInstanceState().screenBounds;return new ce(n,r,o,s)}getViewportScreenCenter(){return this.getViewportScreenBounds().center}getViewportPageBounds(){const{w:n,h:r}=this.getViewportScreenBounds(),{x:o,y:s,z:i}=this.getCamera();return new ce(-o,-s,n/i,r/i)}getViewportPageCenter(){return this.getViewportPageBounds().center}screenToPage(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(yt),{x:o,y:s,z:i=1}=this.getCamera();return{x:(n.x-r.x)/i-o,y:(n.y-r.y)/i-s,z:n.z??.5}}screenToPageBox(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(yt),{x:o,y:s,z:i=1}=this.getCamera();return new ce((n.minX-r.x)/i-o,(n.minY-r.y)/i-s,n.width/i,n.height/i)}pageToScreen(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(yt),{x:o,y:s,z:i=1}=this.getCamera();return{x:(n.x+o)*i+r.x,y:(n.y+s)*i+r.y,z:n.z??.5}}pageToScreenBox(n){const r=this.pageToScreen({x:n.minX,y:n.minY}),o=this.pageToScreen({x:n.maxX,y:n.maxY});return new ce(r.x,r.y,o.x-r.x,o.y-r.y)}startFollowingUser(n){const r=this.store.query.records("instance_presence",()=>({userId:{eq:n}})),o=this.user.getId();if(o||console.warn("You should set the userId for the current instance before following a user"),r.get().some(c=>c.followingUserId===o))return this;an(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:n},{ephemeral:!0})});const s=()=>{this.removeListener("frame",a),this.removeListener("stop-following",s)};let i=!1;const a=()=>{const c=[...r.get()].sort((j,N)=>j.lastActivityTimestamp-N.lastActivityTimestamp).pop();if(!c){this.stopFollowingUser();return}const l=c.currentPageId===this.getCurrentPageId(),u=l?AT:1;if(!l){this.stopFollowingUser(),this.setCurrentPage(c.currentPageId),this.startFollowingUser(n);return}const{center:d,width:f,height:p}=this.getViewportPageBounds(),v=ce.From(c.screenBounds),m=v.width/c.camera.z,y=v.height/c.camera.z,b=new k(m/2-c.camera.x,y/2-c.camera.y),x=c.followingUserId===o,w=f+(m-f)*u,S=p+(y-p)*u,C=x?p/S:Math.min(f/w,p/S),P=jn(this.getCamera().z*C,ai,ts),E=this.getViewportScreenBounds().w/P,_=this.getViewportScreenBounds().h/P,$=b.sub(d),T=k.Add(d,k.Mul($,u)),M=k.Sub(T,d).len(),O=Math.abs(P-this.getCamera().z);if(M<MT&&O<RT){i=!0;return}i&&M<OT&&O<jT||(i=!1,this.stopCameraAnimation(),this._setCamera({x:-(T.x-E/2),y:-(T.y-_/2),z:P}))};return this.once("stop-following",s),this.addListener("frame",a),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},{ephemeral:!0}),this.emit("stop-following"),this}getCameraState(){return this._cameraState.get()}getUnorderedRenderingShapes(n){const r=[];let o=Qn*2,s=Qn;const i=this.getEditingShapeId(),a=this.getSelectedShapeIds(),c=this.getErasingShapeIds(),l=this.getRenderingBoundsExpanded(),u=Number.isFinite(this.renderingBoundsMargin),d=(f,p,v)=>{const m=this.getShape(f);if(!m)return;p*=m.opacity;let y=!1,b=!1;const x=this.getShapeUtil(m),w=this.getShapeMaskedPageBounds(f);n&&(b=!v&&c.includes(f),b&&(p*=.32),y=u&&x.canUnmount(m)&&i!==f&&(w===void 0||!l.includes(w)&&!a.includes(f))),r.push({id:f,shape:m,util:x,index:o,backgroundIndex:s,opacity:p,isCulled:y,maskedPageBounds:w}),o+=1,s+=1;const S=this.getSortedChildIdsForParent(f);if(!S.length)return;let C=null;x.providesBackgroundForChildren(m)&&(C=s,s=o,o+=Qn);for(const P of S)d(P,p,v||b);C!==null&&(s=C)};for(const f of this.getSortedChildIdsForParent(this.getCurrentPageId()))d(f,1,!1);return r}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(RI)}getRenderingBounds(){return this._renderingBounds.get()}getRenderingBoundsExpanded(){return this._renderingBoundsExpanded.get()}updateRenderingBounds(){const n=this.getViewportPageBounds();return n.equals(this._renderingBounds.__unsafe__getWithoutCapture())?this:(this._renderingBounds.set(n.clone()),Number.isFinite(this.renderingBoundsMargin)?this._renderingBoundsExpanded.set(n.clone().expandBy(this.renderingBoundsMargin/this.getZoomLevel())):this._renderingBoundsExpanded.set(n),this)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Dn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(n){return this.store.get(typeof n=="string"?n:n.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getPageShapeIds(n){const r=typeof n=="string"?n:n.id,o=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(o.map(s=>s.id))}setCurrentPage(n,r){const o=typeof n=="string"?n:n.id;return this._setCurrentPageId(o,r),this}updatePage(n,r){return this._updatePage(n,r),this}createPage(n){return this._createPage(n),this}deletePage(n){const r=typeof n=="string"?n:n.id;return this._deletePage(r),this}duplicatePage(n,r=Lr.createId()){if(this.getPages().length>=tl)return this;const o=typeof n=="string"?n:n.id,s=this.getPage(o);if(!s)return this;const i={...this.getCamera()},a=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(s.id));return this.batch(()=>{var u;const c=this.getPages(),l=Tc(s.index,(u=c[c.indexOf(s)+1])==null?void 0:u.index);if(this.createPage({name:s.name+" Copy",id:r,index:l}),this.setCurrentPage(r),this.setCamera(i),a)return this.putContentOntoCurrentPage(a)}),this}renamePage(n,r,o){const s=typeof n=="string"?n:n.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:s,name:r},o),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(n){return this._createAssets(n),this}updateAssets(n){return this._updateAssets(n),this}deleteAssets(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id);return this._deleteAssets(r),this}getAsset(n){return this.store.get(typeof n=="string"?n:n.id)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",n=>this.getShapeUtil(n).getGeometry(n),(n,r)=>n.props===r.props)}getShapeGeometry(n){return this._getShapeGeometryCache().get(typeof n=="string"?n:n.id)}_getShapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",n=>this.getShapeUtil(n).getOutlineSegments(n))}getShapeOutlineSegments(n){return this._getShapeOutlineSegmentsCache().get(typeof n=="string"?n:n.id)??nr}_getShapeHandlesCache(){return this.store.createComputedCache("handles",n=>{var r,o;return(o=(r=this.getShapeUtil(n)).getHandles)==null?void 0:o.call(r,n)})}getShapeHandles(n){return this._getShapeHandlesCache().get(typeof n=="string"?n:n.id)}getShapeLocalTransform(n){const r=typeof n=="string"?n:n.id,o=this.getShape(r);if(!o)throw Error("Editor.getTransform: shape not found");return ie.Identity().translate(o.x,o.y).rotate(o.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",n=>{if(Lt(n.parentId))return this.getShapeLocalTransform(n);const r=this._getShapePageTransformCache().get(n.parentId)??ie.Identity();return ie.Compose(r,this.getShapeLocalTransform(n))})}getShapeParentTransform(n){const r=typeof n=="string"?n:n.id,o=this.getShape(r);return!o||Lt(o.parentId)?ie.Identity():this._getShapePageTransformCache().get(o.parentId)??ie.Identity()}getShapePageTransform(n){const r=typeof n=="string"?n:this.getShape(n).id;return this._getShapePageTransformCache().get(r)??ie.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",n=>{const r=this._getShapePageTransformCache().get(n.id);return r?ce.FromPoints(ie.applyToPoints(r,this.getShapeGeometry(n).vertices)):new ce})}getShapePageBounds(n){return this._getShapePageBoundsCache().get(typeof n=="string"?n:n.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",n=>{const r=this._getShapeMaskCache().get(n.id);if(!r)return;if(r.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const o=this._getShapePageTransformCache().get(n.id);return o?`polygon(${ie.applyToPoints(ie.Inverse(o),r).map(i=>`${i.x}px ${i.y}px`).join(",")})`:void 0})}getShapeClipPath(n){return this._getShapeClipPathCache().get(typeof n=="string"?n:n.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",n=>{if(Lt(n.parentId))return;const r=this.getShapeAncestors(n.id).filter(s=>this.isShapeOfType(s,"frame")||this.isShapeOfType(s,"geoframe")||this.isShapeOfType(s,"genmedia"));return r.length===0?void 0:r.map(s=>this._getShapePageTransformCache().get(s.id).applyToPoints(this.getShapeGeometry(s).vertices)).reduce((s,i)=>{if(!(i&&s))return;const a=Cf(s,i);return a?a.map(k.Cast):[]})})}getShapeMask(n){return this._getShapeMaskCache().get(typeof n=="string"?n:n.id)}getShapeMaskedPageBounds(n){typeof n!="string"&&(n=n.id);const r=this._getShapePageBoundsCache().get(n);if(!r)return;const o=this._getShapeMaskCache().get(n);if(o){if(o.length===0)return;const{corners:s}=r;if(s.every((a,c)=>k.Equals(a,o[c])))return r.clone();const i=Cf(o,s);return i?ce.FromPoints(i):void 0}return r}getShapeAncestors(n,r=[]){const o=typeof n=="string"?n:n.id,s=this.getShape(o);if(!s)return r;const i=s.parentId;if(Lt(i))return r.reverse(),r;const a=this.store.get(i);return a?(r.push(a),this.getShapeAncestors(a,r)):r}findShapeAncestor(n,r){const o=typeof n=="string"?n:n.id,s=this.getShape(o);if(!s)return;const i=s.parentId;if(Lt(i))return;const a=this.getShape(i);if(a)return r(a)?a:this.findShapeAncestor(a,r)}hasAncestor(n,r){const o=typeof n=="string"?n:n==null?void 0:n.id,s=o&&this.getShape(o);return s?s.parentId===r?!0:this.hasAncestor(this.getShapeParent(s),r):!1}findCommonAncestor(n,r){var l;if(n.length===0)return;const o=typeof n[0]=="string"?n:n.map(u=>u.id),s=fe(o.map(u=>this.getShape(u)));if(s.length===1){const u=s[0].parentId;return Lt(u)?void 0:r?(l=this.findShapeAncestor(s[0],r))==null?void 0:l.id:u}const[i,...a]=s;let c=this.getShapeParent(i);for(;c;){if(r&&!r(c)){c=this.getShapeParent(c);continue}if(a.every(u=>this.hasAncestor(u,c.id)))return c.id;c=this.getShapeParent(c)}}isShapeOrAncestorLocked(n){const r=typeof n=="string"?this.getShape(n):n;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}getCurrentPageBounds(){let n;return this.getCurrentPageShapeIds().forEach(r=>{const o=this.getShapeMaskedPageBounds(r);o&&(n?n=n.expand(o):n=o.clone())}),n}getSelectedShapeAtPoint(n){const r=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(o=>o.type!=="group"&&r.includes(o.id)).reverse().find(o=>this.isPointInShape(o,n,{hitInside:!0,margin:0}))}getShapeAtPoint(n,r={}){const o=this.getZoomLevel(),s=this.getViewportPageBounds(),{filter:i,margin:a=0,hitLabels:c=!1,hitInside:l=!1,hitFrameInside:u=!1}=r;let d=1/0,f=null,p=1/0,v=null;const m=(r.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(y=>{if(this.isShapeOfType(y,"group"))return!1;const b=this.getShapeMask(y);return b&&!_s(n,b)?!1:i?i(y):!0});for(let y=m.length-1;y>=0;y--){const b=m[y],x=this.getShapeGeometry(b),w=x instanceof Ul,S=this.getPointInShapeSpace(b,n);if((this.isShapeOfType(b,"arrow")||this.isShapeOfType(b,"geo")&&b.props.fill==="none")&&b.props.text.trim()){for(const P of x.children)if(P.isLabel&&P.isPointInBounds(S))return b}if(this.isShapeOfType(b,"frame")){const P=x.distanceToPoint(S,l);if(Math.abs(P)<=a)return v||b;if(x.hitTestPoint(S,0,!0))return v||f||(u?b:void 0);continue}let C;if(w){let P=1/0;for(const E of x.children){if(E.isLabel&&!c)continue;const _=E.distanceToPoint(S,l);_<P&&(P=_)}C=P}else a===0&&(x.bounds.w<1||x.bounds.h<1)||x.bounds.containsPoint(S,a)?C=x.distanceToPoint(S,l):C=1/0;if(x.isClosed){if(C<=a){if(x.isFilled||w&&x.children[0].isFilled)return v||b;if(this.getShapePageBounds(b).contains(s))continue;if(Math.abs(C)<a)Math.abs(C)<p&&(p=Math.abs(C),v=b);else if(!v){const{area:P}=x;P<d&&(d=P,f=b)}}}else if(C<KT/o)return b}return v||f||void 0}getShapesAtPoint(n,r={}){return this.getCurrentPageShapes().filter(o=>this.isPointInShape(o,n,r))}isPointInShape(n,r,o={}){const{hitInside:s=!1,margin:i=0}=o,a=typeof n=="string"?n:n.id,c=this.getShapeMask(a);return c&&!_s(r,c)?!1:this.getShapeGeometry(a).hitTestPoint(this.getPointInShapeSpace(n,r),i,s)}getPointInShapeSpace(n,r){const o=typeof n=="string"?n:n.id;return this._getShapePageTransformCache().get(o).clone().invert().applyToPoint(r)}getPointInParentSpace(n,r){const o=typeof n=="string"?n:n.id,s=this.getShape(o);if(!s)return new k(0,0);if(Lt(s.parentId))return k.From(r);const i=this.getShapePageTransform(s.parentId);return i?i.clone().invert().applyToPoint(r):k.From(r)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),n=>this.store.get(n))}getCurrentPageShapesSorted(){const n=new Set(this.getCurrentPageShapes().sort(Dn)),r=[];function o(s){r.push(s),n.delete(s),n.forEach(i=>{i.parentId===s.id&&o(i)})}return n.forEach(s=>{const i=this.getShape(s.parentId);go(i)||o(s)}),r}getCurrentPageRenderingShapesSorted(){return this.getRenderingShapes().filter(({isCulled:n})=>!n).sort((n,r)=>n.index-r.index).map(({shape:n})=>n)}isShapeOfType(n,r){return(typeof n=="string"?this.getShape(n):n).type===r}getShape(n){const r=typeof n=="string"?n:n.id;if(Sn(r))return this.store.get(r)}getShapeParent(n){const r=typeof n=="string"?n:n==null?void 0:n.id;if(!r)return;const o=this.getShape(r);if(!(o===void 0||!Sn(o.parentId)))return this.store.get(o.parentId)}getShapeNearestSibling(n,r){return r?r.parentId===n.parentId?r:this.findShapeAncestor(r,s=>s.parentId===n.parentId):void 0}isShapeInPage(n,r=this.getCurrentPageId()){const o=typeof n=="string"?n:n.id,s=this.getShape(o);if(!s)return!1;let i=!1;if(s.parentId===r)i=!0;else{let a=this.getShape(s.parentId);e:for(;a;){if(a.parentId===r){i=!0;break e}a=this.getShape(a.parentId)}}return i}getAncestorPageId(n){const r=typeof n=="string"?n:n==null?void 0:n.id,o=r&&this.getShape(r);if(o)return Lt(o.parentId)?o.parentId:this.getAncestorPageId(this.getShape(o.parentId))}reparentShapes(n,r,o){const s=typeof n[0]=="string"?n:n.map(v=>v.id);if(s.length===0)return this;const i=[],a=Lt(r)?ie.Identity():this.getShapePageTransform(r),c=a.rotation();let l=[];const u=fe(this.getSortedChildIdsForParent(r).map(v=>this.getShape(v)));if(o){const v=u.find(m=>m.index===o);if(v){const m=u[u.indexOf(v)+1];m?l=Is(o,m.index,s.length):l=Qu(o,s.length)}else{const m=u.sort(Dn).find(y=>y.index>o);m?l=Is(o,m.index,s.length):l=Qu(o,s.length)}}else{const v=u.length&&u[u.length-1];l=v?Qu(v.index,s.length):gx(s.length)}const d=a.clone().invert(),f=fe(s.map(v=>this.getShape(v))),p=f.filter(v=>v.isLocked);p.length&&this.updateShapes(p.map(({id:v,type:m})=>({id:v,type:m,isLocked:!1})));for(let v=0;v<f.length;v++){const m=f[v],y=this.getShapePageTransform(m);if(!y)continue;const b=y.point();if(!b)continue;const x=d.applyToPoint(b),w=y.rotation()-c;i.push({id:m.id,type:m.type,parentId:r,x:x.x,y:x.y,rotation:w,index:l[v],isLocked:m.isLocked})}return this.updateShapes(i),this}getHighestIndexForParent(n){const r=typeof n=="string"?n:n.id,o=this._parentIdsToChildIds.get()[r];if(!o||o.length===0)return"a1";const s=this.getShape(o[o.length-1]);return Tr(s.index)}getSortedChildIdsForParent(n){const r=typeof n=="string"?n:n.id,o=this._parentIdsToChildIds.get()[r];return o?this._childIdsCache.get(o,()=>o):nr}visitDescendants(n,r){const o=typeof n=="string"?n:n.id,s=this.getSortedChildIdsForParent(o);for(const i of s)r(i)!==!1&&this.visitDescendants(i,r);return this}getShapeAndDescendantIds(n){const r=new Set,o=[...n];for(;o.length>0;){const s=o.pop();if(!s)break;if(!r.has(s)){r.add(s);for(const i of this.getSortedChildIdsForParent(s))o.push(i)}}return r}getDroppingOverShape(n,r=[]){const o=this.getCurrentPageShapesSorted();for(let s=o.length-1;s>=0;s--){const i=o[s];if(!this.getShapeUtil(i).canDropShapes(i,r)||r.find(c=>c.id===i.id||this.hasAncestor(i,c.id)))continue;const a=this.getShapeMaskedPageBounds(i.id);if(a&&a.containsPoint(n)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,n),0,!0))return i}}getOutermostSelectableShape(n,r){const o=typeof n=="string"?n:n.id,s=this.getShape(o);let i=s,a=s;const c=this.getFocusedGroup();for(;a;){if(this.isShapeOfType(a,"group")&&(c==null?void 0:c.id)!==a.id&&!this.hasAncestor(c,a.id)&&((r==null?void 0:r(a))??!0))i=a;else if((c==null?void 0:c.id)===a.id)break;a=this.getShapeParent(a)}return i}rotateShapesBy(n,r){if((typeof n[0]=="string"?n:n.map(i=>i.id)).length<=0)return this;const s=FM({editor:this});return s?(BM({delta:r,snapshot:s,editor:this,stage:"one-off"}),this):this}nudgeShapes(n,r,o){var a,c;const s=typeof n[0]=="string"?n:n.map(l=>l.id);if(s.length<=0)return this;const i=[];for(const l of s){const u=this.getShape(l);if(!u)throw Error(`Could not find a shape with the id ${l}.`);const d=k.Cast(r),f=this.getShapeParentTransform(u);f&&d.rot(-f.rotation());const p=(c=(a=this.getShapeUtil(u)).onTranslateStart)==null?void 0:c.call(a,u);i.push(p?{...p,x:u.x+d.x,y:u.y+d.y}:{id:l,x:u.x+d.x,y:u.y+d.y,type:u.type})}return this.updateShapes(i,{squashing:!0,...o}),this}duplicateShapes(n,r){const o=typeof n[0]=="string"?n:n.map(u=>u.id);if(o.length<=0)return this;const s=new Set(o),i=[],a=[...o];for(;a.length>0;){const u=a.pop();if(!u)break;i.push(u),this.getSortedChildIdsForParent(u).forEach(d=>a.push(d))}i.reverse();const c=new Map(i.map(u=>[u,Ln()])),l=fe(i.map(u=>{const d=this.getShape(u);if(!d)return null;const f=c.get(u);let p=0,v=0;if(r&&s.has(u)){const P=this.getShapeParentTransform(d),E=new k(r.x,r.y).rot(-P.rotation());p=E.x,v=E.y}const m=d.parentId??this.getCurrentPageId(),y=this.getSortedChildIdsForParent(m),b=y.indexOf(d.id),x=y[b+1],w=x?this.getShape(x):null,S=w?Tc(d.index,w.index):Tr(d.index);let C=Or(d);if(this.isShapeOfType(d,"arrow")&&this.isShapeOfType(C,"arrow")){const P=this.getArrowInfo(d);let E,_;if(d.props.start.type==="binding"&&(E=c.get(d.props.start.boundShapeId),!E))if(P!=null&&P.isValid){const{x:T,y:M}=P.start.point;C.props.start={type:"point",x:T,y:M}}else{const{start:T}=fo(this,d);C.props.start={type:"point",x:T.x,y:T.y}}if(d.props.end.type==="binding"&&(_=c.get(d.props.end.boundShapeId),!_))if(P!=null&&P.isValid){const{x:T,y:M}=P.end.point;C.props.end={type:"point",x:T,y:M}}else{const{end:T}=fo(this,d);C.props.start={type:"point",x:T.x,y:T.y}}const $=li(C)?$i(this,C):ed(this,C);if(P!=null&&P.isValid&&($!=null&&$.isValid)&&!li(d)){const T=k.Med(P.start.handle,P.end.handle),M=k.Dist(P.middle,T),O=k.Dist($.middle,T);C.props.bend<0?C.props.bend+=O-M:C.props.bend-=O-M}C.props.start.type==="binding"&&E&&(C.props.start.boundShapeId=E),C.props.end.type==="binding"&&_&&(C.props.end.boundShapeId=_)}return C={...C,id:f,x:d.x+p,y:d.y+v,index:S},C}));return l.forEach(u=>{Sn(u.parentId)&&c.has(u.parentId)&&(u.parentId=c.get(u.parentId))}),this.history.batch(()=>{const u=l.length+this.getCurrentPageShapeIds().size>Qn;u&&Va(this);const d=u?l.slice(0,Qn-this.getCurrentPageShapeIds().size):l,f=d.map(p=>p.id);if(this.createShapes(d),this.setSelectedShapes(f),r!==void 0){const p=this.getSelectionPageBounds(),v=this.getViewportPageBounds();p&&!v.contains(p)&&this.centerOnPoint(p.center,{duration:tr})}}),this}moveShapesToPage(n,r){const o=typeof n[0]=="string"?n:n.map(c=>c.id);if(o.length===0)return this;if(this.getInstanceState().isReadonly)return this;const s=this.getCurrentPageId();if(r===s)return this;if(!this.store.has(r))return this;const i=this.getContentFromCurrentPage(o);if(!i)return this;if(this.getPageShapeIds(r).size+i.shapes.length>Qn)return Va(this,r),this;const a=this.getCamera().z;return this.history.batch(()=>{this.deleteShapes(o),this.setCurrentPage(r),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:a}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(n){const r=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.getInstanceState().isReadonly||r.length===0)return this;let o=!0,s=!0;const i=[];for(const a of r){const c=this.getShape(a);c&&(i.push(c),c.isLocked?s=!1:o=!1)}return this.batch(()=>{s?(this.updateShapes(i.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapes([])):o?this.updateShapes(i.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(i.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(n){const r=typeof n[0]=="string"?n:n.map(s=>s.id),o=Ua(this,"toBack",r);return o&&this.updateShapes(o),this}sendBackward(n){const r=typeof n[0]=="string"?n:n.map(s=>s.id),o=Ua(this,"backward",r);return o&&this.updateShapes(o),this}bringForward(n){const r=typeof n[0]=="string"?n:n.map(s=>s.id),o=Ua(this,"forward",r);return o&&this.updateShapes(o),this}bringToFront(n){const r=typeof n[0]=="string"?n:n.map(s=>s.id),o=Ua(this,"toFront",r);return o&&this.updateShapes(o),this}flipShapes(n,r){const o=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;let s=fe(o.map(a=>this.getShape(a)));if(!s.length)return this;s=fe(s.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(c=>this.getShape(c)):a).flat());const i=ce.Common(fe(s.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of s)if(["image","genmedia"].includes(a.type)){const l=a,u=l.props.flip,d=r==="horizontal";this.updateShape({id:l.id,type:l.type,props:{flip:{none:d?"x":"y",x:d?"none":"both",y:d?"both":"none",both:d?"y":"x"}[u]}})}else{const l=this.getShapeGeometry(a).bounds,u=this.getShapePageTransform(a.id);if(!u)continue;this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:l,initialPageTransform:u,initialShape:a,mode:"scale_shape",scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(n,r,o){const s=typeof n[0]=="string"?n:n.map(y=>y.id);if(this.getInstanceState().isReadonly)return this;const i=fe(s.map(y=>this.getShape(y)).filter(y=>!(!y||this.isShapeOfType(y,"arrow")&&(y.props.start.type==="binding"||y.props.end.type==="binding")))),a=i.length;if(o===0&&a<3||a<2)return this;const c=Object.fromEntries(i.map(y=>[y.id,this.getShapePageBounds(y)]));let l,u,d,f;r==="horizontal"?(l="x",u="minX",d="maxX",f="width"):(l="y",u="minY",d="maxY",f="height");let p;if(o===0){const y=[];i.sort((x,w)=>c[x.id][u]-c[w.id][u]);for(let x=0;x<a-1;x++){const w=i[x],S=i[x+1],C=c[w.id],E=c[S.id][u]-C[d],_=y.find($=>$.gap===E);_?_.count++:y.push({gap:E,count:1})}let b=0;y.forEach(x=>{x.count>b&&(b=x.count,p=x.gap)}),b===1&&(p=Math.max(0,y.reduce((x,w)=>x+w.gap*w.count,0)/(a-1)))}else p=o;const v=[];let m=c[i[0].id][d];return i.forEach((y,b)=>{var P,E;if(b===0)return;const x={x:0,y:0};x[l]=m+p-c[y.id][l];const w=this.getShapeParent(y),S=w?k.Rot(x,-this.getShapePageTransform(w).decompose().rotation):x,C=(E=(P=this.getShapeUtil(y)).onTranslateStart)==null?void 0:E.call(P,y);v.push(C?{...C,[l]:y[l]+S[l]}:{id:y.id,type:y.type,[l]:y[l]+S[l]}),m+=c[y.id][f]+p}),this.updateShapes(v),this}packShapes(n,r){var E,_;const o=typeof n[0]=="string"?n:n.map($=>$.id);if(this.getInstanceState().isReadonly)return this;if(o.length<2)return this;const s=fe(o.map($=>this.getShape($)).filter($=>!(!$||this.isShapeOfType($,"arrow")&&($.props.start.type==="binding"||$.props.end.type==="binding")))),i={},a={};let c,l,u=0;for(let $=0;$<s.length;$++)c=s[$],l=this.getShapePageBounds(c),i[c.id]=l,a[c.id]=l.clone(),u+=l.width*l.height;const d=ce.Common(fe(Object.values(i))),f=d.width;s.sort(($,T)=>i[T.id].height-i[$.id].height);const p=Math.max(Math.ceil(Math.sqrt(u/.95)),f),v=[new ce(d.x,d.y,p,1/0)];let m=0,y=0,b,x;for(let $=0;$<s.length;$++){c=s[$],l=a[c.id];for(let T=v.length-1;T>=0;T--)if(b=v[T],!(l.width>b.width||l.height>b.height)){l.x=b.x,l.y=b.y,y=Math.max(y,l.maxY),m=Math.max(m,l.maxX),l.width===b.width&&l.height===b.height?(x=v.pop(),T<v.length&&(v[T]=x)):l.height===b.height?(b.x+=l.width+r,b.width-=l.width+r):l.width===b.width?(b.y+=l.height+r,b.height-=l.height+r):(v.push(new ce(b.x+(l.width+r),b.y,b.width-(l.width+r),l.height)),b.y+=l.height+r,b.height-=l.height+r);break}}const w=ce.Common(Object.values(a)),S=k.Sub(d.center,w.center);let C;const P=[];for(let $=0;$<s.length;$++){c=s[$],l=i[c.id],C=a[c.id];const T=k.Sub(C.point,l.point).add(S),M=this.getShapeParentTransform(c);M&&T.rot(-M.rotation());const O={id:c.id,type:c.type,x:c.x+T.x,y:c.y+T.y},j=(_=(E=this.getShapeUtil(c)).onTranslateStart)==null?void 0:_.call(E,{...c,...O});j?P.push({...O,...j}):P.push(O)}return P.length&&this.updateShapes(P),this}alignShapes(n,r){const o=typeof n[0]=="string"?n:n.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;if(o.length<2)return this;const s=fe(o.map(l=>this.getShape(l))),i=Object.fromEntries(s.map(l=>[l.id,this.getShapePageBounds(l)])),a=ce.Common(fe(Object.values(i))),c=[];return s.forEach(l=>{var m,y;const u=i[l.id];if(!u)return;const d={x:0,y:0};switch(r){case"top":{d.y=a.minY-u.minY;break}case"center-vertical":{d.y=a.midY-u.minY-u.height/2;break}case"bottom":{d.y=a.maxY-u.minY-u.height;break}case"left":{d.x=a.minX-u.minX;break}case"center-horizontal":{d.x=a.midX-u.minX-u.width/2;break}case"right":{d.x=a.maxX-u.minX-u.width;break}}const f=this.getShapeParent(l),p=f?k.Rot(d,-this.getShapePageTransform(f).decompose().rotation):d,v=(y=(m=this.getShapeUtil(l)).onTranslateStart)==null?void 0:y.call(m,l);c.push(v?{...v,x:l.x+p.x,y:l.y+p.y}:{id:l.id,type:l.type,x:l.x+p.x,y:l.y+p.y})}),this.updateShapes(c),this}distributeShapes(n,r){const o=typeof n[0]=="string"?n:n.map(w=>w.id);if(this.getInstanceState().isReadonly)return this;if(o.length<3)return this;const s=o.length,i=fe(o.map(w=>this.getShape(w))),a=Object.fromEntries(i.map(w=>[w.id,this.getShapePageBounds(w)]));let c,l,u,d,f;r==="horizontal"?(c="x",l="minX",u="maxX",d="midX",f="width"):(c="y",l="minY",u="maxY",d="midY",f="height");const p=[],v=i.sort((w,S)=>a[w.id][l]-a[S.id][l])[0],m=i.sort((w,S)=>a[S.id][u]-a[w.id][u])[0],y=a[v.id][d],b=(a[m.id][d]-y)/(s-1),x=y+b;return i.filter(w=>w!==v&&w!==m).sort((w,S)=>a[w.id][d]-a[S.id][d]).forEach((w,S)=>{var $,T;const C={x:0,y:0};C[c]=x+b*S-a[w.id][f]/2-a[w.id][c];const P=this.getShapeParent(w),E=P?k.Rot(C,-this.getShapePageTransform(P).rotation()):C,_=(T=($=this.getShapeUtil(w)).onTranslateStart)==null?void 0:T.call($,w);p.push(_?{..._,[c]:w[c]+E[c]}:{id:w.id,type:w.type,[c]:w[c]+E[c]})}),this.updateShapes(p),this}stretchShapes(n,r){const o=typeof n[0]=="string"?n:n.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;if(o.length<2)return this;const s=fe(o.map(l=>this.getShape(l))),i=Object.fromEntries(o.map(l=>[l,this.getShapeGeometry(l).bounds])),a=Object.fromEntries(o.map(l=>[l,this.getShapePageBounds(l)])),c=ce.Common(fe(Object.values(a)));switch(r){case"vertical":{this.batch(()=>{for(const l of s){if(this.getShapePageTransform(l).rotation()%He)continue;const d=i[l.id],f=a[l.id],p=new k(0,c.minY-f.minY),v=this.getShapeParentTransform(l);v&&p.rot(-v.rotation());const{x:m,y}=k.Add(p,l);this.updateShapes([{id:l.id,type:l.type,x:m,y}],{squashing:!0});const b=new k(1,c.height/f.height);this.resizeShape(l.id,b,{initialBounds:d,scaleOrigin:new k(f.center.x,c.minY),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const l of s){const u=i[l.id],d=a[l.id];if(this.getShapePageTransform(l).rotation()%He)continue;const p=new k(c.minX-d.minX,0),v=this.getShapeParentTransform(l);v&&p.rot(-v.rotation());const{x:m,y}=k.Add(p,l);this.updateShapes([{id:l.id,type:l.type,x:m,y}],{squashing:!0});const b=new k(c.width/d.width,1);this.resizeShape(l.id,b,{initialBounds:u,scaleOrigin:new k(c.minX,d.center.y),scaleAxisRotation:0})}});break}}return this}resizeShape(n,r,o={}){var p;const s=typeof n=="string"?n:n.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(r.x)||(r=new k(1,r.y)),Number.isFinite(r.y)||(r=new k(r.x,1));const i=o.initialShape??this.getShape(s);if(!i)return this;const a=o.scaleOrigin??((p=this.getShapePageBounds(s))==null?void 0:p.center);if(!a)return this;const c=o.initialPageTransform?ie.Cast(o.initialPageTransform):this.getShapePageTransform(s);if(!c)return this;const l=c.rotation();if(l==null)return this;const u=o.scaleAxisRotation??l,d=o.initialBounds??this.getShapeGeometry(s).bounds;if(!d)return this;if(!CT(l,u))return this._resizeUnalignedShape(s,r,{...o,initialBounds:d,scaleOrigin:a,scaleAxisRotation:u,initialPageTransform:c,initialShape:i});const f=this.getShapeUtil(i);if(f.isAspectRatioLocked(i)&&(Math.abs(r.x)>Math.abs(r.y)?r=new k(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new k(Math.sign(r.x)*Math.abs(r.y),r.y)),f.onResize&&f.canResize(i)){const v=this._scalePagePoint(ie.applyToPoint(c,new k(0,0)),a,r,u),m=this.getPointInParentSpace(i.id,v),y=new k(r.x,r.y),b=ki((l-u)%Math.PI,0);y.x=b?r.x:r.y,y.y=b?r.y:r.x;const x=ie.applyToPoint(c,new k),{x:w,y:S}=this.getPointInParentSpace(i.id,x);this.updateShapes([{id:s,type:i.type,x:m.x,y:m.y,...f.onResize({...i,x:w,y:S},{newPoint:m,handle:o.dragHandle??"bottom_right",mode:o.mode??"scale_shape",scaleX:y.x,scaleY:y.y,initialBounds:d,initialShape:i})}],{squashing:!0})}else{const v=ie.applyToPoint(c,d.center),m=this._scalePagePoint(v,a,r,u),y=this.getPointInParentSpace(i.id,v),b=this.getPointInParentSpace(i.id,m),x=k.Sub(b,y);this.updateShapes([{id:s,type:i.type,x:i.x+x.x,y:i.y+x.y}],{squashing:!0})}return this}_scalePagePoint(n,r,o,s){const i=k.RotWith(n,r,-s).sub(r),a=k.MulV(i,o);return k.Add(a,r).rotWith(r,s)}_resizeUnalignedShape(n,r,o){const{type:s}=o.initialShape,i=new k(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?i.x=Math.sign(r.x)*Math.abs(r.y):i.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(n,i,{initialShape:o.initialShape,initialBounds:o.initialBounds}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:b}=ie.Decompose(o.initialPageTransform);b-=2*b,this.updateShapes([{id:n,type:s,rotation:b}],{squashing:!0})}const a=ie.applyToPoint(o.initialPageTransform,o.initialBounds.center),c=this._scalePagePoint(a,o.scaleOrigin,r,o.scaleAxisRotation),l=this.getShapePageBounds(n),u=this.getShapePageTransform(n),d=l.center,f=u.point();if(!d||!f)return this;const p=k.Sub(c,d),v=k.Add(f,p),{x:m,y}=this.getPointInParentSpace(n,v);return this.updateShapes([{id:n,type:s,x:m,y}],{squashing:!0}),this}getInitialMetaForShape(n){return{}}createShape(n){return this._createShapes([n]),this}createShapes(n){if(!Array.isArray(n))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(n),this}animateShape(n,r){return this.animateShapes([n],r)}animateShapes(n,r={}){const{duration:o=500,easing:s=Br.linear}=r,i=je();let a=o,c;const l=[];n.forEach(f=>{if(!f)return;const p={partial:f,values:[]},v=this.getShape(f.id);if(v){for(const m of["x","y","rotation"])f[m]!==void 0&&v[m]!==f[m]&&p.values.push({prop:m,from:v[m],to:f[m]});l.push(p),this.animatingShapes.set(v.id,i)}});let u;const d=f=>{if(a-=f,a<0){const{animatingShapes:v}=this,m=n.filter(y=>y&&v.get(y.id)===i);m.length&&this.updateShapes(m,{squashing:!1}),this.removeListener("tick",d);return}c=s(1-a/o);const{animatingShapes:p}=this;try{const v=[];for(let m=0;m<l.length;m++)u=l[m],p.get(u.partial.id)===i&&v.push({id:u.partial.id,type:u.partial.type,...u.values.reduce((y,{prop:b,from:x,to:w})=>(y[b]=x+(w-x)*c,y),{})});this._updateShapes(v,{squashing:!0})}catch{}};return this.addListener("tick",d),this}groupShapes(n,r=Ln()){var p;if(!Array.isArray(n))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const o=typeof n[0]=="string"?n:n.map(v=>v.id);if(o.length<=1)return this;const s=fe(this._getUnlockedShapeIds(o).map(v=>this.getShape(v))),i=s.sort(Dn).map(v=>v.id),a=ce.Common(fe(s.map(v=>this.getShapePageBounds(v)))),{x:c,y:l}=a.point,u=this.findCommonAncestor(s)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const d=s.filter(v=>v.parentId===u).sort(Dn),f=(p=d[d.length-1])==null?void 0:p.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:u,index:f,x:c,y:l,opacity:1,props:{}}]),this.reparentShapes(i,r),this.select(r)}),this}ungroupShapes(n){const r=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.getInstanceState().isReadonly)return this;if(r.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,s=fe(r.map(a=>this.getShape(a))),i=[];return s.forEach(a=>{this.isShapeOfType(a,"group")?i.push(a):o.add(a.id)}),i.length===0?this:(this.batch(()=>{let a;for(let c=0,l=i.length;c<l;c++){a=i[c];const u=this.getSortedChildIdsForParent(a.id);for(let d=0,f=u.length;d<f;d++)o.add(u[d]);this.reparentShapes(u,a.parentId,a.index)}this.deleteShapes(i.map(c=>c.id)),this.select(...o)}),this)}updateShape(n,r){return this.updateShapes([n],r),this}updateShapeById(n,r,o){const s=this.getShape(n);return s?(this.updateShapes([{...r,id:s.id,type:s.type}],o),this):this}updateShapes(n,r){let o=fe(n);return this.animatingShapes.size>0&&o.forEach(s=>this.animatingShapes.delete(s.id)),o=o.filter(s=>{const i=this.getShape(s.id);return!(!i||this.isShapeOrAncestorLocked(i)&&!Object.hasOwn(s,"isLocked"))}),this._updateShapes(o,r),this}_getUnlockedShapeIds(n){return n.filter(r=>{var o;return!((o=this.getShape(r))!=null&&o.isLocked)})}deleteShapes(n){if(!Array.isArray(n))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds(typeof n[0]=="string"?n:n.map(r=>r.id))),this}deleteShape(n){return this.deleteShapes([typeof n=="string"?n:n.id]),this}_extractSharedStyles(n,r){if(this.isShapeOfType(n,"group")){const o=this._parentIdsToChildIds.get()[n.id];if(!o)return;for(let s=0,i=o.length;s<i;s++)this._extractSharedStyles(this.getShape(o[s]),r)}else for(const[o,s]of this.styleProps[n.type])r.applyValue(o,yo(n.props,s))}getStyleForNextShape(n){const r=this.getInstanceState().stylesForNextShape[n.id];return r===void 0?n.defaultValue:r}getShapeStyleIfExists(n,r){const o=this.styleProps[n.type].get(r);if(o!==void 0)return yo(n.props,o)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._selectionSharedStyles.get();const n=this.root.getCurrent(),r=new Ef;if(!n)return r;if(n.shapeType)for(const o of this.styleProps[n.shapeType].keys())r.applyValue(o,this.getStyleForNextShape(o));return r}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const n=[],r=s=>{const i=this.getShape(s);if(i)if(this.isShapeOfType(i,"group"))for(const a of this.getSortedChildIdsForParent(i.id))r(a);else n.push(i)};for(const s of this.getSelectedShapeIds())r(s);let o=null;for(const s of n)if(o===null)o=s.opacity;else if(o!==s.opacity)return{type:"mixed"};if(o!==null)return{type:"shared",value:o}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(n,r){return this.updateInstanceState({opacityForNextShape:n},r),this}setOpacityForSelectedShapes(n,r){const o=this.getSelectedShapes();if(o.length>0){const s=[],i=a=>{if(this.isShapeOfType(a,"group")){const c=this.getSortedChildIdsForParent(a);for(const l of c)i(this.getShape(l))}else s.push(a)};for(const a of o)i(a);this.updateShapes(s.map(a=>({id:a.id,type:a.type,opacity:n})),r)}return this}setStyleForNextShapes(n,r,o){const s=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...s,[n.id]:r}},o),this}setStyleForSelectedShapes(n,r,o){const s=this.getSelectedShapes();if(s.length>0){const i=[],a=c=>{if(this.isShapeOfType(c,"group")){const l=this.getSortedChildIdsForParent(c.id);for(const u of l)a(this.getShape(u))}else{const l=this.getShapeUtil(c),u=this.styleProps[c.type].get(n);if(u){const d={id:c.id,type:c.type,props:{[u]:r}};i.push({util:l,originalShape:c,updatePartial:d})}}};for(const c of s)a(c);this.updateShapes(i.map(({updatePartial:c})=>c),o)}return this}registerExternalAssetHandler(n,r){return this.externalAssetContentHandlers[n]=r,this}async getAssetForExternalContent(n){var r,o;return await((o=(r=this.externalAssetContentHandlers)[n.type])==null?void 0:o.call(r,n))}registerExternalContentHandler(n,r){return this.externalContentHandlers[n]=r,this}async putExternalContent(n){var r,o;return(o=(r=this.externalContentHandlers)[n.type])==null?void 0:o.call(r,n)}getContentFromCurrentPage(n){const r=typeof n[0]=="string"?n:n.map(c=>c.id);if(!r||r.length===0)return;const o={};let s=Wc(r.map(c=>this.getShape(c)).sort(Dn).flatMap(c=>{const l=[c];return this.visitDescendants(c.id,u=>{l.push(this.getShape(u))}),l}));s=s.map(c=>{if(o[c.id]=this.getShapePageTransform(c.id),c=vo(c),this.isShapeOfType(c,"arrow")){const l=c.props.start.type==="binding"?c.props.start.boundShapeId:void 0,u=c.props.end.type==="binding"?c.props.end.boundShapeId:void 0,d=this.getArrowInfo(c);if(c.props.start.type==="binding"&&!s.some(p=>p.id===l))if(d!=null&&d.isValid){const{x:p,y:v}=d.start.point;c.props.start={type:"point",x:p,y:v}}else{const{start:p}=fo(this,c);c.props.start={type:"point",x:p.x,y:p.y}}if(c.props.end.type==="binding"&&!s.some(p=>p.id===u))if(d!=null&&d.isValid){const{x:p,y:v}=d.end.point;c.props.end={type:"point",x:p,y:v}}else{const{end:p}=fo(this,c);c.props.end={type:"point",x:p.x,y:p.y}}const f=li(c)?$i(this,c):ed(this,c);if(d!=null&&d.isValid&&(f!=null&&f.isValid)&&!li(c)){const p=k.Med(d.start.handle,d.end.handle),v=k.Dist(d.middle,p),m=k.Dist(f.middle,p);c.props.bend<0?c.props.bend+=m-v:c.props.bend-=m-v}return c}return c});const i=[];s.forEach(c=>{if(s.find(l=>l.id===c.parentId)===void 0){const l=this.getShapePageTransform(c.id),u=l.point(),d=l.rotation();c.x=u.x,c.y=u.y,c.rotation=d,c.parentId=this.getCurrentPageId(),i.push(c.id)}});const a=new Set;return s.forEach(c=>{"assetId"in c.props&&c.props.assetId!==null&&a.add(c.props.assetId)}),{shapes:s,rootShapeIds:i,schema:this.store.schema.serialize(),assets:fe(Array.from(a).map(c=>this.getAsset(c)))}}putContentOntoCurrentPage(n,r={}){if(this.getInstanceState().isReadonly)return this;if(!n.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:o=!1,preserveIds:s=!1,preservePosition:i=!1}=r;let{point:a=void 0}=r;const c=this.getCurrentPageId(),{assets:l,shapes:u,rootShapeIds:d}=n,f=new Map(u.map(C=>[C.id,Ln()]));let p=this.getCurrentPageId(),v=1/0,m=[];for(const C of this.getSelectedShapes()){if(v===0)break;const P=this.isShapeOfType(C,"frame")||this.isShapeOfType(C,"geoframe"),E=this.getShapeAncestors(C);P&&E.push(C);const _=P?E.length+1:E.length;if(_<v)v=_,m=E,p=P?C.id:C.parentId;else if(_===v){if(m.length!==E.length)throw Error(`Ancestors: ${m.length} !== ${E.length}`);if(m.length===0){p=c;break}else{p=c;for(let $=0;$<m.length&&E[$]===m[$];$++)p=E[$].id}}}let y=!1;if(!Lt(p)){const C=this.getShape(p);if(C){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(C)))p=c;else if(d.length===1){const P=u.find(E=>E.id===d[0]);this.isShapeOfType(C,"frame")&&this.isShapeOfType(P,"frame")&&P.props.w===(C==null?void 0:C.props.w)&&P.props.h===(C==null?void 0:C.props.h)&&(y=!0)}}else p=c}y||(y=f.has(p)),y&&(p=this.getShape(p).parentId);let b=this.getHighestIndexForParent(p);const x=[],w=u.map(C=>{let P;if(s)P=Or(C),f.set(C.id,C.id);else{const E=f.get(C.id);P=Or({...C,id:E})}if(d.includes(C.id)&&(P.parentId=c,x.push(P)),f.has(P.parentId)?P.parentId=f.get(C.parentId):(d.push(P.id),P.index=b,b=Tr(b)),this.isShapeOfType(P,"arrow")){if(P.props.start.type==="binding"){const E=f.get(P.props.start.boundShapeId);P.props.start=E?{...P.props.start,boundShapeId:E}:{type:"point",x:0,y:0}}if(P.props.end.type==="binding"){const E=f.get(P.props.end.boundShapeId);P.props.end=E?{...P.props.end,boundShapeId:E}:{type:"point",x:0,y:0}}}return P});if(w.length+this.getCurrentPageShapeIds().size>Qn)return Va(this),this;let S=[];if(l){for(let P=0;P<l.length;P++){const E=l[P],_=this.store.schema.migratePersistedRecord(E,n.schema);if(_.type==="success")l[P]=_.value;else throw Error(`Could not put content:
could not migrate content for asset:
${E.id}
${E.type}
reason:${_.reason}`)}const C=[];S=l.filter(P=>!this.store.has(P.id)).map(P=>{var E;return(P.type==="image"||P.type==="video")&&(P.props.src&&((E=P.props.src)!=null&&E.startsWith("data:image"))?(C.push(vo(P)),P.props.src=null):C.push(vo(P))),P}),Promise.allSettled(C.map(async P=>{const E=await $M(P.props.src,P.props.name,P.props.mimeType??"image/png"),_=await this.getAssetForExternalContent({type:"file",file:E});return _?[P,_]:null})).then(P=>{this.updateAssets(fe(P.map(E=>E.status==="fulfilled"&&E.value?{...E.value[1],id:E.value[0].id}:void 0)))})}for(let C=0;C<w.length;C++){const P=w[C],E=this.store.schema.migratePersistedRecord(P,n.schema);if(E.type==="success")w[C]=E.value;else throw Error(`Could not put content:
could not migrate content for shape:
${P.id}, ${P.type}
reason:${E.reason}`)}return this.batch(()=>{S.length>0&&this.createAssets(S),this.createShapes(w),o&&this.select(...x.map($=>$.id)),p!==c&&this.reparentShapes(x.map($=>$.id),p);const C=w.map($=>this.getShape($.id)),P=ce.Common(C.map($=>this.getShapePageBounds($)));if(a===void 0)if(Lt(p)){const $=this.getViewportPageBounds();i||$.includes(ce.From(P))?a=P.center:a=$.center}else{const $=this.getShape(p);a=ie.applyToPoint(this.getShapePageTransform($),this.getShapeGeometry($).bounds.center)}if(x.length===1){const $=x[0];if(this.isShapeOfType($,"frame"))for(;this.getShapesAtPoint(a).some(T=>this.isShapeOfType(T,"frame")&&T.props.w===$.props.w&&T.props.h===$.props.h);)a.x+=P.w+16}const E=ce.Common(fe(x.map(({id:$})=>this.getShapePageBounds($)))).center,_=k.Sub(a,E);this.updateShapes(x.map(({id:$})=>{const T=this.getShape($),M=this.getShapeParentTransform($).decompose().rotation,O=k.Rot(_,-M);return{id:T.id,type:T.type,x:T.x+O.x,y:T.y+O.y}}))}),this}async getSvg(n,r={}){var C,P;const o=typeof n[0]=="string"?n:n.map(E=>E.id);if(o.length===0)return;if(!window.document)throw Error("No document");const{scale:s=1,background:i=!1,padding:a=LT,preserveAspectRatio:c=!1}=r,l=Dl({isDarkMode:this.user.getIsDarkMode()}),u=this.getShapeAndDescendantIds(o),d=this.getUnorderedRenderingShapes(!1).filter(({id:E})=>u.has(E));let f=null;if(r.bounds)f=r.bounds;else for(const{maskedPageBounds:E}of d)E&&(f?f.union(E):f=E.clone());if(!f)return;const p=o.length===1&&(this.isShapeOfType(this.getShape(o[0]),"frame")||this.isShapeOfType(this.getShape(o[0]),"geoframe"))?o[0]:null;p||f.expandBy(a);const v=f.width*s,m=f.height*s,y=window.document.createElementNS("http://www.w3.org/2000/svg","svg");c&&y.setAttribute("preserveAspectRatio",c),y.setAttribute("direction","ltr"),y.setAttribute("width",v+""),y.setAttribute("height",m+""),y.setAttribute("viewBox",`${f.minX} ${f.minY} ${f.width} ${f.height}`),y.setAttribute("stroke-linecap","round"),y.setAttribute("stroke-linejoin","round"),i?typeof i=="string"?y.style.setProperty("background-color",i):p?y.style.setProperty("background",l.solid):y.style.setProperty("background-color",l.background):y.style.setProperty("background-color","transparent");try{(P=(C=document.body).focus)==null||P.call(C)}catch{}const b=window.document.createElementNS("http://www.w3.org/2000/svg","defs");y.append(b);const x=new Map,w={opts:r,addExportDef:E=>{if(x.has(E.key))return;const _=(async()=>{const $=await E.getElement();if(!$)return;const T=document.createComment(`def: ${E.key}`);b.appendChild(T);for(const M of Array.isArray($)?$:[$])b.appendChild(M)})();x.set(E.key,_)}},S=(await Promise.all(d.map(async({id:E,opacity:_,index:$,backgroundIndex:T})=>{var V,z;if(E===p)return[];const M=this.getShape(E);if(this.isShapeOfType(M,"group"))return[];const O=this.getShapeUtil(M);let j=await((V=O.toSvg)==null?void 0:V.call(O,M,w)),N=await((z=O.toBackgroundSvg)==null?void 0:z.call(O,M,w));if(j){const W=document.createElementNS("http://www.w3.org/2000/svg","g");W.appendChild(j),j=W}if(N){const W=document.createElementNS("http://www.w3.org/2000/svg","g");W.appendChild(N),N=W}if(!j&&!N){const W=this.getShapePageBounds(M),Q=window.document.createElementNS("http://www.w3.org/2000/svg","rect");Q.setAttribute("width",W.width+""),Q.setAttribute("height",W.height+""),Q.setAttribute("fill",l.solid),Q.setAttribute("stroke",l.grey.pattern),Q.setAttribute("stroke-width","1"),j=Q}let B=this.getShapePageTransform(M).toCssString();"scale"in M.props&&M.props.scale!==1&&(B=`${B} scale(${M.props.scale}, ${M.props.scale})`),j==null||j.setAttribute("transform",B),N==null||N.setAttribute("transform",B),j==null||j.setAttribute("opacity",_+""),N==null||N.setAttribute("opacity",_+"");const D=this.getShapeMask(M.id);if(D){const W=document.createElementNS("http://www.w3.org/2000/svg","clipPath");b.appendChild(W);const Q=je();W.id=Q;const oe=document.createElementNS("http://www.w3.org/2000/svg","path");if(oe.setAttribute("d",`M${D.map(({x:se,y:ye})=>`${se},${ye}`).join("L")}Z`),W.appendChild(oe),j){const se=document.createElementNS("http://www.w3.org/2000/svg","g");se.setAttribute("clip-path",`url(#${Q})`),se.appendChild(j),j=se}if(N){const se=document.createElementNS("http://www.w3.org/2000/svg","g");se.setAttribute("clip-path",`url(#${Q})`),se.appendChild(N),N=se}}const G=[];return j&&G.push({zIndex:$,element:j}),N&&G.push({zIndex:T,element:N}),G}))).flat();await Promise.all(x.values());for(const{element:E}of S.sort((_,$)=>_.zIndex-$.zIndex))y.appendChild(E);return y}_updateInputsFromEvent(n){var v;const{previousScreenPoint:r,previousPagePoint:o,currentScreenPoint:s,currentPagePoint:i}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(yt),{x:c,y:l,z:u}=n.point,{x:d,y:f,z:p}=this.getCamera();r.setTo(s),o.setTo(i),s.set(c,l),i.set((c-a.x)/p-d,(l-a.y)/p-f,u??.5),this.inputs.isPen=n.type==="pointer"&&n.isPen,n.name==="pointer_down"&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:qc,typeName:"pointer",x:i.x,y:i.y,lastActivityTimestamp:n.type==="pointer"&&n.pointerId===Zm.CAMERA_MOVE?((v=this.store.get(qc))==null?void 0:v.lastActivityTimestamp)??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}}re([X],ne.prototype,"getCanUndo");re([X],ne.prototype,"getCanRedo");re([X],ne.prototype,"_getArrowBindingsIndex");re([X],ne.prototype,"getArrowInfoCache");re([X],ne.prototype,"getPath");re([X],ne.prototype,"getCurrentTool");re([X],ne.prototype,"getCurrentToolId");re([X],ne.prototype,"getDocumentSettings");re([X],ne.prototype,"getInstanceState");re([X],ne.prototype,"getOpenMenus");re([X],ne.prototype,"getIsMenuOpen");re([X],ne.prototype,"getPageStates");re([X],ne.prototype,"_getPageStatesQuery");re([X],ne.prototype,"getCurrentPageState");re([X],ne.prototype,"_getCurrentPageStateId");re([X],ne.prototype,"getSelectedShapeIds");re([X],ne.prototype,"getSelectedShapes");re([X],ne.prototype,"getOnlySelectedShape");re([X],ne.prototype,"getSelectionPageBounds");re([X],ne.prototype,"getSelectionRotation");re([X],ne.prototype,"getSelectionRotatedPageBounds");re([X],ne.prototype,"getFocusedGroupId");re([X],ne.prototype,"getFocusedGroup");re([X],ne.prototype,"getEditingShapeId");re([X],ne.prototype,"getEditingShape");re([X],ne.prototype,"getHoveredShapeId");re([X],ne.prototype,"getHoveredShape");re([X],ne.prototype,"getHintingShapeIds");re([X],ne.prototype,"getHintingShape");re([X],ne.prototype,"getErasingShapeIds");re([X],ne.prototype,"getErasingShapes");re([X],ne.prototype,"getCameraId");re([X],ne.prototype,"getCamera");re([X],ne.prototype,"getZoomLevel");re([X],ne.prototype,"getViewportScreenBounds");re([X],ne.prototype,"getViewportScreenCenter");re([X],ne.prototype,"getViewportPageBounds");re([X],ne.prototype,"getViewportPageCenter");re([X],ne.prototype,"getRenderingShapes");re([X],ne.prototype,"_getAllPagesQuery");re([X],ne.prototype,"getPages");re([X],ne.prototype,"_getAllAssetsQuery");re([X],ne.prototype,"_getShapeGeometryCache");re([X],ne.prototype,"_getShapeOutlineSegmentsCache");re([X],ne.prototype,"_getShapeHandlesCache");re([X],ne.prototype,"_getShapePageTransformCache");re([X],ne.prototype,"_getShapePageBoundsCache");re([X],ne.prototype,"_getShapeClipPathCache");re([X],ne.prototype,"_getShapeMaskCache");re([X],ne.prototype,"getCurrentPageBounds");re([X],ne.prototype,"getCurrentPageShapes");re([X],ne.prototype,"getCurrentPageShapesSorted");re([X],ne.prototype,"getCurrentPageRenderingShapesSorted");re([X({isEqual:(e,t)=>e.equals(t)})],ne.prototype,"getSharedStyles");re([X],ne.prototype,"getSharedOpacity");function Va(e,t=e.getCurrentPageId()){const n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:Qn})}function Vl(){const e=U();return Y("isDarkMode",()=>e.user.getIsDarkMode(),[e])}const ky="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",Ty="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Ka='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>',hO='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',pO='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>';function An(e,t,n,r,o,s=16,i=16){const a=(-n-t)*(xt/180),c=Math.sin(a),l=Math.cos(a),u=1*l-1*c,d=1*c+1*l;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${o};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${s} ${i}, pointer`}const gO=["default","pointer","cross","move","grab","grabbing","text"],mO={none:()=>"none","ew-resize":(e,t,n)=>An(Ty,e,0,t,n),"ns-resize":(e,t,n)=>An(Ty,e,90,t,n),"nesw-resize":(e,t,n)=>An(ky,e,0,t,n),"nwse-resize":(e,t,n)=>An(ky,e,90,t,n),"nwse-rotate":(e,t,n)=>An(Ka,e,0,t,n),"nesw-rotate":(e,t,n)=>An(Ka,e,90,t,n),"senw-rotate":(e,t,n)=>An(Ka,e,180,t,n),"swne-rotate":(e,t,n)=>An(Ka,e,270,t,n),"zoom-in":(e,t,n)=>An(hO,e,0,t,n),"zoom-out":(e,t,n)=>An(pO,e,0,t,n)};function Ft(e,t=0,n="black"){return mO[e](PT(t),!1,n)}const yO=(e,t)=>e.includes(t);function vO(){const e=U(),t=ut(),n=Vl();mo("useCursor",()=>{const{type:r,rotation:o,custom:s}=e.getInstanceState().cursor;if(r==="custom"){s?t.style.setProperty("--tl-cursor",s):t.style.setProperty("--tl-cursor","var(--tl-cursor-default)");return}if(yO(gO,r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",Ft(r,o,n?"white":"black"))},[e,t,n])}function bO(){const e=U(),t=ut(),n=Vl(),r=Y(ze.forceSrgb);Z.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}function SO(e){const t=g.useRef();return g.useLayoutEffect(()=>{t.current=e}),g.useDebugValue(e),g.useCallback((...n)=>{const r=t.current;return Nh(r,"fn does not exist"),r(...n)},[])}function xO(e){const t=U(),n=ut();g.useLayoutEffect(()=>{e?(t.getInstanceState().isFocused||t.updateInstanceState({isFocused:!0}),t.getContainer().focus()):t.getInstanceState().isFocused&&t.updateInstanceState({isFocused:!1})},[t,n,e])}function wO(){const[e,t]=g.useState(0);g.useEffect(()=>t(n=>n+1),[])}const fs="TLDRAW_TAB_ID_v2",ct=globalThis.window;function CO(){return ct?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(ct.navigator.platform)||ct.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const cl=(ct==null?void 0:ct[fs])??(ct==null?void 0:ct.sessionStorage[fs])??"TLDRAW_INSTANCE_STATE_V1_"+je();ct&&(ct[fs]=cl,CO()?ct.sessionStorage[fs]=cl:delete ct.sessionStorage[fs]);ct==null||ct.addEventListener("beforeunload",()=>{ct.sessionStorage[fs]=cl});const PO={Initial:0},Ui=PO.Initial,yx=ge({version:H,currentPageId:Di,isFocusMode:le,exportBackground:le,isDebugMode:le,isToolLocked:le,isGridMode:le,pageStates:Ze(ge({pageId:Di,camera:ge({x:H,y:H,z:H}),selectedShapeIds:Ze(Tt),focusedGroupId:Tt.nullable()}))}),EO=he({currentVersion:Ui});function _O(e){if(!e||typeof e!="object")return console.warn("Invalid instance state"),null;if(!("version"in e)||typeof e.version!="number")return console.warn("No version in instance state"),null;const t=zh({value:e,fromVersion:e.version,toVersion:Ui,migrations:EO});if(t.type==="error")return console.warn(t.reason),null;const n={...t.value,version:Ui};try{yx.validate(n)}catch(r){return console.warn(r),null}return n}function IO(e){const t=e.query.ids("page");return X("sessionStateSnapshot",()=>{const n=e.get(yt);if(!n)return null;const r=[...t.get()];return{version:Ui,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(o=>{const s=e.get(gt.createId(o)),i=e.get(pt.createId(o));return{pageId:o,camera:{x:(i==null?void 0:i.x)??0,y:(i==null?void 0:i.y)??0,z:(i==null?void 0:i.z)??1},selectedShapeIds:(s==null?void 0:s.selectedShapeIds)??[],focusedGroupId:(s==null?void 0:s.focusedGroupId)??null}})}})}function kO(e,t){const n=_O(t);if(!n)return;const r=e.allRecords().filter(i=>i.typeName==="instance_page_state"||i.typeName==="camera"),o={added:{},updated:{},removed:{...uS(r.map(i=>[i.id,i]))}};e.has(yt)&&(o.removed[yt]=e.get(yt));const s={removed:{},updated:{},added:{[yt]:e.schema.types.instance.create({id:yt,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(const i of n.pageStates){const a=pt.createId(i.pageId),c=gt.createId(i.pageId);s.added[a]=pt.create({id:pt.createId(i.pageId),x:i.camera.x,y:i.camera.y,z:i.camera.z}),s.added[c]=gt.create({id:gt.createId(i.pageId),pageId:i.pageId,selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId})}an(()=>{e.applyDiff(Ml([o,s])),e.ensureStoreIsUsable()})}function TO(e){var o;const t=[];for(const s of Object.values(e))(o=s.typeName)!=null&&o.match(/^(instance.*|pointer|camera)$/)&&t.push(s);const n=t.filter(s=>s.typeName==="instance"&&s.id!==yt)[0];if(!n)return null;const r={version:Ui,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===n.id).map(s=>{const i=e[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:i.x,y:i.y,z:i.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return yx.validate(r),r}catch{return null}}function $O(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using PixStudio in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function AO(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using PixStudio in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Kl="TLDRAW_DOCUMENT_v2",vx="TLDRAW_DB_NAME_INDEX_v2",$e={Records:"records",Schema:"schema",SessionState:"session_state"};async function Wl(e,t){DO(e);const n=await B_(e,3,{upgrade(r){r.objectStoreNames.contains($e.Records)||r.createObjectStore($e.Records),r.objectStoreNames.contains($e.Schema)||r.createObjectStore($e.Schema),r.objectStoreNames.contains($e.SessionState)||r.createObjectStore($e.SessionState)}});try{return await t(n)}finally{n.close()}}async function MO({persistenceKey:e,sessionId:t,didCancel:n}){const r=Kl+e;if(up().includes(r))return await jO({persistenceKey:e,didCancel:n}),await Wl(r,async o=>{var d,f;if(n!=null&&n())return;const s=o.transaction([$e.Records,$e.Schema,$e.SessionState],"readonly"),i=s.objectStore($e.Records),a=s.objectStore($e.Schema),c=s.objectStore($e.SessionState);let l=t?(d=await c.get(t))==null?void 0:d.snapshot:null;l||(l=(f=(await c.getAll()).sort((v,m)=>v.updatedAt-m.updatedAt).pop())==null?void 0:f.snapshot);const u={records:await i.getAll(),schema:await a.get($e.Schema),sessionStateSnapshot:l};if(n!=null&&n()){s.abort();return}return await s.done,u})}async function OO({persistenceKey:e,schema:t,changes:n,sessionId:r,sessionStateSnapshot:o,didCancel:s}){const i=Kl+e;await Wl(i,async a=>{const c=a.transaction([$e.Records,$e.Schema,$e.SessionState],"readwrite"),l=c.objectStore($e.Records),u=c.objectStore($e.Schema),d=c.objectStore($e.SessionState);for(const[f,p]of Object.entries(n.added))await l.put(p,f);for(const[f,p]of Object.values(n.updated))await l.put(p,p.id);for(const f of Object.keys(n.removed))await l.delete(f);if(u.put(t.serialize(),$e.Schema),o&&r?d.put({snapshot:o,updatedAt:Date.now(),id:r},r):(o||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),s!=null&&s())return c.abort();await c.done})}async function RO({persistenceKey:e,schema:t,snapshot:n,sessionId:r,sessionStateSnapshot:o,didCancel:s}){const i=Kl+e;await Wl(i,async a=>{const c=a.transaction([$e.Records,$e.Schema,$e.SessionState],"readwrite"),l=c.objectStore($e.Records),u=c.objectStore($e.Schema),d=c.objectStore($e.SessionState);await l.clear();for(const[f,p]of Object.entries(n))await l.put(p,f);if(u.put(t.serialize(),$e.Schema),o&&r?d.put({snapshot:o,updatedAt:Date.now(),id:r},r):(o||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),s!=null&&s())return c.abort();await c.done})}async function jO({persistenceKey:e,didCancel:t}){await Wl(Kl+e,async n=>{const r=n.transaction([$e.SessionState],"readwrite"),o=r.objectStore($e.SessionState),s=(await o.getAll()).sort((a,c)=>a.updatedAt-c.updatedAt);if(s.length<10){await r.done;return}const i=s.slice(0,s.length-10);for(const{id:a}of i)await o.delete(a);if(t!=null&&t())return r.abort();await r.done})}function up(){const e=JSON.parse((window==null?void 0:window.localStorage.getItem(vx))||"[]")??[];return Array.isArray(e)?e:[]}function DO(e){const t=new Set(up());t.add(e),window==null||window.localStorage.setItem(vx,JSON.stringify([...t]))}const NO=350,LO=1e4,$y=Symbol("UPDATE_INSTANCE_STATE"),FO=e=>e;class BO{constructor(t){I(this,"onmessage")}postMessage(t){}close(){}}const zO=typeof BroadcastChannel>"u"?BO:BroadcastChannel;class UO{constructor(t,{persistenceKey:n,sessionId:r=cl,onLoad:o,onLoadError:s},i=new zO(`tldraw-tab-sync-${n}`)){I(this,"disposables",new Set);I(this,"diffQueue",[]);I(this,"didDispose",!1);I(this,"shouldDoFullDBWrite",!0);I(this,"isReloading",!1);I(this,"persistenceKey");I(this,"sessionId");I(this,"serializedSchema");I(this,"isDebugging",!1);I(this,"documentTypes");I(this,"$sessionStateSnapshot");I(this,"initTime",Date.now());I(this,"isPersisting",!1);I(this,"didLastWriteError",!1);I(this,"scheduledPersistTimeout",null);this.store=t,this.channel=i,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=IO(this.store),this.disposables.add(t.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(FO({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(t.listen(()=>{this.diffQueue.push($y),this.schedulePersist()},{scope:"session"})),this.connect(o,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...t){this.isDebugging&&console.debug(...t)}async connect(t,n){this.debug("connecting");let r;try{r=await MO({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(o){n(o),AO(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const o=Object.fromEntries(r.records.map(a=>[a.id,a])),s=r.sessionStateSnapshot??TO(o),i=this.store.schema.migrateStoreSnapshot({store:o,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(i.type==="error"){console.error("failed to migrate store",i),n(new Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),s&&kO(this.store,s)}this.channel.onmessage=({data:o})=>{var a,c;this.debug("got message",o);const s=o,i=WI(this.serializedSchema,s.schema??this.store.schema.serializeEarliestVersion());if(i===-1){if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}else if(i===1){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}s.type==="diff"&&(this.debug("applying diff"),an(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),t(this)}catch(o){if(this.debug("error loading data from store",o),this.didDispose)return;n(o);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(t=>t())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?LO:NO))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){Nh(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const t=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await RO({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=Ml(t.filter(r=>r!==$y));await OO({persistenceKey:this.persistenceKey,changes:n,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),$O(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function VO({initialData:e,defaultName:t="",...n}){const r="schema"in n&&n.schema?n.schema:Dk({shapes:KO(dx("shapeUtils"in n&&n.shapeUtils?n.shapeUtils:[]))});return new fS({schema:r,initialData:e,props:{defaultName:t}})}function KO(e){return Object.fromEntries(e.map(t=>[t.type,{props:t.props,migrations:t.migrations}]))}function Ay(e){const t=VO(e);return e.snapshot&&t.loadSnapshot(e.snapshot),{store:t,opts:e}}function WO(e){const[t,n]=g.useState(()=>Ay(e));if(!$I(t.opts,e)){const r=Ay(e);return n(r),r.store}return t.store}function HO({persistenceKey:e,sessionId:t,...n}){const[r,o]=g.useState(null),s=WO(n);return g.useEffect(()=>{const i=je();if(!e){o({id:i,storeWithStatus:{status:"not-synced",store:s}});return}o({id:i,storeWithStatus:{status:"loading"}});const a=l=>{o(u=>(u==null?void 0:u.id)===i?{id:i,storeWithStatus:l}:u)},c=new UO(s,{sessionId:t,persistenceKey:e,onLoad(){a({store:s,status:"synced-local"})},onLoadError(l){a({status:"error",error:l})}});return()=>{o(l=>(l==null?void 0:l.id)===i?null:l),c.close()}},[e,s,t]),(r==null?void 0:r.storeWithStatus)??{status:"loading"}}let bx=!1;if(typeof window<"u"){const e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);bx=t&&n&&!e.match(/CriOS/i)}function GO(){const e=U();g.useEffect(()=>{if(!bx)return;function t(n){(n.target instanceof HTMLInputElement&&n.target.type==="text"||n.target instanceof HTMLTextAreaElement)&&e.complete()}return document.addEventListener("focusout",t),()=>document.removeEventListener("focusout",t)},[e])}function YO(){const e=U(),t=ut();g.useEffect(()=>{const n=s=>t.style.setProperty("--tl-zoom",s.toString()),r=lS(n,100),o=new Rs("useZoomCss",()=>{e.getCurrentPageShapeIds().size<300?n(e.getZoomLevel()):r(e.getZoomLevel())});return o.attach(),o.execute(),()=>{o.detach()}},[e,t])}const XO=[],qO=[],aX=g.memo(function({store:t,components:n,className:r,user:o,...s}){const[i,a]=Z.useState(null),c=g.useMemo(()=>o??rx(),[o]),l=(n==null?void 0:n.ErrorFallback)===void 0?kS:n==null?void 0:n.ErrorFallback,u={...s,shapeUtils:s.shapeUtils??XO,tools:s.tools??qO,components:n};return h.jsx("div",{ref:a,draggable:!1,className:ue("tl-container tl-theme__light",r),onPointerDown:Ct,tabIndex:-1,children:h.jsx(Bi,{fallback:l,onError:d=>Lh(d,{tags:{origin:"react.tldraw-before-app"}}),children:i&&h.jsx(hT,{container:i,children:h.jsx(c2,{overrides:n,children:t?t instanceof fS?h.jsx(xx,{...u,store:t,user:c}):h.jsx(Sx,{...u,store:t,user:c}):h.jsx(ZO,{...u,store:t,user:c})})})})})});function ZO(e){const{defaultName:t,snapshot:n,initialData:r,shapeUtils:o,persistenceKey:s,sessionId:i,user:a}=e,c=HO({shapeUtils:o,initialData:r,persistenceKey:s,sessionId:i,defaultName:t,snapshot:n});return h.jsx(Sx,{...e,store:c,user:a})}const Sx=g.memo(function({store:t,user:n,...r}){var s;const o=ut();switch(g.useLayoutEffect(()=>{n.userPreferences.get().isDarkMode&&(o.classList.remove("tl-theme__light"),o.classList.add("tl-theme__dark"))},[o,n]),t.status){case"error":throw t.error;case"loading":{const i=((s=r.components)==null?void 0:s.LoadingScreen)??dM;return h.jsx(i,{})}}return h.jsx(xx,{...r,store:t.store,user:n})});function xx({onMount:e,children:t,store:n,tools:r,shapeUtils:o,user:s,initialState:i,autoFocus:a=!0,inferDarkMode:c}){const{ErrorFallback:l}=ot(),u=ut(),[d,f]=g.useState(null);g.useLayoutEffect(()=>{const v=new ne({store:n,shapeUtils:o,tools:r,getContainer:()=>u,user:s,initialState:i,inferDarkMode:c});return window.app=v,window.editor=v,f(v),()=>{v.dispose()}},[u,o,r,n,s,i,c]);const p=g.useSyncExternalStore(g.useCallback(v=>d?(d.on("crash",v),()=>d.off("crash",v)):()=>{},[d]),()=>(d==null?void 0:d.getCrashingError())??null);return d?h.jsx(Bi,{fallback:l,onError:v=>d.annotateError(v,{origin:"react.tldraw",willCrashApp:!0}),children:p?h.jsx(JO,{crashingError:p}):h.jsx(Jh.Provider,{value:d,children:h.jsx(QO,{autoFocus:a,onMount:e,children:t})})}):null}function QO({children:e,onMount:t,autoFocus:n}){return YO(),vO(),bO(),GO(),wO(),xO(n),nR(t),LA(),U().updateViewportScreenBounds(),e??h.jsx(ZS,{})}function JO({crashingError:e}){throw e}function eR({children:e}){const{Spinner:t}=ot();return h.jsxs("div",{className:"tl-loading",children:[t?h.jsx(t,{}):null,e]})}function tR({children:e}){return h.jsx("div",{className:"tl-loading",children:e})}function nR(e){const t=U(),n=SO(r=>{const o=e==null?void 0:e(r);return r.emit("mount"),window.tldrawReady=!0,o});Z.useLayoutEffect(()=>{if(t)return n==null?void 0:n(t)},[t,n])}function wx({children:e,className:t="",...n}){return h.jsx("div",{...n,className:`tl-html-container ${t}`,children:e})}Te(function({x:t=0,y:n=0,rotation:r=0,...o}){const s=U(),i=g.useRef(null),a=s.getCamera();return g.useLayoutEffect(()=>{const{x:c,y:l,z:u}=s.getCamera(),d=i.current;d&&c!==void 0&&(d.style.transform=`translate(${c}px, ${l}px) scale(${u}) rotate(${r}rad) translate(${t}px, ${n}px)`)},[a,s,t,n,r]),h.jsx("div",{ref:i,...o,className:ue("tl-positioned",o.className)})});function rR(e,t,n={}){const{newPoint:r,handle:o,scaleX:s,scaleY:i}=t,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:u=1/0}=n;let d=e.props.w*s,f=e.props.h*i;const p=new k(0,0);if(d>0){if(d<a){switch(o){case"top_left":case"left":case"bottom_left":{p.x=d-a;break}case"top":case"bottom":{p.x=(d-a)/2;break}default:p.x=0}d=a}}else if(p.x=d,d=-d,d<a){switch(o){case"top_left":case"left":case"bottom_left":{p.x=-d;break}default:p.x=-a}d=a}if(f>0){if(f<l){switch(o){case"top_left":case"top":case"top_right":{p.y=f-l;break}case"right":case"left":{p.y=(f-l)/2;break}default:p.y=0}f=l}}else if(p.y=f,f=-f,f<l){switch(o){case"top_left":case"top":case"top_right":{p.y=-f;break}default:p.y=-l}f=l}const{x:v,y:m}=p.rot(e.rotation).add(r);return{x:v,y:m,props:{w:Math.min(c,d),h:Math.min(u,f)}}}class Cx extends ds{constructor(){super(...arguments);I(this,"onResize",(n,r)=>rR(n,r))}getGeometry(n){return new lx({width:n.props.w,height:n.props.h,isFilled:!0})}}function oR(e){const t=U();return Y("isEditing",()=>t.getEditingShapeId()===e,[t,e])}function On(e){const t=U();return g.useMemo(function(){const o=l=>{if(l.isKilled)return;if(l.button===2){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...Ht(l)});return}if(l.button!==0)return;const u=el(l.currentTarget);function d(){u.removeEventListener("pointerup",d),na(u,l)}ta(u,l),u.addEventListener("pointerup",d),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...Ht(l)}),Ct(l)};let s,i;function a(l){l.isKilled||l.button===0&&(l.clientX===s&&l.clientY===i||(s=l.clientX,i=l.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...Ht(l)})))}return{onPointerDown:o,onPointerMove:a,onPointerUp:l=>{l.isKilled||l.button===0&&t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...Ht(l)})}}},[t,e])}const sR=20,iR=8;function aR(e,t=sR){return Math.max(iR,Math.ceil(e/t))}class cR extends zl{constructor(n){super({isClosed:!0,...n});I(this,"_center");I(this,"radius");I(this,"x");I(this,"y");this.config=n;const{x:r=0,y:o=0,radius:s}=n;this.x=r,this.y=o,this._center=new k(s+r,s+o),this.radius=s}getBounds(){return new ce(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:n,radius:r}=this,o=He*r,s=[];for(let i=0,a=aR(o);i<a;i++){const c=i/a*He;s.push(n.clone().add(k.FromAngle(c).mul(r)))}return s}nearestPoint(n){const{_center:r,radius:o}=this;return r.equals(n)?k.AddXY(r,o,0):r.clone().add(n.clone().sub(r).uni().mul(o))}hitTestLineSegment(n,r,o){const{_center:s,radius:i}=this;return ap(n,r,s,i)!==null}}async function lR({shouldReload:e=!0}={}){sessionStorage.clear(),await Promise.all(up().map(t=>z_(t))),localStorage.clear(),e&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=lR);function uR(e,t="_blank"){ep.openWindow(e,t)}var ui=function(e){return e&&e.Math===Math&&e},Et=ui(typeof globalThis=="object"&&globalThis)||ui(typeof window=="object"&&window)||ui(typeof self=="object"&&self)||ui(typeof Ue=="object"&&Ue)||ui(typeof Ue=="object"&&Ue)||function(){return this}()||Function("return this")(),dp={},_t=function(e){try{return!!e()}catch{return!0}},dR=_t,Zr=!dR(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),fR=_t,Hl=!fR(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),hR=Hl,Wa=Function.prototype.call,pr=hR?Wa.bind(Wa):function(){return Wa.apply(Wa,arguments)},Px={},Ex={}.propertyIsEnumerable,_x=Object.getOwnPropertyDescriptor,pR=_x&&!Ex.call({1:2},1);Px.f=pR?function(t){var n=_x(this,t);return!!n&&n.enumerable}:Ex;var Ix=function(e,t){return{enumerable:!(e&1),configurable:!(e&2),writable:!(e&4),value:t}},kx=Hl,Tx=Function.prototype,_f=Tx.call,gR=kx&&Tx.bind.bind(_f,_f),st=kx?gR:function(e){return function(){return _f.apply(e,arguments)}},$x=st,mR=$x({}.toString),yR=$x("".slice),zs=function(e){return yR(mR(e),8,-1)},vR=st,bR=_t,SR=zs,td=Object,xR=vR("".split),wR=bR(function(){return!td("z").propertyIsEnumerable(0)})?function(e){return SR(e)==="String"?xR(e,""):td(e)}:td,Gl=function(e){return e==null},CR=Gl,PR=TypeError,Us=function(e){if(CR(e))throw new PR("Can't call method on "+e);return e},ER=wR,_R=Us,Yl=function(e){return ER(_R(e))},nd=typeof document=="object"&&document.all,It=typeof nd>"u"&&nd!==void 0?function(e){return typeof e=="function"||e===nd}:function(e){return typeof e=="function"},IR=It,Io=function(e){return typeof e=="object"?e!==null:IR(e)},rd=Et,kR=It,TR=function(e){return kR(e)?e:void 0},Xl=function(e,t){return arguments.length<2?TR(rd[e]):rd[e]&&rd[e][t]},$R=st,Ax=$R({}.isPrototypeOf),AR=Et,My=AR.navigator,Oy=My&&My.userAgent,MR=Oy?String(Oy):"",Mx=Et,od=MR,Ry=Mx.process,jy=Mx.Deno,Dy=Ry&&Ry.versions||jy&&jy.version,Ny=Dy&&Dy.v8,wn,ll;Ny&&(wn=Ny.split("."),ll=wn[0]>0&&wn[0]<4?1:+(wn[0]+wn[1]));!ll&&od&&(wn=od.match(/Edge\/(\d+)/),(!wn||wn[1]>=74)&&(wn=od.match(/Chrome\/(\d+)/),wn&&(ll=+wn[1])));var OR=ll,Ly=OR,RR=_t,jR=Et,DR=jR.String,Ox=!!Object.getOwnPropertySymbols&&!RR(function(){var e=Symbol("symbol detection");return!DR(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ly&&Ly<41}),NR=Ox,Rx=NR&&!Symbol.sham&&typeof Symbol.iterator=="symbol",LR=Xl,FR=It,BR=Ax,zR=Rx,UR=Object,jx=zR?function(e){return typeof e=="symbol"}:function(e){var t=LR("Symbol");return FR(t)&&BR(t.prototype,UR(e))},VR=String,KR=function(e){try{return VR(e)}catch{return"Object"}},WR=It,HR=KR,GR=TypeError,fp=function(e){if(WR(e))return e;throw new GR(HR(e)+" is not a function")},YR=fp,XR=Gl,hp=function(e,t){var n=e[t];return XR(n)?void 0:YR(n)},sd=pr,id=It,ad=Io,qR=TypeError,ZR=function(e,t){var n,r;if(t==="string"&&id(n=e.toString)&&!ad(r=sd(n,e))||id(n=e.valueOf)&&!ad(r=sd(n,e))||t!=="string"&&id(n=e.toString)&&!ad(r=sd(n,e)))return r;throw new qR("Can't convert object to primitive value")},Dx={exports:{}},Fy=Et,QR=Object.defineProperty,pp=function(e,t){try{QR(Fy,e,{value:t,configurable:!0,writable:!0})}catch{Fy[e]=t}return t},JR=Et,ej=pp,By="__core-js_shared__",zy=Dx.exports=JR[By]||ej(By,{});(zy.versions||(zy.versions=[])).push({version:"3.38.1",mode:"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.38.1/LICENSE",source:"https://github.com/zloirock/core-js"});var gp=Dx.exports,Uy=gp,mp=function(e,t){return Uy[e]||(Uy[e]=t||{})},tj=Us,nj=Object,ia=function(e){return nj(tj(e))},rj=st,oj=ia,sj=rj({}.hasOwnProperty),Qr=Object.hasOwn||function(t,n){return sj(oj(t),n)},ij=st,aj=0,cj=Math.random(),lj=ij(1 .toString),Nx=function(e){return"Symbol("+(e===void 0?"":e)+")_"+lj(++aj+cj,36)},uj=Et,dj=mp,Vy=Qr,fj=Nx,hj=Ox,pj=Rx,rs=uj.Symbol,cd=dj("wks"),gj=pj?rs.for||rs:rs&&rs.withoutSetter||fj,gr=function(e){return Vy(cd,e)||(cd[e]=hj&&Vy(rs,e)?rs[e]:gj("Symbol."+e)),cd[e]},mj=pr,Ky=Io,Wy=jx,yj=hp,vj=ZR,bj=gr,Sj=TypeError,xj=bj("toPrimitive"),wj=function(e,t){if(!Ky(e)||Wy(e))return e;var n=yj(e,xj),r;if(n){if(t===void 0&&(t="default"),r=mj(n,e,t),!Ky(r)||Wy(r))return r;throw new Sj("Can't convert object to primitive value")}return t===void 0&&(t="number"),vj(e,t)},Cj=wj,Pj=jx,Lx=function(e){var t=Cj(e,"string");return Pj(t)?t:t+""},Ej=Et,Hy=Io,If=Ej.document,_j=Hy(If)&&Hy(If.createElement),Fx=function(e){return _j?If.createElement(e):{}},Ij=Zr,kj=_t,Tj=Fx,Bx=!Ij&&!kj(function(){return Object.defineProperty(Tj("div"),"a",{get:function(){return 7}}).a!==7}),$j=Zr,Aj=pr,Mj=Px,Oj=Ix,Rj=Yl,jj=Lx,Dj=Qr,Nj=Bx,Gy=Object.getOwnPropertyDescriptor;dp.f=$j?Gy:function(t,n){if(t=Rj(t),n=jj(n),Nj)try{return Gy(t,n)}catch{}if(Dj(t,n))return Oj(!Aj(Mj.f,t,n),t[n])};var Vs={},Lj=Zr,Fj=_t,zx=Lj&&Fj(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Bj=Io,zj=String,Uj=TypeError,ko=function(e){if(Bj(e))return e;throw new Uj(zj(e)+" is not an object")},Vj=Zr,Kj=Bx,Wj=zx,Ha=ko,Yy=Lx,Hj=TypeError,ld=Object.defineProperty,Gj=Object.getOwnPropertyDescriptor,ud="enumerable",dd="configurable",fd="writable";Vs.f=Vj?Wj?function(t,n,r){if(Ha(t),n=Yy(n),Ha(r),typeof t=="function"&&n==="prototype"&&"value"in r&&fd in r&&!r[fd]){var o=Gj(t,n);o&&o[fd]&&(t[n]=r.value,r={configurable:dd in r?r[dd]:o[dd],enumerable:ud in r?r[ud]:o[ud],writable:!1})}return ld(t,n,r)}:ld:function(t,n,r){if(Ha(t),n=Yy(n),Ha(r),Kj)try{return ld(t,n,r)}catch{}if("get"in r||"set"in r)throw new Hj("Accessors not supported");return"value"in r&&(t[n]=r.value),t};var Yj=Zr,Xj=Vs,qj=Ix,yp=Yj?function(e,t,n){return Xj.f(e,t,qj(1,n))}:function(e,t,n){return e[t]=n,e},Ux={exports:{}},kf=Zr,Zj=Qr,Vx=Function.prototype,Qj=kf&&Object.getOwnPropertyDescriptor,vp=Zj(Vx,"name"),Jj=vp&&(function(){}).name==="something",eD=vp&&(!kf||kf&&Qj(Vx,"name").configurable),tD={EXISTS:vp,PROPER:Jj,CONFIGURABLE:eD},nD=st,rD=It,Tf=gp,oD=nD(Function.toString);rD(Tf.inspectSource)||(Tf.inspectSource=function(e){return oD(e)});var Kx=Tf.inspectSource,sD=Et,iD=It,Xy=sD.WeakMap,aD=iD(Xy)&&/native code/.test(String(Xy)),cD=mp,lD=Nx,qy=cD("keys"),Wx=function(e){return qy[e]||(qy[e]=lD(e))},bp={},uD=aD,Hx=Et,dD=Io,fD=yp,hd=Qr,pd=gp,hD=Wx,pD=bp,Zy="Object already initialized",$f=Hx.TypeError,gD=Hx.WeakMap,ul,Vi,dl,mD=function(e){return dl(e)?Vi(e):ul(e,{})},yD=function(e){return function(t){var n;if(!dD(t)||(n=Vi(t)).type!==e)throw new $f("Incompatible receiver, "+e+" required");return n}};if(uD||pd.state){var Mn=pd.state||(pd.state=new gD);Mn.get=Mn.get,Mn.has=Mn.has,Mn.set=Mn.set,ul=function(e,t){if(Mn.has(e))throw new $f(Zy);return t.facade=e,Mn.set(e,t),t},Vi=function(e){return Mn.get(e)||{}},dl=function(e){return Mn.has(e)}}else{var Vo=hD("state");pD[Vo]=!0,ul=function(e,t){if(hd(e,Vo))throw new $f(Zy);return t.facade=e,fD(e,Vo,t),t},Vi=function(e){return hd(e,Vo)?e[Vo]:{}},dl=function(e){return hd(e,Vo)}}var Gx={set:ul,get:Vi,has:dl,enforce:mD,getterFor:yD},Sp=st,vD=_t,bD=It,Ga=Qr,Af=Zr,SD=tD.CONFIGURABLE,xD=Kx,Yx=Gx,wD=Yx.enforce,CD=Yx.get,Qy=String,Mc=Object.defineProperty,PD=Sp("".slice),ED=Sp("".replace),_D=Sp([].join),ID=Af&&!vD(function(){return Mc(function(){},"length",{value:8}).length!==8}),kD=String(String).split("String"),TD=Ux.exports=function(e,t,n){PD(Qy(t),0,7)==="Symbol("&&(t="["+ED(Qy(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!Ga(e,"name")||SD&&e.name!==t)&&(Af?Mc(e,"name",{value:t,configurable:!0}):e.name=t),ID&&n&&Ga(n,"arity")&&e.length!==n.arity&&Mc(e,"length",{value:n.arity});try{n&&Ga(n,"constructor")&&n.constructor?Af&&Mc(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch{}var r=wD(e);return Ga(r,"source")||(r.source=_D(kD,typeof t=="string"?t:"")),e};Function.prototype.toString=TD(function(){return bD(this)&&CD(this).source||xD(this)},"toString");var $D=Ux.exports,AD=It,MD=Vs,OD=$D,RD=pp,Xx=function(e,t,n,r){r||(r={});var o=r.enumerable,s=r.name!==void 0?r.name:t;if(AD(n)&&OD(n,s,r),r.global)o?e[t]=n:RD(t,n);else{try{r.unsafe?e[t]&&(o=!0):delete e[t]}catch{}o?e[t]=n:MD.f(e,t,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},qx={},jD=Math.ceil,DD=Math.floor,ND=Math.trunc||function(t){var n=+t;return(n>0?DD:jD)(n)},LD=ND,To=function(e){var t=+e;return t!==t||t===0?0:LD(t)},FD=To,BD=Math.max,zD=Math.min,UD=function(e,t){var n=FD(e);return n<0?BD(n+t,0):zD(n,t)},VD=To,KD=Math.min,Zx=function(e){var t=VD(e);return t>0?KD(t,9007199254740991):0},WD=Zx,aa=function(e){return WD(e.length)},HD=Yl,GD=UD,YD=aa,Jy=function(e){return function(t,n,r){var o=HD(t),s=YD(o);if(s===0)return!e&&-1;var i=GD(r,s),a;if(e&&n!==n){for(;s>i;)if(a=o[i++],a!==a)return!0}else for(;s>i;i++)if((e||i in o)&&o[i]===n)return e||i||0;return!e&&-1}},XD={includes:Jy(!0),indexOf:Jy(!1)},qD=st,gd=Qr,ZD=Yl,QD=XD.indexOf,JD=bp,ev=qD([].push),Qx=function(e,t){var n=ZD(e),r=0,o=[],s;for(s in n)!gd(JD,s)&&gd(n,s)&&ev(o,s);for(;t.length>r;)gd(n,s=t[r++])&&(~QD(o,s)||ev(o,s));return o},xp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],eN=Qx,tN=xp,nN=tN.concat("length","prototype");qx.f=Object.getOwnPropertyNames||function(t){return eN(t,nN)};var Jx={};Jx.f=Object.getOwnPropertySymbols;var rN=Xl,oN=st,sN=qx,iN=Jx,aN=ko,cN=oN([].concat),lN=rN("Reflect","ownKeys")||function(t){var n=sN.f(aN(t)),r=iN.f;return r?cN(n,r(t)):n},tv=Qr,uN=lN,dN=dp,fN=Vs,hN=function(e,t,n){for(var r=uN(t),o=fN.f,s=dN.f,i=0;i<r.length;i++){var a=r[i];!tv(e,a)&&!(n&&tv(n,a))&&o(e,a,s(t,a))}},pN=_t,gN=It,mN=/#|\.prototype\./,ca=function(e,t){var n=vN[yN(e)];return n===SN?!0:n===bN?!1:gN(t)?pN(t):!!t},yN=ca.normalize=function(e){return String(e).replace(mN,".").toLowerCase()},vN=ca.data={},bN=ca.NATIVE="N",SN=ca.POLYFILL="P",xN=ca,Ya=Et,wN=dp.f,CN=yp,PN=Xx,EN=pp,_N=hN,IN=xN,Ks=function(e,t){var n=e.target,r=e.global,o=e.stat,s,i,a,c,l,u;if(r?i=Ya:o?i=Ya[n]||EN(n,{}):i=Ya[n]&&Ya[n].prototype,i)for(a in t){if(l=t[a],e.dontCallGetSet?(u=wN(i,a),c=u&&u.value):c=i[a],s=IN(r?a:n+(o?".":"#")+a,e.forced),!s&&c!==void 0){if(typeof l==typeof c)continue;_N(l,c)}(e.sham||c&&c.sham)&&CN(l,"sham",!0),PN(i,a,l,e)}},ew={},kN=Qx,TN=xp,$N=Object.keys||function(t){return kN(t,TN)},AN=Zr,MN=zx,ON=Vs,RN=ko,jN=Yl,DN=$N;ew.f=AN&&!MN?Object.defineProperties:function(t,n){RN(t);for(var r=jN(n),o=DN(n),s=o.length,i=0,a;s>i;)ON.f(t,a=o[i++],r[a]);return t};var NN=Xl,LN=NN("document","documentElement"),FN=ko,BN=ew,nv=xp,zN=bp,UN=LN,VN=Fx,KN=Wx,rv=">",ov="<",Mf="prototype",Of="script",tw=KN("IE_PROTO"),md=function(){},nw=function(e){return ov+Of+rv+e+ov+"/"+Of+rv},sv=function(e){e.write(nw("")),e.close();var t=e.parentWindow.Object;return e=null,t},WN=function(){var e=VN("iframe"),t="java"+Of+":",n;return e.style.display="none",UN.appendChild(e),e.src=String(t),n=e.contentWindow.document,n.open(),n.write(nw("document.F=Object")),n.close(),n.F},Xa,Oc=function(){try{Xa=new ActiveXObject("htmlfile")}catch{}Oc=typeof document<"u"?document.domain&&Xa?sv(Xa):WN():sv(Xa);for(var e=nv.length;e--;)delete Oc[Mf][nv[e]];return Oc()};zN[tw]=!0;var rw=Object.create||function(t,n){var r;return t!==null?(md[Mf]=FN(t),r=new md,md[Mf]=null,r[tw]=t):r=Oc(),n===void 0?r:BN.f(r,n)},HN=gr,GN=rw,YN=Vs.f,Rf=HN("unscopables"),jf=Array.prototype;jf[Rf]===void 0&&YN(jf,Rf,{configurable:!0,value:GN(null)});var wp=function(e){jf[Rf][e]=!0},XN=Ks,qN=ia,ZN=aa,QN=To,JN=wp;XN({target:"Array",proto:!0},{at:function(t){var n=qN(this),r=ZN(n),o=QN(t),s=o>=0?o:r+o;return s<0||s>=r?void 0:n[s]}});JN("at");var e3=Et,t3=st,la=function(e,t){return t3(e3[e].prototype[t])},n3=la;n3("Array","at");var r3=zs,ow=Array.isArray||function(t){return r3(t)==="Array"},o3=TypeError,s3=9007199254740991,i3=function(e){if(e>s3)throw o3("Maximum allowed index exceeded");return e},a3=zs,c3=st,l3=function(e){if(a3(e)==="Function")return c3(e)},iv=l3,u3=fp,d3=Hl,f3=iv(iv.bind),h3=function(e,t){return u3(e),t===void 0?e:d3?f3(e,t):function(){return e.apply(t,arguments)}},p3=ow,g3=aa,m3=i3,y3=h3,sw=function(e,t,n,r,o,s,i,a){for(var c=o,l=0,u=i?y3(i,a):!1,d,f;l<r;)l in n&&(d=u?u(n[l],l,t):n[l],s>0&&p3(d)?(f=g3(d),c=sw(e,t,d,f,c,s-1)-1):(m3(c+1),e[c]=d),c++),l++;return c},iw=sw,v3=gr,b3=v3("toStringTag"),aw={};aw[b3]="z";var S3=String(aw)==="[object z]",x3=S3,w3=It,Rc=zs,C3=gr,P3=C3("toStringTag"),E3=Object,_3=Rc(function(){return arguments}())==="Arguments",I3=function(e,t){try{return e[t]}catch{}},cw=x3?Rc:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=I3(t=E3(e),P3))=="string"?n:_3?Rc(t):(r=Rc(t))==="Object"&&w3(t.callee)?"Arguments":r},k3=st,T3=_t,lw=It,$3=cw,A3=Xl,M3=Kx,uw=function(){},dw=A3("Reflect","construct"),Cp=/^\s*(?:class|function)\b/,O3=k3(Cp.exec),R3=!Cp.test(uw),di=function(t){if(!lw(t))return!1;try{return dw(uw,[],t),!0}catch{return!1}},fw=function(t){if(!lw(t))return!1;switch($3(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return R3||!!O3(Cp,M3(t))}catch{return!0}};fw.sham=!0;var j3=!dw||T3(function(){var e;return di(di.call)||!di(Object)||!di(function(){e=!0})||e})?fw:di,av=ow,D3=j3,N3=Io,L3=gr,F3=L3("species"),cv=Array,B3=function(e){var t;return av(e)&&(t=e.constructor,D3(t)&&(t===cv||av(t.prototype))?t=void 0:N3(t)&&(t=t[F3],t===null&&(t=void 0))),t===void 0?cv:t},z3=B3,hw=function(e,t){return new(z3(e))(t===0?0:t)},U3=Ks,V3=iw,K3=ia,W3=aa,H3=To,G3=hw;U3({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,n=K3(this),r=W3(n),o=G3(n,0);return o.length=V3(o,n,n,r,0,t===void 0?1:H3(t)),o}});var Y3=wp;Y3("flat");var X3=la;X3("Array","flat");var q3=Ks,Z3=iw,Q3=fp,J3=ia,eL=aa,tL=hw;q3({target:"Array",proto:!0},{flatMap:function(t){var n=J3(this),r=eL(n),o;return Q3(t),o=tL(n,0),o.length=Z3(o,n,n,r,0,1,t,arguments.length>1?arguments[1]:void 0),o}});var nL=wp;nL("flatMap");var rL=la;rL("Array","flatMap");var oL=cw,sL=String,ua=function(e){if(oL(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return sL(e)},iL=Ks,aL=st,cL=Us,lL=To,uL=ua,dL=_t,fL=aL("".charAt),hL=dL(function(){return"𠮷".at(-2)!=="\uD842"});iL({target:"String",proto:!0,forced:hL},{at:function(t){var n=uL(cL(this)),r=n.length,o=lL(t),s=o>=0?o:r+o;return s<0||s>=r?void 0:fL(n,s)}});var pL=la;pL("String","at");var gL=ko,pw=function(){var e=gL(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Pp=_t,mL=Et,Ep=mL.RegExp,_p=Pp(function(){var e=Ep("a","y");return e.lastIndex=2,e.exec("abcd")!==null}),yL=_p||Pp(function(){return!Ep("a","y").sticky}),vL=_p||Pp(function(){var e=Ep("^r","gy");return e.lastIndex=2,e.exec("str")!==null}),bL={BROKEN_CARET:vL,MISSED_STICKY:yL,UNSUPPORTED_Y:_p},SL=_t,xL=Et,wL=xL.RegExp,CL=SL(function(){var e=wL(".","s");return!(e.dotAll&&e.test(`
`)&&e.flags==="s")}),PL=_t,EL=Et,_L=EL.RegExp,IL=PL(function(){var e=_L("(?<a>b)","g");return e.exec("b").groups.a!=="b"||"b".replace(e,"$<a>c")!=="bc"}),os=pr,ql=st,kL=ua,TL=pw,$L=bL,AL=mp,ML=rw,OL=Gx.get,RL=CL,jL=IL,DL=AL("native-string-replace",String.prototype.replace),fl=RegExp.prototype.exec,Df=fl,NL=ql("".charAt),LL=ql("".indexOf),FL=ql("".replace),yd=ql("".slice),Nf=function(){var e=/a/,t=/b*/g;return os(fl,e,"a"),os(fl,t,"a"),e.lastIndex!==0||t.lastIndex!==0}(),gw=$L.BROKEN_CARET,Lf=/()??/.exec("")[1]!==void 0,BL=Nf||Lf||gw||RL||jL;BL&&(Df=function(t){var n=this,r=OL(n),o=kL(t),s=r.raw,i,a,c,l,u,d,f;if(s)return s.lastIndex=n.lastIndex,i=os(Df,s,o),n.lastIndex=s.lastIndex,i;var p=r.groups,v=gw&&n.sticky,m=os(TL,n),y=n.source,b=0,x=o;if(v&&(m=FL(m,"y",""),LL(m,"g")===-1&&(m+="g"),x=yd(o,n.lastIndex),n.lastIndex>0&&(!n.multiline||n.multiline&&NL(o,n.lastIndex-1)!==`
`)&&(y="(?: "+y+")",x=" "+x,b++),a=new RegExp("^(?:"+y+")",m)),Lf&&(a=new RegExp("^"+y+"$(?!\\s)",m)),Nf&&(c=n.lastIndex),l=os(fl,v?a:n,x),v?l?(l.input=yd(l.input,b),l[0]=yd(l[0],b),l.index=n.lastIndex,n.lastIndex+=l[0].length):n.lastIndex=0:Nf&&l&&(n.lastIndex=n.global?l.index+l[0].length:c),Lf&&l&&l.length>1&&os(DL,l[0],a,function(){for(u=1;u<arguments.length-2;u++)arguments[u]===void 0&&(l[u]=void 0)}),l&&p)for(l.groups=d=ML(null),u=0;u<p.length;u++)f=p[u],d[f[0]]=l[f[1]];return l});var Ip=Df,zL=Ks,lv=Ip;zL({target:"RegExp",proto:!0,forced:/./.exec!==lv},{exec:lv});var UL=Hl,mw=Function.prototype,uv=mw.apply,dv=mw.call,VL=typeof Reflect=="object"&&Reflect.apply||(UL?dv.bind(uv):function(){return dv.apply(uv,arguments)}),fv=pr,hv=Xx,KL=Ip,pv=_t,yw=gr,WL=yp,HL=yw("species"),vd=RegExp.prototype,GL=function(e,t,n,r){var o=yw(e),s=!pv(function(){var l={};return l[o]=function(){return 7},""[e](l)!==7}),i=s&&!pv(function(){var l=!1,u=/a/;return e==="split"&&(u={},u.constructor={},u.constructor[HL]=function(){return u},u.flags="",u[o]=/./[o]),u.exec=function(){return l=!0,null},u[o](""),!l});if(!s||!i||n){var a=/./[o],c=t(o,""[e],function(l,u,d,f,p){var v=u.exec;return v===KL||v===vd.exec?s&&!p?{done:!0,value:fv(a,u,d,f)}:{done:!0,value:fv(l,d,u,f)}:{done:!1}});hv(String.prototype,e,c[0]),hv(vd,o,c[1])}r&&WL(vd[o],"sham",!0)},kp=st,YL=To,XL=ua,qL=Us,ZL=kp("".charAt),gv=kp("".charCodeAt),QL=kp("".slice),mv=function(e){return function(t,n){var r=XL(qL(t)),o=YL(n),s=r.length,i,a;return o<0||o>=s?e?"":void 0:(i=gv(r,o),i<55296||i>56319||o+1===s||(a=gv(r,o+1))<56320||a>57343?e?ZL(r,o):i:e?QL(r,o,o+2):(i-55296<<10)+(a-56320)+65536)}},JL={codeAt:mv(!1),charAt:mv(!0)},eF=JL.charAt,tF=function(e,t,n){return t+(n?eF(e,t).length:1)},Tp=st,nF=ia,rF=Math.floor,bd=Tp("".charAt),oF=Tp("".replace),Sd=Tp("".slice),sF=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,iF=/\$([$&'`]|\d{1,2})/g,vw=function(e,t,n,r,o,s){var i=n+e.length,a=r.length,c=iF;return o!==void 0&&(o=nF(o),c=sF),oF(s,c,function(l,u){var d;switch(bd(u,0)){case"$":return"$";case"&":return e;case"`":return Sd(t,0,n);case"'":return Sd(t,i);case"<":d=o[Sd(u,1,-1)];break;default:var f=+u;if(f===0)return l;if(f>a){var p=rF(f/10);return p===0?l:p<=a?r[p-1]===void 0?bd(u,1):r[p-1]+bd(u,1):l}d=r[f-1]}return d===void 0?"":d})},yv=pr,aF=ko,cF=It,lF=zs,uF=Ip,dF=TypeError,fF=function(e,t){var n=e.exec;if(cF(n)){var r=yv(n,e,t);return r!==null&&aF(r),r}if(lF(e)==="RegExp")return yv(uF,e,t);throw new dF("RegExp#exec called on incompatible receiver")},hF=VL,vv=pr,Zl=st,pF=GL,gF=_t,mF=ko,yF=It,vF=Gl,bF=To,SF=Zx,Ko=ua,xF=Us,wF=tF,CF=hp,PF=vw,EF=fF,_F=gr,Ff=_F("replace"),IF=Math.max,kF=Math.min,TF=Zl([].concat),xd=Zl([].push),bv=Zl("".indexOf),Sv=Zl("".slice),$F=function(e){return e===void 0?e:String(e)},AF=function(){return"a".replace(/./,"$0")==="$0"}(),xv=function(){return/./[Ff]?/./[Ff]("a","$0")==="":!1}(),MF=!gF(function(){var e=/./;return e.exec=function(){var t=[];return t.groups={a:"7"},t},"".replace(e,"$<a>")!=="7"});pF("replace",function(e,t,n){var r=xv?"$":"$0";return[function(s,i){var a=xF(this),c=vF(s)?void 0:CF(s,Ff);return c?vv(c,s,a,i):vv(t,Ko(a),s,i)},function(o,s){var i=mF(this),a=Ko(o);if(typeof s=="string"&&bv(s,r)===-1&&bv(s,"$<")===-1){var c=n(t,i,a,s);if(c.done)return c.value}var l=yF(s);l||(s=Ko(s));var u=i.global,d;u&&(d=i.unicode,i.lastIndex=0);for(var f=[],p;p=EF(i,a),!(p===null||(xd(f,p),!u));){var v=Ko(p[0]);v===""&&(i.lastIndex=wF(a,SF(i.lastIndex),d))}for(var m="",y=0,b=0;b<f.length;b++){p=f[b];for(var x=Ko(p[0]),w=IF(kF(bF(p.index),a.length),0),S=[],C,P=1;P<p.length;P++)xd(S,$F(p[P]));var E=p.groups;if(l){var _=TF([x],S,w,a);E!==void 0&&xd(_,E),C=Ko(hF(s,void 0,_))}else C=PF(x,a,w,S,E,s);w>=y&&(m+=Sv(a,y,w)+C,y=w+x.length)}return m+Sv(a,y)}]},!MF||!AF||xv);var OF=Io,RF=zs,jF=gr,DF=jF("match"),NF=function(e){var t;return OF(e)&&((t=e[DF])!==void 0?!!t:RF(e)==="RegExp")},LF=pr,FF=Qr,BF=Ax,zF=pw,wv=RegExp.prototype,UF=function(e){var t=e.flags;return t===void 0&&!("flags"in wv)&&!FF(e,"flags")&&BF(wv,e)?LF(zF,e):t},VF=Ks,KF=pr,$p=st,Cv=Us,WF=It,HF=Gl,GF=NF,fi=ua,YF=hp,XF=UF,qF=vw,ZF=gr,QF=ZF("replace"),JF=TypeError,wd=$p("".indexOf);$p("".replace);var Pv=$p("".slice),e5=Math.max;VF({target:"String",proto:!0},{replaceAll:function(t,n){var r=Cv(this),o,s,i,a,c,l,u,d,f,p,v=0,m="";if(!HF(t)){if(o=GF(t),o&&(s=fi(Cv(XF(t))),!~wd(s,"g")))throw new JF("`.replaceAll` does not allow non-global regexes");if(i=YF(t,QF),i)return KF(i,t,r,n)}for(a=fi(r),c=fi(t),l=WF(n),l||(n=fi(n)),u=c.length,d=e5(1,u),f=wd(a,c);f!==-1;)p=l?fi(n(c,f,a)):qF(c,a,f,[],void 0,n),m+=Pv(a,v,f)+p,v=f+u,f=f+d>a.length?-1:wd(a,c,f+d);return v<a.length&&(m+=Pv(a,v)),m}});var t5=la;t5("String","replaceAll");function n5({size:e,width:t,height:n,hideAlternateHandles:r}){const o=L(e/3),s=o/2;return h.jsxs("svg",{className:"tl-overlays__item",children:[h.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${L(0-s)},${L(e)} 
						${L(0-s)},${L(0-s)} 
						${L(e)},${L(0-s)}`,strokeWidth:o,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),h.jsx("line",{className:ue("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:L(t/2-e),y1:L(0-s),x2:L(t/2+e),y2:L(0-s),strokeWidth:o,"data-testid":"selection.crop.top","aria-label":"top handle"}),h.jsx("polyline",{className:ue("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${L(t-e)},${L(0-s)} 
						${L(t+s)},${L(0-s)} 
						${L(t+s)},${L(e)}`,strokeWidth:o,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),h.jsx("line",{className:ue("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:L(t+s),y1:L(n/2-e),x2:L(t+s),y2:L(n/2+e),strokeWidth:o,"data-testid":"selection.crop.right","aria-label":"right handle"}),h.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${L(t+s)},${L(n-e)} 
						${L(t+s)},${L(n+s)}
						${L(t-e)},${L(n+s)}`,strokeWidth:o,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),h.jsx("line",{className:ue("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:L(t/2-e),y1:L(n+s),x2:L(t/2+e),y2:L(n+s),strokeWidth:o,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),h.jsx("polyline",{className:ue("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${L(0+e)},${L(n+s)} 
						${L(0-s)},${L(n+s)}
						${L(0-s)},${L(n-e)}`,strokeWidth:o,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),h.jsx("line",{className:ue("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:L(0-s),y1:L(n/2-e),x2:L(0-s),y2:L(n/2+e),strokeWidth:o,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const{PI:r5}=Math,hs=r5+1e-4;function o5(e,t={}){const{size:n=16,smoothing:r=.5}=t;if(e.length===0||n<=0)return{left:[],right:[]};const o=e[0],s=e[e.length-1],i=s.runningLength,a=Math.pow(n*r,2),c=[],l=[];let u=e[0].vector,d=e[0].point,f=d,p=d,v=f,m=!1,y;for(let b=0;b<e.length;b++){y=e[b];const{point:x,vector:w}=e[b],S=y.vector.dpr(u),C=(b<e.length-1?e[b+1]:e[b]).vector,P=b<e.length-1?C.dpr(y.vector):1,E=S<0&&!m,_=P!==null&&P<.2;if(E||_){if(P>-.62&&i-y.runningLength>y.radius){const T=u.clone().mul(y.radius);u.clone().cpr(C)<0?(p=k.Add(x,T),v=k.Sub(x,T)):(p=k.Sub(x,T),v=k.Add(x,T)),c.push(p),l.push(v)}else{const T=u.clone().mul(y.radius).per(),M=k.Sub(y.input,T);for(let O=1/13,j=0;j<1;j+=O)p=k.RotWith(M,y.input,hs*j),c.push(p),v=k.RotWith(M,y.input,hs+hs*-j),l.push(v)}d=p,f=v,_&&(m=!0);continue}if(m=!1,y===o||y===s){const T=k.Per(w).mul(y.radius);c.push(k.Sub(x,T)),l.push(k.Add(x,T));continue}const $=k.Lrp(C,w,P).per().mul(y.radius);p=k.Sub(x,$),(b<=1||k.Dist2(d,p)>a)&&(c.push(p),d=p),v=k.Add(x,$),(b<=1||k.Dist2(f,v)>a)&&(l.push(v),f=v),u=w}return{left:c,right:l}}function s5(e,t={}){const{size:n=16,start:r={},end:o={},last:s=!1}=t,{cap:i=!0}=r,{cap:a=!0}=o;if(e.length===0||n<=0)return[];const c=e[0],l=e[e.length-1],u=l.runningLength,d=r.taper===!1?0:r.taper===!0?Math.max(n,u):r.taper,f=o.taper===!1?0:o.taper===!0?Math.max(n,u):o.taper,{left:p,right:v}=o5(e,t),m=c.point,y=e.length>1?e[e.length-1].point:k.AddXY(c.point,1,1);if(e.length===1&&(!(d||f)||s)){const S=k.Add(m,k.Sub(m,y).uni().per().mul(-c.radius)),C=[];for(let P=1/13,E=P;E<=1;E+=P)C.push(k.RotWith(S,m,hs*2*E));return C}const b=[];if(!(d||f&&e.length===1))if(i)for(let S=1/8,C=S;C<=1;C+=S){const P=k.RotWith(v[0],m,hs*C);b.push(P)}else{const S=k.Sub(p[0],v[0]),C=k.Mul(S,.5),P=k.Mul(S,.51);b.push(k.Sub(m,C),k.Sub(m,P),k.Add(m,P),k.Add(m,C))}const x=[],w=l.vector.clone().per().neg();if(f||d&&e.length===1)x.push(y);else if(a){const S=k.Add(y,k.Mul(w,l.radius));for(let C=1/29,P=C;P<1;P+=C)x.push(k.RotWith(S,y,hs*3*P))}else x.push(k.Add(y,k.Mul(w,l.radius)),k.Add(y,k.Mul(w,l.radius*.99)),k.Sub(y,k.Mul(w,l.radius*.99)),k.Sub(y,k.Mul(w,l.radius)));return p.concat(x,v.reverse(),b)}const i5=.025,a5=.01;function c5(e,t={}){var y;const{streamline:n=.5,size:r=16,simulatePressure:o=!1}=t;if(e.length===0)return[];const s=.15+(1-n)*.85;let i=e.map(k.From),a=0;if(!o){let b=i[0];for(;b&&!(b.z>=i5);)i.shift(),b=i[0]}if(!o){let b=i[i.length-1];for(;b&&!(b.z>=a5);)i.pop(),b=i[i.length-1]}if(i.length===0)return[{point:k.From(e[0]),input:k.From(e[0]),pressure:o?.5:.15,vector:new k(1,1),distance:0,runningLength:0,radius:1}];let c=i[1];for(;c&&!(k.Dist(c,i[0])>r/3);)i[0].z=Math.max(i[0].z,c.z),i.splice(1,1),c=i[1];const l=i.pop();for(c=i[i.length-1];c&&!(k.Dist(c,l)>r/3);)i.pop(),c=i[i.length-1],a++;i.push(l);const u=t.last||!t.simulatePressure||i.length>1&&k.Dist(i[i.length-1],i[i.length-2])<r||a>0;if(i.length===2&&t.simulatePressure){const b=i[1];i=i.slice(0,-1);for(let x=1;x<5;x++){const w=k.Lrp(i[0],b,x/4);w.z=(i[0].z+(b.z-i[0].z))*x/4,i.push(w)}}const d=[{point:i[0],input:i[0],pressure:o?.5:i[0].z,vector:new k(1,1),distance:0,runningLength:0,radius:1}];let f=0,p=d[0],v,m;u&&n>0&&i.push(i[i.length-1].clone());for(let b=1,x=i.length;b<x;b++)v=!s||t.last&&b===x-1?i[b].clone():i[b].clone().lrp(p.point,1-s),!p.point.equals(v)&&(m=k.Dist(v,p.point),f+=m,!(b<4&&f<r)&&(p={input:i[b],point:v,pressure:o?.5:i[b].z,vector:k.Sub(p.point,v).uni(),distance:m,runningLength:f,radius:1},d.push(p)));if((y=d[1])!=null&&y.vector&&(d[0].vector=d[1].vector.clone()),f<1){const b=Math.max(.5,...d.map(x=>x.pressure));d.forEach(x=>x.pressure=b)}return d}const{min:Pr}=Math,Cd=.275;function l5(e,t){const{size:n=16,thinning:r=.5,simulatePressure:o=!0,easing:s=y=>y,start:i={},end:a={}}=t,{easing:c=Br.easeOutQuad}=i,{easing:l=Br.easeOutCubic}=a,u=e[e.length-1].runningLength;let d,f=e[0].pressure,p;if(!o&&u<n){const y=e.reduce((b,x)=>Math.max(b,x.pressure),.5);return e.forEach(b=>{b.pressure=y,b.radius=n*s(.5-r*(.5-b.pressure))}),e}else{let y;for(let b=0,x=e.length;b<x&&(p=e[b],!(p.runningLength>n*5));b++){const w=Pr(1,p.distance/n);if(o){const S=Pr(1,1-w);y=Pr(1,f+(S-f)*(w*Cd))}else y=Pr(1,f+(p.pressure-f)*.5);f=f+(y-f)*.5}for(let b=0;b<e.length;b++){if(p=e[b],r){let{pressure:x}=p;const w=Pr(1,p.distance/n);if(o){const S=Pr(1,1-w);x=Pr(1,f+(S-f)*(w*Cd))}else x=Pr(1,f+(x-f)*(w*Cd));p.radius=n*s(.5-r*(.5-x)),f=x}else p.radius=n/2;d===void 0&&(d=p.radius)}}const v=i.taper===!1?0:i.taper===!0?Math.max(n,u):i.taper,m=a.taper===!1?0:a.taper===!0?Math.max(n,u):a.taper;if(v||m)for(let y=0;y<e.length;y++){p=e[y];const{runningLength:b}=p,x=b<v?c(b/v):1,w=u-b<m?l((u-b)/m):1;p.radius=Math.max(.01,p.radius*Math.min(x,w))}return e}function gn(){const e=U();return Y("isReadonlyMode",()=>e.getInstanceState().isReadonly,[e])}const cX=Te(function({bounds:t,rotation:n}){const r=U(),o=g.useRef(null),s=gn(),i=On("top"),a=On("right"),c=On("bottom"),l=On("left"),u=On("top_left"),d=On("top_right"),f=On("bottom_right"),p=On("bottom_left"),v=!r.getIsMenuOpen()&&r.getInstanceState().cursor.type==="default",m=r.getInstanceState().isCoarsePointer,y=r.getSelectedShapes(),b=r.getOnlySelectedShape(),x=b&&r.isShapeOrAncestorLocked(b),w=b?r.getShapeUtil(b).expandSelectionOutlinePx(b):0;if(Ls(o,t==null?void 0:t.x,t==null?void 0:t.y,1,r.getSelectionRotation(),{x:-w,y:-w}),!t)return null;t=t.clone().expandBy(w).zeroFix();const S=r.getZoomLevel(),C=r.getInstanceState().isChangingStyle,P=t.width,E=t.height,_=8/S,$=P<_*2,T=E<_*2,M=P<_*4,O=E<_*4,j=P<_*5,N=E<_*5,B=m?1.75:1,D=6/S*B,G=(M?D/2:D)*(B*.75),V=(O?D/2:D)*(B*.75),z=y.every(Tn=>r.getShapeUtil(Tn).canResize(Tn)),W=y.every(Tn=>!r.getShapeUtil(Tn).hideRotateHandle(Tn)),Q=(b?!r.getShapeUtil(b).hideSelectionBoundsFg(b):!0)&&!C;let oe=Q&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||Q&&r.isIn("select.resizing")&&b&&r.isShapeOfType(b,"text");b&&oe&&r.environment.isFirefox&&r.isShapeOfType(b,"embed")&&(oe=!1);const se=r.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!C&&!s,ye=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!C&&!s,ee=!m&&!($||T)&&(ye||se)&&(b?!r.getShapeUtil(b).hideRotateHandle(b):W)&&!x,be=m&&(!M||!O)&&(ye||se)&&(b?!r.getShapeUtil(b).hideRotateHandle(b):W)&&!x,Se=ye&&(b?r.getShapeUtil(b).canResize(b)&&!r.getShapeUtil(b).hideResizeHandles(b):z)&&!se&&!x,Ie=$||T,de=$&&T,Ee=j||N,xe=Se||se,Qe=!ee,Fe=!ye||!be,et=!ye||!xe,Oe=!ye||!xe||Ie,tt=!ye||!xe||Ie,kn=!ye||!xe||de&&!se;let vn=m;vn&&y.every(Tn=>r.getShapeUtil(Tn).isAspectRatioLocked(Tn))&&(vn=!1);let Je=!0;se?Je=Ee:Se&&(Je=Ie||de||vn);const Yn=Math.min(24/S,E-V*3),br=ye&&m&&b&&r.isShapeOfType(b,"text")&&Yn*S>=4;return h.jsx("svg",{className:"tl-overlays__item tl-selection__fg tl-svg-context","data-testid":"selection-foreground",children:h.jsxs("g",{ref:o,children:[oe&&h.jsx("rect",{className:ue("tl-selection__fg__outline"),width:L(P),height:L(E)}),h.jsx(qa,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:D,corner:"top_left_rotate",cursor:v?Ft("nwse-rotate",n):void 0,isHidden:Qe}),h.jsx(qa,{"data-testid":"selection.rotate.top-right",cx:P+D*3,cy:0,targetSize:D,corner:"top_right_rotate",cursor:v?Ft("nesw-rotate",n):void 0,isHidden:Qe}),h.jsx(qa,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:E+D*3,targetSize:D,corner:"bottom_left_rotate",cursor:v?Ft("swne-rotate",n):void 0,isHidden:Qe}),h.jsx(qa,{"data-testid":"selection.rotate.bottom-right",cx:P+D*3,cy:E+D*3,targetSize:D,corner:"bottom_right_rotate",cursor:v?Ft("senw-rotate",n):void 0,isHidden:Qe}),h.jsx(d5,{"data-testid":"selection.rotate.mobile",cx:M?-D*1.5:P/2,cy:M?E/2:-D*1.5,size:_,isHidden:Fe}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":Je}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:L(0-(O?V*2:V)),width:L(P),height:L(Math.max(1,V*2)),style:v?{cursor:Ft("ns-resize",n)}:void 0,...i}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":Je}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:L(P-(M?0:G)),y:0,height:L(E),width:L(Math.max(1,G*2)),style:v?{cursor:Ft("ew-resize",n)}:void 0,...a}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":Je}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:L(E-(O?0:V)),width:L(P),height:L(Math.max(1,V*2)),style:v?{cursor:Ft("ns-resize",n)}:void 0,...c}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":Je}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:L(0-(M?G*2:G)),y:0,height:L(E),width:L(Math.max(1,G*2)),style:v?{cursor:Ft("ew-resize",n)}:void 0,...l}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:L(0-(M?G*2:G*1.5)),y:L(0-(O?V*2:V*1.5)),width:L(G*3),height:L(V*3),style:v?{cursor:Ft("nwse-resize",n)}:void 0,...u}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":Oe}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:L(P-(M?0:G*1.5)),y:L(0-(O?V*2:V*1.5)),width:L(G*3),height:L(V*3),style:v?{cursor:Ft("nesw-resize",n)}:void 0,...d}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":kn}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:L(P-(M?G:G*1.5)),y:L(E-(O?V:V*1.5)),width:L(G*3),height:L(V*3),style:v?{cursor:Ft("nwse-resize",n)}:void 0,...f}),h.jsx("rect",{className:ue("tl-transparent",{"tl-hidden":tt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:L(0-(M?G*3:G*1.5)),y:L(E-(O?0:V*1.5)),width:L(G*3),height:L(V*3),style:v?{cursor:Ft("nesw-resize",n)}:void 0,...p}),Se&&h.jsxs(h.Fragment,{children:[h.jsx("rect",{"data-testid":"selection.resize.top-left",className:ue("tl-corner-handle",{"tl-hidden":et}),"aria-label":"top_left handle",x:L(0-_/2),y:L(0-_/2),width:L(_),height:L(_)}),h.jsx("rect",{"data-testid":"selection.resize.top-right",className:ue("tl-corner-handle",{"tl-hidden":Oe}),"aria-label":"top_right handle",x:L(P-_/2),y:L(0-_/2),width:L(_),height:L(_)}),h.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:ue("tl-corner-handle",{"tl-hidden":kn}),"aria-label":"bottom_right handle",x:L(P-_/2),y:L(E-_/2),width:L(_),height:L(_)}),h.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:ue("tl-corner-handle",{"tl-hidden":tt}),"aria-label":"bottom_left handle",x:L(0-_/2),y:L(E-_/2),width:L(_),height:L(_)})]}),br&&h.jsxs(h.Fragment,{children:[h.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:L(0-_/4),y:L(E/2-Yn/2),rx:_/4,width:L(_/2),height:L(Yn)}),h.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:_/4,x:L(P-_/4),y:L(E/2-Yn/2),width:L(_/2),height:L(Yn)})]}),se&&h.jsx(n5,{size:_,width:P,height:E,hideAlternateHandles:Ee})]})})}),qa=function({cx:t,cy:n,targetSize:r,corner:o,cursor:s,isHidden:i,"data-testid":a}){const c=On(o);return h.jsx("rect",{className:ue("tl-transparent","tl-rotate-corner",{"tl-hidden":i}),"data-testid":a,"aria-label":`${o} target`,pointerEvents:"all",x:L(t-r*3),y:L(n-r*3),width:L(Math.max(1,r*3)),height:L(Math.max(1,r*3)),cursor:s,...c})},u5=Math.sqrt(Math.PI),d5=function({cx:t,cy:n,size:r,isHidden:o,"data-testid":s}){const i=On("mobile_rotate"),a=U(),c=Y("zoom level",()=>a.getZoomLevel(),[a]),l=Math.max(14*(1/c),20/Math.max(1,c));return h.jsxs("g",{children:[h.jsx("circle",{"data-testid":s,pointerEvents:"all",className:ue("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":o}),cx:t,cy:n,r:l,...i}),h.jsx("circle",{className:ue("tl-mobile-rotate__fg",{"tl-hidden":o}),cx:t,cy:n,r:r/u5})]})},Bf={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Ql={s:2,m:3.5,l:5,xl:10},lX={s:18,m:24,l:36,xl:44},uX={s:18,m:22,l:26,xl:32},Ev={s:18,m:20,l:24,xl:28},dX={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};function fX(){return Dl({isDarkMode:Vl()})}const Jt=Z.memo(function({d:t,color:n,fill:r,theme:o}){if(typeof o<"u")switch(r){case"none":return null;case"solid":return h.jsx("path",{fill:o[n].semi,d:t});case"semi":return h.jsx("path",{fill:o.solid,d:t})}switch(r){case"none":return null;default:return h.jsx("path",{fill:n,d:t})}});function en({d:e,color:t,fill:n}){if(n==="none")return;const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r.setAttribute("fill",t),r}function tn(e,t){if(t){const n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(t),n.appendChild(e),n}else return e}function zn(e,t,n={}){const{closed:r=!1,snap:o=1,start:s="outset",end:i="outset",lengthRatio:a=2,style:c="dashed"}=n;let l=0,u=0,d=1,f=0,p=0;switch(c){case"dashed":{d=1,l=Math.min(t*a,e/4);break}case"dotted":{d=100,l=t/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(e+=l/2,p+=l/2):s==="skip"&&(e-=l,p-=l),i==="outset"?e+=l/2:i==="skip"&&(e-=l)),u=Math.floor(e/l/(2*d)),u-=u%o,u<3&&c==="dashed"?e/t<5?(l=e,u=1,f=0):(l=e*.333,f=e*.333):(u=Math.max(u,3),l=e/u/(2*d),r?(p=l/2,f=(e-u*l)/u):f=(e-u*l)/Math.max(1,u-1)),{strokeDasharray:[l,f].join(" "),strokeDashoffset:p.toString()}}const ss="  ",St=class St{static insertTextFirefox(t,n){t.setRangeText(n,t.selectionStart||0,t.selectionEnd||0,"end"),t.dispatchEvent(new InputEvent("input",{data:n,inputType:"insertText",isComposing:!1}))}static insert(t,n){const r=t.ownerDocument,o=r.activeElement;o!==t&&t.focus(),r.execCommand("insertText",!1,n)||St.insertTextFirefox(t,n),o===r.body?t.blur():o instanceof HTMLElement&&o!==t&&o.focus()}static set(t,n){t.select(),St.insert(t,n)}static getSelection(t){const{selectionStart:n,selectionEnd:r}=t;return t.value.slice(n||void 0,r||void 0)}static wrapSelection(t,n,r){const{selectionStart:o,selectionEnd:s}=t,i=St.getSelection(t);St.insert(t,n+i+(r??n)),t.selectionStart=(o||0)+n.length,t.selectionEnd=(s||0)+n.length}static replace(t,n,r){let o=0;t.value.replace(n,(...s)=>{const i=o+s[s.length-2],a=s[0].length;t.selectionStart=i,t.selectionEnd=i+a;const c=typeof r=="string"?r:r(...s);return St.insert(t,c),t.selectionStart=i,o+=c.length-a,c})}static findLineEnd(t,n){const r=t.lastIndexOf(`
`,n-1)+1;return t.charAt(r)!=="	"?n:r+1}static indent(t){var a;const{selectionStart:n,selectionEnd:r,value:o}=t,s=o.slice(n,r),i=(a=/\n/g.exec(s))==null?void 0:a.length;if(i&&i>0){const c=o.lastIndexOf(`
`,n-1)+1,l=t.value.slice(c,r-1),u=l.replace(/^|\n/g,`$&${ss}`),d=u.length-l.length;t.setSelectionRange(c,r-1),St.insert(t,u),t.setSelectionRange(n+1,r+d)}else St.insert(t,ss)}static unindent(t){const{selectionStart:n,selectionEnd:r,value:o}=t,s=o.lastIndexOf(`
`,n-1)+1,i=St.findLineEnd(o,r),a=t.value.slice(s,i),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=a.length-c.length;t.setSelectionRange(s,i),St.insert(t,c);const u=/\t| {1,2}/.exec(o.slice(s,n)),d=u?u[0].length:0,f=n-d;t.setSelectionRange(n-d,Math.max(f,r-l))}static indentCE(t){var c;const n=window.getSelection(),r=t.innerText,o=Za(t)??0,s=Za(t)??0,i=r.slice(o,s),a=(c=/\n/g.exec(i))==null?void 0:c.length;if(a&&a>0){const l=r.lastIndexOf(`
`,o-1)+1,u=r.slice(l,s-1),f=u.replace(/^|\n/g,`$&${ss}`).length-u.length;n&&n.setBaseAndExtent(t,o+1,t,s+f)}else{const l=window.getSelection();t.innerText=r.slice(0,o)+ss+r.slice(o),l==null||l.setBaseAndExtent(t,o+1,t,o+2)}}static unindentCE(t){const n=window.getSelection(),r=t.innerText,o=Za(t)??0,s=Za(t)??0,i=r.lastIndexOf(`
`,o-1)+1,a=St.findLineEnd(r,s),c=r.slice(i,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-l.length;if(n){n.setBaseAndExtent(t,i,t,a);const d=/\t| {1,2}/.exec(r.slice(i,o)),f=d?d[0].length:0,p=o-f;n.setBaseAndExtent(t,o-f,t,Math.max(p,s-u))}}static normalizeText(t){return t.replace(St.fixNewLines,`
`)}static normalizeTextForDom(t){return t.replace(St.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}};I(St,"fixNewLines",/\r?\n|\r/g);let Rr=St;function Za(e){if(typeof window.getSelection>"u")return;const t=window.getSelection();if(!t)return;let n=0;if(t.rangeCount!==0){const r=t.getRangeAt(0),o=r.cloneRange();o.selectNodeContents(e),o.setEnd(r.endContainer,r.endOffset),n=o.toString().length}return n}function bw(e,t,n){const r=U(),o=g.useRef(null),s=g.useRef(!1),i=g.useRef(),a=Y("isEditing",()=>r.getEditingShapeId()===e,[r,e]);g.useEffect(()=>{const m=o.current;m&&a&&document.activeElement!==m&&m.focus()},[a]);const c=g.useCallback(()=>{const m=s.current;s.current=!1,requestAnimationFrame(()=>{const y=o.current;if(!y)return;const b=r.getShape(e);b&&(y.value=b.props.text,y.value.length&&!m&&y.select())})},[r,e]),l=g.useCallback(()=>{const m=i.current;requestAnimationFrame(()=>{var x;const y=o.current,b=r.getEditingShapeId();if(y&&b){if(b===e)if(m)if(!m.length)y.focus();else{s.current=!0,y.focus();const w=window.getSelection();w&&m.forEach(S=>w.addRange(S))}else y.focus()}else(x=window.getSelection())==null||x.removeAllRanges(),r.complete()})},[r,e]),u=g.useCallback(m=>{if(a)switch((m.ctrlKey||m.metaKey)&&Ct(m),m.key){case"Enter":{(m.ctrlKey||m.metaKey)&&r.complete();break}case"Tab":{_e(m),m.shiftKey?Rr.unindent(m.currentTarget):Rr.indent(m.currentTarget);break}}},[r,a]),d=g.useCallback(m=>{if(!a)return;let y=Rr.normalizeText(m.currentTarget.value);const b=y.replace(/\t/g,ss);if(b!==y){const x=m.currentTarget.selectionStart;m.currentTarget.value=b,m.currentTarget.selectionStart=x+(b.length-y.length),m.currentTarget.selectionEnd=x+(b.length-y.length),y=b}r.updateShapes([{id:e,type:t,props:{text:y}}])},[r,e,t,a]),f=n.trim().length===0;g.useEffect(()=>{if(!a)return;if(o.current){let y=function(){var x,w;const b=(x=window.getSelection)==null?void 0:x.call(window);if(b&&b.type!=="None"){const S=[];if(b)for(let C=0;C<b.rangeCount;C++)S.push((w=b.getRangeAt)==null?void 0:w.call(b,C));i.current=S}};return document.addEventListener("selectionchange",y),()=>{document.removeEventListener("selectionchange",y)}}},[a]);const p=g.useCallback(m=>{r.dispatch({...Ht(m),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e)}),Ct(m)},[r,e]);return{rInput:o,isEditing:a,handleFocus:c,handleBlur:l,handleKeyDown:u,handleChange:d,handleInputPointerDown:p,handleDoubleClick:Ct,isEmpty:f}}const hX=g.memo(function({id:t,text:n,size:r,font:o,position:s,width:i,labelColor:a}){const{rInput:c,isEditing:l,handleFocus:u,handleBlur:d,handleKeyDown:f,handleChange:p,isEmpty:v,handleInputPointerDown:m,handleDoubleClick:y}=bw(t,"arrow",n),x=Rr.normalizeTextForDom(n).trim().length>0;return!l&&!x?null:h.jsx("div",{className:"tl-arrow-label","data-font":o,"data-align":"center","data-hastext":!v,"data-isediting":l,style:{textAlign:"center",fontSize:Ev[r],lineHeight:Ev[r]*Bf.lineHeight+"px",transform:`translate(${s.x}px, ${s.y}px)`,color:a},children:h.jsxs("div",{className:"tl-arrow-label__inner",children:[h.jsx("p",{style:{width:i||"9px"},children:n?Rr.normalizeTextForDom(n):" "}),l&&h.jsx("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:u,onChange:p,onKeyDown:f,onBlur:d,onContextMenu:Ct,onPointerDown:m,onDoubleClick:y})]})})}),f5=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function pX(e){return f5.test(e)}function h5(e){return e.replace(/\t/g,ss)}function p5(e){const t=e.split(`
`);for(;t[0]&&t[0].trim().length===0;)t.shift();let n=1/0;for(const r of t)if(r.trim().length>0){const o=r.length-r.trimStart().length;n=Math.min(n,o)}return t.map(r=>r.slice(n)).join(`
`)}function g5(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function gX(e){return g5(p5(h5(e)))}const Pd=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...",_v="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Sw({url:e,zoomLevel:t}){return h.jsx("a",{className:ue("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:Ct,onPointerUp:Ct,title:e,draggable:!1,children:h.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${_v}") center 100% / 100% no-repeat`,WebkitMask:`url("${_v}") center 100% / 100% no-repeat`}})})}const m5=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function y5(e){return m5.map(n=>{const{offsetX:r,offsetY:o,blur:s,spread:i,color:a}=n,c=new k(r,o),{x:l,y:u}=c.rot(-e);return`${l}px ${u}px ${s}px ${i}px ${a}`}).join(", ")}class Ed extends Cx{constructor(){super(...arguments);I(this,"canResize",()=>!1);I(this,"hideSelectionBoundsFg",()=>!0);I(this,"onBeforeCreate",n=>{Iv(this.editor,n)});I(this,"onBeforeUpdate",(n,r)=>{if(n.props.url!==r.props.url)if(gf(r.props.url))Iv(this.editor,r);else return{...r,props:{...r.props,url:n.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(n){const r=n.props.assetId?this.editor.getAsset(n.props.assetId):null,o=this.editor.getShapePageTransform(n).rotation(),s=v5(n);return h.jsx(wx,{children:h.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:y5(o)},children:[h.jsxs("div",{className:"tl-bookmark__image_container",children:[r!=null&&r.props.image?h.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):h.jsx("div",{className:"tl-bookmark__placeholder"}),h.jsx(Sw,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]}),h.jsxs("div",{className:"tl-bookmark__copy_container",children:[(r==null?void 0:r.props.title)&&h.jsx("h2",{className:"tl-bookmark__heading",children:Pd((r==null?void 0:r.props.title)||"",54)}),(r==null?void 0:r.props.description)&&h.jsx("p",{className:"tl-bookmark__description",children:Pd((r==null?void 0:r.props.description)||"",128)}),h.jsx("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Ct,onPointerUp:Ct,onClick:Ct,children:Pd(s,45)})]})]})})}indicator(n){return h.jsx("rect",{width:L(n.props.w),height:L(n.props.h),rx:"6",ry:"6"})}}I(Ed,"type","bookmark"),I(Ed,"props",Xk),I(Ed,"migrations",qk);const v5=e=>{try{const t=new URL(e.props.url),n=t.pathname.replace(/\/*$/,"");return`${t.hostname}${n}`}catch{return e.props.url}};function Iv(e,t){const{url:n}=t.props,r=Ol.createId(TI(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),b5(e,t))}const b5=lS(async(e,t)=>{const{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.batch(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function mX(e,t,n,r){if((e==="start-legacy"||e==="end-legacy")&&n.length!==0){const o=ce.From(n[0].box);for(const{box:s}of n)o.union(s);if(e==="start-legacy")return(r-2*t-o.width)/2;if(e==="end-legacy")return-(r-2*t-o.width)/2}}function S5(e){return e==="start-legacy"||e==="middle-legacy"||e==="end-legacy"}const yX=Z.memo(function({id:t,type:n,text:r,textColor:o,font:s,richFont:i,writingMode:a,align:c,verticalAlign:l,fontSize:u,wrap:d,bounds:f,textStrokeColor:p}){const{rInput:v,isEmpty:m,isEditing:y,handleFocus:b,handleChange:x,handleKeyDown:w,handleBlur:S,handleInputPointerDown:C,handleDoubleClick:P}=bw(t,n,r),E=Rr.normalizeTextForDom(r),_=E.length>0,$=S5(c);if(!y&&!_)return null;const T=p||"#fff";return h.jsx("div",{className:"tl-text-label","data-font":s,"data-align":c,"data-hastext":!m,"data-isediting":y,"data-textwrap":!!d,style:{justifyContent:c==="middle"||$?"center":c,alignItems:l==="middle"?"center":l,writingMode:a,...f?{top:f.minY,left:f.minX,width:f.width,height:f.height,position:"absolute"}:{},...i?{fontFamily:`"${i}"`}:{}},children:h.jsxs("div",{className:"tl-text-label__inner",style:{fontSize:u,lineHeight:u*Bf.lineHeight+"px",minHeight:Bf.lineHeight+32,minWidth:0,color:o,textShadow:`0 var(--b) 0 ${T}, 0 var(--a) 0 ${T},
                                              var(--b) var(--b) 0 ${T}, var(--a) var(--b) 0 ${T},
                                              var(--a) var(--a) 0 ${T}, var(--b) var(--a) 0 ${T}`},children:[h.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",children:E}),y&&h.jsx("textarea",{ref:v,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:r,onFocus:b,onChange:x,onKeyDown:w,onBlur:S,onContextMenu:Ct,onPointerDown:C,onDoubleClick:P})]})})});function x5(e,t=!1){const n=e.length;if(n<2)return"";let r=e[0].point,o=e[1].point;if(n===2)return`M${cn(r)}L${cn(o)}`;let s="";for(let i=2,a=n-1;i<a;i++)r=e[i].point,o=e[i+1].point,s+=ln(r,o);return t?`M${ln(e[0].point,e[1].point)}Q${cn(e[1].point)}${ln(e[1].point,e[2].point)}T${s}${ln(e[n-1].point,e[0].point)}${ln(e[0].point,e[1].point)}Z`:`M${cn(e[0].point)}Q${cn(e[1].point)}${ln(e[1].point,e[2].point)}${e.length>3?"T":""}${s}L${cn(e[n-1].point)}`}function w5(e){if(typeof e!="string")throw new TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function C5(e){const t=new URL(e).host.replace("www.","");for(const n of Ps)if(xw(n.hostnames,t)){const r=n.fromEmbedUrl(e);if(r)return{definition:n,url:r,embedUrl:e}}}const P5=e=>e.split("*").map(t=>w5(t)).join(".+"),xw=(e,t)=>!!e.find(n=>{const r=new RegExp(P5(n));return t.match(r)});function E5(e){const t=new URL(e).host.replace("www.","");for(const n of Ps)if(xw(n.hostnames,t)){const r=n.toEmbedUrl(e);if(r)return{definition:n,embedUrl:r,url:e}}}function _5(e){return E5(e)??C5(e)}function Ap(e){try{return _5(e)}catch(t){console.error(t)}}var Mp={exports:{}};Mp.exports;(function(e){(function(t,n,r){function o(c){var l=this,u=a();l.next=function(){var d=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=d-(l.c=d|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(c),l.s0<0&&(l.s0+=1),l.s1-=u(c),l.s1<0&&(l.s1+=1),l.s2-=u(c),l.s2<0&&(l.s2+=1),u=null}function s(c,l){return l.c=c.c,l.s0=c.s0,l.s1=c.s1,l.s2=c.s2,l}function i(c,l){var u=new o(c),d=l&&l.state,f=u.next;return f.int32=function(){return u.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,d&&(typeof d=="object"&&s(d,u),f.state=function(){return s(u,{})}),f}function a(){var c=4022871197,l=function(u){u=String(u);for(var d=0;d<u.length;d++){c+=u.charCodeAt(d);var f=.02519603282416938*c;c=f>>>0,f-=c,f*=c,c=f>>>0,f-=c,c+=f*4294967296}return(c>>>0)*23283064365386963e-26};return l}n.exports?n.exports=i:this.alea=i})(Ue,e)})(Mp);var I5=Mp.exports,Op={exports:{}};Op.exports;(function(e){(function(t,n,r){function o(a){var c=this,l="";c.x=0,c.y=0,c.z=0,c.w=0,c.next=function(){var d=c.x^c.x<<11;return c.x=c.y,c.y=c.z,c.z=c.w,c.w^=c.w>>>19^d^d>>>8},a===(a|0)?c.x=a:l+=a;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,c.next()}function s(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c}function i(a,c){var l=new o(a),u=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,v=(f+p)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,u&&(typeof u=="object"&&s(u,l),d.state=function(){return s(l,{})}),d}n.exports?n.exports=i:this.xor128=i})(Ue,e)})(Op);var k5=Op.exports,Rp={exports:{}};Rp.exports;(function(e){(function(t,n,r){function o(a){var c=this,l="";c.next=function(){var d=c.x^c.x>>>2;return c.x=c.y,c.y=c.z,c.z=c.w,c.w=c.v,(c.d=c.d+362437|0)+(c.v=c.v^c.v<<4^(d^d<<1))|0},c.x=0,c.y=0,c.z=0,c.w=0,c.v=0,a===(a|0)?c.x=a:l+=a;for(var u=0;u<l.length+64;u++)c.x^=l.charCodeAt(u)|0,u==l.length&&(c.d=c.x<<10^c.x>>>4),c.next()}function s(a,c){return c.x=a.x,c.y=a.y,c.z=a.z,c.w=a.w,c.v=a.v,c.d=a.d,c}function i(a,c){var l=new o(a),u=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,v=(f+p)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,u&&(typeof u=="object"&&s(u,l),d.state=function(){return s(l,{})}),d}n.exports?n.exports=i:this.xorwow=i})(Ue,e)})(Rp);var T5=Rp.exports,jp={exports:{}};jp.exports;(function(e){(function(t,n,r){function o(a){var c=this;c.next=function(){var u=c.x,d=c.i,f,p;return f=u[d],f^=f>>>7,p=f^f<<24,f=u[d+1&7],p^=f^f>>>10,f=u[d+3&7],p^=f^f>>>3,f=u[d+4&7],p^=f^f<<7,f=u[d+7&7],f=f^f<<13,p^=f^f<<9,u[d]=p,c.i=d+1&7,p};function l(u,d){var f,p=[];if(d===(d|0))p[0]=d;else for(d=""+d,f=0;f<d.length;++f)p[f&7]=p[f&7]<<15^d.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],u.x=p,u.i=0,f=256;f>0;--f)u.next()}l(c,a)}function s(a,c){return c.x=a.x.slice(),c.i=a.i,c}function i(a,c){a==null&&(a=+new Date);var l=new o(a),u=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,v=(f+p)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,u&&(u.x&&s(u,l),d.state=function(){return s(l,{})}),d}n.exports?n.exports=i:this.xorshift7=i})(Ue,e)})(jp);var $5=jp.exports,Dp={exports:{}};Dp.exports;(function(e){(function(t,n,r){function o(a){var c=this;c.next=function(){var u=c.w,d=c.X,f=c.i,p,v;return c.w=u=u+1640531527|0,v=d[f+34&127],p=d[f=f+1&127],v^=v<<13,p^=p<<17,v^=v>>>15,p^=p>>>12,v=d[f]=v^p,c.i=f,v+(u^u>>>16)|0};function l(u,d){var f,p,v,m,y,b=[],x=128;for(d===(d|0)?(p=d,d=null):(d=d+"\0",p=0,x=Math.max(x,d.length)),v=0,m=-32;m<x;++m)d&&(p^=d.charCodeAt((m+32)%d.length)),m===0&&(y=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(y=y+1640531527|0,f=b[m&127]^=p+y,v=f==0?v+1:0);for(v>=128&&(b[(d&&d.length||0)&127]=-1),v=127,m=4*128;m>0;--m)p=b[v+34&127],f=b[v=v+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,b[v]=p^f;u.w=y,u.X=b,u.i=v}l(c,a)}function s(a,c){return c.i=a.i,c.w=a.w,c.X=a.X.slice(),c}function i(a,c){a==null&&(a=+new Date);var l=new o(a),u=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,v=(f+p)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,u&&(u.X&&s(u,l),d.state=function(){return s(l,{})}),d}n.exports?n.exports=i:this.xor4096=i})(Ue,e)})(Dp);var A5=Dp.exports,Np={exports:{}};Np.exports;(function(e){(function(t,n,r){function o(a){var c=this,l="";c.next=function(){var d=c.b,f=c.c,p=c.d,v=c.a;return d=d<<25^d>>>7^f,f=f-p|0,p=p<<24^p>>>8^v,v=v-d|0,c.b=d=d<<20^d>>>12^f,c.c=f=f-p|0,c.d=p<<16^f>>>16^v,c.a=v-d|0},c.a=0,c.b=0,c.c=-1640531527,c.d=1367130551,a===Math.floor(a)?(c.a=a/4294967296|0,c.b=a|0):l+=a;for(var u=0;u<l.length+20;u++)c.b^=l.charCodeAt(u)|0,c.next()}function s(a,c){return c.a=a.a,c.b=a.b,c.c=a.c,c.d=a.d,c}function i(a,c){var l=new o(a),u=c&&c.state,d=function(){return(l.next()>>>0)/4294967296};return d.double=function(){do var f=l.next()>>>11,p=(l.next()>>>0)/4294967296,v=(f+p)/(1<<21);while(v===0);return v},d.int32=l.next,d.quick=d,u&&(typeof u=="object"&&s(u,l),d.state=function(){return s(l,{})}),d}n.exports?n.exports=i:this.tychei=i})(Ue,e)})(Np);var M5=Np.exports,ww={exports:{}};(function(e){(function(t,n,r){var o=256,s=6,i=52,a="random",c=r.pow(o,s),l=r.pow(2,i),u=l*2,d=o-1,f;function p(S,C,P){var E=[];C=C==!0?{entropy:!0}:C||{};var _=b(y(C.entropy?[S,w(n)]:S??x(),3),E),$=new v(E),T=function(){for(var M=$.g(s),O=c,j=0;M<l;)M=(M+j)*o,O*=o,j=$.g(1);for(;M>=u;)M/=2,O/=2,j>>>=1;return(M+j)/O};return T.int32=function(){return $.g(4)|0},T.quick=function(){return $.g(4)/4294967296},T.double=T,b(w($.S),n),(C.pass||P||function(M,O,j,N){return N&&(N.S&&m(N,$),M.state=function(){return m($,{})}),j?(r[a]=M,O):M})(T,_,"global"in C?C.global:this==r,C.state)}function v(S){var C,P=S.length,E=this,_=0,$=E.i=E.j=0,T=E.S=[];for(P||(S=[P++]);_<o;)T[_]=_++;for(_=0;_<o;_++)T[_]=T[$=d&$+S[_%P]+(C=T[_])],T[$]=C;(E.g=function(M){for(var O,j=0,N=E.i,B=E.j,D=E.S;M--;)O=D[N=d&N+1],j=j*o+D[d&(D[N]=D[B=d&B+O])+(D[B]=O)];return E.i=N,E.j=B,j})(o)}function m(S,C){return C.i=S.i,C.j=S.j,C.S=S.S.slice(),C}function y(S,C){var P=[],E=typeof S,_;if(C&&E=="object")for(_ in S)try{P.push(y(S[_],C-1))}catch{}return P.length?P:E=="string"?S:S+"\0"}function b(S,C){for(var P=S+"",E,_=0;_<P.length;)C[d&_]=d&(E^=C[d&_]*19)+P.charCodeAt(_++);return w(C)}function x(){try{var S;return f&&(S=f.randomBytes)?S=S(o):(S=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(S)),w(S)}catch{var C=t.navigator,P=C&&C.plugins;return[+new Date,t,P,t.screen,w(n)]}}function w(S){return String.fromCharCode.apply(0,S)}if(b(r.random(),n),e.exports){e.exports=p;try{f=nI}catch{}}else r["seed"+a]=p})(typeof self<"u"?self:Ue,[],Math)})(ww);var O5=ww.exports,R5=I5,j5=k5,D5=T5,N5=$5,L5=A5,F5=M5,$o=O5;$o.alea=R5;$o.xor128=j5;$o.xorwow=D5;$o.xorshift7=N5;$o.xor4096=L5;$o.tychei=F5;var B5=$o;const vX=As(B5);function z5(e){return h.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:h.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[h.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),h.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:h.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function U5(){const[e,t]=g.useState(!1);return g.useEffect(()=>{const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{t(n.matches)};return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),e}function ft(e){return`${L(e.x)},${L(e.y)} `}function Cw(e=""){let t=0,n=0,r=0,o=0;function s(){const i=t^t<<11;return t=n,n=r,r=o,o^=(o>>>19^i^i>>>8)>>>0,o/4294967296*2}for(let i=0;i<e.length+64;i++)t^=e.charCodeAt(i)|0,s();return s}function hl(e){let t="M";const n=e.length;let r,o,s;for(let i=0,a=n;i<a;i+=3)r=e[i],o=e[i+1],s=e[i+2],t+=`${ft(r)}L${ft(o)}Q${ft(s)}`;return t+=`${ft(e[0])}`,t}function pl(e,t,n,r,o){const s=[],i=Cw(e);let a=t[0],c;const l=t.length;for(let u=0,d=l*o;u<d;u++){c=k.AddXY(t[(u+1)%l],i()*n,i()*n);const f=k.Sub(c,a),p=k.Len(f),v=k.Div(f,p).mul(Math.min(p/4,r));s.push(k.Add(a,v),k.Add(c,v.neg()),c),a=c}return s}function bX(e,t,n){let r=`M ${ft(t[0])}L`,o=`M ${ft(t[0])}L`;const s=n/3,i=n*2,a=Cw(e);let c=t[0],l,u=t[0],d;const f=t.length;for(let p=0,v=f-1;p<v;p++){l=t[p+1],d=k.AddXY(t[p+1],a()*s,a()*s);const m=k.Sub(l,c),y=k.Len(m),b=k.Div(m,y).mul(Math.min(y/4,i)),x=k.Add(c,b),w=k.Add(l,b.neg()),S=k.Sub(d,u),C=k.Len(S),P=k.Div(S,C).mul(Math.min(C/4,i)),E=k.Add(u,P),_=k.Add(d,P.neg());p===v-1?(r+=`${ft(x)}L ${ft(l)}`,o+=`${ft(E)}L ${ft(d)}`):(r+=`${ft(x)}L ${ft(w)}Q ${ft(l)}`,o+=`${ft(E)}L ${ft(_)}Q ${ft(d)}`,c=l,u=d)}return[r,r+o]}function kv(e,t){const n=Math.min(e,t)/2,r=Math.max(e,t)-n*2;return Math.PI*(n*2)+2*r}function V5(e,t,n){const r=Math.min(e,t)/2,o=Math.max(e,t)-r*2,i=(Math.PI*(r*2)+2*o)/n,a=e>t?[{type:"straight",start:new k(r,0),delta:new k(1,0)},{type:"arc",center:new k(e-r,r),startAngle:-xt/2},{type:"straight",start:new k(e-r,t),delta:new k(-1,0)},{type:"arc",center:new k(r,r),startAngle:xt/2}]:[{type:"straight",start:new k(e,r),delta:new k(0,1)},{type:"arc",center:new k(r,t-r),startAngle:0},{type:"straight",start:new k(0,t-r),delta:new k(0,-1)},{type:"arc",center:new k(r,r),startAngle:xt}];let c=0;const l=[];for(let u=0;u<n;u++){const d=a[0];d.type==="straight"?l.push(k.Add(d.start,k.Mul(d.delta,c))):l.push(ES(d.center.x,d.center.y,r,d.startAngle+c/r)),c+=i;let f=d.type==="straight"?o:xt*r;for(;c>f;)c-=f,a.push(a.shift()),f=a[0].type==="straight"?o:xt*r}return l}function da(e,t,n,r){const o=Fh(n),s=kv(e,t),i=Math.max(Math.ceil(s/r*20),6,Math.ceil(s/Math.min(e,t))),a=s/i*.2,c=Math.max(e-a*2,1),l=Math.max(t-a*2,1),u=(e-c)/2,d=(t-l)/2,f=kv(c,l)/i,p=V5(c,l,i).map(x=>x.addXY(u,d)),v=e<20?0:a*.3,m=t<20?0:a*.3,y=p.slice(0);for(let x=0;x<Math.floor(i/2);x++)y[x]=k.AddXY(y[x],o()*v,o()*m),y[i-x-1]=k.AddXY(y[i-x-1],o()*v,o()*m);const b=[];for(let x=0;x<y.length;x++){const w=x===y.length-1?0:x+1,S=y[x],C=y[w],P=p[x],E=p[w],_=k.Average([P,E]),$=k.Angle(P,E)-Math.PI/2,T=k.Dist(P,E),M=f-T,j=k.Dist(S,C)/T,N=(Math.max(u,d)+M)*j,B=k.Add(_,k.FromAngle($,N));B.x<0?B.x=0:B.x>e&&(B.x=e),B.y<0?B.y=0:B.y>t&&(B.y=t);const D=Pw(S,C,B),G=k.Dist(D||k.Average([S,C]),S);b.push({leftPoint:S,rightPoint:C,arcPoint:B,center:D,radius:G})}return b}function Pw(e,t,n){const r=e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y,o=(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y),s=(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x),i=-o/(2*r),a=-s/(2*r);return!Number.isFinite(i)||!Number.isFinite(a)?null:new k(i,a)}function SX(e,t,n,r){const o=[],s=da(e,t,n,r);for(const{center:i,radius:a,leftPoint:c,rightPoint:l}of s)o.push(...K5(c,l,i,a,10));return o}function Jl(e,t,n,r){const o=da(e,t,n,r);let s=`M${L(o[0].leftPoint.x)},${L(o[0].leftPoint.y)}`;for(const{leftPoint:i,rightPoint:a,radius:c,center:l}of o){if(l===null){s+=` L${L(a.x)},${L(a.y)}`;continue}const u=_w(i,a,l)?"0":"1";s+=` A${L(c)},${L(c)} 0 ${u},1 ${L(a.x)},${L(a.y)}`}return s+=" Z",s}function Ew(e,t,n,r){const o=Fh(n),s=r/3.5*.7,i=v=>v+o()*s*2,a=da(e,t,n,r),u=a.reduce((v,m)=>v+k.Dist(m.leftPoint,m.rightPoint),0)/a.length>s*15?v=>new k(i(v.x),i(v.y)):v=>v;let d=`M${L(a[0].leftPoint.x)},${L(a[0].leftPoint.y)}`,f=u(a[0].leftPoint),p=`M${L(f.x)},${L(f.y)}`;for(const{leftPoint:v,center:m,rightPoint:y,radius:b,arcPoint:x}of a){if(m===null){d+=` L${L(y.x)},${L(y.y)}`;const _=u(y);p+=` L${L(_.x)},${L(_.y)}`,f=_;continue}const w=_w(v,y,m)?"0":"1";d+=` A${L(b)},${L(b)} 0 ${w},1 ${L(y.x)},${L(y.y)}`;const S=u(y),C=u(x),P=Pw(f,S,C);if(!P){p+=` L${L(S.x)},${L(S.y)}`,f=S;continue}const E=Math.abs(k.Dist(P,f));p+=` A${L(E)},${L(E)} 0 ${w},1 ${L(S.x)},${L(S.y)}`,f=S}return d+p+" Z"}function K5(e,t,n,r,o){if(n===null)return[k.From(e),k.From(t)];const s=[],i=k.Angle(n,e),a=k.Angle(n,t),c=Nl(i,a);for(let l=0;l<o;l++){const u=l/(o-1),d=i+c*u,f=ES(n.x,n.y,r,d);s.push(f)}return s}function _w(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}const xX=g.memo(function({dash:t,fill:n,backgroundColor:r,strokeColor:o,strokeWidth:s,w:i,h:a,id:c}){const l=Jl(i,a,c,s),u=da(i,a,c,s);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:l,fill:n,color:r}),h.jsx("g",{strokeWidth:s,stroke:o,fill:"none",pointerEvents:"all",children:u.map(({leftPoint:d,rightPoint:f,center:p,radius:v},m)=>{const y=p?v*or(or(k.Angle(p,f))-or(k.Angle(p,d))):k.Dist(d,f),{strokeDasharray:b,strokeDashoffset:x}=zn(y,s,{style:t,start:"outset",end:"outset"});return h.jsx("path",{d:p?`M${d.x},${d.y}A${v},${v},0,0,1,${f.x},${f.y}`:`M${d.x},${d.y}L${f.x},${f.y}`,strokeDasharray:b,strokeDashoffset:x},m)})})]})});function wX({dash:e,fill:t,backgroundColor:n,strokeColor:r,strokeWidth:o,w:s,h:i,id:a}){const c=Jl(s,i,a,o),l=da(s,i,a,o),u=document.createElementNS("http://www.w3.org/2000/svg","g");u.setAttribute("stroke-width",o.toString()),u.setAttribute("stroke",r),u.setAttribute("fill","none");for(const{leftPoint:f,rightPoint:p,center:v,radius:m}of l){const y=v?m*or(or(k.Angle(v,p))-or(k.Angle(v,f))):k.Dist(f,p),{strokeDasharray:b,strokeDashoffset:x}=zn(y,o,{style:e,start:"outset",end:"outset"}),w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",v?`M${f.x},${f.y}A${m},${m},0,0,1,${p.x},${p.y}`:`M${f.x},${f.y}L${p.x},${p.y}`),w.setAttribute("stroke-dasharray",b.toString()),w.setAttribute("stroke-dashoffset",x.toString()),u.appendChild(w)}const d=en({d:c,fill:t,color:n});return tn(u,d)}const CX=g.memo(function({w:t,h:n,strokeWidth:r,dash:o,backgroundColor:s,strokeColor:i,fill:a}){const c=t/2,l=n/2,u=Math.max(0,c),d=Math.max(0,l),f=Fi(u,d),{strokeDasharray:p,strokeDashoffset:v}=zn(f<64?f*2:f,r,{style:o,snap:4,closed:!0}),m=`M${c-u},${l}a${u},${d},0,1,1,${u*2},0a${u},${d},0,1,1,-${u*2},0`;return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:m,color:s,fill:a}),h.jsx("path",{d:m,strokeWidth:r,width:L(t),height:L(n),fill:"none",stroke:i,strokeDasharray:p,strokeDashoffset:v,pointerEvents:"all"})]})});function PX({w:e,h:t,strokeWidth:n,dash:r,backgroundColor:o,strokeColor:s,fill:i}){const a=e/2,c=t/2,l=Math.max(0,a-n/2),u=Math.max(0,c-n/2),d=Fi(l,u),{strokeDasharray:f,strokeDashoffset:p}=zn(d<64?d*2:d,n,{style:r,snap:4,closed:!0}),v=`M${a-l},${c}a${l},${u},0,1,1,${l*2},0a${l},${u},0,1,1,-${l*2},0`,m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",v),m.setAttribute("stroke-width",n.toString()),m.setAttribute("width",e.toString()),m.setAttribute("height",t.toString()),m.setAttribute("fill","none"),m.setAttribute("stroke",s),m.setAttribute("stroke-dasharray",f),m.setAttribute("stroke-dashoffset",p);const y=en({d:v,fill:i,color:o});return tn(m,y)}function Iw(e,t){if(t>e){const r=e/2;return`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}const n=t/2;return`
    M${n},0
    L${e-n},0
    a${n},${n},0,1,1,0,${n*2}
    L${n},${t}
    a${n},${n},0,1,1,0,${-n*2}
    Z`}function kw(e,t){if(e>t){const r=t/2;return Fi(r,r)+(e-r*2)*2}const n=e/2;return Fi(n,n)+(t-n*2)*2}const EX=g.memo(function({w:t,h:n,strokeWidth:r,dash:o,backgroundColor:s,strokeColor:i,fill:a}){const c=Iw(t,n),l=kw(t,n),{strokeDasharray:u,strokeDashoffset:d}=zn(l<64?l*2:l,r,{style:o,snap:4,start:"outset",end:"outset",closed:!0});return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:c,color:s,fill:a}),h.jsx("path",{d:c,strokeWidth:r,width:L(t),height:L(n),fill:"none",stroke:i,strokeDasharray:u,strokeDashoffset:d,pointerEvents:"all"})]})});function _X({w:e,h:t,strokeWidth:n,dash:r,strokeColor:o,backgroundColor:s,fill:i}){const a=Iw(e,t),c=kw(e,t),{strokeDasharray:l,strokeDashoffset:u}=zn(c<64?c*2:c,n,{style:r,snap:4,closed:!0}),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o),d.setAttribute("stroke-dasharray",l),d.setAttribute("stroke-dashoffset",u);const f=en({d:a,fill:i,color:s});return tn(d,f)}const IX=g.memo(function({dash:t,fill:n,backgroundColor:r,strokeColor:o,strokeWidth:s,outline:i,lines:a}){const c="M"+i[0]+"L"+i.slice(1)+"Z";return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:c,fill:n,color:r}),h.jsxs("g",{strokeWidth:s,stroke:o,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((l,u)=>{const d=i[u],f=i[(u+1)%i.length],p=k.Dist(d,f),{strokeDasharray:v,strokeDashoffset:m}=zn(p,s,{style:t,start:"outset",end:"outset"});return h.jsx("line",{x1:d.x,y1:d.y,x2:f.x,y2:f.y,strokeDasharray:v,strokeDashoffset:m},u)}),a&&a.map(([l,u],d)=>{const f=k.Dist(l,u),{strokeDasharray:p,strokeDashoffset:v}=zn(f,s,{style:t,start:"skip",end:"outset",snap:t==="dotted"?4:void 0});return h.jsx("path",{d:`M${l.x},${l.y}L${u.x},${u.y}`,stroke:o,strokeWidth:s,fill:"none",strokeDasharray:p,strokeDashoffset:v},`line_fg_${d}`)})]})]})});function kX({dash:e,fill:t,backgroundColor:n,strokeColor:r,strokeWidth:o,outline:s,lines:i}){const a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",o.toString()),a.setAttribute("stroke",r),a.setAttribute("fill","none"),Array.from(Array(s.length)).forEach((l,u)=>{const d=s[u],f=s[(u+1)%s.length],p=k.Dist(d,f),{strokeDasharray:v,strokeDashoffset:m}=zn(p,o,{style:e}),y=document.createElementNS("http://www.w3.org/2000/svg","line");y.setAttribute("x1",d.x.toString()),y.setAttribute("y1",d.y.toString()),y.setAttribute("x2",f.x.toString()),y.setAttribute("y2",f.y.toString()),y.setAttribute("stroke-dasharray",v.toString()),y.setAttribute("stroke-dashoffset",m.toString()),a.appendChild(y)}),i)for(const[l,u]of i){const d=k.Dist(l,u),{strokeDasharray:f,strokeDashoffset:p}=zn(d,o,{style:e,start:"skip",end:"skip",snap:e==="dotted"?4:2}),v=document.createElementNS("http://www.w3.org/2000/svg","line");v.setAttribute("x1",l.x.toString()),v.setAttribute("y1",l.y.toString()),v.setAttribute("x2",u.x.toString()),v.setAttribute("y2",u.y.toString()),v.setAttribute("stroke-dasharray",f.toString()),v.setAttribute("stroke-dashoffset",p.toString()),a.appendChild(v)}const c=en({d:"M"+s[0]+"L"+s.slice(1)+"Z",fill:t,color:n});return tn(a,c)}const TX=g.memo(function({fill:t,backgroundColor:n,strokeColor:r,strokeWidth:o,w:s,h:i,id:a}){const c=Ew(s,i,a,o);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:c,fill:t,color:n}),h.jsx("path",{d:c,stroke:r,strokeWidth:o,fill:"none"})]})});function $X({fill:e,backgroundColor:t,strokeColor:n,strokeWidth:r,w:o,h:s,id:i}){const a=Ew(o,s,i,r),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",a),c.setAttribute("stroke-width",r.toString()),c.setAttribute("stroke",n),c.setAttribute("fill","none");const l=en({d:a,fill:e,color:t});return tn(c,l)}g.memo(function({id:t,w:n,h:r,strokeWidth:o,fill:s,backgroundColor:i,strokeColor:a}){const c=Mw(t,n,r,o),l=Aw(t,n,r,o);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:c,color:i,fill:s}),h.jsx("path",{d:l,fill:a,strokeWidth:0,pointerEvents:"all"})]})});function AX({id:e,w:t,h:n,strokeWidth:r,fill:o,backgroundColor:s,strokeColor:i}){const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",Aw(e,t,n,r)),a.setAttribute("fill",i);const c=en({d:Mw(e,t,n,r),fill:o,color:s});return tn(a,c)}function Tw(e){return{size:e?1+e:0,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function $w(e,t,n,r){const o=Fh(e),s=t/2,i=n/2,a=Fi(s,i),c=[],l=He*o(),u=He+$t/2+Math.abs(o())*$t,d=Math.max(16,a/10);for(let f=0;f<d;f++){const p=f/(d-1),v=l+p*u,m=Math.cos(v),y=Math.sin(v);c.push(new k(s*m+t*.5+.05*o(),i*y+n/2+.05*o(),Math.min(1,.5+Math.abs(.5-(o()>0?Br.easeInOutSine(p):Br.easeInExpo(p)))/2)))}return c5(c,Tw(r))}function Aw(e,t,n,r){const o=Tw(r);return $S(s5(l5($w(e,t,n,r),o),o))}function Mw(e,t,n,r){return x5($w(e,t,n,r))}const MX=g.memo(function({id:t,outline:n,lines:r,fill:o,backgroundColor:s,strokeColor:i,strokeWidth:a}){const c=pl(t,n,a/3,a*2,2);let l=hl(c);if(r)for(const[f,p]of r)l+=`M${f.x},${f.y}L${p.x},${p.y}`;const u=pl(t,n,0,a*2,1),d=hl(u);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d,fill:o,color:s}),h.jsx("path",{d:l,stroke:i,strokeWidth:a,fill:"none"})]})});function OX({id:e,outline:t,lines:n,fill:r,backgroundColor:o,strokeColor:s,strokeWidth:i}){const a=pl(e,t,i/3,i*2,2);let c=hl(a);if(n)for(const[p,v]of n)c+=`M${p.x},${p.y}L${v.x},${v.y}`;const l=pl(e,t,0,i*2,1),u=hl(l),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",c),d.setAttribute("fill","none"),d.setAttribute("stroke",s),d.setAttribute("stroke-width",i.toString());const f=en({d:u,fill:r,color:o});return tn(d,f)}const RX=g.memo(function({fill:t,strokeColor:n,backgroundColor:r,strokeWidth:o,w:s,h:i,id:a}){const c=Jl(s,i,a,o);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:c,fill:t,color:r}),h.jsx("path",{d:c,stroke:n,strokeWidth:o,fill:"none"})]})});function jX({fill:e,backgroundColor:t,strokeColor:n,strokeWidth:r,w:o,h:s,id:i}){const a=Jl(o,s,i,r),c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",a),c.setAttribute("stroke-width",r.toString()),c.setAttribute("stroke",n),c.setAttribute("fill","none");const l=en({d:a,fill:e,color:t});return tn(c,l)}const DX=g.memo(function({w:t,h:n,strokeWidth:r,fill:o,strokeColor:s,backgroundColor:i}){const a=t/2,c=n/2,l=Math.max(0,a),u=Math.max(0,c),d=`M${a-l},${c}a${l},${u},0,1,1,${l*2},0a${l},${u},0,1,1,-${l*2},0`;return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d,color:i,fill:o}),h.jsx("path",{d,stroke:s,strokeWidth:r,fill:"none"})]})});function NX({w:e,h:t,strokeWidth:n,fill:r,backgroundColor:o,strokeColor:s}){const i=e/2,a=t/2,c=Math.max(0,i),l=Math.max(0,a),u=`M${i-c},${a}a${c},${l},0,1,1,${c*2},0a${c},${l},0,1,1,-${c*2},0`,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",u),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",s);const f=en({d:u,fill:r,color:o});return tn(d,f)}const LX=g.memo(function({w:t,h:n,strokeWidth:r,fill:o,strokeColor:s,backgroundColor:i}){const a=Ow(t,n);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:a,color:i,fill:o}),h.jsx("path",{d:a,stroke:s,strokeWidth:r,fill:"none"})]})});function FX({w:e,h:t,strokeWidth:n,fill:r,backgroundColor:o,strokeColor:s}){const i=Ow(e,t),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",i),a.setAttribute("stroke-width",n.toString()),a.setAttribute("width",e.toString()),a.setAttribute("height",t.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",s);const c=en({d:i,fill:r,color:o});return tn(a,c)}function Ow(e,t){let n;if(t>e){const r=e/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=t/2;n=`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${t}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return n}const BX=g.memo(function({outline:t,lines:n,fill:r,backgroundColor:o,strokeColor:s,strokeWidth:i}){let a="M"+t[0]+"L"+t.slice(1)+"Z";if(n)for(const[c,l]of n)a+=`M${c.x},${c.y}L${l.x},${l.y}`;return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:a,fill:r,color:o}),h.jsx("path",{d:a,stroke:s,strokeWidth:i,fill:"none"})]})});function zX({outline:e,lines:t,fill:n,backgroundColor:r,strokeColor:o,strokeWidth:s}){const i="M"+e[0]+"L"+e.slice(1)+"Z",a=i;let c=i;if(t)for(const[d,f]of t)c+=`M${d.x},${d.y}L${f.x},${f.y}`;const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",c),l.setAttribute("stroke-width",s.toString()),l.setAttribute("stroke",o),l.setAttribute("fill","none");const u=en({d:a,fill:n,color:r});return tn(l,u)}g.memo(function({w:t,h:n,strokeWidth:r,fill:o,strokeColor:s,backgroundColor:i}){const a=t/2,c=n/2,l=Math.max(0,a),u=Math.max(0,c),d=`M${a-l},${c}a${l},${u},0,1,1,${l*2},0a${l},${u},0,1,1,-${l*2},0`;return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d,color:i,fill:o}),h.jsx("path",{d,stroke:s,strokeWidth:r,fill:"none"})]})});function UX({w:e,h:t,strokeWidth:n,fill:r,backgroundColor:o,strokeColor:s}){const i=e/2,a=t/2,c=Math.max(0,i),l=Math.max(0,a),u=`M${i-c},${a}a${c},${l},0,1,1,${c*2},0a${c},${l},0,1,1,-${c*2},0`,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",u),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",e.toString()),d.setAttribute("height",t.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",s);const f=en({d:u,fill:r,color:o});return tn(d,f)}g.memo(function({w:t,h:n,strokeWidth:r,fill:o,strokeColor:s,backgroundColor:i}){const a=Rw(t,n);return h.jsxs(h.Fragment,{children:[h.jsx(Jt,{d:a,color:i,fill:o}),h.jsx("path",{d:a,stroke:s,strokeWidth:r,fill:"none"})]})});function VX({w:e,h:t,strokeWidth:n,fill:r,backgroundColor:o,strokeColor:s}){const i=Rw(e,t),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",i),a.setAttribute("stroke-width",n.toString()),a.setAttribute("width",e.toString()),a.setAttribute("height",t.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",s);const c=en({d:i,fill:r,color:o});return tn(a,c)}function Rw(e,t){let n;if(t>e){const r=e/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=t/2;n=`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${t}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return n}const KX=g.memo(function({outline:t,color:n,edgeOnly:r}){const o="M"+t[0]+"L"+t.slice(1)+"Z";return r?h.jsx("path",{d:o,fill:"none",stroke:n,strokeWidth:Ql.m}):h.jsx("path",{d:o,fill:n})});function WX({outline:e,color:t,edgeOnly:n}){const r="M"+e[0]+"L"+e.slice(1)+"Z",o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",r),n?(o.setAttribute("fill","none"),o.setAttribute("stroke",t),o.setAttribute("stroke-width",`${Ql.l}`)):o.setAttribute("fill",t),o}const HX=g.memo(function({outline:t,color:n,edgeOnly:r}){const o="M"+t[0]+"L"+t.slice(1)+"Z";return r?h.jsx("path",{d:o,fill:"none",stroke:n,strokeWidth:Ql.m}):h.jsx("path",{d:o,fill:n})});function GX({outline:e,color:t,edgeOnly:n}){const r="M"+e[0]+"L"+e.slice(1)+"Z",o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",r),n?(o.setAttribute("fill","none"),o.setAttribute("stroke",t),o.setAttribute("stroke-width",`${Ql.l}`)):o.setAttribute("fill",t),o}const W5=(e,t,n)=>"#"+[5,3,1].map(r=>{const o=(r+e/60)%6;return((n-n*t*Math.max(Math.min(o,4-o,1),0))*255|0).toString(16).padStart(2,"0")}).join(""),Tv=["#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ff00","#00ff55","#00ffaa","#00ffff","#00aaff","#0055ff","#0000ff","#5500ff","#aa00ff","#ff00ff","#ff00aa","#ff0055"],Wo={keypointRadius:4,keypoints:["nose","neck","right_shoulder","right_elbow","right_wrist","left_shoulder","left_elbow","left_wrist","right_hip","right_knee","right_ankle","left_hip","left_knee","left_ankle","right_eye","left_eye","right_ear","left_ear"],connections:[[1,2],[1,5],[2,3],[3,4],[5,6],[6,7],[1,8],[8,9],[9,10],[1,11],[11,12],[12,13],[1,0],[0,14],[14,16],[0,15],[15,17]],keypointColors:Tv,connectionColors:Tv},$v=["wrist",...["thumb","index","middle","ring","pinky"].flatMap(e=>Array.from({length:4},(t,n)=>e+"_"+(n+1)))],_d=[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20]],Nt={keypointRadius:2,keypoints:$v,connections:_d,keypointColors:new Array($v.length).fill("#0000ff"),connectionColors:_d.map((e,t)=>W5(t/_d.length*360,1,1)),displayIgnoreKeypoints:[0]},Qa=[...[["face_outline",17],["left_eyebrow",5],["right_eyebrow",5],["nose_bridge",4],["nose_bottom",5],["left_eye_outline",6],["right_eye_outline",6],["mouth_outer_bound",12],["mouth_inner_bound",8]].flatMap(([e,t])=>Array.from({length:t},(n,r)=>e+"_"+(r+1))),"left_eyeball","right_eyeball"],Ho={keypointRadius:2,keypoints:Qa,keypointColors:new Array(Qa.length).fill("#ffffff"),displayIgnoreKeypoints:[Qa.length-2,Qa.length-1]},Id=["body","handLeft","handRight","face"],H5=[[0,-43],[0,0],[-50,-2],[-64,63],[-78,132],[57,-2],[76,62],[91,125],[-16,121],[-28,239],[-26,334],[29,120],[41,240],[45,336],[-9,-61],[12,-60],[-16,-50],[19,-48]].map(([e,t])=>({x:e,y:t,c:1})),G5=[[-22,-12],[-46,-29],[-57,-49],[-72,-64],[-25,-71],[-27,-98],[-29,-116],[-30,-132],[-5,-76],[-7,-98],[-6,-117],[-7,-139],[10,-71],[13,-93],[13,-111],[13,-130],[26,-63],[31,-79],[35,-92],[39,-107]].map(([e,t])=>({x:e,y:t,c:1})),Y5=[[22,-8],[46,-23],[63,-41],[81,-52],[32,-70],[35,-89],[39,-106],[43,-123],[11,-73],[12,-95],[14,-119],[17,-140],[-7,-69],[-7,-95],[-6,-114],[-2,-133],[-26,-61],[-29,-79],[-33,-92],[-37,-106]].map(([e,t])=>({x:e,y:t,c:1}));class kd extends ds{constructor(){super(...arguments);I(this,"isAspectRatioLocked",()=>!0);I(this,"canBind",()=>!1);I(this,"canSnap",()=>!1);I(this,"expandSelectionOutlinePx",()=>4);I(this,"onHandleChange",(n,{handle:r})=>{const[o,s]=r.id.split("."),i=o,a=Number(s);return{id:n.id,type:n.type,props:{[i]:n.props[i].map((c,l)=>l!==a?c:{...c,x:r.x,y:r.y})}}});I(this,"onResize",(n,r)=>{const{scaleX:o,scaleY:s}=r;return{id:n.id,type:n.type,props:Object.fromEntries(Id.map(i=>{var a;return[i,(a=n.props[i])==null?void 0:a.map(c=>({...c,x:c.x*o,y:c.y*s}))]}))}});I(this,"onEditEnd",n=>{const r=n.props.body[1].x,o=n.props.body[1].y;return{id:n.id,type:n.type,props:Object.fromEntries(Id.map(s=>{var i;return[s,(i=n.props[s])==null?void 0:i.map(a=>({...a,x:a.x-r,y:a.y-o}))]}))}})}getDefaultProps(){return{body:[...H5],handLeft:null,handRight:null,face:null}}getGeometry(n){const{body:r,handLeft:o,handRight:s,face:i}=Ja(n);return new Ul({children:[nc(Wo,r),o&&nc(Nt,o),s&&nc(Nt,s),i&&nc(Ho,i),rc(Wo,r),o&&rc(Nt,o),s&&rc(Nt,s),i&&rc(Ho,i)].filter(Boolean).flat(),isSnappable:!1})}getHandles(n){return Id.map(r=>{var o;return(o=n.props[r])==null?void 0:o.map((s,i)=>({id:r+"."+i,type:"vertex",index:"a0",x:s.x,y:s.y,canBind:!0}))}).filter(Boolean).flat()}component(n){const{body:r,handLeft:o,handRight:s,face:i}=Ja(n),a=this._getScale(n);return h.jsxs(sx,{children:[h.jsx(ec,{part:Wo,keypoints:r,scale:a}),o&&h.jsx(ec,{part:Nt,keypoints:o,scale:a}),s&&h.jsx(ec,{part:Nt,keypoints:s,scale:a}),i&&h.jsx(ec,{part:Ho,keypoints:i,scale:a}),h.jsx(tc,{part:Wo,keypoints:r,scale:a}),o&&h.jsx(tc,{part:Nt,keypoints:o,scale:a}),s&&h.jsx(tc,{part:Nt,keypoints:s,scale:a}),i&&h.jsx(tc,{part:Ho,keypoints:i,scale:a})]})}indicator(n){}toSvg(n,r){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),{body:s,handLeft:i,handRight:a,face:c}=Ja(n),l=this._getScale(n),u=[oc(Wo,s,l),i&&oc(Nt,i,l),a&&oc(Nt,a,l),c&&oc(Ho,c,l),sc(Wo,s,l),i&&sc(Nt,i,l),a&&sc(Nt,a,l),c&&sc(Ho,c,l)].filter(Boolean);for(const d of u)o.appendChild(d);return o}attachHand(n,r,o,s){const i=o==="left"?n.props.body[7]:n.props.body[4],a=o==="left"?n.props.body[6]:n.props.body[3],c=r[8],l=Math.atan2(c.y-s.y,c.x-s.x),d=Math.atan2(i.y-a.y,i.x-a.x)-l,f=X5(r,d,s),p=Math.hypot(i.x-a.x,i.y-a.y),v=Z5(Nt,[s,...f])*4,m=p*.7/v,y=q5(f,m),b=i.x-s.x,x=i.y-s.y,w=hi(y,b,x);return{id:n.id,type:n.type,props:{[o==="left"?"handLeft":"handRight"]:w}}}attachDefaultHand(n,r){const o=r==="left"?G5:Y5;return this.attachHand(n,o,r,{x:0,y:0,c:1})}exportJson(n){let{body:r,handLeft:o,handRight:s,face:i}=Ja(n);r=ic(r),o=o&&ic(o),s=s&&ic(s),i=i&&ic(i);const a=[r,o,s,i].filter(Boolean).flat(),c=-Math.min(...a.map(f=>f.x)),l=-Math.min(...a.map(f=>f.y)),u=Math.max(...a.map(f=>f.x))+c,d=Math.max(...a.map(f=>f.y))+l;return{canvas_width:u,canvas_height:d,people:[{pose_keypoints_2d:hi(r,c,l).flatMap(({x:f,y:p,c:v})=>[f,p,v]),hand_left_keypoints_2d:o&&hi(o,c,l).flatMap(({x:f,y:p,c:v})=>[f,p,v]),hand_right_keypoints_2d:s&&hi(s,c,l).flatMap(({x:f,y:p,c:v})=>[f,p,v]),face_keypoints_2d:i&&hi(i,c,l).flatMap(({x:f,y:p,c:v})=>[f,p,v])}]}}_getScale(n){const r=this.editor.getShapeGeometry(n).bounds;return 1/Math.min(1,512/Math.max(r.width,r.height))}}I(kd,"type","pose"),I(kd,"props",Hk),I(kd,"migrations",Gk);function Ja(e){const{body:t,handLeft:n,handRight:r,face:o}=e.props;return{body:t,handLeft:n&&[t[7],...n],handRight:r&&[t[4],...r],face:o&&[...o,t[15],t[14]]}}const jw=({k1:e,k2:t,keypoints:n,scale:r})=>{const o=n[e].x,s=n[e].y,i=n[t].x,a=n[t].y,c=(o+i)/2,l=(s+a)/2,u=Math.sqrt((i-o)**2+(a-s)**2),d=Math.atan2(a-s,i-o)*(180/Math.PI),f=2*r;return{cx:c,cy:l,rx:u/2,ry:f,transform:`rotate(${d}, ${c}, ${l})`}};function ec({part:e,keypoints:t,scale:n}){return!e.connections||!e.connectionColors?null:h.jsx(h.Fragment,{children:e.connections.map(([r,o],s)=>h.jsx("ellipse",{...jw({k1:r,k2:o,keypoints:t,scale:n}),fill:e.connectionColors[s],opacity:.6},r+"-"+o))})}const tc=Te(({part:e,keypoints:t,scale:n})=>{const r=U();return h.jsx(h.Fragment,{children:e.keypoints.map((o,s)=>h.jsxs(g.Fragment,{children:[h.jsx("circle",{cx:t[s].x,cy:t[s].y,r:e.keypointRadius*.5*n,fill:e.keypointColors[s],opacity:t[s].c}),r.getInstanceState().isDebugMode&&h.jsxs("text",{x:t[s].x,y:t[s].y,fontSize:e.keypointRadius*n,fill:"white",textAnchor:"middle",alignmentBaseline:"middle",style:{backgroundColor:"white"},children:[t[s].x.toFixed(0),", ",t[s].y.toFixed(0)," [",t[s].c.toFixed(2),"]"]})]},o)).filter((o,s)=>{var i;return!((i=e.displayIgnoreKeypoints)!=null&&i.includes(s))})})});function nc(e,t){return e.connections?e.connections.map(([n,r])=>new Pf({start:k.From(t[n]),end:k.From(t[r]),isSnappable:!1})):[]}function rc(e,t){return e.keypoints.map((n,r)=>new cR({x:t[r].x-e.keypointRadius,y:t[r].y-e.keypointRadius,radius:e.keypointRadius,isFilled:!0})).filter((n,r)=>{var o;return!((o=e.displayIgnoreKeypoints)!=null&&o.includes(r))})}function oc(e,t,n){if(!e.connections||!e.connectionColors)return;const r=document.createElementNS("http://www.w3.org/2000/svg","g");for(const[o,[s,i]]of Object.entries(e.connections)){const a=Number(o),c=jw({k1:s,k2:i,keypoints:t,scale:n}),l=document.createElementNS("http://www.w3.org/2000/svg","ellipse");for(const[u,d]of Object.entries(c))l.setAttribute(u,d+"");l.setAttribute("fill",e.keypointColors[a]),l.setAttribute("opacity","0.6"),r.appendChild(l)}return r}function sc(e,t,n){var o;const r=document.createElementNS("http://www.w3.org/2000/svg","g");for(let s=0;s<e.keypoints.length;s++){if((o=e.displayIgnoreKeypoints)!=null&&o.includes(s))continue;const i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttribute("cx",t[s].x+""),i.setAttribute("cy",t[s].y+""),i.setAttribute("r",e.keypointRadius*n+""),i.setAttribute("fill",e.keypointColors[s]),i.setAttribute("opacity",t[s].c+""),r.appendChild(i)}return r}function hi(e,t,n){return e.map(r=>({x:r.x+t,y:r.y+n,c:r.c}))}function X5(e,t,n){const r=k.From(n);return e.map(o=>{const s=k.From(o).rotWith(r,t);return{x:s.x,y:s.y,c:o.c}})}function q5(e,t){return e.map(n=>({x:n.x*t,y:n.y*t,c:n.c}))}function Z5(e,t){if(!e.connections)throw new Error("part has no connections");return e.connections.reduce((n,[r,o])=>{const s=t[r],i=t[o];return n+Math.hypot(s.x-i.x,s.y-i.y)},0)/e.connections.length||0}function ic(e){return e.map(t=>({x:Math.round(t.x),y:Math.round(t.y),c:t.c}))}class Td extends Cx{constructor(){super(...arguments);I(this,"canEdit",()=>!0);I(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(n){return h.jsx(J5,{shape:n,videoUtil:this})}indicator(n){return h.jsx("rect",{width:L(n.props.w),height:L(n.props.h)})}toSvg(n){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","image");return o.setAttributeNS("http://www.w3.org/1999/xlink","href",Q5(n.id)),o.setAttribute("width",n.props.w.toString()),o.setAttribute("height",n.props.h.toString()),r.appendChild(o),r}}I(Td,"type","video"),I(Td,"props",tT),I(Td,"migrations",nT);function Q5(e){const t=e.split(":")[1],n=document.querySelector(`.tl-video-shape-${t}`);if(n){const r=document.createElement("canvas");return r.width=n.videoWidth,r.height=n.videoHeight,r.getContext("2d").drawImage(n,0,0),r.toDataURL("image/png")}else throw new Error("Video with id "+t+" not found")}const J5=Te(function(t){const{shape:n,videoUtil:r}=t,o=r.editor.getShapeGeometry(n).bounds.w*r.editor.getZoomLevel()>=110,s=n.props.assetId?r.editor.getAsset(n.props.assetId):null,{time:i,playing:a}=n.props,c=oR(n.id),l=U5(),u=Z.useRef(null),d=Z.useCallback(b=>{const x=b.currentTarget;r.editor.updateShapes([{type:"video",id:n.id,props:{playing:!0,time:x.currentTime}}])},[n.id,r.editor]),f=Z.useCallback(b=>{const x=b.currentTarget;r.editor.updateShapes([{type:"video",id:n.id,props:{playing:!1,time:x.currentTime}}])},[n.id,r.editor]),p=Z.useCallback(b=>{const x=b.currentTarget;c&&r.editor.updateShapes([{type:"video",id:n.id,props:{time:x.currentTime}}])},[c,n.id,r.editor]),[v,m]=Z.useState(!1),y=Z.useCallback(b=>{const x=b.currentTarget;i!==x.currentTime&&(x.currentTime=i),a||x.pause(),m(!0)},[a,i]);return Z.useEffect(()=>{const b=u.current;b&&(v&&!c&&i!==b.currentTime&&(b.currentTime=i),c&&document.activeElement!==b&&b.focus())},[c,v,i]),Z.useEffect(()=>{if(l){const b=u.current;b.pause(),b.currentTime=0}},[u,l]),h.jsxs(h.Fragment,{children:[h.jsx(wx,{id:n.id,children:h.jsx("div",{className:"tl-counter-scaled",children:s!=null&&s.props.src?h.jsx("video",{ref:u,style:c?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${n.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:c&&o,onPlay:d,onPause:f,onTimeUpdate:p,onLoadedData:y,hidden:!v,children:h.jsx("source",{src:s.props.src})}):null})}),"url"in n.props&&n.props.url&&h.jsx(Sw,{url:n.props.url,zoomLevel:r.editor.getZoomLevel()})]})});var Dw={exports:{}};(function(e){(function(t,n){e.exports?e.exports=n():t.downscale=n()})(Ue,function(){function t(_,b,x,w,S,C,P,E){var _=document.createElement("canvas");_.width=x,_.height=w;var $=_.getContext("2d");return $.mozImageSmoothingEnabled=!0,$.imageSmoothingQuality="high",$.webkitImageSmoothingEnabled=!0,$.msImageSmoothingEnabled=!0,$.imageSmoothingEnabled=!0,$.drawImage(b,S,C,P,E,0,0,x,w),_}function n(y){return y+.49<<0}function r(y,b,x,w,S,C,P){for(var E=new ImageData(b,x),_=new Int32Array(y.data.buffer),$=y.width,T=new Int32Array(E.data.buffer),M=E.width,O=b/C,j=x/P,N=n(1/O),B=n(1/j),D=N*B,G=0;G<E.height;G++)for(var V=0;V<M;V++){for(var z=w+n(V/O)+(S+n(G/j))*$,W=0,Q=0,oe=0,se=0,ye=0;ye<B;ye++)for(var ee=0;ee<N;ee++){var be=_[z+ee+ye*$];W+=be<<24>>>24,Q+=be<<16>>>24,oe+=be<<8>>>24,se+=be>>>24}W=n(W/D),Q=n(Q/D),oe=n(oe/D),se=n(se/D),T[V+G*M]=se<<24|oe<<16|Q<<8|W}return E}function o(y,b,x,w){var S=new Date,C={},P=S,E="01";return{mark:y?function(_){_=E+". "+(_||"..."),C[_]={"time (ms)":new Date-P},P=new Date,E=("0"+((E>>0)+1)).substr(-2)}:new Function,finish:y?function(){C[E+" TOTAL"]={"time (ms)":new Date-S},console.log("IMAGE SOURCE:",b),console.log("DOWNSCALE TO:",x+"x"+w),console.table(C)}:new Function}}function s(){var y=[],b=[],x=[],w=new Object;return{createSetter:function(S){if(!this.get(S)){var C=y.push(S)-1;return b.push(w),x.push([]),function(P){b[C]=P,x[C]=x[C].reduce(function(E,_){_(P)},[])}}},get:function(S,C){var P=y.indexOf(S);if(~P){if(b[P]===w){x[P].push(C);return}C(b[P])}},has:function(S){return!!~y.indexOf(S)}}}function i(y,b,x,w){y.width=x,y.height=w;var S=y.getContext("2d");return S.drawImage(b,0,0),S.getImageData(0,0,x,w)}function a(y,b){y.width=b.width,y.height=b.height;var x=y.getContext("2d");return x.putImageData(b,0,0),y}function c(y,b,T,M,S,C){var P=S,E=C,_=S/C;y===0&&(y=b*_>>0),b===0&&(b=y/_>>0);var $=y/b;$>_?C=S/$>>0:S=C*$>>0;var T=T||(P-S)/2>>0,M=M||(E-C)/2>>0;return{destWidth:y,destHeight:b,sourceX:T,sourceY:M,sourceWidth:S,sourceHeight:C}}function l(y,b,x){if(b.returnCanvas){x(y);return}if(b.returnBlob){y.toBlob(x,"image/"+(b.imageType||"jpeg"),b.quality||.85);return}var w=y.toDataURL("image/"+(b.imageType||"jpeg"),b.quality||.85);x(w)}function u(y,b){var x=new XMLHttpRequest;x.open("GET",y),x.responseType="arraybuffer",x.addEventListener("load",function(){b(this.response)}),x.send()}function d(y,b){y.complete?b():y.addEventListener("load",b)}function f(y,b){y.readyState>1?b():y.addEventListener("loadeddata",b)}function p(y){if(y instanceof File)return"File";if(y instanceof HTMLImageElement)return"HTMLImageElement";if(y instanceof HTMLVideoElement)return"HTMLVideoElement";if(typeof y=="string")return"URL"}function v(y){if(y.length<3)return new TypeError("3 arguments required, but only "+y.length+" present.");if(!p(y[0]))return new TypeError("First argument should be HTMLImageElement, HTMLVideoElement, File of String");if(typeof y[1]!="number")return new TypeError("Second argument should be a number");if(typeof y[2]!="number")return new TypeError("Third argument should be a number")}function m(y,b,x,w){var S=o(w&&w.debug||!1,y,b,x),C=v(arguments);if(C instanceof TypeError)return Promise.reject(C);w=w||{};var P,E=new Promise(function(j,N){P=j});m.canvas=m.canvas||document.createElement("canvas"),m.cache=m.cache||s();var _=m.canvas,$=m.cache;if($.has(y))return S.mark(),$.get(y,function(j){S.mark("PENDING CACHE");var N=j[0],B=j[1],D=c(b,x,w.sourceX,w.sourceY,B.width,B.height);if(D.sourceWidth/D.destWidth>=2&&D.sourceHeight/D.destHeight>=2){S.mark();var G=r(B,D.destWidth,D.destHeight,D.sourceX,D.sourceY,D.sourceWidth,D.sourceHeight);S.mark("DOWNSCALE"),_=a(_,G)}else _=t(_,N,D.destWidth,D.destHeight,D.sourceX,D.sourceY,D.sourceWidth,D.sourceHeight),S.mark("RESIZE WITH CANVAS");l(_,w,function(V){S.mark("PRODUCE RESULT"),P(V),S.finish()})}),E;var T=function(j,N,B){var D=c(b,x,w.sourceX,w.sourceY,N,B);if(D.sourceWidth/D.destWidth>=2&&D.sourceHeight/D.destHeight>=2){S.mark();var G=i(_,j,N,B);S.mark("GET IMAGE DATA");var V=r(G,D.destWidth,D.destHeight,D.sourceX,D.sourceY,D.sourceWidth,D.sourceHeight);S.mark("DOWNSCALE"),_=a(_,V),p(j)!=="HTMLVideoElement"&&$.createSetter(j)([j,G])}else _=t(_,j,D.destWidth,D.destHeight,D.sourceX,D.sourceY,D.sourceWidth,D.sourceHeight),S.mark("RESIZE WITH CANVAS");l(_,w,function(z){S.mark("PRODUCE RESULT"),P(z),S.finish()})},M=window.URL||window.webkitURL;switch(p(y)){case"File":var O=document.createElement("img");S.mark(),O.src=M.createObjectURL(y),S.mark("READ FILE"),d(O,function(){S.mark("LOAD IMAGE"),T(O,O.naturalWidth,O.naturalHeight)});break;case"HTMLImageElement":S.mark(),d(y,function(){S.mark("LOAD IMAGE"),T(y,y.naturalWidth,y.naturalHeight)});break;case"HTMLVideoElement":f(y,function(){T(y,y.videoWidth,y.videoHeight)});break;case"URL":S.mark(),setTimeout(function(){u(y,function(j){S.mark("LOAD ARRAY BUFFER");var N=new Uint8Array(j),B=new Blob([N],{type:"image/jpeg"}),D=document.createElement("img");D.src=M.createObjectURL(B),S.mark(),d(D,function(){S.mark("LOAD IMAGE"),T(D,D.naturalWidth,D.naturalHeight)})})});break}return E}return m})})(Dw);var e6=Dw.exports;const YX=As(e6);/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function t6(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var r,o,s,i,a=[],c=!0,l=!1;try{if(s=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(u){l=!0,o=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return a}}function Av(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Bt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Av(Object(n),!0).forEach(function(r){n6(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Av(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function n6(e,t,n){return t=d6(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r6(e,t){if(e==null)return{};var n={},r=Object.keys(e),o,s;for(s=0;s<r.length;s++)o=r[s],!(t.indexOf(o)>=0)&&(n[o]=e[o]);return n}function o6(e,t){if(e==null)return{};var n=r6(e,t),r,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)r=s[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Mv(e,t){return i6(e)||t6(e,t)||Nw(e,t)||l6()}function ac(e){return s6(e)||a6(e)||Nw(e)||c6()}function s6(e){if(Array.isArray(e))return zf(e)}function i6(e){if(Array.isArray(e))return e}function a6(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Nw(e,t){if(e){if(typeof e=="string")return zf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zf(e,t)}}function zf(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function l6(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function u6(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function d6(e){var t=u6(e,"string");return typeof t=="symbol"?t:String(t)}function Ai(e){var t=e.sizes.shift(),n=Math.max(Math.ceil(t[0]),1),r=Math.max(Math.ceil(t[1]),1),o=[n-1,r-1,1,1],s=Date.now(),i=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;i?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(n,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=n,c.height=r);var l=a.getContext("2d"),u=c.getContext("2d");u&&(u.fillRect.apply(u,o),l.drawImage(c,n-1,r-1,1,1,0,0,1,1));var d=l&&l.getImageData(0,0,1,1).data[3]!==0,f=Date.now()-s;return[a,c].forEach(function(p){p.height=0,p.width=0}),i?(postMessage({width:n,height:r,benchmark:f,isTestPass:d}),!d&&e.sizes.length&&Ai(e)):d?e.onSuccess(n,r,f):(e.onError(n,r,f),e.sizes.length&&Ai(e)),d}var $d={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},f6=["onError","onSuccess"],is={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},pi={};function Ad(e){var t=e.width===e.height,n=e.height===1,r=e.width===1,o=[];if(!e.width||!e.height)e.sizes.forEach(function(u){var d=t||n?u:1,f=t||r?u:1;o.push([d,f])});else for(var s=e.min||is.min,i=e.step||is.step,a=Math.max(e.width,e.height);a>=s;){var c=t||n?a:1,l=t||r?a:1;o.push([c,l]),a-=i}return o}function cc(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),o=e.onError,s=e.onSuccess,i=o6(e,f6),a=null;if(!t)return!1;if(e.useWorker&&n){var c=`
            var canvasTest = `.concat(Ai.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),l=new Blob([c],{type:"application/javascript"}),u=URL.createObjectURL(l);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(d){var f=d.data,p=f.width,v=f.height,m=f.benchmark,y=f.isTestPass;y?(pi[r].onSuccess(p,v,m),delete pi[r]):pi[r].onError(p,v,m)}}if(e.usePromise)return new Promise(function(d,f){var p=Bt(Bt({},e),{},{onError:function(b,x,w){var S;if(e.sizes.length===0)S=!0;else{var C=e.sizes.slice(-1),P=Mv(C,1),E=Mv(P[0],2),_=E[0],$=E[1];S=b===_&&x===$}o(b,x,w),S&&f({width:b,height:x,benchmark:w})},onSuccess:function(b,x,w){s(b,x,w),d({width:b,height:x,benchmark:w})}});if(a){var v=p.onError,m=p.onSuccess;pi[r]={onError:v,onSuccess:m},a.postMessage(i)}else Ai(p)});if(a)pi[r]={onError:o,onSuccess:s},a.postMessage(i);else return Ai(e)}var Md={maxArea:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Ad({width:t.max,height:t.max,min:t.min,step:t.step,sizes:ac($d.area)}),r=Bt(Bt(Bt({},is),t),{},{sizes:n});return cc(r)},maxHeight:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Ad({width:1,height:t.max,min:t.min,step:t.step,sizes:ac($d.height)}),r=Bt(Bt(Bt({},is),t),{},{sizes:n});return cc(r)},maxWidth:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Ad({width:t.max,height:1,min:t.min,step:t.step,sizes:ac($d.width)}),r=Bt(Bt(Bt({},is),t),{},{sizes:n});return cc(r)},test:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Bt(Bt({},is),t);return n.sizes=ac(n.sizes),n.width&&n.height&&(n.sizes=[[n.width,n.height]]),cc(n)}};let Od=null;function h6(){return Od||(Od=p6()),Od}async function p6(){const e=await Md.maxWidth({usePromise:!0}),t=await Md.maxHeight({usePromise:!0}),n=await Md.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}function Wt(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function g6(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function Lw(...e){return t=>e.forEach(n=>g6(n,t))}function fa(...e){return g.useCallback(Lw(...e),e)}function m6(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:f,children:p,...v}=d,m=(f==null?void 0:f[e][c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})}function u(d,f){const p=(f==null?void 0:f[e][c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,y6(o,...t)]}function y6(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}function v6(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function Fw(...e){return t=>e.forEach(n=>v6(n,t))}function Ov(...e){return g.useCallback(Fw(...e),e)}var Uf=g.forwardRef((e,t)=>{const{children:n,...r}=e,o=g.Children.toArray(n),s=o.find(S6);if(s){const i=s.props.children,a=o.map(c=>c===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(Vf,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(Vf,{...r,ref:t,children:n})});Uf.displayName="Slot";var Vf=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const o=w6(n);return g.cloneElement(n,{...x6(r,n.props),ref:t?Fw(t,o):o})}return g.Children.count(n)>1?g.Children.only(null):null});Vf.displayName="SlotClone";var b6=({children:e})=>h.jsx(h.Fragment,{children:e});function S6(e){return g.isValidElement(e)&&e.type===b6}function x6(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function w6(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function eu(e){const t=e+"CollectionProvider",[n,r]=m6(t),[o,s]=n(t,{collectionRef:{current:null},itemMap:new Map}),i=p=>{const{scope:v,children:m}=p,y=Z.useRef(null),b=Z.useRef(new Map).current;return h.jsx(o,{scope:v,itemMap:b,collectionRef:y,children:m})};i.displayName=t;const a=e+"CollectionSlot",c=Z.forwardRef((p,v)=>{const{scope:m,children:y}=p,b=s(a,m),x=Ov(v,b.collectionRef);return h.jsx(Uf,{ref:x,children:y})});c.displayName=a;const l=e+"CollectionItemSlot",u="data-radix-collection-item",d=Z.forwardRef((p,v)=>{const{scope:m,children:y,...b}=p,x=Z.useRef(null),w=Ov(v,x),S=s(l,m);return Z.useEffect(()=>(S.itemMap.set(x,{ref:x,...b}),()=>void S.itemMap.delete(x))),h.jsx(Uf,{[u]:"",ref:w,children:y})});d.displayName=l;function f(p){const v=s(e+"CollectionConsumer",p);return Z.useCallback(()=>{const y=v.collectionRef.current;if(!y)return[];const b=Array.from(y.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((S,C)=>b.indexOf(S.ref.current)-b.indexOf(C.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:c,ItemSlot:d},f,r]}function C6(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];const l=d=>{var b;const{scope:f,children:p,...v}=d,m=((b=f==null?void 0:f[e])==null?void 0:b[c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})};l.displayName=s+"Provider";function u(d,f){var m;const p=((m=f==null?void 0:f[e])==null?void 0:m[c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,P6(o,...t)]}function P6(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}var Bw=g.forwardRef((e,t)=>{const{children:n,...r}=e,o=g.Children.toArray(n),s=o.find(_6);if(s){const i=s.props.children,a=o.map(c=>c===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(Kf,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(Kf,{...r,ref:t,children:n})});Bw.displayName="Slot";var Kf=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const o=k6(n);return g.cloneElement(n,{...I6(r,n.props),ref:t?Lw(t,o):o})}return g.Children.count(n)>1?g.Children.only(null):null});Kf.displayName="SlotClone";var E6=({children:e})=>h.jsx(h.Fragment,{children:e});function _6(e){return g.isValidElement(e)&&e.type===E6}function I6(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function k6(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var T6=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Hn=T6.reduce((e,t)=>{const n=g.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Bw:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function zw(e,t){e&&Eo.flushSync(()=>e.dispatchEvent(t))}function ar(e){const t=g.useRef(e);return g.useEffect(()=>{t.current=e}),g.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function $6(e,t=globalThis==null?void 0:globalThis.document){const n=ar(e);g.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var A6="DismissableLayer",Wf="dismissableLayer.update",M6="dismissableLayer.pointerDownOutside",O6="dismissableLayer.focusOutside",Rv,Uw=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Vw=g.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...c}=e,l=g.useContext(Uw),[u,d]=g.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=g.useState({}),v=fa(t,E=>d(E)),m=Array.from(l.layers),[y]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(y),x=u?m.indexOf(u):-1,w=l.layersWithOutsidePointerEventsDisabled.size>0,S=x>=b,C=j6(E=>{const _=E.target,$=[...l.branches].some(T=>T.contains(_));!S||$||(o==null||o(E),i==null||i(E),E.defaultPrevented||a==null||a())},f),P=D6(E=>{const _=E.target;[...l.branches].some(T=>T.contains(_))||(s==null||s(E),i==null||i(E),E.defaultPrevented||a==null||a())},f);return $6(E=>{x===l.layers.size-1&&(r==null||r(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},f),g.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(Rv=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),jv(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Rv)}},[u,f,n,l]),g.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),jv())},[u,l]),g.useEffect(()=>{const E=()=>p({});return document.addEventListener(Wf,E),()=>document.removeEventListener(Wf,E)},[]),h.jsx(Hn.div,{...c,ref:v,style:{pointerEvents:w?S?"auto":"none":void 0,...e.style},onFocusCapture:Wt(e.onFocusCapture,P.onFocusCapture),onBlurCapture:Wt(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:Wt(e.onPointerDownCapture,C.onPointerDownCapture)})});Vw.displayName=A6;var R6="DismissableLayerBranch",Kw=g.forwardRef((e,t)=>{const n=g.useContext(Uw),r=g.useRef(null),o=fa(t,r);return g.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(Hn.div,{...e,ref:o})});Kw.displayName=R6;function j6(e,t=globalThis==null?void 0:globalThis.document){const n=ar(e),r=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){Ww(M6,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=c,t.addEventListener("click",o.current,{once:!0})):c()}else t.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",s),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function D6(e,t=globalThis==null?void 0:globalThis.document){const n=ar(e),r=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!r.current&&Ww(O6,n,{originalEvent:s},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function jv(){const e=new CustomEvent(Wf);document.dispatchEvent(e)}function Ww(e,t,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?zw(o,s):o.dispatchEvent(s)}var N6=Vw,L6=Kw,gl=globalThis!=null&&globalThis.document?g.useLayoutEffect:()=>{},F6="Portal",Hw=g.forwardRef((e,t)=>{var a;const{container:n,...r}=e,[o,s]=g.useState(!1);gl(()=>s(!0),[]);const i=n||o&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?Qi.createPortal(h.jsx(Hn.div,{...r,ref:t}),i):null});Hw.displayName=F6;function B6(e,t){return g.useReducer((n,r)=>t[n][r]??n,e)}var Gw=e=>{const{present:t,children:n}=e,r=z6(t),o=typeof n=="function"?n({present:r.isPresent}):g.Children.only(n),s=fa(r.ref,U6(o));return typeof n=="function"||r.isPresent?g.cloneElement(o,{ref:s}):null};Gw.displayName="Presence";function z6(e){const[t,n]=g.useState(),r=g.useRef({}),o=g.useRef(e),s=g.useRef("none"),i=e?"mounted":"unmounted",[a,c]=B6(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const l=lc(r.current);s.current=a==="mounted"?l:"none"},[a]),gl(()=>{const l=r.current,u=o.current;if(u!==e){const f=s.current,p=lc(l);e?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,c]),gl(()=>{if(t){let l;const u=t.ownerDocument.defaultView??window,d=p=>{const m=lc(r.current).includes(p.animationName);if(p.target===t&&m&&(c("ANIMATION_END"),!o.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",l=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},f=p=>{p.target===t&&(s.current=lc(r.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{u.clearTimeout(l),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:g.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function lc(e){return(e==null?void 0:e.animationName)||"none"}function U6(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function V6({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,o]=K6({defaultProp:t,onChange:n}),s=e!==void 0,i=s?e:r,a=ar(n),c=g.useCallback(l=>{if(s){const d=typeof l=="function"?l(e):l;d!==e&&a(d)}else o(l)},[s,e,o,a]);return[i,c]}function K6({defaultProp:e,onChange:t}){const n=g.useState(e),[r]=n,o=g.useRef(r),s=ar(t);return g.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var W6="VisuallyHidden",Lp=g.forwardRef((e,t)=>h.jsx(Hn.span,{...e,ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}));Lp.displayName=W6;var Fp="ToastProvider",[Bp,H6,G6]=eu("Toast"),[Yw,XX]=C6("Toast",[G6]),[Y6,tu]=Yw(Fp),Xw=e=>{const{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:o="right",swipeThreshold:s=50,children:i}=e,[a,c]=g.useState(null),[l,u]=g.useState(0),d=g.useRef(!1),f=g.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${Fp}\`. Expected non-empty \`string\`.`),h.jsx(Bp.Provider,{scope:t,children:h.jsx(Y6,{scope:t,label:n,duration:r,swipeDirection:o,swipeThreshold:s,toastCount:l,viewport:a,onViewportChange:c,onToastAdd:g.useCallback(()=>u(p=>p+1),[]),onToastRemove:g.useCallback(()=>u(p=>p-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:f,children:i})})};Xw.displayName=Fp;var qw="ToastViewport",X6=["F8"],Hf="toast.viewportPause",Gf="toast.viewportResume",Zw=g.forwardRef((e,t)=>{const{__scopeToast:n,hotkey:r=X6,label:o="Notifications ({hotkey})",...s}=e,i=tu(qw,n),a=H6(n),c=g.useRef(null),l=g.useRef(null),u=g.useRef(null),d=g.useRef(null),f=fa(t,d,i.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),v=i.toastCount>0;g.useEffect(()=>{const y=b=>{var w;r.length!==0&&r.every(S=>b[S]||b.code===S)&&((w=d.current)==null||w.focus())};return document.addEventListener("keydown",y),()=>document.removeEventListener("keydown",y)},[r]),g.useEffect(()=>{const y=c.current,b=d.current;if(v&&y&&b){const x=()=>{if(!i.isClosePausedRef.current){const P=new CustomEvent(Hf);b.dispatchEvent(P),i.isClosePausedRef.current=!0}},w=()=>{if(i.isClosePausedRef.current){const P=new CustomEvent(Gf);b.dispatchEvent(P),i.isClosePausedRef.current=!1}},S=P=>{!y.contains(P.relatedTarget)&&w()},C=()=>{y.contains(document.activeElement)||w()};return y.addEventListener("focusin",x),y.addEventListener("focusout",S),y.addEventListener("pointermove",x),y.addEventListener("pointerleave",C),window.addEventListener("blur",x),window.addEventListener("focus",w),()=>{y.removeEventListener("focusin",x),y.removeEventListener("focusout",S),y.removeEventListener("pointermove",x),y.removeEventListener("pointerleave",C),window.removeEventListener("blur",x),window.removeEventListener("focus",w)}}},[v,i.isClosePausedRef]);const m=g.useCallback(({tabbingDirection:y})=>{const x=a().map(w=>{const S=w.ref.current,C=[S,...c7(S)];return y==="forwards"?C:C.reverse()});return(y==="forwards"?x.reverse():x).flat()},[a]);return g.useEffect(()=>{const y=d.current;if(y){const b=x=>{var C,P,E;const w=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!w){const _=document.activeElement,$=x.shiftKey;if(x.target===y&&$){(C=l.current)==null||C.focus();return}const O=m({tabbingDirection:$?"backwards":"forwards"}),j=O.findIndex(N=>N===_);Rd(O.slice(j+1))?x.preventDefault():$?(P=l.current)==null||P.focus():(E=u.current)==null||E.focus()}};return y.addEventListener("keydown",b),()=>y.removeEventListener("keydown",b)}},[a,m]),h.jsxs(L6,{ref:c,role:"region","aria-label":o.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:v?void 0:"none"},children:[v&&h.jsx(Yf,{ref:l,onFocusFromOutsideViewport:()=>{const y=m({tabbingDirection:"forwards"});Rd(y)}}),h.jsx(Bp.Slot,{scope:n,children:h.jsx(Hn.ol,{tabIndex:-1,...s,ref:f})}),v&&h.jsx(Yf,{ref:u,onFocusFromOutsideViewport:()=>{const y=m({tabbingDirection:"backwards"});Rd(y)}})]})});Zw.displayName=qw;var Qw="ToastFocusProxy",Yf=g.forwardRef((e,t)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...o}=e,s=tu(Qw,n);return h.jsx(Lp,{"aria-hidden":!0,tabIndex:0,...o,ref:t,style:{position:"fixed"},onFocus:i=>{var l;const a=i.relatedTarget;!((l=s.viewport)!=null&&l.contains(a))&&r()}})});Yf.displayName=Qw;var nu="Toast",q6="toast.swipeStart",Z6="toast.swipeMove",Q6="toast.swipeCancel",J6="toast.swipeEnd",Jw=g.forwardRef((e,t)=>{const{forceMount:n,open:r,defaultOpen:o,onOpenChange:s,...i}=e,[a=!0,c]=V6({prop:r,defaultProp:o,onChange:s});return h.jsx(Gw,{present:n||a,children:h.jsx(n7,{open:a,...i,ref:t,onClose:()=>c(!1),onPause:ar(e.onPause),onResume:ar(e.onResume),onSwipeStart:Wt(e.onSwipeStart,l=>{l.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Wt(e.onSwipeMove,l=>{const{x:u,y:d}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","move"),l.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:Wt(e.onSwipeCancel,l=>{l.currentTarget.setAttribute("data-swipe","cancel"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Wt(e.onSwipeEnd,l=>{const{x:u,y:d}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","end"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),c(!1)})})})});Jw.displayName=nu;var[e7,t7]=Yw(nu,{onClose(){}}),n7=g.forwardRef((e,t)=>{const{__scopeToast:n,type:r="foreground",duration:o,open:s,onClose:i,onEscapeKeyDown:a,onPause:c,onResume:l,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:f,onSwipeEnd:p,...v}=e,m=tu(nu,n),[y,b]=g.useState(null),x=fa(t,N=>b(N)),w=g.useRef(null),S=g.useRef(null),C=o||m.duration,P=g.useRef(0),E=g.useRef(C),_=g.useRef(0),{onToastAdd:$,onToastRemove:T}=m,M=ar(()=>{var B;(y==null?void 0:y.contains(document.activeElement))&&((B=m.viewport)==null||B.focus()),i()}),O=g.useCallback(N=>{!N||N===1/0||(window.clearTimeout(_.current),P.current=new Date().getTime(),_.current=window.setTimeout(M,N))},[M]);g.useEffect(()=>{const N=m.viewport;if(N){const B=()=>{O(E.current),l==null||l()},D=()=>{const G=new Date().getTime()-P.current;E.current=E.current-G,window.clearTimeout(_.current),c==null||c()};return N.addEventListener(Hf,D),N.addEventListener(Gf,B),()=>{N.removeEventListener(Hf,D),N.removeEventListener(Gf,B)}}},[m.viewport,C,c,l,O]),g.useEffect(()=>{s&&!m.isClosePausedRef.current&&O(C)},[s,C,m.isClosePausedRef,O]),g.useEffect(()=>($(),()=>T()),[$,T]);const j=g.useMemo(()=>y?i0(y):null,[y]);return m.viewport?h.jsxs(h.Fragment,{children:[j&&h.jsx(r7,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:j}),h.jsx(e7,{scope:n,onClose:M,children:Eo.createPortal(h.jsx(Bp.ItemSlot,{scope:n,children:h.jsx(N6,{asChild:!0,onEscapeKeyDown:Wt(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||M(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:h.jsx(Hn.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":m.swipeDirection,...v,ref:x,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:Wt(e.onKeyDown,N=>{N.key==="Escape"&&(a==null||a(N.nativeEvent),N.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,M()))}),onPointerDown:Wt(e.onPointerDown,N=>{N.button===0&&(w.current={x:N.clientX,y:N.clientY})}),onPointerMove:Wt(e.onPointerMove,N=>{if(!w.current)return;const B=N.clientX-w.current.x,D=N.clientY-w.current.y,G=!!S.current,V=["left","right"].includes(m.swipeDirection),z=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,W=V?z(0,B):0,Q=V?0:z(0,D),oe=N.pointerType==="touch"?10:2,se={x:W,y:Q},ye={originalEvent:N,delta:se};G?(S.current=se,uc(Z6,d,ye,{discrete:!1})):Dv(se,m.swipeDirection,oe)?(S.current=se,uc(q6,u,ye,{discrete:!1}),N.target.setPointerCapture(N.pointerId)):(Math.abs(B)>oe||Math.abs(D)>oe)&&(w.current=null)}),onPointerUp:Wt(e.onPointerUp,N=>{const B=S.current,D=N.target;if(D.hasPointerCapture(N.pointerId)&&D.releasePointerCapture(N.pointerId),S.current=null,w.current=null,B){const G=N.currentTarget,V={originalEvent:N,delta:B};Dv(B,m.swipeDirection,m.swipeThreshold)?uc(J6,p,V,{discrete:!0}):uc(Q6,f,V,{discrete:!0}),G.addEventListener("click",z=>z.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),r7=e=>{const{__scopeToast:t,children:n,...r}=e,o=tu(nu,t),[s,i]=g.useState(!1),[a,c]=g.useState(!1);return i7(()=>i(!0)),g.useEffect(()=>{const l=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(l)},[]),a?null:h.jsx(Hw,{asChild:!0,children:h.jsx(Lp,{...r,children:s&&h.jsxs(h.Fragment,{children:[o.label," ",n]})})})},o7="ToastTitle",e0=g.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e;return h.jsx(Hn.div,{...r,ref:t})});e0.displayName=o7;var s7="ToastDescription",t0=g.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e;return h.jsx(Hn.div,{...r,ref:t})});t0.displayName=s7;var n0="ToastAction",r0=g.forwardRef((e,t)=>{const{altText:n,...r}=e;return n.trim()?h.jsx(s0,{altText:n,asChild:!0,children:h.jsx(zp,{...r,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${n0}\`. Expected non-empty \`string\`.`),null)});r0.displayName=n0;var o0="ToastClose",zp=g.forwardRef((e,t)=>{const{__scopeToast:n,...r}=e,o=t7(o0,n);return h.jsx(s0,{asChild:!0,children:h.jsx(Hn.button,{type:"button",...r,ref:t,onClick:Wt(e.onClick,o.onClose)})})});zp.displayName=o0;var s0=g.forwardRef((e,t)=>{const{__scopeToast:n,altText:r,...o}=e;return h.jsx(Hn.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...o,ref:t})});function i0(e){const t=[];return Array.from(e.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&t.push(r.textContent),a7(r)){const o=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!o)if(s){const i=r.dataset.radixToastAnnounceAlt;i&&t.push(i)}else t.push(...i0(r))}}),t}function uc(e,t,n,{discrete:r}){const o=n.originalEvent.currentTarget,s=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?zw(o,s):o.dispatchEvent(s)}var Dv=(e,t,n=0)=>{const r=Math.abs(e.x),o=Math.abs(e.y),s=r>o;return t==="left"||t==="right"?s&&r>n:!s&&o>n};function i7(e=()=>{}){const t=ar(e);gl(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[t])}function a7(e){return e.nodeType===e.ELEMENT_NODE}function c7(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Rd(e){const t=document.activeElement;return e.some(n=>n===t?!0:(n.focus(),document.activeElement!==t))}var l7=Jw,u7=e0,d7=t0,f7=r0,Nv=zp;let Xf={fonts:{draw:"/tlassets/fonts/AnimeAce3BB-Italic.woff2",serif:"/tlassets/fonts/YasashisaAntique.woff2",sansSerif:"/tlassets/fonts/IBMPlexSans-Medium.woff2",monospace:"/tlassets/fonts/IBMPlexMono-Medium.woff2"}};function qX(e){return g.useMemo(()=>e?{fonts:{...Xf.fonts,...e==null?void 0:e.fonts}}:Xf,[e])}const h7=["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"];let gi={...Xf,icons:Object.fromEntries(h7.map(e=>[e,`/tlassets/icons/icon/${e}.svg`])),translations:Object.fromEntries(Li.map(e=>[e.locale,`/tlassets/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(Ps.map(e=>[e.type,`/tlassets/embed-icons/${e.type}.png`]))};function p7(e){return e?{fonts:Object.assign({...gi.fonts},{...e==null?void 0:e.fonts}),icons:Object.assign({...gi.icons},{...e==null?void 0:e.icons}),embedIcons:Object.assign({...gi.embedIcons},{...e==null?void 0:e.embedIcons}),translations:Object.assign({...gi.translations},{...e==null?void 0:e.translations})}:gi}function g7(e,t){const n=fe(t.map(o=>e.getShape(o)).filter(o=>o&&e.isShapeOfType(o,"frame")));if(!n.length)return;const r=[];e.batch(()=>{n.map(o=>{const s=e.getSortedChildIdsForParent(o.id);s.length&&(e.reparentShapes(s,o.parentId,o.index),r.push(...s))}),e.setSelectedShapes(r),e.deleteShapes(t)})}const m7=50;function y7(e,t,n={}){const r=e.getShape(t);if(!r)return;const o=e.getSortedChildIdsForParent(r.id),s=fe(o.map(p=>e.getShape(p)));if(!s.length)return;const i=ce.FromPoints(s.flatMap(p=>{const v=e.getShapeGeometry(p.id);return e.getShapeLocalTransform(p).applyToPoints(v.vertices)})),{padding:a=m7}=n,c=i.w+2*a,l=i.h+2*a,u=a-i.minX,d=a-i.minY;if(u===0&&d===0&&r.props.w===c&&r.props.h===l)return;const f=new k(u,d).rot(r.rotation);e.batch(()=>{const p=o.map(v=>{const m=e.getShape(v);return{id:m.id,type:m.type,x:m.x+u,y:m.y+d}});p.push({id:r.id,type:r.type,x:r.x-f.x,y:r.y-f.y,props:{w:c,h:l}}),e.updateShapes(p)})}const a0=g.createContext(null);function v7({assetUrls:e,children:t}){return h.jsx(a0.Provider,{value:e,children:t})}function Up(){const e=g.useContext(a0);if(!e)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return e}const qf={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.lock":"Lock","action.unlock":"Unlock","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.dialogue":"Dialog","tool.rich-dialogue":"Rich Dialog","tool.rich-text":"Rich Text","tool.marker":"Marker (Drawing)","tool.marker-lasso":"Marker (Lasso)","tool.marker-geo":"Marker (Rectangle)","tool.marker-eraser":"Marker Eraser","tool.svg":"Shapes","tool.speed-lines":"Speed Lines","tool.focus-lines":"Focus Lines","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Workspace 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Go={locale:"en",label:"English",messages:qf};async function b7(e,t){if(!(await fetch(t.translations.en)).ok)return console.warn("No main translations found."),Go;if(e==="en")return Go;const r=Li.find(i=>i.locale===e);if(!r)return console.warn(`No translation found for locale ${e}`),Go;const s=await(await fetch(t.translations[r.locale])).json();if(!s)return console.warn(`No messages found for locale ${e}`),Go;for(const i in Go.messages)s[i];return{locale:e,label:r.label,messages:{...Go.messages,...s}}}const c0=g.createContext({}),S7=()=>g.useContext(c0),x7=Te(function({overrides:t,children:n}){const o=U().user.getLocale(),s=Up(),[i,a]=g.useState(()=>t&&t.en?{locale:"en",label:"English",messages:{...qf,...t.en}}:{locale:"en",label:"English",messages:qf});return g.useEffect(()=>{let c=!1;async function l(){const u=await b7(o,s);u&&!c&&(t&&t[o]?a({...u,messages:{...u.messages,...t[o]}}):a(u))}return l(),()=>{c=!0}},[s,o,t]),h.jsx(c0.Provider,{value:i,children:n})});function Ce(){const e=S7();return g.useCallback(function(n){return e.messages[n]??n},[e])}const Yt=g.memo(function({small:t,invertIcon:n,icon:r,color:o,className:s,...i}){const a=Up(),c=a.icons[r]??a.icons["question-mark-circle"],l=g.useRef(null);return g.useLayoutEffect(()=>{c||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${JSON.stringify(c)}) center 100% / 100% no-repeat`)},[l,c,r]),h.jsx("div",{...i,ref:l,className:ue("tlui-icon",{"tlui-icon__small":t},s),style:{color:o,mask:`url(${JSON.stringify(c)}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}),l0=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,u0=l0?"⌘":"Ctrl",d0=l0?"⌥":"Alt";function w7(e){return e.split(",")[0].split("").map(t=>{const n=t.replace(/\$/g,u0).replace(/\?/g,d0).replace(/!/g,"⇧");return n[0].toUpperCase()+n.slice(1)})}function Un(e){return"— "+e.split(",")[0].split("").map(t=>{const n=t.replace(/\$/g,u0).replace(/\?/g,d0).replace(/!/g,"⇧");return n[0].toUpperCase()+n.slice(1)}).join(" ")}function ru({children:e}){return h.jsx("kbd",{className:"tlui-kbd",children:w7(e).map((t,n)=>h.jsx("span",{children:t},n))})}const te=g.forwardRef(function({label:t,icon:n,invertIcon:r,iconLeft:o,smallIcon:s,kbd:i,isChecked:a=!1,type:c,children:l,spinner:u,...d},f){const p=Ce(),v=t?p(t):"";return h.jsxs("button",{ref:f,draggable:!1,type:"button",...d,title:d.title??v,className:ue("tlui-button",`tlui-button__${c}`,d.className),children:[o&&h.jsx(Yt,{icon:o,className:"tlui-button__icon-left",small:!0}),l,t&&h.jsxs("span",{className:"tlui-button__label",draggable:!1,children:[v,a&&h.jsx(Yt,{icon:"check"})]}),i&&h.jsx(ru,{children:i}),n&&!u&&h.jsx(Yt,{icon:n,small:!!t||s,invertIcon:r}),u&&h.jsx(z5,{})]})});function jr(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function C7(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function f0(...e){return t=>e.forEach(n=>C7(n,t))}function Ao(...e){return g.useCallback(f0(...e),e)}function P7(e,t){const n=g.createContext(t),r=s=>{const{children:i,...a}=s,c=g.useMemo(()=>a,Object.values(a));return h.jsx(n.Provider,{value:c,children:i})};r.displayName=e+"Provider";function o(s){const i=g.useContext(n);if(i)return i;if(t!==void 0)return t;throw new Error(`\`${s}\` must be used within \`${e}\``)}return[r,o]}function E7(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];const l=d=>{var b;const{scope:f,children:p,...v}=d,m=((b=f==null?void 0:f[e])==null?void 0:b[c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})};l.displayName=s+"Provider";function u(d,f){var m;const p=((m=f==null?void 0:f[e])==null?void 0:m[c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,_7(o,...t)]}function _7(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}var ml=globalThis!=null&&globalThis.document?g.useLayoutEffect:()=>{},I7=_h.useId||(()=>{}),k7=0;function jd(e){const[t,n]=g.useState(I7());return ml(()=>{e||n(r=>r??String(k7++))},[e]),e||(t?`radix-${t}`:"")}function So(e){const t=g.useRef(e);return g.useEffect(()=>{t.current=e}),g.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function T7({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,o]=$7({defaultProp:t,onChange:n}),s=e!==void 0,i=s?e:r,a=So(n),c=g.useCallback(l=>{if(s){const d=typeof l=="function"?l(e):l;d!==e&&a(d)}else o(l)},[s,e,o,a]);return[i,c]}function $7({defaultProp:e,onChange:t}){const n=g.useState(e),[r]=n,o=g.useRef(r),s=So(t);return g.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var Vp=g.forwardRef((e,t)=>{const{children:n,...r}=e,o=g.Children.toArray(n),s=o.find(M7);if(s){const i=s.props.children,a=o.map(c=>c===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(Zf,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(Zf,{...r,ref:t,children:n})});Vp.displayName="Slot";var Zf=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const o=R7(n);return g.cloneElement(n,{...O7(r,n.props),ref:t?f0(t,o):o})}return g.Children.count(n)>1?g.Children.only(null):null});Zf.displayName="SlotClone";var A7=({children:e})=>h.jsx(h.Fragment,{children:e});function M7(e){return g.isValidElement(e)&&e.type===A7}function O7(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function R7(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var j7=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],mr=j7.reduce((e,t)=>{const n=g.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Vp:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function D7(e,t){e&&Eo.flushSync(()=>e.dispatchEvent(t))}function N7(e,t=globalThis==null?void 0:globalThis.document){const n=So(e);g.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var L7="DismissableLayer",Qf="dismissableLayer.update",F7="dismissableLayer.pointerDownOutside",B7="dismissableLayer.focusOutside",Lv,h0=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),p0=g.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...c}=e,l=g.useContext(h0),[u,d]=g.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=g.useState({}),v=Ao(t,E=>d(E)),m=Array.from(l.layers),[y]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(y),x=u?m.indexOf(u):-1,w=l.layersWithOutsidePointerEventsDisabled.size>0,S=x>=b,C=V7(E=>{const _=E.target,$=[...l.branches].some(T=>T.contains(_));!S||$||(o==null||o(E),i==null||i(E),E.defaultPrevented||a==null||a())},f),P=K7(E=>{const _=E.target;[...l.branches].some(T=>T.contains(_))||(s==null||s(E),i==null||i(E),E.defaultPrevented||a==null||a())},f);return N7(E=>{x===l.layers.size-1&&(r==null||r(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},f),g.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(Lv=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),Fv(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Lv)}},[u,f,n,l]),g.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),Fv())},[u,l]),g.useEffect(()=>{const E=()=>p({});return document.addEventListener(Qf,E),()=>document.removeEventListener(Qf,E)},[]),h.jsx(mr.div,{...c,ref:v,style:{pointerEvents:w?S?"auto":"none":void 0,...e.style},onFocusCapture:jr(e.onFocusCapture,P.onFocusCapture),onBlurCapture:jr(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:jr(e.onPointerDownCapture,C.onPointerDownCapture)})});p0.displayName=L7;var z7="DismissableLayerBranch",U7=g.forwardRef((e,t)=>{const n=g.useContext(h0),r=g.useRef(null),o=Ao(t,r);return g.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(mr.div,{...e,ref:o})});U7.displayName=z7;function V7(e,t=globalThis==null?void 0:globalThis.document){const n=So(e),r=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){g0(F7,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=c,t.addEventListener("click",o.current,{once:!0})):c()}else t.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",s),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function K7(e,t=globalThis==null?void 0:globalThis.document){const n=So(e),r=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!r.current&&g0(B7,n,{originalEvent:s},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Fv(){const e=new CustomEvent(Qf);document.dispatchEvent(e)}function g0(e,t,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?D7(o,s):o.dispatchEvent(s)}var Dd="focusScope.autoFocusOnMount",Nd="focusScope.autoFocusOnUnmount",Bv={bubbles:!1,cancelable:!0},W7="FocusScope",m0=g.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=e,[a,c]=g.useState(null),l=So(o),u=So(s),d=g.useRef(null),f=Ao(t,m=>c(m)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(r){let m=function(w){if(p.paused||!a)return;const S=w.target;a.contains(S)?d.current=S:Er(d.current,{select:!0})},y=function(w){if(p.paused||!a)return;const S=w.relatedTarget;S!==null&&(a.contains(S)||Er(d.current,{select:!0}))},b=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&Er(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const x=new MutationObserver(b);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),x.disconnect()}}},[r,a,p.paused]),g.useEffect(()=>{if(a){Uv.add(p);const m=document.activeElement;if(!a.contains(m)){const b=new CustomEvent(Dd,Bv);a.addEventListener(Dd,l),a.dispatchEvent(b),b.defaultPrevented||(H7(Z7(y0(a)),{select:!0}),document.activeElement===m&&Er(a))}return()=>{a.removeEventListener(Dd,l),setTimeout(()=>{const b=new CustomEvent(Nd,Bv);a.addEventListener(Nd,u),a.dispatchEvent(b),b.defaultPrevented||Er(m??document.body,{select:!0}),a.removeEventListener(Nd,u),Uv.remove(p)},0)}}},[a,l,u,p]);const v=g.useCallback(m=>{if(!n&&!r||p.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,b=document.activeElement;if(y&&b){const x=m.currentTarget,[w,S]=G7(x);w&&S?!m.shiftKey&&b===S?(m.preventDefault(),n&&Er(w,{select:!0})):m.shiftKey&&b===w&&(m.preventDefault(),n&&Er(S,{select:!0})):b===x&&m.preventDefault()}},[n,r,p.paused]);return h.jsx(mr.div,{tabIndex:-1,...i,ref:f,onKeyDown:v})});m0.displayName=W7;function H7(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Er(r,{select:t}),document.activeElement!==n)return}function G7(e){const t=y0(e),n=zv(t,e),r=zv(t.reverse(),e);return[n,r]}function y0(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function zv(e,t){for(const n of e)if(!Y7(n,{upTo:t}))return n}function Y7(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function X7(e){return e instanceof HTMLInputElement&&"select"in e}function Er(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&X7(e)&&t&&e.select()}}var Uv=q7();function q7(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=Vv(e,t),e.unshift(t)},remove(t){var n;e=Vv(e,t),(n=e[0])==null||n.resume()}}}function Vv(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function Z7(e){return e.filter(t=>t.tagName!=="A")}var Q7="Portal",v0=g.forwardRef((e,t)=>{var a;const{container:n,...r}=e,[o,s]=g.useState(!1);ml(()=>s(!0),[]);const i=n||o&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?Qi.createPortal(h.jsx(mr.div,{...r,ref:t}),i):null});v0.displayName=Q7;function J7(e,t){return g.useReducer((n,r)=>t[n][r]??n,e)}var ou=e=>{const{present:t,children:n}=e,r=e4(t),o=typeof n=="function"?n({present:r.isPresent}):g.Children.only(n),s=Ao(r.ref,t4(o));return typeof n=="function"||r.isPresent?g.cloneElement(o,{ref:s}):null};ou.displayName="Presence";function e4(e){const[t,n]=g.useState(),r=g.useRef({}),o=g.useRef(e),s=g.useRef("none"),i=e?"mounted":"unmounted",[a,c]=J7(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const l=dc(r.current);s.current=a==="mounted"?l:"none"},[a]),ml(()=>{const l=r.current,u=o.current;if(u!==e){const f=s.current,p=dc(l);e?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,c]),ml(()=>{if(t){let l;const u=t.ownerDocument.defaultView??window,d=p=>{const m=dc(r.current).includes(p.animationName);if(p.target===t&&m&&(c("ANIMATION_END"),!o.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",l=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},f=p=>{p.target===t&&(s.current=dc(r.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{u.clearTimeout(l),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:g.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function dc(e){return(e==null?void 0:e.animationName)||"none"}function t4(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var Ld=0;function n4(){g.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??Kv()),document.body.insertAdjacentElement("beforeend",e[1]??Kv()),Ld++,()=>{Ld===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),Ld--}},[])}function Kv(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var jc="right-scroll-bar-position",Dc="width-before-scroll-bar",r4="with-scroll-bars-hidden",o4="--removed-body-scroll-bar-size",b0=Ih(),Fd=function(){},su=g.forwardRef(function(e,t){var n=g.useRef(null),r=g.useState({onScrollCapture:Fd,onWheelCapture:Fd,onTouchMoveCapture:Fd}),o=r[0],s=r[1],i=e.forwardProps,a=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,f=e.sideCar,p=e.noIsolation,v=e.inert,m=e.allowPinchZoom,y=e.as,b=y===void 0?"div":y,x=e.gapMode,w=kh(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=f,C=Th([n,t]),P=rt(rt({},w),o);return g.createElement(g.Fragment,null,u&&g.createElement(S,{sideCar:b0,removeScrollBar:l,shards:d,noIsolation:p,inert:v,setCallbacks:s,allowPinchZoom:!!m,lockRef:n,gapMode:x}),i?g.cloneElement(g.Children.only(a),rt(rt({},P),{ref:C})):g.createElement(b,rt({},P,{className:c,ref:C}),a))});su.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};su.classNames={fullWidth:Dc,zeroRight:jc};var s4={left:0,top:0,right:0,gap:0},Bd=function(e){return parseInt(e||"",10)||0},i4=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[Bd(n),Bd(r),Bd(o)]},a4=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return s4;var t=i4(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},c4=Ms(),ps="data-scroll-locked",l4=function(e,t,n,r){var o=e.left,s=e.top,i=e.right,a=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(r4,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(ps,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(jc,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Dc,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(jc," .").concat(jc,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Dc," .").concat(Dc,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ps,`] {
    `).concat(o4,": ").concat(a,`px;
  }
`)},Wv=function(){var e=parseInt(document.body.getAttribute(ps)||"0",10);return isFinite(e)?e:0},u4=function(){g.useEffect(function(){return document.body.setAttribute(ps,(Wv()+1).toString()),function(){var e=Wv()-1;e<=0?document.body.removeAttribute(ps):document.body.setAttribute(ps,e.toString())}},[])},d4=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;u4();var s=g.useMemo(function(){return a4(o)},[o]);return g.createElement(c4,{styles:l4(s,!t,o,n?"":"!important")})},Jf=!1;if(typeof window<"u")try{var fc=Object.defineProperty({},"passive",{get:function(){return Jf=!0,!0}});window.addEventListener("test",fc,fc),window.removeEventListener("test",fc,fc)}catch{Jf=!1}var Yo=Jf?{passive:!1}:!1,f4=function(e){return e.tagName==="TEXTAREA"},S0=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!f4(e)&&n[t]==="visible")},h4=function(e){return S0(e,"overflowY")},p4=function(e){return S0(e,"overflowX")},Hv=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=x0(e,r);if(o){var s=w0(e,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},g4=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},m4=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},x0=function(e,t){return e==="v"?h4(t):p4(t)},w0=function(e,t){return e==="v"?g4(t):m4(t)},y4=function(e,t){return e==="h"&&t==="rtl"?-1:1},v4=function(e,t,n,r,o){var s=y4(e,window.getComputedStyle(t).direction),i=s*r,a=n.target,c=t.contains(a),l=!1,u=i>0,d=0,f=0;do{var p=w0(e,a),v=p[0],m=p[1],y=p[2],b=m-y-s*v;(v||b)&&x0(e,a)&&(d+=b,f+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(l=!0),l},hc=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Gv=function(e){return[e.deltaX,e.deltaY]},Yv=function(e){return e&&"current"in e?e.current:e},b4=function(e,t){return e[0]===t[0]&&e[1]===t[1]},S4=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},x4=0,Xo=[];function w4(e){var t=g.useRef([]),n=g.useRef([0,0]),r=g.useRef(),o=g.useState(x4++)[0],s=g.useState(Ms)[0],i=g.useRef(e);g.useEffect(function(){i.current=e},[e]),g.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var m=$h([e.lockRef.current],(e.shards||[]).map(Yv),!0).filter(Boolean);return m.forEach(function(y){return y.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var a=g.useCallback(function(m,y){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var b=hc(m),x=n.current,w="deltaX"in m?m.deltaX:x[0]-b[0],S="deltaY"in m?m.deltaY:x[1]-b[1],C,P=m.target,E=Math.abs(w)>Math.abs(S)?"h":"v";if("touches"in m&&E==="h"&&P.type==="range")return!1;var _=Hv(E,P);if(!_)return!0;if(_?C=E:(C=E==="v"?"h":"v",_=Hv(E,P)),!_)return!1;if(!r.current&&"changedTouches"in m&&(w||S)&&(r.current=C),!C)return!0;var $=r.current||C;return v4($,y,m,$==="h"?w:S)},[]),c=g.useCallback(function(m){var y=m;if(!(!Xo.length||Xo[Xo.length-1]!==s)){var b="deltaY"in y?Gv(y):hc(y),x=t.current.filter(function(C){return C.name===y.type&&(C.target===y.target||y.target===C.shadowParent)&&b4(C.delta,b)})[0];if(x&&x.should){y.cancelable&&y.preventDefault();return}if(!x){var w=(i.current.shards||[]).map(Yv).filter(Boolean).filter(function(C){return C.contains(y.target)}),S=w.length>0?a(y,w[0]):!i.current.noIsolation;S&&y.cancelable&&y.preventDefault()}}},[]),l=g.useCallback(function(m,y,b,x){var w={name:m,delta:y,target:b,should:x,shadowParent:C4(b)};t.current.push(w),setTimeout(function(){t.current=t.current.filter(function(S){return S!==w})},1)},[]),u=g.useCallback(function(m){n.current=hc(m),r.current=void 0},[]),d=g.useCallback(function(m){l(m.type,Gv(m),m.target,a(m,e.lockRef.current))},[]),f=g.useCallback(function(m){l(m.type,hc(m),m.target,a(m,e.lockRef.current))},[]);g.useEffect(function(){return Xo.push(s),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",c,Yo),document.addEventListener("touchmove",c,Yo),document.addEventListener("touchstart",u,Yo),function(){Xo=Xo.filter(function(m){return m!==s}),document.removeEventListener("wheel",c,Yo),document.removeEventListener("touchmove",c,Yo),document.removeEventListener("touchstart",u,Yo)}},[]);var p=e.removeScrollBar,v=e.inert;return g.createElement(g.Fragment,null,v?g.createElement(s,{styles:S4(o)}):null,p?g.createElement(d4,{gapMode:e.gapMode}):null)}function C4(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const P4=Ah(b0,w4);var C0=g.forwardRef(function(e,t){return g.createElement(su,rt({},e,{ref:t,sideCar:P4}))});C0.classNames=su.classNames;var Kp="Dialog",[P0,ZX]=E7(Kp),[E4,In]=P0(Kp),E0=e=>{const{__scopeDialog:t,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=e,a=g.useRef(null),c=g.useRef(null),[l=!1,u]=T7({prop:r,defaultProp:o,onChange:s});return h.jsx(E4,{scope:t,triggerRef:a,contentRef:c,contentId:jd(),titleId:jd(),descriptionId:jd(),open:l,onOpenChange:u,onOpenToggle:g.useCallback(()=>u(d=>!d),[u]),modal:i,children:n})};E0.displayName=Kp;var _0="DialogTrigger",_4=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=In(_0,n),s=Ao(t,o.triggerRef);return h.jsx(mr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Gp(o.open),...r,ref:s,onClick:jr(e.onClick,o.onOpenToggle)})});_4.displayName=_0;var Wp="DialogPortal",[I4,I0]=P0(Wp,{forceMount:void 0}),k0=e=>{const{__scopeDialog:t,forceMount:n,children:r,container:o}=e,s=In(Wp,t);return h.jsx(I4,{scope:t,forceMount:n,children:g.Children.map(r,i=>h.jsx(ou,{present:n||s.open,children:h.jsx(v0,{asChild:!0,container:o,children:i})}))})};k0.displayName=Wp;var yl="DialogOverlay",T0=g.forwardRef((e,t)=>{const n=I0(yl,e.__scopeDialog),{forceMount:r=n.forceMount,...o}=e,s=In(yl,e.__scopeDialog);return s.modal?h.jsx(ou,{present:r||s.open,children:h.jsx(k4,{...o,ref:t})}):null});T0.displayName=yl;var k4=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=In(yl,n);return h.jsx(C0,{as:Vp,allowPinchZoom:!0,shards:[o.contentRef],children:h.jsx(mr.div,{"data-state":Gp(o.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),xo="DialogContent",$0=g.forwardRef((e,t)=>{const n=I0(xo,e.__scopeDialog),{forceMount:r=n.forceMount,...o}=e,s=In(xo,e.__scopeDialog);return h.jsx(ou,{present:r||s.open,children:s.modal?h.jsx(T4,{...o,ref:t}):h.jsx($4,{...o,ref:t})})});$0.displayName=xo;var T4=g.forwardRef((e,t)=>{const n=In(xo,e.__scopeDialog),r=g.useRef(null),o=Ao(t,n.contentRef,r);return g.useEffect(()=>{const s=r.current;if(s)return kl(s)},[]),h.jsx(A0,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:jr(e.onCloseAutoFocus,s=>{var i;s.preventDefault(),(i=n.triggerRef.current)==null||i.focus()}),onPointerDownOutside:jr(e.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:jr(e.onFocusOutside,s=>s.preventDefault())})}),$4=g.forwardRef((e,t)=>{const n=In(xo,e.__scopeDialog),r=g.useRef(!1),o=g.useRef(!1);return h.jsx(A0,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,a;(i=e.onCloseAutoFocus)==null||i.call(e,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{var c,l;(c=e.onInteractOutside)==null||c.call(e,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;((l=n.triggerRef.current)==null?void 0:l.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),A0=g.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=e,a=In(xo,n),c=g.useRef(null),l=Ao(t,c);return n4(),h.jsxs(h.Fragment,{children:[h.jsx(m0,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(p0,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Gp(a.open),...i,ref:l,onDismiss:()=>a.onOpenChange(!1)})}),h.jsxs(h.Fragment,{children:[h.jsx(M4,{titleId:a.titleId}),h.jsx(R4,{contentRef:c,descriptionId:a.descriptionId})]})]})}),Hp="DialogTitle",M0=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=In(Hp,n);return h.jsx(mr.h2,{id:o.titleId,...r,ref:t})});M0.displayName=Hp;var O0="DialogDescription",A4=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=In(O0,n);return h.jsx(mr.p,{id:o.descriptionId,...r,ref:t})});A4.displayName=O0;var R0="DialogClose",j0=g.forwardRef((e,t)=>{const{__scopeDialog:n,...r}=e,o=In(R0,n);return h.jsx(mr.button,{type:"button",...r,ref:t,onClick:jr(e.onClick,()=>o.onOpenChange(!1))})});j0.displayName=R0;function Gp(e){return e?"open":"closed"}var D0="DialogTitleWarning",[QX,N0]=P7(D0,{contentName:xo,titleName:Hp,docsSlug:"dialog"}),M4=({titleId:e})=>{const t=N0(D0),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return g.useEffect(()=>{e&&(document.getElementById(e)||console.error(n))},[n,e]),null},O4="DialogDescriptionWarning",R4=({contentRef:e,descriptionId:t})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${N0(O4).contentName}}.`;return g.useEffect(()=>{var s;const o=(s=e.current)==null?void 0:s.getAttribute("aria-describedby");t&&o&&(document.getElementById(t)||console.warn(r))},[r,e,t]),null},j4=E0,D4=k0,N4=T0,L4=$0;function iu({className:e,children:t}){return h.jsx("div",{className:ue("tlui-dialog__header",e),children:t})}function au({className:e,children:t}){return h.jsx(M0,{dir:"ltr",className:ue("tlui-dialog__header__title",e),children:t})}function cu(){return h.jsx("div",{className:"tlui-dialog__header__close",children:h.jsx(j0,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:h.jsx(te,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:h.jsx(Yt,{small:!0,icon:"cross-2"})})})})}function Ki({className:e,children:t,style:n}){return h.jsx("div",{className:ue("tlui-dialog__body",e),style:n,children:t})}function Yp({className:e,children:t}){return h.jsx("div",{className:ue("tlui-dialog__footer",e),children:t})}const Xp=g.forwardRef(function({className:t,label:n,icon:r,iconLeft:o,autoselect:s=!1,autofocus:i=!1,defaultValue:a,placeholder:c,onComplete:l,onValueChange:u,onCancel:d,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:p=!1,children:v,value:m},y){const b=U(),x=g.useRef(null);g.useImperativeHandle(y,()=>x.current);const w=Ce(),S=g.useRef(a??""),C=g.useRef(a??""),[P,E]=g.useState(!1),_=g.useCallback(O=>{E(!0);const j=O.currentTarget;C.current=j.value,requestAnimationFrame(()=>{s&&j.select()})},[s]),$=g.useCallback(O=>{const j=O.currentTarget.value;C.current=j,u==null||u(j)},[u]),T=g.useCallback(O=>{switch(O.key){case"Enter":{O.currentTarget.blur(),Ct(O),l==null||l(O.currentTarget.value);break}case"Escape":{O.currentTarget.value=S.current,O.currentTarget.blur(),Ct(O),d==null||d(O.currentTarget.value);break}}},[l,d]),M=g.useCallback(O=>{E(!1);const j=O.currentTarget.value;f==null||f(j)},[f]);return g.useEffect(()=>{if(!b.environment.isIos)return;const O=window.visualViewport;if(P&&p&&O){const j=()=>{var N;(N=x.current)==null||N.scrollIntoView({block:"center"})};return O.addEventListener("resize",j),O.addEventListener("scroll",j),requestAnimationFrame(()=>{var N;(N=x.current)==null||N.scrollIntoView({block:"center"})}),()=>{O.removeEventListener("resize",j),O.removeEventListener("scroll",j)}}},[b,P,p]),h.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[v,n&&h.jsx("label",{children:w(n)}),o&&h.jsx(Yt,{icon:o,className:"tlui-icon-left",small:!0}),h.jsx("input",{ref:x,className:ue("tlui-input",t),type:"text",defaultValue:a,onKeyUp:T,onChange:$,onFocus:_,onBlur:M,autoFocus:i,placeholder:c,value:m}),r&&h.jsx(Yt,{icon:r,small:!!n})]})});function Xv(e){return gf(e)?{isValid:!0,hasProtocol:!0}:gf("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const F4=Te(function({onClose:t}){const r=U().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?h.jsx(B4,{onClose:t,selectedShape:r}):null}),B4=Te(function({onClose:t,selectedShape:n}){const r=U(),o=Ce(),s=g.useRef(null);g.useEffect(()=>{requestAnimationFrame(()=>{var v;return(v=s.current)==null?void 0:v.focus()})},[]);const i=g.useRef(n.props.url),[a,c]=g.useState(()=>{const v=Xv(n.props.url),m=v.isValid===!0?v.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:m,safe:m,valid:!0}}),l=g.useCallback(v=>{const m=v.replace(/https?:\/\/(https?:\/\/)/,(x,w)=>w),y=Xv(m),b=y.isValid===!0?y.hasProtocol?m:"https://"+m:"https://";c({actual:m,safe:b,valid:y.isValid})},[]),u=g.useCallback(()=>{const v=r.getOnlySelectedShape();v&&(r.updateShapes([{id:v.id,type:v.type,props:{url:""}}]),t())},[r,t]),d=g.useCallback(()=>{const v=r.getOnlySelectedShape();v&&(v&&"url"in v.props&&v.props.url!==a.safe&&r.updateShapes([{id:v.id,type:v.type,props:{url:a.safe}}]),t())},[r,t,a]),f=g.useCallback(()=>{t()},[t]);if(!n)return t(),null;const p=i.current&&!a.valid;return h.jsxs(h.Fragment,{children:[h.jsxs(iu,{children:[h.jsx(au,{children:o("edit-link-dialog.title")}),h.jsx(cu,{})]}),h.jsx(Ki,{children:h.jsxs("div",{className:"tlui-edit-link-dialog",children:[h.jsx(Xp,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:a.actual,onValueChange:l,onComplete:d,onCancel:f}),h.jsx("div",{children:a.valid?o("edit-link-dialog.detail"):o("edit-link-dialog.invalid-url")})]})}),h.jsxs(Yp,{className:"tlui-dialog__footer__actions",children:[h.jsx(te,{type:"normal",onClick:f,onTouchEnd:f,children:o("edit-link-dialog.cancel")}),p?h.jsx(te,{type:"danger",onTouchEnd:u,onClick:u,children:o("edit-link-dialog.clear")}):h.jsx(te,{type:"primary",disabled:!a.valid,onTouchEnd:d,onClick:d,children:o("edit-link-dialog.save")})]})]})}),z4=Te(function({onClose:t}){const n=U(),r=Ce(),o=Up(),[s,i]=g.useState(null),[a,c]=g.useState(""),[l,u]=g.useState(null),[d,f]=g.useState(!1),p=g.useRef(-1);return h.jsxs(h.Fragment,{children:[h.jsxs(iu,{children:[h.jsx(au,{children:s?`${r("embed-dialog.title")} — ${s.title}`:r("embed-dialog.title")}),h.jsx(cu,{})]}),s?h.jsxs(h.Fragment,{children:[h.jsxs(Ki,{className:"tlui-embed-dialog__enter",children:[h.jsx(Xp,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:v=>{c(v);const m=Ap(v);u(m&&m.definition.type===s.type?m:null),f(!1),clearTimeout(p.current),p.current=setTimeout(()=>f(!m),320)}}),a===""?h.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[h.jsx("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&h.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",h.jsx(Yt,{icon:"external-link",small:!0})]})]}):h.jsx("div",{className:"tlui-embed-dialog__warning",children:d?r("embed-dialog.invalid-url"):" "})]}),h.jsxs(Yp,{className:"tlui-dialog__footer__actions",children:[h.jsx(te,{type:"normal",onClick:()=>{i(null),u(null),c("")},label:"embed-dialog.back"}),h.jsx("div",{className:"tlui-embed__spacer"}),h.jsx(te,{type:"normal",label:"embed-dialog.cancel",onClick:t}),h.jsx(te,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(n.putExternalContent({type:"embed",url:a,point:n.getViewportPageCenter(),embed:l.definition}),t())}})]})]}):h.jsx(h.Fragment,{children:h.jsx(Ki,{className:"tlui-embed-dialog__list",children:Ps.map(v=>h.jsx(te,{type:"menu",onClick:()=>i(v),label:v.title,children:h.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${JSON.stringify(o.embedIcons[v.type])})`}})},v.type))})})]})});var qp={exports:{}};qp.exports;(function(e){var t=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function i(c,l){if(!s[c]){s[c]={};for(var u=0;u<c.length;u++)s[c][c.charAt(u)]=u}return s[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return i(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),d=0,f=l.length;d<f;d++){var p=l.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,d=l.length;u<d;u++)l[u]=c[u*2]*256+c[u*2+1];var f=[];return l.forEach(function(p){f.push(n(p))}),a.decompress(f.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return o.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return i(o,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var d,f,p={},v={},m="",y="",b="",x=2,w=3,S=2,C=[],P=0,E=0,_;for(_=0;_<c.length;_+=1)if(m=c.charAt(_),Object.prototype.hasOwnProperty.call(p,m)||(p[m]=w++,v[m]=!0),y=b+m,Object.prototype.hasOwnProperty.call(p,y))b=y;else{if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(d=0;d<S;d++)P=P<<1,E==l-1?(E=0,C.push(u(P)),P=0):E++;for(f=b.charCodeAt(0),d=0;d<8;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1}else{for(f=1,d=0;d<S;d++)P=P<<1|f,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1}x--,x==0&&(x=Math.pow(2,S),S++),delete v[b]}else for(f=p[b],d=0;d<S;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1;x--,x==0&&(x=Math.pow(2,S),S++),p[y]=w++,b=String(m)}if(b!==""){if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(d=0;d<S;d++)P=P<<1,E==l-1?(E=0,C.push(u(P)),P=0):E++;for(f=b.charCodeAt(0),d=0;d<8;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1}else{for(f=1,d=0;d<S;d++)P=P<<1|f,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1}x--,x==0&&(x=Math.pow(2,S),S++),delete v[b]}else for(f=p[b],d=0;d<S;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1;x--,x==0&&(x=Math.pow(2,S),S++)}for(f=2,d=0;d<S;d++)P=P<<1|f&1,E==l-1?(E=0,C.push(u(P)),P=0):E++,f=f>>1;for(;;)if(P=P<<1,E==l-1){C.push(u(P));break}else E++;return C.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var d=[],f=4,p=4,v=3,m="",y=[],b,x,w,S,C,P,E,_={val:u(0),position:l,index:1};for(b=0;b<3;b+=1)d[b]=b;for(w=0,C=Math.pow(2,2),P=1;P!=C;)S=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),w|=(S>0?1:0)*P,P<<=1;switch(w){case 0:for(w=0,C=Math.pow(2,8),P=1;P!=C;)S=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),w|=(S>0?1:0)*P,P<<=1;E=n(w);break;case 1:for(w=0,C=Math.pow(2,16),P=1;P!=C;)S=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),w|=(S>0?1:0)*P,P<<=1;E=n(w);break;case 2:return""}for(d[3]=E,x=E,y.push(E);;){if(_.index>c)return"";for(w=0,C=Math.pow(2,v),P=1;P!=C;)S=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),w|=(S>0?1:0)*P,P<<=1;switch(E=w){case 0:for(w=0,C=Math.pow(2,8),P=1;P!=C;)S=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),w|=(S>0?1:0)*P,P<<=1;d[p++]=n(w),E=p-1,f--;break;case 1:for(w=0,C=Math.pow(2,16),P=1;P!=C;)S=_.val&_.position,_.position>>=1,_.position==0&&(_.position=l,_.val=u(_.index++)),w|=(S>0?1:0)*P,P<<=1;d[p++]=n(w),E=p-1,f--;break;case 2:return y.join("")}if(f==0&&(f=Math.pow(2,v),v++),d[E])m=d[E];else if(E===p)m=x+x.charAt(0);else return null;y.push(m),d[p++]=x+m.charAt(0),f--,x=m,f==0&&(f=Math.pow(2,v),v++)}}};return a}();e!=null?e.exports=t:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return t})})(qp);var L0=qp.exports;async function U4(e,t,n){var b,x,w;const{elements:r,files:o}=t,s={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},i=new Map,a=new Map,c=e.getCurrentPageId(),l=new Map,u=[],d=new Set;r.forEach(S=>{if(l.set(S.id,Ln()),S.boundElements!==null)for(const C of S.boundElements)C.type==="text"&&d.add(C.id)});let f="a1";for(const S of r){if(d.has(S.id))continue;const C=l.get(S.id),P={id:C,typeName:"shape",parentId:c,index:f,x:S.x,y:S.y,rotation:0,isLocked:S.locked,opacity:V4(S.opacity),meta:{}};switch(S.angle!==0&&a.set(C,S.angle),S.groupIds&&S.groupIds.length>0?i.has(S.groupIds[0])?(b=i.get(S.groupIds[0]))==null||b.push(C):i.set(S.groupIds[0],[C]):u.push(C),S.type){case"rectangle":case"ellipse":case"diamond":{let E="",_="middle";if(S.boundElements!==null){for(const T of S.boundElements)if(T.type==="text"){const M=r.find(O=>O.id===T.id);M&&(E=M.text,_=qv[M.textAlign])}}const $=S.backgroundColor==="transparent"?S.strokeColor:S.backgroundColor;s.shapes.push({...P,type:"geo",props:{geo:S.type,url:S.link??"",w:S.width,h:S.height,size:pc[S.strokeWidth]??"draw",color:mi[$]??"black",text:E,align:_,dash:gc(S),fill:q4(S)}});break}case"freedraw":{s.shapes.push({...P,type:"draw",props:{dash:gc(S),size:pc[S.strokeWidth],color:mi[S.strokeColor]??"black",segments:[{type:"free",points:S.points.map(([E,_,$=.5])=>({x:E,y:_,z:$}))}]}});break}case"line":{const E=S.points[0],_=S.points[S.points.length-1],$=gx(S.points.length);s.shapes.push({...P,type:"line",props:{dash:gc(S),size:pc[S.strokeWidth],color:mi[S.strokeColor]??"black",spline:S.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:$[0],x:E[0],y:E[1]},end:{id:"end",type:"vertex",index:$[$.length-1],x:_[0],y:_[1]},...Object.fromEntries(S.points.slice(1,-1).map(([T,M],O)=>{const j=je();return[j,{id:j,type:"vertex",index:$[O+1],x:T,y:M}]}))}}});break}case"arrow":{let E="";if(S.boundElements!==null){for(const O of S.boundElements)if(O.type==="text"){const j=r.find(N=>N.id===O.id);j&&(E=j.text)}}const _=S.points[0],$=S.points[S.points.length-1],T=l.get((x=S.startBinding)==null?void 0:x.elementId),M=l.get((w=S.endBinding)==null?void 0:w.elementId);s.shapes.push({...P,type:"arrow",props:{text:E,bend:X4(S,_,$),dash:gc(S),size:pc[S.strokeWidth]??"m",color:mi[S.strokeColor]??"black",start:T?{type:"binding",boundShapeId:T,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:_[0],y:_[1]},end:M?{type:"binding",boundShapeId:M,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:$[0],y:$[1]},arrowheadEnd:Zv[S.endArrowhead]??"none",arrowheadStart:Zv[S.startArrowhead]??"none"}});break}case"text":{const{size:E,scale:_}=W4(S.fontSize);s.shapes.push({...P,type:"text",props:{size:E,scale:_,font:H4[S.fontFamily]??"draw",color:mi[S.strokeColor]??"black",text:S.text,align:qv[S.textAlign]}});break}case"image":{const E=o[S.fileId];if(!E)break;const _=Ol.createId();s.assets.push({id:_,typeName:"asset",type:"image",props:{w:S.width,h:S.height,name:S.id??"Untitled",isAnimated:!1,mimeType:E.mimeType,src:E.dataURL},meta:{}}),s.shapes.push({...P,type:"image",props:{w:S.width,h:S.height,assetId:_}})}}f=Tr(f)}const p=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(s,{point:p,select:!1,preserveIds:!0});for(const S of i.values())if(S.length>1){e.groupShapes(S);const C=e.getShape(S[0]);C!=null&&C.parentId&&Sn(C.parentId)&&u.push(C.parentId)}for(const[S,C]of a)e.select(S),e.rotateShapesBy([S],C);const v=fe(u.map(S=>e.getShape(S))),m=ce.Common(v.map(S=>e.getShapePageBounds(S))),y=e.getViewportPageBounds().center;e.updateShapes(v.map(S=>{const C={x:(S.x??0)-(m.x+m.w/2),y:(S.y??0)-(m.y+m.h/2)};return{id:S.id,type:S.type,x:y.x+C.x,y:y.y+C.y}})),e.setSelectedShapes(u)}const V4=e=>{const t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},pc={1:"s",2:"m",3:"l",4:"xl"},K4={16:"s",20:"m",28:"l",36:"xl"};function W4(e){const t=K4[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}const H4={1:"draw",2:"sans",3:"mono"},mi={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},G4={solid:"draw",dashed:"dashed",dotted:"dotted"},Y4={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},qv={left:"start",center:"middle",right:"end"},Zv={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function X4(e,t,n){let r=0;if(e.points.length>2){const o=new k(t[0],t[1]),s=new k(n[0],n[1]),i=new k(e.points[1][0],e.points[1][1]),a=k.Sub(s,o),c=k.Per(a),l=k.Med(s,o),u=k.Sub(l,c),d=k.Add(l,c),f=k.NearestPointOnLineSegment(u,d,i,!1);r=k.Dist(f,l),k.Clockwise(f,s,l)&&(r*=-1)}return r}const gc=e=>{let t=G4[e.strokeStyle]??"draw";return t==="draw"&&e.roughness===0&&(t="solid"),t},q4=e=>e.backgroundColor==="transparent"?"none":Y4[e.fillStyle]??"solid";async function F0(e,t,n,r){const s=(await Promise.all(t.map(async i=>await(await fetch(i)).blob()))).map(i=>new File([i],"tldrawFile",{type:i.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:s,point:n,ignoreParent:!1,sources:r}),t.forEach(i=>URL.revokeObjectURL(i))}function Z4(e,t,n){const r=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);e.mark("paste"),e.putContentOntoCurrentPage(t,{point:r,select:!0})}async function eh(e,t,n,r){var o;try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)&&(o=(await fetch(t,{method:"HEAD"})).headers.get("content-type"))!=null&&o.match(/^image\//)){e.mark("paste"),F0(e,[t]);return}}catch(s){s.message!=="Failed to fetch"&&console.error(s)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}const B0=()=>{},z0=g.createContext({});function Q4({onEvent:e,children:t}){return h.jsx(z0.Provider,{value:e??B0,children:t})}function Ws(){return g.useContext(z0)??B0}function J4(e){const t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}const e8=e=>{try{const t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}},t8=e=>{const t=e.split(/[\n\s]/);for(const n of t)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return HS(t)},n8=e=>/^<svg/.test(e),r8=["input","select","textarea"];function Nc(e){const{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||r8.indexOf(t.tagName.toLowerCase())>-1)}async function zd(e){return new Promise((t,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{const o=r.result;t(o)}),r.addEventListener("error",()=>{n(r.error)}),r.readAsText(e)})}const o8=e=>e.types.find(t=>t.match(/^image\//)),Ud=(e,t,n,r)=>{const o=t8(t);if(o)for(const s of o)eh(e,s,n);else e8(t)?eh(e,t,n):n8(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},s8=async(e,t,n)=>{if(e.getEditingShapeId()!==null)return;if(!t)throw Error("No clipboard data");const r=[];for(const o of Object.values(t.items))switch(o.kind){case"file":{r.push({type:"file",source:new Promise(s=>s(o.getAsFile()))});break}case"string":{o.type==="text/html"?r.push({type:"html",source:new Promise(s=>o.getAsString(s))}):o.type==="text/plain"?r.push({type:"text",source:new Promise(s=>o.getAsString(s))}):r.push({type:o.type,source:new Promise(s=>o.getAsString(s))});break}}V0(e,r,n)},U0=async(e,t,n)=>{const r=[];for(const o of t){if(o8(o))for(const s of o.types)s.match(/^image\//)&&r.push({type:"blob",source:o.getType(s)});o.types.includes("text/html")&&r.push({type:"html",source:new Promise(s=>o.getType("text/html").then(i=>zd(i).then(s)))}),o.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(s=>o.getType("text/uri-list").then(i=>zd(i).then(s)))}),o.types.includes("text/plain")&&r.push({type:"text",source:new Promise(s=>o.getType("text/plain").then(i=>zd(i).then(s)))})}return await V0(e,r,n)};async function V0(e,t,n){const r=t.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(r.length){const i=(await Promise.all(r.map(a=>a.source))).filter(Boolean).map(a=>URL.createObjectURL(a));return await F0(e,i,n)}const o=await Promise.all(t.filter(s=>s.type!=="file").map(s=>new Promise(i=>{const a=s;if(a.type==="file"){i({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var u;const l=(u=c.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:u[1];if(l)try{const d=L0.decompressFromBase64(l);if(d===null){i({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const f=JSON.parse(d);if(f.type!=="application/tldraw"&&i({type:"error",data:f,reason:`found tldraw data comment but JSON was of a different type: ${f.type}`}),typeof f.data=="string"){i({type:"error",data:f,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}i({type:"tldraw",data:f.data});return}}catch{i({type:"error",data:l,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){i({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){i({type:"text",data:c,subtype:"url"});return}try{const d=JSON.parse(c);if(d.type==="excalidraw/clipboard"){i({type:"excalidraw",data:d});return}else{i({type:"text",data:c,subtype:"json"});return}}catch{i({type:"text",data:c,subtype:"text"});return}}})})));for(const s of o)if(s.type==="tldraw"){Z4(e,s.data,n);return}for(const s of o)if(s.type==="excalidraw"){U4(e,s.data,n);return}for(const s of o)if(s.type==="text"&&s.subtype==="html"){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(l=>l.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const l=a.firstElementChild.getAttribute("href");Ud(e,l,n,o);return}if(!o.some(l=>l.type==="text"&&l.subtype!=="html")&&s.data.trim()){Ud(e,J4(s.data),n,o);return}}for(const s of o)if(s.type==="text"&&s.subtype==="url"){eh(e,s.data,n,o);return}for(const s of o)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){Ud(e,s.data,n,o);return}}const vl=e=>{var r;const t=e.getContentFromCurrentPage(e.getSelectedShapeIds());if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const n=L0.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if(!(typeof navigator>"u")){const o=t.shapes.map(s=>e.isShapeOfType(s,"text")||e.isShapeOfType(s,"geo")||e.isShapeOfType(s,"arrow")?s.props.text:e.isShapeOfType(s,"bookmark")||e.isShapeOfType(s,"embed")?s.props.url:null).filter(DI);if((r=navigator.clipboard)!=null&&r.write){const s=new Blob([`<tldraw>${n}</tldraw>`],{type:"text/html"});let i=o.join(" ");i===""&&(i=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([i],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${n}</tldraw>`)}};function i8(){const e=U(),t=Ws(),n=g.useCallback(function(i){e.getSelectedShapeIds().length!==0&&(vl(e),t("copy",{source:i}))},[e,t]),r=g.useCallback(function(i){e.getSelectedShapeIds().length!==0&&(vl(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:i}))},[e,t]),o=g.useCallback(async function(i,a,c){e.getEditingShapeId()!==null||Nc(e)||(Array.isArray(i)&&i[0]instanceof ClipboardItem?(U0(e,i,c),t("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{o(l,a,c)}))},[e,t]);return{copy:n,cut:r,paste:o}}function a8(){const e=U(),t=Ws(),n=Y("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);g.useEffect(()=>{if(!n)return;const r=()=>{e.getSelectedShapeIds().length===0||e.getEditingShapeId()!==null||Nc(e)||(vl(e),t("copy",{source:"kbd"}))};function o(){e.getSelectedShapeIds().length===0||e.getEditingShapeId()!==null||Nc(e)||(vl(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let s=!1;const i=c=>{c.button===1&&(s=!0,requestAnimationFrame(()=>{s=!1}))},a=c=>{if(s){c.stopPropagation();return}e.getEditingShapeId()!==null||Nc(e)||(c.clipboardData&&!e.inputs.shiftKey?s8(e,c.clipboardData):navigator.clipboard.read().then(l=>{Array.isArray(l)&&l[0]instanceof ClipboardItem&&U0(e,l,e.inputs.currentPagePoint)}),t("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",o),document.addEventListener("paste",a),document.addEventListener("pointerup",i),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",o),document.removeEventListener("paste",a),document.removeEventListener("pointerup",i)}},[e,t,n])}async function K0(e,t,n){const{type:r,quality:o,scale:s}=n,i=+e.getAttribute("width"),a=+e.getAttribute("height");let c=i*s,l=a*s;const u=await W0(e),d=await h6();if(i>d.maxWidth&&(c=d.maxWidth,l=c/i*a),a>d.maxHeight&&(l=d.maxHeight,c=l/a*i),c*l>d.maxArea){const b=Math.sqrt(d.maxArea/(c*l));c*=b,l*=b}c=Math.floor(c),l=Math.floor(l);const f=c/i,p=await new Promise(b=>{const x=new Image;x.crossOrigin="anonymous",x.onload=async()=>{t&&await new Promise(C=>setTimeout(C,250));const w=document.createElement("canvas"),S=w.getContext("2d");w.width=c,w.height=l,S.imageSmoothingEnabled=!0,S.imageSmoothingQuality="high",S.drawImage(x,0,0,c,l),URL.revokeObjectURL(u),b(w)},x.onerror=()=>{b(null)},x.src=u});if(!p)return null;const v=await new Promise(b=>p.toBlob(x=>{(!x||ze.throwToBlob.get())&&b(null),b(x)},"image/"+r,o));if(!v)return null;if(r!=="png")return v;const m=new DataView(await v.arrayBuffer());let y=Rn.setPhysChunk(m,f,{type:"image/"+r});if(!y)return null;if(n.comment){const b=new DataView(await y.arrayBuffer());y=Rn.setItxtChunk(b,"Comment",n.comment)}return y}async function W0(e){const t=e.cloneNode(!0);t.setAttribute("encoding","UTF-8");const n=new FileReader,r=Array.from(t.querySelectorAll("image"));for(const i of r){const a=i.getAttribute("xlink:href");if(a&&!a.startsWith("data:")){const c=await(await fetch(a)).blob(),l=await new Promise((u,d)=>{n.onload=()=>u(n.result),n.onerror=()=>d(n.error),n.readAsDataURL(c)});i.setAttribute("xlink:href",l)}}const o=new XMLSerializer().serializeToString(t);return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(o)))}`}function c8(e,t,n="svg",r={}){return e.getSvg(t!=null&&t.length?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...r}).then(o=>{if(!o)throw new Error("Could not construct SVG.");switch(n){case"svg":{window.navigator.clipboard&&(window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([Jv(o)],{type:"text/plain"})})]):Qv(async()=>Jv(o)));break}case"jpeg":case"png":{const s=K0(o,e.environment.isSafari,{type:n,quality:1,scale:2}).then(a=>{if(a){if(window.navigator.clipboard)return a;throw new Error("Copy not supported")}else throw new Error("Copy not possible")}),i=n==="jpeg"?"image/jpeg":"image/png";window.navigator.clipboard.write&&window.navigator.clipboard.write([new ClipboardItem({[i]:s})]).catch(a=>{a.toString().match(/^TypeError: DOMString not supported/)||console.error(a),s.then(c=>{window.navigator.clipboard.write([new ClipboardItem({[i]:c})])})});break}case"json":{const s=e.getContentFromCurrentPage(t),i=JSON.stringify(s);window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([i],{type:"text/plain"})})]):Qv(async()=>i);break}default:throw new Error(`Copy type ${n} not supported.`)}})}async function Qv(e){var t,n;(n=(t=navigator.clipboard)==null?void 0:t.writeText)==null||n.call(t,await e())}function Jv(e){const t=e.cloneNode(!0);return e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+""),new XMLSerializer().serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}const H0=g.createContext({});function l8({children:e}){const[t,n]=g.useState([]),r=g.useCallback(i=>{const a=i.id??je();return n(c=>[...c.filter(l=>l.id!==i.id),{...i,id:a}]),a},[]),o=g.useCallback(i=>(n(a=>a.filter(c=>c.id!==i)),i),[]),s=g.useCallback(()=>{n(()=>[])},[]);return h.jsx(H0.Provider,{value:{toasts:t,addToast:r,removeToast:o,clearToasts:s},children:e})}function Gn(){const e=g.useContext(H0);if(!e)throw new Error("useToasts must be used within a ToastsProvider");return e}function u8(){const e=U(),{addToast:t}=Gn(),n=Ce();return g.useCallback((r,o="svg")=>{c8(e,r,o).catch(()=>{t({id:"copy-fail",icon:"warning-triangle",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}const G0=g.createContext({});function d8({children:e}){const t=U(),n=Ws(),[r,o]=g.useState([]),s=g.useCallback(l=>{const u=l.id??je();return o(d=>[...d.filter(f=>f.id!==l.id),{...l,id:u}]),n("open-menu",{source:"dialog",id:u}),t.addOpenMenu(u),u},[t,n]),i=g.useCallback((l,u)=>(o(d=>d.map(f=>f.id===l?{...f,...u}:f)),n("open-menu",{source:"dialog",id:l}),t.addOpenMenu(l),l),[t,n]),a=g.useCallback(l=>(o(u=>u.filter(d=>{var f;return d.id===l?((f=d.onClose)==null||f.call(d),!1):!0})),n("close-menu",{source:"dialog",id:l}),t.deleteOpenMenu(l),l),[t,n]),c=g.useCallback(()=>{o(l=>(l.forEach(u=>{var d;(d=u.onClose)==null||d.call(u),n("close-menu",{source:"dialog",id:u.id}),t.deleteOpenMenu(u.id)}),[]))},[t,n]);return h.jsx(G0.Provider,{value:{dialogs:r,addDialog:s,removeDialog:a,clearDialogs:c,updateDialog:i},children:e})}function Hs(){const e=g.useContext(G0);if(!e)throw new Error("useDialogs must be used within a DialogsProvider");return e}async function f8(e,t,n="png",r={}){const o=await e.getSvg(t!=null&&t.length?t:[...e.getCurrentPageShapeIds()],r);if(!o)throw new Error("Could not construct SVG.");let s="shapes"+h8();if(t.length===1){const i=e.getShape(t[0]);e.isShapeOfType(i,"frame")?s=i.props.name??"frame":s=i.id.replace(/:/,"_")}switch(n){case"svg":return W0(o).then(i=>Vd(i,`${s}.svg`));case"webp":case"png":{const i=await K0(o,e.environment.isSafari,{type:n,quality:1,scale:2});if(!i)throw Error();const a=URL.createObjectURL(i);Vd(a,`${s}.${n}`),URL.revokeObjectURL(a);return}case"json":{const i=e.getContentFromCurrentPage(t),a=new Blob([JSON.stringify(i,null,4)],{type:"application/json"}),c=URL.createObjectURL(a);Vd(c,`${s||"shapes"}.json`),URL.revokeObjectURL(c);return}default:throw new Error(`Export type ${n} not supported.`)}}function h8(){const e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),o=String(e.getHours()).padStart(2,"0"),s=String(e.getMinutes()).padStart(2,"0"),i=String(e.getSeconds()).padStart(2,"0");return` at ${t}-${n}-${r} ${o}.${s}.${i}`}function Vd(e,t){const n=document.createElement("a");n.href=e,n.download=t,n.click()}function p8(){const e=U(),{addToast:t}=Gn(),n=Ce();return g.useCallback((r,o="png")=>{f8(e,r,o,{scale:1,background:e.getInstanceState().exportBackground}).catch(s=>{console.error(s.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc")})})},[e,t,n])}function Y0(){const e=U(),t=g.useRef();return g.useEffect(()=>{const n=window.document.createElement("input");n.type="file",n.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",n.multiple=!0,t.current=n;async function r(o){const s=o.target.files;!s||s.length===0||(await e.putExternalContent({type:"files",files:Array.from(s),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.addEventListener("change",r),()=>{t.current=void 0,n.removeEventListener("change",r)}},[e]),g.useCallback(()=>{var n;(n=t.current)==null||n.click()},[t])}function g8(){const e=U(),t=g.useRef(null),n=g.useRef(null);return g.useCallback(async function(){const o=document.createElement("div"),s=document.createElement("style"),i=(b,x)=>{b&&(b.innerHTML=""),x&&document.head.contains(x)&&document.head.removeChild(x),b&&document.body.contains(b)&&document.body.removeChild(b)};i(t.current,n.current),t.current=o,n.current=s;const a=`tl-print-surface-${je()}`;o.className=a,s.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(s),document.body.appendChild(o)},l=()=>{e.once("change-history",()=>{i(o,s)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",l);function u(b,x,w){try{o.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${w.outerHTML}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${x?"":"hide"}">
          ${x??""}
        </div>
      </div>`}catch(S){console.error(S)}}function d(){e.environment.isChromeForIos?(c(),window.print()):e.environment.isSafari?(c(),document.execCommand("print",!1)):window.print()}const f=e.getSelectedShapeIds(),p=e.getCurrentPageId(),v=e.getPages(),y={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){const b=await e.getSvg(f,y);if(b){const x=v.find(w=>w.id===p);u(`tldraw — ${x==null?void 0:x.name}`,null,b),d()}}else{const b=e.getCurrentPage(),x=await e.getSvg(e.getSortedChildIdsForParent(b.id),y);x&&(u(`tldraw — ${b.name}`,null,x),d())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",l)},[e])}const X0=g.createContext({});function m8(e){return Object.fromEntries(e.map(t=>[t.id,t]))}function y8({overrides:e,children:t}){const n=U(),{addDialog:r,clearDialogs:o}=Hs(),{clearToasts:s}=Gn(),i=Y0(),a=g8(),{cut:c,copy:l,paste:u}=i8(),d=u8(),f=p8(),p=Ws(),v=g.useMemo(()=>{function m(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function y(){return n.getSelectedShapeIds().length>0}const x=m8([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(w){y()&&(m()||(p("edit-link",{source:w}),n.mark("edit-link"),r({component:F4})))}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,onSelect(w){p("insert-embed",{source:w}),r({component:z4})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(w){p("insert-media",{source:w}),i()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(w){p("undo",{source:w}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(w){p("redo",{source:w}),n.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(w){p("export-as",{format:"svg",source:w}),f(n.getSelectedShapeIds(),"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(w){p("export-as",{format:"png",source:w}),f(n.getSelectedShapeIds(),"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(w){p("export-as",{format:"json",source:w}),f(n.getSelectedShapeIds(),"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(w){p("copy-as",{format:"svg",source:w}),d(n.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(w){p("copy-as",{format:"png",source:w}),d(n.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(w){p("copy-as",{format:"json",source:w}),d(n.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(w){y()&&(m()||(p("toggle-auto-size",{source:w}),n.mark("toggling auto size"),n.updateShapes(n.getSelectedShapes().filter(S=>n.isShapeOfType(S,"text")&&S.props.autoSize===!1).map(S=>({id:S.id,type:S.type,props:{...S.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(w){p("open-embed-link",{source:w});const S=n.getSelectedShapeIds(),C="No embed shapes selected";if(S.length!==1){console.error(C);return}const P=n.getShape(S[0]);if(!P||!n.isShapeOfType(P,"embed")){console.error(C);return}uR(P.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(w){var S,C;if(((S=n.root.getCurrent())==null?void 0:S.id)!=="zoom"&&(p("zoom-tool",{source:w}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){const P=n.root.getCurrent();P&&((C=P.getCurrent())==null?void 0:C.id)==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:P.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(w){y()&&(m()||n.batch(()=>{p("convert-to-bookmark",{source:w});const S=n.getSelectedShapes(),C=[],P=[];for(const E of S){if(!E||!n.isShapeOfType(E,"embed")||!E.props.url)continue;const _=new k(E.x,E.y);_.rot(-E.rotation),_.add(new k(E.props.w/2-300/2,E.props.h/2-320/2)),_.rot(E.rotation);const $={id:Ln(),type:"bookmark",rotation:E.rotation,x:_.x,y:_.y,opacity:1,props:{url:E.props.url}};C.push($),P.push(E.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(P),n.createShapes(C)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(w){y()&&(m()||(p("convert-to-embed",{source:w}),n.batch(()=>{const S=n.getSelectedShapeIds(),C=fe(S.map(_=>n.getShape(_))),P=[],E=[];for(const _ of C){if(!n.isShapeOfType(_,"bookmark"))continue;const{url:$}=_.props,T=Ap(_.props.url);if(!T||!T.definition)continue;const{width:M,height:O}=T.definition,j=new k(_.x,_.y);j.rot(-_.rotation),j.add(new k(_.props.w/2-M/2,_.props.h/2-O/2)),j.rot(_.rotation);const N={id:Ln(),type:"embed",x:j.x,y:j.y,rotation:_.rotation,props:{url:$,w:M,h:O}};P.push(N),E.push(_.id)}n.mark("convert shapes to embed"),n.deleteShapes(E),n.createShapes(P)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(w){if(!y()||m())return;p("duplicate-shapes",{source:w});const S=n.getSelectedShapeIds(),C=ce.Common(fe(S.map(E=>n.getShapePageBounds(E)))),P=n.getInstanceState().canMoveCamera?{x:C.width+10,y:0}:{x:16/n.getZoomLevel(),y:16/n.getZoomLevel()};n.mark("duplicate shapes"),n.duplicateShapes(S,P)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(w){y()&&(m()||(p("ungroup-shapes",{source:w}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(w){if(!y()||m())return;p("group-shapes",{source:w});const S=n.getOnlySelectedShape();S&&n.isShapeOfType(S,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",readonlyOk:!1,onSelect(w){if(!y())return;p("remove-frame",{source:w});const S=n.getSelectedShapes();S.length>0&&S.every(C=>n.isShapeOfType(C,"frame"))&&(n.mark("remove-frame"),g7(n,S.map(C=>C.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",readonlyOk:!1,onSelect(w){if(!y())return;p("fit-frame-to-content",{source:w});const S=n.getOnlySelectedShape();S&&n.isShapeOfType(S,"frame")&&(n.mark("fit-frame-to-content"),y7(n,S.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(w){y()&&(m()||(p("align-shapes",{operation:"left",source:w}),n.mark("align left"),n.alignShapes(n.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(w){y()&&(m()||(p("align-shapes",{operation:"center-horizontal",source:w}),n.mark("align center horizontal"),n.alignShapes(n.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(w){y()&&(m()||(p("align-shapes",{operation:"right",source:w}),n.mark("align right"),n.alignShapes(n.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(w){y()&&(m()||(p("align-shapes",{operation:"center-vertical",source:w}),n.mark("align center vertical"),n.alignShapes(n.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(w){y()&&(m()||(p("align-shapes",{operation:"top",source:w}),n.mark("align top"),n.alignShapes(n.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(w){y()&&(m()||(p("align-shapes",{operation:"bottom",source:w}),n.mark("align bottom"),n.alignShapes(n.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(w){y()&&(m()||(p("distribute-shapes",{operation:"horizontal",source:w}),n.mark("distribute horizontal"),n.distributeShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(w){y()&&(m()||(p("distribute-shapes",{operation:"vertical",source:w}),n.mark("distribute vertical"),n.distributeShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(w){y()&&(m()||(p("stretch-shapes",{operation:"horizontal",source:w}),n.mark("stretch horizontal"),n.stretchShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(w){y()&&(m()||(p("stretch-shapes",{operation:"vertical",source:w}),n.mark("stretch vertical"),n.stretchShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(w){y()&&(m()||(p("flip-shapes",{operation:"horizontal",source:w}),n.mark("flip horizontal"),n.flipShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(w){y()&&(m()||(p("flip-shapes",{operation:"vertical",source:w}),n.mark("flip vertical"),n.flipShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(w){y()&&(m()||(p("pack-shapes",{source:w}),n.mark("pack"),n.packShapes(n.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(w){y()&&(m()||(p("stack-shapes",{operation:"vertical",source:w}),n.mark("stack-vertical"),n.stackShapes(n.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(w){y()&&(m()||(p("stack-shapes",{operation:"horizontal",source:w}),n.mark("stack-horizontal"),n.stackShapes(n.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(w){y()&&(m()||(p("reorder-shapes",{operation:"toFront",source:w}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(w){y()&&(m()||(p("reorder-shapes",{operation:"forward",source:w}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(w){y()&&(m()||(p("reorder-shapes",{operation:"backward",source:w}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(w){y()&&(m()||(p("reorder-shapes",{operation:"toBack",source:w}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(w){y()&&(m()||(n.mark("cut"),c(w)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(w){y()&&(m()||l(w))}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(w){var S;(S=navigator.clipboard)==null||S.read().then(C=>{u(C,w,w==="context-menu"?n.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(w){n.batch(()=>{m()||(p("select-all-shapes",{source:w}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(w){y()&&(m()||(p("select-none-shapes",{source:w}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",readonlyOk:!1,onSelect(w){y()&&(m()||(p("delete-shapes",{source:w}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(w){if(!y()||m())return;p("rotate-cw",{source:w}),n.mark("rotate-cw");const S=n.getSelectionRotation()%($t/2),C=ki(S,0)||ki(S,$t/2);n.rotateShapesBy(n.getSelectedShapeIds(),$t/2-(C?0:S))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(w){if(!y()||m())return;p("rotate-ccw",{source:w}),n.mark("rotate-ccw");const S=n.getSelectionRotation()%($t/2),C=ki(S,0);n.rotateShapesBy(n.getSelectedShapeIds(),C?-($t/2):-S)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(w){p("zoom-in",{source:w}),n.zoomIn(n.getViewportScreenCenter(),{duration:tr})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(w){p("zoom-out",{source:w}),n.zoomOut(n.getViewportScreenCenter(),{duration:tr})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(w){p("reset-zoom",{source:w}),n.resetZoom(n.getViewportScreenCenter(),{duration:tr})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(w){p("zoom-to-fit",{source:w}),n.zoomToFit({duration:tr})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(w){y()&&(m()||(p("zoom-to-selection",{source:w}),n.zoomToSelection({duration:tr})))}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(w){p("toggle-snap-mode",{source:w}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(w){p("toggle-dark-mode",{source:w}),n.user.updateUserPreferences({isDarkMode:!n.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(w){p("toggle-reduce-motion",{source:w}),n.user.updateUserPreferences({animationSpeed:n.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:"action.toggle-edge-scrolling",menuLabel:"action.toggle-edge-scrolling.menu",readonlyOk:!0,onSelect(w){p("toggle-edge-scrolling",{source:w}),n.user.updateUserPreferences({edgeScrollSpeed:n.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(w){p("toggle-transparent",{source:w}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",readonlyOk:!1,onSelect(w){p("unlock-all",{source:w});const S=[];for(const C of n.getCurrentPageShapes())C.isLocked&&S.push({id:C.id,type:C.type,isLocked:!1});S.length>0&&n.updateShapes(S)}},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(w){requestAnimationFrame(()=>{n.batch(()=>{p("toggle-focus-mode",{source:w}),o(),s(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(w){p("toggle-grid-mode",{source:w}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(w){p("toggle-debug-mode",{source:w}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(w){p("print",{source:w}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(w){p("exit-pen-mode",{source:w}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(w){p("stop-following",{source:w}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(w){p("zoom-to-content",{source:w}),n.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(w){n.mark("locking"),p("toggle-lock",{source:w}),n.toggleLock(n.getSelectedShapeIds())}}]);return e?e(n,x,void 0):x},[n,p,e,r,i,f,d,c,l,u,o,s,a]);return h.jsx(X0.Provider,{value:v,children:t})}function vt(){const e=g.useContext(X0);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}function lu(e){return e.filter(t=>t!=null&&t!==!1)}function ve(e,...t){const n=lu(t);return n.length===0?null:{id:e,type:"group",checkbox:n.every(r=>r.type==="item"&&r.actionItem.checkbox),disabled:n.every(r=>r.disabled),readonlyOk:n.some(r=>r.readonlyOk),children:n}}function Nn(e,t,...n){const r=lu(n);return r.length===0?null:{id:e,type:"submenu",label:t,children:r,disabled:r.every(o=>o.disabled),readonlyOk:r.some(o=>o.readonlyOk)}}function Zp(e,t={}){const{readonlyOk:n=!0,disabled:r=!1}=t;return{id:e,type:"custom",disabled:r,readonlyOk:n}}function F(e,t={}){if(!e)throw Error("No action item provided to menuItem");if(!e.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:n=!1,disabled:r=!1}=t;return{id:e.id,type:"item",actionItem:e,disabled:r,checked:n,readonlyOk:e.readonlyOk}}function v8(e){return e.getSelectedShapeIds().map(r=>e.getShape(r)).filter(r=>!(!r||e.isShapeOfType(r,"arrow")&&r.props.start.type==="binding"||e.isShapeOfType(r,"arrow")&&r.props.end.type==="binding"))}const q0=()=>{const e=U();return Y("threeStackableItems",()=>v8(e).length>2,[e])};function b8(e){const t=e.getSelectedShapes(),n=[],r=new Map;t.forEach(s=>{s.type==="arrow"?n.push(s):r.set(s.id,s)});const o=n.filter(s=>!(s.props.start.type==="binding"&&!r.has(s.props.start.boundShapeId)||s.props.end.type==="binding"&&!r.has(s.props.end.boundShapeId)));return Array.from(r.values()).concat(o)}const Qp=()=>{const e=U();return Y("allowGroup",()=>b8(e).length>1,[e])},Jp=()=>{const e=U();return Y("allowUngroup",()=>e.getSelectedShapeIds().some(t=>{var n;return((n=e.getShape(t))==null?void 0:n.type)==="group"}),[e])},Z0=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,Kd=[0,390,428,468,580,640,840,1023],Q0=Z.createContext(0);function S8({forceMobile:e=!1,children:t}){const n=U(),r=Y("breakpoint",()=>{const{width:o}=n.getViewportScreenBounds(),s=e?3:Kd.length-1;for(let i=0;i<s;i++)if(o>Kd[i]&&o<=Kd[i+1])return i;return s},[n]);return h.jsx(Q0.Provider,{value:r,children:t})}function mn(){return g.useContext(Q0)}function eg(){const e=U();return Y("hasLinkShapeSelected",()=>{const t=e.getSelectedShapes();return t.length===1&&"url"in t[0].props&&t[0].type!=="embed"},[e])}const J0=Z.createContext({}),x8=({overrides:e,children:t})=>{const n=U(),r=vt(),o=Y("selected count",()=>n.getSelectedShapeIds().length,[n]),s=o>0,i=o>1,a=o>2,c=q0(),l=Qp(),u=Jp(),d=eg(),f=mn(),p=Y("zoom is 1",()=>n.getZoomLevel()===1,[n]),v=g.useMemo(()=>{const m=[F(r["align-left"],{disabled:!i}),F(r["align-center-horizontal"],{disabled:!i}),F(r["align-right"],{disabled:!i}),F(r["stretch-horizontal"],{disabled:!i}),F(r["align-top"],{disabled:!i}),F(r["align-center-vertical"],{disabled:!i}),F(r["align-bottom"],{disabled:!i}),F(r["stretch-vertical"],{disabled:!i}),F(r["distribute-horizontal"],{disabled:!a}),F(r["distribute-vertical"],{disabled:!a}),F(r["stack-horizontal"],{disabled:!c}),F(r["stack-vertical"],{disabled:!c}),F(r["send-to-back"],{disabled:!s}),F(r["send-backward"],{disabled:!s}),F(r["bring-forward"],{disabled:!s}),F(r["bring-to-front"],{disabled:!s}),f<5?F(r["zoom-to-100"],{disabled:!!p}):F(r["rotate-ccw"],{disabled:!s}),F(r["rotate-cw"],{disabled:!s}),F(r["edit-link"],{disabled:!d}),l?F(r.group,{disabled:!i}):u?F(r.ungroup):F(r.group,{disabled:!i})];return e?e(n,m,{actions:r,oneSelected:s,twoSelected:i,threeSelected:a}):m},[n,p,l,e,r,s,i,a,c,u,d,f]);return h.jsx(J0.Provider,{value:v,children:t})};function w8(){const e=Z.useContext(J0);if(!e)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return e}function C8(){const e=U();return Y("onlyFlippableShape",()=>{const t=e.getSelectedShapes();return t.length===1&&t.every(n=>e.isShapeOfType(n,"group")||e.isShapeOfType(n,"arrow")||e.isShapeOfType(n,"line")||e.isShapeOfType(n,"draw")||e.isShapeOfType(n,"image")||e.isShapeOfType(n,"genmedia"))},[e])}function e1(){const e=U();return Y("showAutoSizeToggle",()=>{const t=e.getSelectedShapes();return t.length===1&&e.isShapeOfType(t[0],"text")&&t[0].props.autoSize===!1},[e])}const t1=Z.createContext({}),P8=Te(function({overrides:t,children:n}){var _;const r=U(),o=vt(),s=e1(),i=C8(),a=r.getSelectedShapes(),c=a.length,l=c>0,u=c>1,d=c>2,f=q0(),p=Y("atLeastOneShapeOnPage",()=>r.getCurrentPageShapeIds().size>0,[]),v=Y("isTransparentBg",()=>r.getInstanceState().exportBackground,[]),m=Qp(),y=Jp(),b=!!((_=window.navigator.clipboard)!=null&&_.write),x=eg(),w=r.getOnlySelectedShape(),S=l&&a.every($=>r.isShapeOfType($,"frame")),C=w&&r.isShapeOfType(w,"frame")&&r.getSortedChildIdsForParent(w).length>0,P=w&&r.isShapeOrAncestorLocked(w),E=g.useMemo(()=>{let $=lu([ve("selection",s&&F(o["toggle-auto-size"]),x&&!P&&F(o["edit-link"]),l&&!P&&F(o.duplicate),m&&!P&&F(o.group),y&&!P&&F(o.ungroup),S&&!P&&F(o["remove-frame"]),C&&!P&&F(o["fit-frame-to-content"]),l&&F(o["toggle-lock"])),ve("modify",(u||i)&&Nn("arrange","context-menu.arrange",u&&ve("align",F(o["align-left"]),F(o["align-center-horizontal"]),F(o["align-right"]),F(o["align-top"]),F(o["align-center-vertical"]),F(o["align-bottom"])),d&&ve("distribute",F(o["distribute-horizontal"]),F(o["distribute-vertical"])),u&&ve("stretch",F(o["stretch-horizontal"]),F(o["stretch-vertical"])),i&&!P&&ve("flip",F(o["flip-horizontal"]),F(o["flip-vertical"])),u&&ve("order",F(o.pack,{disabled:!u}),f&&F(o["stack-vertical"]),f&&F(o["stack-horizontal"]))),l&&!P&&Nn("reorder","context-menu.reorder",ve("reorder",F(o["bring-to-front"]),F(o["bring-forward"]),F(o["send-backward"]),F(o["send-to-back"]))),l&&!P&&Zp("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),ve("clipboard-group",l&&!P&&F(o.cut),l&&F(o.copy),Z0&&F(o.paste)),p&&ve("conversions",Nn("copy-as","context-menu.copy-as",ve("copy-as-group",F(o["copy-as-svg"]),b&&F(o["copy-as-png"]),F(o["copy-as-json"])),ve("export-bg",F(o["toggle-transparent"],{checked:!v}))),Nn("export-as","context-menu.export-as",ve("export-as-group",F(o["export-as-svg"]),F(o["export-as-png"]),F(o["export-as-json"])),ve("export-bg,",F(o["toggle-transparent"],{checked:!v})))),p&&ve("set-selection-group",F(o["select-all"]),l&&F(o["select-none"])),l&&!P&&ve("delete-group",F(o.delete))]);return t&&($=t(r,$,{actions:o,oneSelected:l,twoSelected:u,threeSelected:d,showAutoSizeToggle:s,showUngroup:y,onlyFlippableShapeSelected:i})),$},[r,t,o,l,u,d,s,i,p,f,m,y,S,C,b,x,v,P]);return h.jsx(t1.Provider,{value:E,children:n})});function n1(){const e=Z.useContext(t1);if(!e)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return e}const r1=g.createContext({});function E8({overrides:e,children:t}){const n=U(),r=Ws(),o=Y0(),s=g.useMemo(()=>{const i=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){n.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){n.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},...["rectangle","ellipse"].map(c=>({id:c,label:`tool.${c}`,readonlyOk:!1,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"e":void 0,icon:"geo-"+c,onSelect(l){n.batch(()=>{n.updateInstanceState({stylesForNextShape:{...n.getInstanceState().stylesForNextShape,[Es.id]:c}},{ephemeral:!0}),n.setCurrentTool("geo"),r("select-tool",{source:l,id:`geo-${c}`})})}})),{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(c){n.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"geoframe",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"!f",onSelect(c){n.setCurrentTool("geoframe"),r("select-tool",{source:c,id:"geoframe"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(c){n.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"rich-text",label:"tool.rich-text",readonlyOk:!1,icon:"tool-text",kbd:"!t",onSelect(c){n.setCurrentTool("rich-text"),r("select-tool",{source:c,id:"rich-text"})}},{id:"speed-lines",label:"tool.speed-lines",readonlyOk:!1,icon:"tool-frame",kbd:"m",onSelect(c){n.setCurrentTool("speed-lines"),r("select-tool",{source:c,id:"speed-lines"})}},{id:"focus-lines",label:"tool.focus-lines",readonlyOk:!1,icon:"tool-frame",kbd:"!m",onSelect(c){n.setCurrentTool("focus-lines"),r("select-tool",{source:c,id:"focus-lines"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(c){o(),r("select-tool",{source:c,id:"media"})}},{id:"dialogue",label:"tool.dialogue",readonlyOk:!1,icon:"comment",onSelect(c){n.setCurrentTool("dialogue"),r("select-tool",{source:c,id:"dialogue"})}},{id:"rich-dialogue",label:"tool.rich-dialogue",readonlyOk:!1,icon:"comment",onSelect(c){n.setCurrentTool("rich-dialogue"),r("select-tool",{source:c,id:"rich-dialogue"})}},{id:"marker",label:"tool.marker",readonlyOk:!1,icon:"tool-highlight",kbd:"i",onSelect(c){n.setCurrentTool("marker"),r("select-tool",{source:c,id:"marker"})}},{id:"marker-lasso",label:"tool.marker-lasso",readonlyOk:!1,icon:"tool-highlight",kbd:"!i",onSelect(c){n.setCurrentTool("marker-lasso"),r("select-tool",{source:c,id:"marker-lasso"})}},{id:"marker-geo",label:"tool.marker-geo",readonlyOk:!1,icon:"tool-highlight",kbd:"$i",onSelect(c){n.setCurrentTool("marker-geo"),r("select-tool",{source:c,id:"marker-geo"})}},{id:"marker-eraser",label:"tool.marker-eraser",readonlyOk:!1,icon:"tool-eraser",kbd:"!$i",onSelect(c){n.setCurrentTool("marker-eraser"),r("select-tool",{source:c,id:"marker-eraser"})}},{id:"svg",label:"tool.svg",readonlyOk:!1,icon:"tool-note",kbd:"d",onSelect(c){n.setCurrentTool("svg"),n.setStyleForNextShapes(xS,"dialog"),r("select-tool",{source:c,id:"svg"})}}],a=Object.fromEntries(i.map(c=>[c.id,c]));return e?e(n,a,{insertMedia:o}):a},[e,n,r,o]);return h.jsx(r1.Provider,{value:s,children:t})}function tg(){const e=g.useContext(r1);if(!e)throw new Error("useTools must be used within a ToolProvider");return e}const o1=Z.createContext({}),_8=Te(function({overrides:t,children:n}){const r=U(),o=tg(),s=vt(),i=g.useMemo(()=>{const a=fe([ve("shortcuts-dialog.tools",F(o.select),F(o.hand),F(o.text),F(o.frame),F(o.marker),F(o["marker-lasso"]),F(o["marker-geo"]),F(o["marker-eraser"])),ve("shortcuts-dialog.file",F(s["insert-media"]),F(s.print)),ve("shortcuts-dialog.preferences",F(s["toggle-dark-mode"]),F(s["toggle-focus-mode"]),F(s["toggle-grid"])),ve("shortcuts-dialog.edit",F(s.undo),F(s.redo),F(s.cut),F(s.copy),F(s.paste),F(s["select-all"]),F(s.delete),F(s.duplicate),F(s["export-as-svg"]),F(s["export-as-png"])),ve("shortcuts-dialog.view",F(s["zoom-in"]),F(s["zoom-out"]),F(s["zoom-to-100"]),F(s["zoom-to-fit"]),F(s["zoom-to-selection"])),ve("shortcuts-dialog.transform",F(s["bring-to-front"]),F(s["bring-forward"]),F(s["send-backward"]),F(s["send-to-back"]),F(s.group),F(s.ungroup),F(s["flip-horizontal"]),F(s["flip-vertical"]),F(s["align-top"]),F(s["align-center-vertical"]),F(s["align-bottom"]),F(s["align-left"]),F(s["align-center-horizontal"]),F(s["align-right"]))]);return t?t(r,a,{tools:o,actions:s}):a},[r,t,s,o]);return h.jsx(o1.Provider,{value:i,children:n})});function I8(){const e=Z.useContext(o1);if(!e)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return e}const k8=()=>{const e=Ce(),t=gn(),n=I8();function r(o){if(!o||t&&!o.readonlyOk)return null;switch(o.type){case"group":return h.jsxs("div",{className:"tlui-shortcuts-dialog__group",children:[h.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:e(o.id)}),h.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:o.children.filter(s=>s&&s.type==="item"&&s.actionItem.kbd).map(r)})]},o.id);case"item":{const{id:s,label:i,shortcutsLabel:a,kbd:c}=o.actionItem;return h.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair",children:[h.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:e(a??i)}),h.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:h.jsx(ru,{children:c})})]},s)}}}return h.jsxs(h.Fragment,{children:[h.jsxs(iu,{className:"tlui-shortcuts-dialog__header",children:[h.jsx(au,{children:e("shortcuts-dialog.title")}),h.jsx(cu,{})]}),h.jsx(Ki,{className:"tlui-shortcuts-dialog__body",children:n.map(r)}),h.jsx("div",{className:"tlui-dialog__scrim"})]})};function s1(){const e=U();return{languages:Li,currentLanguage:e.user.getLocale()}}const i1=Z.createContext({}),T8=Te(function({overrides:t,children:n}){const r=U(),o=vt(),s=r.getSelectedShapeIds().length,i=s>0,a=s>1,c=s>2,{languages:l,currentLanguage:u}=s1(),{addDialog:d}=Hs(),f=g.useMemo(()=>{const p=fe([ve("top",Zp("LANGUAGE_MENU",{readonlyOk:!0}),F({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){d({component:k8})}}))]);return t?t(r,p,{actions:o,currentLanguage:u,languages:l,oneSelected:i,twoSelected:a,threeSelected:c}):p},[r,t,l,o,i,a,c,u,d]);return h.jsx(i1.Provider,{value:f,children:n})});function $8(){const e=Z.useContext(i1);if(!e)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return e}function a1(){const e=U();return Y("useCanRedo",()=>e.getCanRedo(),[e])}function c1(){const e=U();return Y("useCanUndo",()=>e.getCanUndo(),[e])}const l1=Z.createContext({});function A8({overrides:e,children:t}){var B;const n=U(),r=vt(),s=mn()<5,i=Y("isDarkMode",()=>n.user.getIsDarkMode(),[n]),a=Y("animationSpeed",()=>n.user.getAnimationSpeed(),[n]),c=Y("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]),l=Y("isGridMode",()=>n.getInstanceState().isGridMode,[n]),u=Y("isSnapMode",()=>n.user.getIsSnapMode(),[n]);Y("isToolLock",()=>n.getInstanceState().isToolLocked,[n]);const d=Y("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]),f=Y("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]),p=Y("exportBackground",()=>n.getInstanceState().exportBackground,[n]),v=Y("emptyPage",()=>n.getCurrentPageShapeIds().size===0,[n]),m=Y("selectedCount",()=>n.getSelectedShapeIds().length,[n]),y=m===0,b=m>0,x=m>1,w=m>2,S=!!((B=window.navigator.clipboard)!=null&&B.write),C=eg(),P=e1(),E=Qp(),_=Jp(),$=c1(),T=a1(),M=Y("isZoomedTo100",()=>n.getZoomLevel()===1,[n]),O=Y("oneEmbedSelected",()=>{const D=n.getOnlySelectedShape();return D?!!(n.isShapeOfType(D,"embed")&&D.props.url&&!n.isShapeOrAncestorLocked(D)):!1},[]),j=Y("oneEmbeddableBookmarkSelected",()=>{const D=n.getOnlySelectedShape();return D?!!(n.isShapeOfType(D,"bookmark")&&D.props.url&&Ap(D.props.url)&&!n.isShapeOrAncestorLocked(D)):!1},[]),N=g.useMemo(()=>{const D=lu([ve("menu",Nn("file","menu.file",ve("print",F(r.print,{disabled:v}))),Nn("edit","menu.edit",ve("undo-actions",F(r.undo,{disabled:!$}),F(r.redo,{disabled:!T})),ve("clipboard-actions",F(r.cut,{disabled:y}),F(r.copy,{disabled:y}),F(r.paste,{disabled:!Z0})),ve("conversions",Nn("copy-as","menu.copy-as",ve("copy-as-group",F(r["copy-as-svg"],{disabled:v}),F(r["copy-as-png"],{disabled:v||!S}),F(r["copy-as-json"],{disabled:v})),ve("export-bg",F(r["toggle-transparent"],{checked:!p}))),Nn("export-as","menu.export-as",ve("export-as-group",F(r["export-as-svg"],{disabled:v}),F(r["export-as-png"],{disabled:v}),F(r["export-as-json"],{disabled:v})),ve("export-bg",F(r["toggle-transparent"],{checked:!p})))),ve("set-selection-group",F(r["select-all"],{disabled:v}),F(r["select-none"],{disabled:!b})),ve("selection",P&&F(r["toggle-auto-size"]),C&&F(r["edit-link"]),F(r.duplicate,{disabled:!b}),E&&F(r.group),_&&F(r.ungroup),F(r["unlock-all"],{disabled:v})),ve("delete-group",F(r.delete,{disabled:!b})),ve("embeds",O&&F(r["open-embed-link"]),O&&F(r["convert-to-bookmark"]),j&&F(r["convert-to-embed"]))),Nn("view","menu.view",ve("view-actions",F(r["zoom-in"]),F(r["zoom-out"]),F(r["zoom-to-100"],{disabled:M}),F(r["zoom-to-fit"],{disabled:v}),F(r["zoom-to-selection"],{disabled:v||!b})))),ve("extras",F(r["insert-embed"]),F(r["insert-media"])),ve("preferences",Nn("preferences","menu.preferences",ve("preferences-actions",F(r["toggle-snap-mode"],{checked:u}),F(r["toggle-grid"],{checked:l}),F(r["toggle-dark-mode"],{checked:i}),F(r["toggle-focus-mode"],{checked:d}),F(r["toggle-edge-scrolling"],{checked:c===1}),F(r["toggle-reduce-motion"],{checked:a===0}),F(r["toggle-debug-mode"],{checked:f}))),s&&Zp("LANGUAGE_MENU",{readonlyOk:!0}))]);return e?e(n,D,{actions:r,noneSelected:y,oneSelected:b,twoSelected:x,threeSelected:w}):D},[n,e,r,b,x,w,v,s,E,_,C,S,P,y,$,T,a,i,l,u,d,p,f,c,M,j,O]);return h.jsx(l1.Provider,{value:N,children:t})}function M8(){const e=Z.useContext(l1);if(!e)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return e}function uo(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}const u1=Z.createContext([]);function O8({overrides:e,children:t}){const n=U(),r=tg(),o=Z.useMemo(()=>{const s=fe([uo(r.select),uo(r.hand),uo(r.text),uo(r.asset),uo(r.rectangle),uo(r.ellipse),uo(r.frame)]);return e?e(n,s,{tools:r}):s},[n,e,r]);return h.jsx(u1.Provider,{value:o,children:t})}function R8(){const e=Z.useContext(u1);if(!e)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}function j8(){const{addToast:e,removeToast:t,clearToasts:n}=Gn(),{addDialog:r,clearDialogs:o,removeDialog:s,updateDialog:i}=Hs(),c=mn()<5,l=Ce();return g.useMemo(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:r,clearDialogs:o,removeDialog:s,updateDialog:i,msg:l,isMobile:c}),[r,e,o,n,l,s,t,i,c])}function D8(e,t){const n={};for(const r of e)if(r.translations)for(const[o,s]of rr(r.translations)){let i=n[o];i||(i=n[o]={}),Object.assign(i,s)}return{actionsMenu:(r,o,s)=>{for(const i of e)i.actionsMenu&&(o=i.actionsMenu(r,o,{...t,...s}));return o},actions:(r,o)=>{for(const s of e)s.actions&&(o=s.actions(r,o,t));return o},contextMenu:(r,o,s)=>{for(const i of e)i.contextMenu&&(o=i.contextMenu(r,o,{...t,...s}));return o},helpMenu:(r,o,s)=>{for(const i of e)i.helpMenu&&(o=i.helpMenu(r,o,{...t,...s}));return o},menu:(r,o,s)=>{for(const i of e)i.menu&&(o=i.menu(r,o,{...t,...s}));return o},toolbar:(r,o,s)=>{for(const i of e)i.toolbar&&(o=i.toolbar(r,o,{...t,...s}));return o},keyboardShortcutsMenu:(r,o,s)=>{for(const i of e)i.keyboardShortcutsMenu&&(o=i.keyboardShortcutsMenu(r,o,{...t,...s}));return o},tools:(r,o,s)=>{for(const i of e)i.tools&&(o=i.tools(r,o,{...t,...s}));return o},translations:n}}function d1(e){return g.useMemo(()=>e,e)}function N8(e){const t=d1(e==null?[]:Array.isArray(e)?e:[e]);return g.useMemo(()=>{const n={};for(const r of t)if(r.translations)for(const[o,s]of rr(r.translations)){let i=n[o];i||(i=n[o]={}),Object.assign(i,s)}return n},[t])}function L8(e){const t=j8(),n=d1(e==null?[]:Array.isArray(e)?e:[e]);return g.useMemo(()=>D8(n,t),[n,t])}function F8({overrides:e,assetUrls:t,onUiEvent:n,forceMobile:r,children:o}){return h.jsx(v7,{assetUrls:p7(t),children:h.jsx(x7,{overrides:N8(e),children:h.jsx(Q4,{onEvent:n,children:h.jsx(l8,{children:h.jsx(d8,{children:h.jsx(S8,{forceMobile:r,children:h.jsx(B8,{overrides:e,children:o})})})})})})})}function B8({overrides:e,children:t}){const n=L8(e);return h.jsx(y8,{overrides:n.actions,children:h.jsx(E8,{overrides:n.tools,children:h.jsx(O8,{overrides:n.toolbar,children:h.jsx(x8,{overrides:n.actionsMenu,children:h.jsx(_8,{overrides:n.keyboardShortcutsMenu,children:h.jsx(P8,{overrides:n.contextMenu,children:h.jsx(T8,{overrides:n.helpMenu,children:h.jsx(A8,{overrides:n.menu,children:t})})})})})})})})}function z8(){const e=U(),n=vt()["back-to-content"],[r,o]=g.useState(!1);return g.useEffect(()=>{let s=!1;const i=setInterval(()=>{const a=e.getRenderingShapes(),c=e.getRenderingBounds(),u=a.filter(d=>d.maskedPageBounds&&c.includes(d.maskedPageBounds)).length===0&&e.getCurrentPageShapes().length>0;s!==u&&(o(u),s=u)},1e3);return()=>{clearInterval(i)}},[e]),r?h.jsx(te,{iconLeft:n.icon,label:n.label,type:"low",onClick:()=>{n.onSelect("helper-buttons"),o(!1)}}):null}function U8(e){const t=e+"CollectionProvider",[n,r]=Os(t),[o,s]=n(t,{collectionRef:{current:null},itemMap:new Map}),i=p=>{const{scope:v,children:m}=p,y=Z.useRef(null),b=Z.useRef(new Map).current;return Z.createElement(o,{scope:v,itemMap:b,collectionRef:y},m)},a=e+"CollectionSlot",c=Z.forwardRef((p,v)=>{const{scope:m,children:y}=p,b=s(a,m),x=Mt(v,b.collectionRef);return Z.createElement(Ri,{ref:x},y)}),l=e+"CollectionItemSlot",u="data-radix-collection-item",d=Z.forwardRef((p,v)=>{const{scope:m,children:y,...b}=p,x=Z.useRef(null),w=Mt(v,x),S=s(l,m);return Z.useEffect(()=>(S.itemMap.set(x,{ref:x,...b}),()=>void S.itemMap.delete(x))),Z.createElement(Ri,{[u]:"",ref:w},y)});function f(p){const v=s(e+"CollectionConsumer",p);return Z.useCallback(()=>{const y=v.collectionRef.current;if(!y)return[];const b=Array.from(y.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((S,C)=>b.indexOf(S.ref.current)-b.indexOf(C.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:c,ItemSlot:d},f,r]}const V8=g.createContext(void 0);function f1(e){const t=g.useContext(V8);return e||t||"ltr"}const th="dismissableLayer.update",K8="dismissableLayer.pointerDownOutside",W8="dismissableLayer.focusOutside";let eb;const H8=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),G8=g.forwardRef((e,t)=>{var n;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:o,onPointerDownOutside:s,onFocusOutside:i,onInteractOutside:a,onDismiss:c,...l}=e,u=g.useContext(H8),[d,f]=g.useState(null),p=(n=d==null?void 0:d.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,v]=g.useState({}),m=Mt(t,_=>f(_)),y=Array.from(u.layers),[b]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),x=y.indexOf(b),w=d?y.indexOf(d):-1,S=u.layersWithOutsidePointerEventsDisabled.size>0,C=w>=x,P=Y8(_=>{const $=_.target,T=[...u.branches].some(M=>M.contains($));!C||T||(s==null||s(_),a==null||a(_),_.defaultPrevented||c==null||c())},p),E=X8(_=>{const $=_.target;[...u.branches].some(M=>M.contains($))||(i==null||i(_),a==null||a(_),_.defaultPrevented||c==null||c())},p);return U_(_=>{w===u.layers.size-1&&(o==null||o(_),!_.defaultPrevented&&c&&(_.preventDefault(),c()))},p),g.useEffect(()=>{if(d)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(eb=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),tb(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=eb)}},[d,p,r,u]),g.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),tb())},[d,u]),g.useEffect(()=>{const _=()=>v({});return document.addEventListener(th,_),()=>document.removeEventListener(th,_)},[]),g.createElement(Rt.div,me({},l,{ref:m,style:{pointerEvents:S?C?"auto":"none":void 0,...e.style},onFocusCapture:Pe(e.onFocusCapture,E.onFocusCapture),onBlurCapture:Pe(e.onBlurCapture,E.onBlurCapture),onPointerDownCapture:Pe(e.onPointerDownCapture,P.onPointerDownCapture)}))});function Y8(e,t=globalThis==null?void 0:globalThis.document){const n=Nr(e),r=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){h1(K8,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=l,t.addEventListener("click",o.current,{once:!0})):l()}else t.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",s),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function X8(e,t=globalThis==null?void 0:globalThis.document){const n=Nr(e),r=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!r.current&&h1(W8,n,{originalEvent:s},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function tb(){const e=new CustomEvent(th);document.dispatchEvent(e)}function h1(e,t,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?Yb(o,s):o.dispatchEvent(s)}const Wd="focusScope.autoFocusOnMount",Hd="focusScope.autoFocusOnUnmount",nb={bubbles:!1,cancelable:!0},q8=g.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=e,[a,c]=g.useState(null),l=Nr(o),u=Nr(s),d=g.useRef(null),f=Mt(t,m=>c(m)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(r){let m=function(w){if(p.paused||!a)return;const S=w.target;a.contains(S)?d.current=S:_r(d.current,{select:!0})},y=function(w){if(p.paused||!a)return;const S=w.relatedTarget;S!==null&&(a.contains(S)||_r(d.current,{select:!0}))},b=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&_r(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const x=new MutationObserver(b);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),x.disconnect()}}},[r,a,p.paused]),g.useEffect(()=>{if(a){ob.add(p);const m=document.activeElement;if(!a.contains(m)){const b=new CustomEvent(Wd,nb);a.addEventListener(Wd,l),a.dispatchEvent(b),b.defaultPrevented||(Z8(nB(p1(a)),{select:!0}),document.activeElement===m&&_r(a))}return()=>{a.removeEventListener(Wd,l),setTimeout(()=>{const b=new CustomEvent(Hd,nb);a.addEventListener(Hd,u),a.dispatchEvent(b),b.defaultPrevented||_r(m??document.body,{select:!0}),a.removeEventListener(Hd,u),ob.remove(p)},0)}}},[a,l,u,p]);const v=g.useCallback(m=>{if(!n&&!r||p.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,b=document.activeElement;if(y&&b){const x=m.currentTarget,[w,S]=Q8(x);w&&S?!m.shiftKey&&b===S?(m.preventDefault(),n&&_r(w,{select:!0})):m.shiftKey&&b===w&&(m.preventDefault(),n&&_r(S,{select:!0})):b===x&&m.preventDefault()}},[n,r,p.paused]);return g.createElement(Rt.div,me({tabIndex:-1},i,{ref:f,onKeyDown:v}))});function Z8(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(_r(r,{select:t}),document.activeElement!==n)return}function Q8(e){const t=p1(e),n=rb(t,e),r=rb(t.reverse(),e);return[n,r]}function p1(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function rb(e,t){for(const n of e)if(!J8(n,{upTo:t}))return n}function J8(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function eB(e){return e instanceof HTMLInputElement&&"select"in e}function _r(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&eB(e)&&t&&e.select()}}const ob=tB();function tB(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=sb(e,t),e.unshift(t)},remove(t){var n;e=sb(e,t),(n=e[0])===null||n===void 0||n.resume()}}}function sb(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function nB(e){return e.filter(t=>t.tagName!=="A")}const rB=["top","right","bottom","left"],Ur=Math.min,Ut=Math.max,bl=Math.round,mc=Math.floor,Vr=e=>({x:e,y:e}),oB={left:"right",right:"left",bottom:"top",top:"bottom"},sB={start:"end",end:"start"};function nh(e,t,n){return Ut(e,Ur(t,n))}function cr(e,t){return typeof e=="function"?e(t):e}function lr(e){return e.split("-")[0]}function Gs(e){return e.split("-")[1]}function ng(e){return e==="x"?"y":"x"}function rg(e){return e==="y"?"height":"width"}function Ys(e){return["top","bottom"].includes(lr(e))?"y":"x"}function og(e){return ng(Ys(e))}function iB(e,t,n){n===void 0&&(n=!1);const r=Gs(e),o=og(e),s=rg(o);let i=o==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return t.reference[s]>t.floating[s]&&(i=Sl(i)),[i,Sl(i)]}function aB(e){const t=Sl(e);return[rh(e),t,rh(t)]}function rh(e){return e.replace(/start|end/g,t=>sB[t])}function cB(e,t,n){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(e){case"top":case"bottom":return n?t?o:r:t?r:o;case"left":case"right":return t?s:i;default:return[]}}function lB(e,t,n,r){const o=Gs(e);let s=cB(lr(e),n==="start",r);return o&&(s=s.map(i=>i+"-"+o),t&&(s=s.concat(s.map(rh)))),s}function Sl(e){return e.replace(/left|right|bottom|top/g,t=>oB[t])}function uB(e){return{top:0,right:0,bottom:0,left:0,...e}}function g1(e){return typeof e!="number"?uB(e):{top:e,right:e,bottom:e,left:e}}function xl(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function ib(e,t,n){let{reference:r,floating:o}=e;const s=Ys(t),i=og(t),a=rg(i),c=lr(t),l=s==="y",u=r.x+r.width/2-o.width/2,d=r.y+r.height/2-o.height/2,f=r[a]/2-o[a]/2;let p;switch(c){case"top":p={x:u,y:r.y-o.height};break;case"bottom":p={x:u,y:r.y+r.height};break;case"right":p={x:r.x+r.width,y:d};break;case"left":p={x:r.x-o.width,y:d};break;default:p={x:r.x,y:r.y}}switch(Gs(t)){case"start":p[i]-=f*(n&&l?-1:1);break;case"end":p[i]+=f*(n&&l?-1:1);break}return p}const dB=async(e,t,n)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=n,a=s.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(t));let l=await i.getElementRects({reference:e,floating:t,strategy:o}),{x:u,y:d}=ib(l,r,c),f=r,p={},v=0;for(let m=0;m<a.length;m++){const{name:y,fn:b}=a[m],{x,y:w,data:S,reset:C}=await b({x:u,y:d,initialPlacement:r,placement:f,strategy:o,middlewareData:p,rects:l,platform:i,elements:{reference:e,floating:t}});if(u=x??u,d=w??d,p={...p,[y]:{...p[y],...S}},C&&v<=50){v++,typeof C=="object"&&(C.placement&&(f=C.placement),C.rects&&(l=C.rects===!0?await i.getElementRects({reference:e,floating:t,strategy:o}):C.rects),{x:u,y:d}=ib(l,f,c)),m=-1;continue}}return{x:u,y:d,placement:f,strategy:o,middlewareData:p}};async function Wi(e,t){var n;t===void 0&&(t={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:c}=e,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:f=!1,padding:p=0}=cr(t,e),v=g1(p),y=a[f?d==="floating"?"reference":"floating":d],b=xl(await s.getClippingRect({element:(n=await(s.isElement==null?void 0:s.isElement(y)))==null||n?y:y.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),x=d==="floating"?{...i.floating,x:r,y:o}:i.reference,w=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),S=await(s.isElement==null?void 0:s.isElement(w))?await(s.getScale==null?void 0:s.getScale(w))||{x:1,y:1}:{x:1,y:1},C=xl(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:w,strategy:c}):x);return{top:(b.top-C.top+v.top)/S.y,bottom:(C.bottom-b.bottom+v.bottom)/S.y,left:(b.left-C.left+v.left)/S.x,right:(C.right-b.right+v.right)/S.x}}const ab=e=>({name:"arrow",options:e,async fn(t){const{x:n,y:r,placement:o,rects:s,platform:i,elements:a}=t,{element:c,padding:l=0}=cr(e,t)||{};if(c==null)return{};const u=g1(l),d={x:n,y:r},f=og(o),p=rg(f),v=await i.getDimensions(c),m=f==="y",y=m?"top":"left",b=m?"bottom":"right",x=m?"clientHeight":"clientWidth",w=s.reference[p]+s.reference[f]-d[f]-s.floating[p],S=d[f]-s.reference[f],C=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let P=C?C[x]:0;(!P||!await(i.isElement==null?void 0:i.isElement(C)))&&(P=a.floating[x]||s.floating[p]);const E=w/2-S/2,_=P/2-v[p]/2-1,$=Ur(u[y],_),T=Ur(u[b],_),M=$,O=P-v[p]-T,j=P/2-v[p]/2+E,N=nh(M,j,O),D=Gs(o)!=null&&j!=N&&s.reference[p]/2-(j<M?$:T)-v[p]/2<0?j<M?M-j:O-j:0;return{[f]:d[f]-D,data:{[f]:N,centerOffset:j-N+D}}}}),sg=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(t){var n;const{placement:r,middlewareData:o,rects:s,initialPlacement:i,platform:a,elements:c}=t,{mainAxis:l=!0,crossAxis:u=!0,fallbackPlacements:d,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:p="none",flipAlignment:v=!0,...m}=cr(e,t),y=lr(r),b=lr(i)===i,x=await(a.isRTL==null?void 0:a.isRTL(c.floating)),w=d||(b||!v?[Sl(i)]:aB(i));!d&&p!=="none"&&w.push(...lB(i,v,p,x));const S=[i,...w],C=await Wi(t,m),P=[];let E=((n=o.flip)==null?void 0:n.overflows)||[];if(l&&P.push(C[y]),u){const M=iB(r,s,x);P.push(C[M[0]],C[M[1]])}if(E=[...E,{placement:r,overflows:P}],!P.every(M=>M<=0)){var _,$;const M=(((_=o.flip)==null?void 0:_.index)||0)+1,O=S[M];if(O)return{data:{index:M,overflows:E},reset:{placement:O}};let j=($=E.filter(N=>N.overflows[0]<=0).sort((N,B)=>N.overflows[1]-B.overflows[1])[0])==null?void 0:$.placement;if(!j)switch(f){case"bestFit":{var T;const N=(T=E.map(B=>[B.placement,B.overflows.filter(D=>D>0).reduce((D,G)=>D+G,0)]).sort((B,D)=>B[1]-D[1])[0])==null?void 0:T[0];N&&(j=N);break}case"initialPlacement":j=i;break}if(r!==j)return{reset:{placement:j}}}return{}}}};function cb(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function lb(e){return rB.some(t=>e[t]>=0)}const ig=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(t){const{rects:n}=t,{strategy:r="referenceHidden",...o}=cr(e,t);switch(r){case"referenceHidden":{const s=await Wi(t,{...o,elementContext:"reference"}),i=cb(s,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:lb(i)}}}case"escaped":{const s=await Wi(t,{...o,altBoundary:!0}),i=cb(s,n.floating);return{data:{escapedOffsets:i,escaped:lb(i)}}}default:return{}}}}};async function fB(e,t){const{placement:n,platform:r,elements:o}=e,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=lr(n),a=Gs(n),c=Ys(n)==="y",l=["left","top"].includes(i)?-1:1,u=s&&c?-1:1,d=cr(t,e);let{mainAxis:f,crossAxis:p,alignmentAxis:v}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&typeof v=="number"&&(p=a==="end"?v*-1:v),c?{x:p*u,y:f*l}:{x:f*l,y:p*u}}const ag=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(t){const{x:n,y:r}=t,o=await fB(t,e);return{x:n+o.x,y:r+o.y,data:o}}}},cg=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(t){const{x:n,y:r,placement:o}=t,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:y=>{let{x:b,y:x}=y;return{x:b,y:x}}},...c}=cr(e,t),l={x:n,y:r},u=await Wi(t,c),d=Ys(lr(o)),f=ng(d);let p=l[f],v=l[d];if(s){const y=f==="y"?"top":"left",b=f==="y"?"bottom":"right",x=p+u[y],w=p-u[b];p=nh(x,p,w)}if(i){const y=d==="y"?"top":"left",b=d==="y"?"bottom":"right",x=v+u[y],w=v-u[b];v=nh(x,v,w)}const m=a.fn({...t,[f]:p,[d]:v});return{...m,data:{x:m.x-n,y:m.y-r}}}}},lg=function(e){return e===void 0&&(e={}),{options:e,fn(t){const{x:n,y:r,placement:o,rects:s,middlewareData:i}=t,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=cr(e,t),u={x:n,y:r},d=Ys(o),f=ng(d);let p=u[f],v=u[d];const m=cr(a,t),y=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(c){const w=f==="y"?"height":"width",S=s.reference[f]-s.floating[w]+y.mainAxis,C=s.reference[f]+s.reference[w]-y.mainAxis;p<S?p=S:p>C&&(p=C)}if(l){var b,x;const w=f==="y"?"width":"height",S=["top","left"].includes(lr(o)),C=s.reference[d]-s.floating[w]+(S&&((b=i.offset)==null?void 0:b[d])||0)+(S?0:y.crossAxis),P=s.reference[d]+s.reference[w]+(S?0:((x=i.offset)==null?void 0:x[d])||0)-(S?y.crossAxis:0);v<C?v=C:v>P&&(v=P)}return{[f]:p,[d]:v}}}},ug=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(t){const{placement:n,rects:r,platform:o,elements:s}=t,{apply:i=()=>{},...a}=cr(e,t),c=await Wi(t,a),l=lr(n),u=Gs(n),d=Ys(n)==="y",{width:f,height:p}=r.floating;let v,m;l==="top"||l==="bottom"?(v=l,m=u===(await(o.isRTL==null?void 0:o.isRTL(s.floating))?"start":"end")?"left":"right"):(m=l,v=u==="end"?"top":"bottom");const y=p-c[v],b=f-c[m],x=!t.middlewareData.shift;let w=y,S=b;if(d){const P=f-c.left-c.right;S=u||x?Ur(b,P):P}else{const P=p-c.top-c.bottom;w=u||x?Ur(y,P):P}if(x&&!u){const P=Ut(c.left,0),E=Ut(c.right,0),_=Ut(c.top,0),$=Ut(c.bottom,0);d?S=f-2*(P!==0||E!==0?P+E:Ut(c.left,c.right)):w=p-2*(_!==0||$!==0?_+$:Ut(c.top,c.bottom))}await i({...t,availableWidth:S,availableHeight:w});const C=await o.getDimensions(s.floating);return f!==C.width||p!==C.height?{reset:{rects:!0}}:{}}}};function Kr(e){return m1(e)?(e.nodeName||"").toLowerCase():"#document"}function Xt(e){var t;return(e==null||(t=e.ownerDocument)==null?void 0:t.defaultView)||window}function yr(e){var t;return(t=(m1(e)?e.ownerDocument:e.document)||window.document)==null?void 0:t.documentElement}function m1(e){return e instanceof Node||e instanceof Xt(e).Node}function ur(e){return e instanceof Element||e instanceof Xt(e).Element}function Vn(e){return e instanceof HTMLElement||e instanceof Xt(e).HTMLElement}function ub(e){return typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof Xt(e).ShadowRoot}function ha(e){const{overflow:t,overflowX:n,overflowY:r,display:o}=pn(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(o)}function hB(e){return["table","td","th"].includes(Kr(e))}function dg(e){const t=fg(),n=pn(e);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!t&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!t&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function pB(e){let t=ks(e);for(;Vn(t)&&!uu(t);){if(dg(t))return t;t=ks(t)}return null}function fg(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function uu(e){return["html","body","#document"].includes(Kr(e))}function pn(e){return Xt(e).getComputedStyle(e)}function du(e){return ur(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function ks(e){if(Kr(e)==="html")return e;const t=e.assignedSlot||e.parentNode||ub(e)&&e.host||yr(e);return ub(t)?t.host:t}function y1(e){const t=ks(e);return uu(t)?e.ownerDocument?e.ownerDocument.body:e.body:Vn(t)&&ha(t)?t:y1(t)}function wl(e,t){var n;t===void 0&&(t=[]);const r=y1(e),o=r===((n=e.ownerDocument)==null?void 0:n.body),s=Xt(r);return o?t.concat(s,s.visualViewport||[],ha(r)?r:[]):t.concat(r,wl(r))}function v1(e){const t=pn(e);let n=parseFloat(t.width)||0,r=parseFloat(t.height)||0;const o=Vn(e),s=o?e.offsetWidth:n,i=o?e.offsetHeight:r,a=bl(n)!==s||bl(r)!==i;return a&&(n=s,r=i),{width:n,height:r,$:a}}function hg(e){return ur(e)?e:e.contextElement}function gs(e){const t=hg(e);if(!Vn(t))return Vr(1);const n=t.getBoundingClientRect(),{width:r,height:o,$:s}=v1(t);let i=(s?bl(n.width):n.width)/r,a=(s?bl(n.height):n.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const gB=Vr(0);function b1(e){const t=Xt(e);return!fg()||!t.visualViewport?gB:{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}}function mB(e,t,n){return t===void 0&&(t=!1),!n||t&&n!==Xt(e)?!1:t}function wo(e,t,n,r){t===void 0&&(t=!1),n===void 0&&(n=!1);const o=e.getBoundingClientRect(),s=hg(e);let i=Vr(1);t&&(r?ur(r)&&(i=gs(r)):i=gs(e));const a=mB(s,n,r)?b1(s):Vr(0);let c=(o.left+a.x)/i.x,l=(o.top+a.y)/i.y,u=o.width/i.x,d=o.height/i.y;if(s){const f=Xt(s),p=r&&ur(r)?Xt(r):r;let v=f.frameElement;for(;v&&r&&p!==f;){const m=gs(v),y=v.getBoundingClientRect(),b=pn(v),x=y.left+(v.clientLeft+parseFloat(b.paddingLeft))*m.x,w=y.top+(v.clientTop+parseFloat(b.paddingTop))*m.y;c*=m.x,l*=m.y,u*=m.x,d*=m.y,c+=x,l+=w,v=Xt(v).frameElement}}return xl({width:u,height:d,x:c,y:l})}function yB(e){let{rect:t,offsetParent:n,strategy:r}=e;const o=Vn(n),s=yr(n);if(n===s)return t;let i={scrollLeft:0,scrollTop:0},a=Vr(1);const c=Vr(0);if((o||!o&&r!=="fixed")&&((Kr(n)!=="body"||ha(s))&&(i=du(n)),Vn(n))){const l=wo(n);a=gs(n),c.x=l.x+n.clientLeft,c.y=l.y+n.clientTop}return{width:t.width*a.x,height:t.height*a.y,x:t.x*a.x-i.scrollLeft*a.x+c.x,y:t.y*a.y-i.scrollTop*a.y+c.y}}function vB(e){return Array.from(e.getClientRects())}function S1(e){return wo(yr(e)).left+du(e).scrollLeft}function bB(e){const t=yr(e),n=du(e),r=e.ownerDocument.body,o=Ut(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),s=Ut(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+S1(e);const a=-n.scrollTop;return pn(r).direction==="rtl"&&(i+=Ut(t.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function SB(e,t){const n=Xt(e),r=yr(e),o=n.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,c=0;if(o){s=o.width,i=o.height;const l=fg();(!l||l&&t==="fixed")&&(a=o.offsetLeft,c=o.offsetTop)}return{width:s,height:i,x:a,y:c}}function xB(e,t){const n=wo(e,!0,t==="fixed"),r=n.top+e.clientTop,o=n.left+e.clientLeft,s=Vn(e)?gs(e):Vr(1),i=e.clientWidth*s.x,a=e.clientHeight*s.y,c=o*s.x,l=r*s.y;return{width:i,height:a,x:c,y:l}}function db(e,t,n){let r;if(t==="viewport")r=SB(e,n);else if(t==="document")r=bB(yr(e));else if(ur(t))r=xB(t,n);else{const o=b1(e);r={...t,x:t.x-o.x,y:t.y-o.y}}return xl(r)}function x1(e,t){const n=ks(e);return n===t||!ur(n)||uu(n)?!1:pn(n).position==="fixed"||x1(n,t)}function wB(e,t){const n=t.get(e);if(n)return n;let r=wl(e).filter(a=>ur(a)&&Kr(a)!=="body"),o=null;const s=pn(e).position==="fixed";let i=s?ks(e):e;for(;ur(i)&&!uu(i);){const a=pn(i),c=dg(i);!c&&a.position==="fixed"&&(o=null),(s?!c&&!o:!c&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||ha(i)&&!c&&x1(e,i))?r=r.filter(u=>u!==i):o=a,i=ks(i)}return t.set(e,r),r}function CB(e){let{element:t,boundary:n,rootBoundary:r,strategy:o}=e;const i=[...n==="clippingAncestors"?wB(t,this._c):[].concat(n),r],a=i[0],c=i.reduce((l,u)=>{const d=db(t,u,o);return l.top=Ut(d.top,l.top),l.right=Ur(d.right,l.right),l.bottom=Ur(d.bottom,l.bottom),l.left=Ut(d.left,l.left),l},db(t,a,o));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function PB(e){return v1(e)}function EB(e,t,n){const r=Vn(t),o=yr(t),s=n==="fixed",i=wo(e,!0,s,t);let a={scrollLeft:0,scrollTop:0};const c=Vr(0);if(r||!r&&!s)if((Kr(t)!=="body"||ha(o))&&(a=du(t)),r){const l=wo(t,!0,s,t);c.x=l.x+t.clientLeft,c.y=l.y+t.clientTop}else o&&(c.x=S1(o));return{x:i.left+a.scrollLeft-c.x,y:i.top+a.scrollTop-c.y,width:i.width,height:i.height}}function fb(e,t){return!Vn(e)||pn(e).position==="fixed"?null:t?t(e):e.offsetParent}function w1(e,t){const n=Xt(e);if(!Vn(e))return n;let r=fb(e,t);for(;r&&hB(r)&&pn(r).position==="static";)r=fb(r,t);return r&&(Kr(r)==="html"||Kr(r)==="body"&&pn(r).position==="static"&&!dg(r))?n:r||pB(e)||n}const _B=async function(e){let{reference:t,floating:n,strategy:r}=e;const o=this.getOffsetParent||w1,s=this.getDimensions;return{reference:EB(t,await o(n),r),floating:{x:0,y:0,...await s(n)}}};function IB(e){return pn(e).direction==="rtl"}const kB={convertOffsetParentRelativeRectToViewportRelativeRect:yB,getDocumentElement:yr,getClippingRect:CB,getOffsetParent:w1,getElementRects:_B,getClientRects:vB,getDimensions:PB,getScale:gs,isElement:ur,isRTL:IB};function TB(e,t){let n=null,r;const o=yr(e);function s(){clearTimeout(r),n&&n.disconnect(),n=null}function i(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const{left:l,top:u,width:d,height:f}=e.getBoundingClientRect();if(a||t(),!d||!f)return;const p=mc(u),v=mc(o.clientWidth-(l+d)),m=mc(o.clientHeight-(u+f)),y=mc(l),x={rootMargin:-p+"px "+-v+"px "+-m+"px "+-y+"px",threshold:Ut(0,Ur(1,c))||1};let w=!0;function S(C){const P=C[0].intersectionRatio;if(P!==c){if(!w)return i();P?i(!1,P):r=setTimeout(()=>{i(!1,1e-7)},100)}w=!1}try{n=new IntersectionObserver(S,{...x,root:o.ownerDocument})}catch{n=new IntersectionObserver(S,x)}n.observe(e)}return i(!0),s}function pg(e,t,n,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=hg(e),u=o||s?[...l?wl(l):[],...wl(t)]:[];u.forEach(b=>{o&&b.addEventListener("scroll",n,{passive:!0}),s&&b.addEventListener("resize",n)});const d=l&&a?TB(l,n):null;let f=-1,p=null;i&&(p=new ResizeObserver(b=>{let[x]=b;x&&x.target===l&&p&&(p.unobserve(t),cancelAnimationFrame(f),f=requestAnimationFrame(()=>{p&&p.observe(t)})),n()}),l&&!c&&p.observe(l),p.observe(t));let v,m=c?wo(e):null;c&&y();function y(){const b=wo(e);m&&(b.x!==m.x||b.y!==m.y||b.width!==m.width||b.height!==m.height)&&n(),m=b,v=requestAnimationFrame(y)}return n(),()=>{u.forEach(b=>{o&&b.removeEventListener("scroll",n),s&&b.removeEventListener("resize",n)}),d&&d(),p&&p.disconnect(),p=null,c&&cancelAnimationFrame(v)}}const $B=(e,t,n)=>{const r=new Map,o={platform:kB,...n},s={...o.platform,_c:r};return dB(e,t,{...o,platform:s})},gg=e=>{function t(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:e,fn(n){const{element:r,padding:o}=typeof e=="function"?e(n):e;return r&&t(r)?r.current!=null?ab({element:r.current,padding:o}).fn(n):{}:r?ab({element:r,padding:o}).fn(n):{}}}};var Lc=typeof document<"u"?g.useLayoutEffect:g.useEffect;function Cl(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if(typeof e=="function"&&e.toString()===t.toString())return!0;let n,r,o;if(e&&t&&typeof e=="object"){if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!Cl(e[r],t[r]))return!1;return!0}if(o=Object.keys(e),n=o.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(t,o[r]))return!1;for(r=n;r--!==0;){const s=o[r];if(!(s==="_owner"&&e.$$typeof)&&!Cl(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}function C1(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function hb(e,t){const n=C1(e);return Math.round(t*n)/n}function pb(e){const t=g.useRef(e);return Lc(()=>{t.current=e}),t}function mg(e){e===void 0&&(e={});const{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:c,open:l}=e,[u,d]=g.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[f,p]=g.useState(r);Cl(f,r)||p(r);const[v,m]=g.useState(null),[y,b]=g.useState(null),x=g.useCallback(D=>{D!=P.current&&(P.current=D,m(D))},[m]),w=g.useCallback(D=>{D!==E.current&&(E.current=D,b(D))},[b]),S=s||v,C=i||y,P=g.useRef(null),E=g.useRef(null),_=g.useRef(u),$=pb(c),T=pb(o),M=g.useCallback(()=>{if(!P.current||!E.current)return;const D={placement:t,strategy:n,middleware:f};T.current&&(D.platform=T.current),$B(P.current,E.current,D).then(G=>{const V={...G,isPositioned:!0};O.current&&!Cl(_.current,V)&&(_.current=V,Eo.flushSync(()=>{d(V)}))})},[f,t,n,T]);Lc(()=>{l===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,d(D=>({...D,isPositioned:!1})))},[l]);const O=g.useRef(!1);Lc(()=>(O.current=!0,()=>{O.current=!1}),[]),Lc(()=>{if(S&&(P.current=S),C&&(E.current=C),S&&C){if($.current)return $.current(S,C,M);M()}},[S,C,M,$]);const j=g.useMemo(()=>({reference:P,floating:E,setReference:x,setFloating:w}),[x,w]),N=g.useMemo(()=>({reference:S,floating:C}),[S,C]),B=g.useMemo(()=>{const D={position:n,left:0,top:0};if(!N.floating)return D;const G=hb(N.floating,u.x),V=hb(N.floating,u.y);return a?{...D,transform:"translate("+G+"px, "+V+"px)",...C1(N.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:G,top:V}},[n,a,N.floating,u.x,u.y]);return g.useMemo(()=>({...u,update:M,refs:j,elements:N,floatingStyles:B}),[u,M,j,N,B])}const AB=g.forwardRef((e,t)=>{const{children:n,width:r=10,height:o=5,...s}=e;return g.createElement(Rt.svg,me({},s,{ref:t,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?n:g.createElement("polygon",{points:"0,0 30,0 15,10"}))}),JX=AB;function MB(e){const[t,n]=g.useState(void 0);return uf(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,a=l.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}const P1="Popper",[E1,_1]=Os(P1),[OB,I1]=E1(P1),RB=e=>{const{__scopePopper:t,children:n}=e,[r,o]=g.useState(null);return g.createElement(OB,{scope:t,anchor:r,onAnchorChange:o},n)},jB="PopperAnchor",DB=g.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...o}=e,s=I1(jB,n),i=g.useRef(null),a=Mt(t,i);return g.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:g.createElement(Rt.div,me({},o,{ref:a}))}),k1="PopperContent",[NB,eq]=E1(k1),LB=g.forwardRef((e,t)=>{var n,r,o,s,i,a,c,l;const{__scopePopper:u,side:d="bottom",sideOffset:f=0,align:p="center",alignOffset:v=0,arrowPadding:m=0,avoidCollisions:y=!0,collisionBoundary:b=[],collisionPadding:x=0,sticky:w="partial",hideWhenDetached:S=!1,updatePositionStrategy:C="optimized",onPlaced:P,...E}=e,_=I1(k1,u),[$,T]=g.useState(null),M=Mt(t,Oe=>T(Oe)),[O,j]=g.useState(null),N=MB(O),B=(n=N==null?void 0:N.width)!==null&&n!==void 0?n:0,D=(r=N==null?void 0:N.height)!==null&&r!==void 0?r:0,G=d+(p!=="center"?"-"+p:""),V=typeof x=="number"?x:{top:0,right:0,bottom:0,left:0,...x},z=Array.isArray(b)?b:[b],W=z.length>0,Q={padding:V,boundary:z.filter(FB),altBoundary:W},{refs:oe,floatingStyles:se,placement:ye,isPositioned:ee,middlewareData:be}=mg({strategy:"fixed",placement:G,whileElementsMounted:(...Oe)=>pg(...Oe,{animationFrame:C==="always"}),elements:{reference:_.anchor},middleware:[ag({mainAxis:f+D,alignmentAxis:v}),y&&cg({mainAxis:!0,crossAxis:!1,limiter:w==="partial"?lg():void 0,...Q}),y&&sg({...Q}),ug({...Q,apply:({elements:Oe,rects:tt,availableWidth:kn,availableHeight:vn})=>{const{width:Je,height:Yn}=tt.reference,br=Oe.floating.style;br.setProperty("--radix-popper-available-width",`${kn}px`),br.setProperty("--radix-popper-available-height",`${vn}px`),br.setProperty("--radix-popper-anchor-width",`${Je}px`),br.setProperty("--radix-popper-anchor-height",`${Yn}px`)}}),O&&gg({element:O,padding:m}),BB({arrowWidth:B,arrowHeight:D}),S&&ig({strategy:"referenceHidden",...Q})]}),[Se,Ie]=T1(ye),de=Nr(P);uf(()=>{ee&&(de==null||de())},[ee,de]);const Ee=(o=be.arrow)===null||o===void 0?void 0:o.x,xe=(s=be.arrow)===null||s===void 0?void 0:s.y,Qe=((i=be.arrow)===null||i===void 0?void 0:i.centerOffset)!==0,[Fe,et]=g.useState();return uf(()=>{$&&et(window.getComputedStyle($).zIndex)},[$]),g.createElement("div",{ref:oe.setFloating,"data-radix-popper-content-wrapper":"",style:{...se,transform:ee?se.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Fe,"--radix-popper-transform-origin":[(a=be.transformOrigin)===null||a===void 0?void 0:a.x,(c=be.transformOrigin)===null||c===void 0?void 0:c.y].join(" ")},dir:e.dir},g.createElement(NB,{scope:u,placedSide:Se,onArrowChange:j,arrowX:Ee,arrowY:xe,shouldHideArrow:Qe},g.createElement(Rt.div,me({"data-side":Se,"data-align":Ie},E,{ref:M,style:{...E.style,animation:ee?void 0:"none",opacity:(l=be.hide)!==null&&l!==void 0&&l.referenceHidden?0:void 0}}))))});function FB(e){return e!==null}const BB=e=>({name:"transformOrigin",options:e,fn(t){var n,r,o,s,i;const{placement:a,rects:c,middlewareData:l}=t,d=((n=l.arrow)===null||n===void 0?void 0:n.centerOffset)!==0,f=d?0:e.arrowWidth,p=d?0:e.arrowHeight,[v,m]=T1(a),y={start:"0%",center:"50%",end:"100%"}[m],b=((r=(o=l.arrow)===null||o===void 0?void 0:o.x)!==null&&r!==void 0?r:0)+f/2,x=((s=(i=l.arrow)===null||i===void 0?void 0:i.y)!==null&&s!==void 0?s:0)+p/2;let w="",S="";return v==="bottom"?(w=d?y:`${b}px`,S=`${-p}px`):v==="top"?(w=d?y:`${b}px`,S=`${c.floating.height+p}px`):v==="right"?(w=`${-p}px`,S=d?y:`${x}px`):v==="left"&&(w=`${c.floating.width+p}px`,S=d?y:`${x}px`),{data:{x:w,y:S}}}});function T1(e){const[t,n="center"]=e.split("-");return[t,n]}const $1=RB,zB=DB,UB=LB,VB=g.forwardRef((e,t)=>{var n;const{container:r=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...o}=e;return r?Qi.createPortal(g.createElement(Rt.div,me({},o,{ref:t})),r):null});function KB(e){const t=e+"CollectionProvider",[n,r]=Os(t),[o,s]=n(t,{collectionRef:{current:null},itemMap:new Map}),i=p=>{const{scope:v,children:m}=p,y=Z.useRef(null),b=Z.useRef(new Map).current;return Z.createElement(o,{scope:v,itemMap:b,collectionRef:y},m)},a=e+"CollectionSlot",c=Z.forwardRef((p,v)=>{const{scope:m,children:y}=p,b=s(a,m),x=Mt(v,b.collectionRef);return Z.createElement(Ri,{ref:x},y)}),l=e+"CollectionItemSlot",u="data-radix-collection-item",d=Z.forwardRef((p,v)=>{const{scope:m,children:y,...b}=p,x=Z.useRef(null),w=Mt(v,x),S=s(l,m);return Z.useEffect(()=>(S.itemMap.set(x,{ref:x,...b}),()=>void S.itemMap.delete(x))),Z.createElement(Ri,{[u]:"",ref:w},y)});function f(p){const v=s(e+"CollectionConsumer",p);return Z.useCallback(()=>{const y=v.collectionRef.current;if(!y)return[];const b=Array.from(y.querySelectorAll(`[${u}]`));return Array.from(v.itemMap.values()).sort((S,C)=>b.indexOf(S.ref.current)-b.indexOf(C.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:c,ItemSlot:d},f,r]}const Gd="rovingFocusGroup.onEntryFocus",WB={bubbles:!1,cancelable:!0},yg="RovingFocusGroup",[oh,A1,HB]=KB(yg),[GB,M1]=Os(yg,[HB]),[YB,XB]=GB(yg),qB=g.forwardRef((e,t)=>g.createElement(oh.Provider,{scope:e.__scopeRovingFocusGroup},g.createElement(oh.Slot,{scope:e.__scopeRovingFocusGroup},g.createElement(ZB,me({},e,{ref:t}))))),ZB=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:o=!1,dir:s,currentTabStopId:i,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,...u}=e,d=g.useRef(null),f=Mt(t,d),p=f1(s),[v=null,m]=Mh({prop:i,defaultProp:a,onChange:c}),[y,b]=g.useState(!1),x=Nr(l),w=A1(n),S=g.useRef(!1),[C,P]=g.useState(0);return g.useEffect(()=>{const E=d.current;if(E)return E.addEventListener(Gd,x),()=>E.removeEventListener(Gd,x)},[x]),g.createElement(YB,{scope:n,orientation:r,dir:p,loop:o,currentTabStopId:v,onItemFocus:g.useCallback(E=>m(E),[m]),onItemShiftTab:g.useCallback(()=>b(!0),[]),onFocusableItemAdd:g.useCallback(()=>P(E=>E+1),[]),onFocusableItemRemove:g.useCallback(()=>P(E=>E-1),[])},g.createElement(Rt.div,me({tabIndex:y||C===0?-1:0,"data-orientation":r},u,{ref:f,style:{outline:"none",...e.style},onMouseDown:Pe(e.onMouseDown,()=>{S.current=!0}),onFocus:Pe(e.onFocus,E=>{const _=!S.current;if(E.target===E.currentTarget&&_&&!y){const $=new CustomEvent(Gd,WB);if(E.currentTarget.dispatchEvent($),!$.defaultPrevented){const T=w().filter(B=>B.focusable),M=T.find(B=>B.active),O=T.find(B=>B.id===v),N=[M,O,...T].filter(Boolean).map(B=>B.ref.current);O1(N)}}S.current=!1}),onBlur:Pe(e.onBlur,()=>b(!1))})))}),QB="RovingFocusGroupItem",JB=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:o=!1,tabStopId:s,...i}=e,a=ji(),c=s||a,l=XB(QB,n),u=l.currentTabStopId===c,d=A1(n),{onFocusableItemAdd:f,onFocusableItemRemove:p}=l;return g.useEffect(()=>{if(r)return f(),()=>p()},[r,f,p]),g.createElement(oh.ItemSlot,{scope:n,id:c,focusable:r,active:o},g.createElement(Rt.span,me({tabIndex:u?0:-1,"data-orientation":l.orientation},i,{ref:t,onMouseDown:Pe(e.onMouseDown,v=>{r?l.onItemFocus(c):v.preventDefault()}),onFocus:Pe(e.onFocus,()=>l.onItemFocus(c)),onKeyDown:Pe(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){l.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const m=n9(v,l.orientation,l.dir);if(m!==void 0){v.preventDefault();let b=d().filter(x=>x.focusable).map(x=>x.ref.current);if(m==="last")b.reverse();else if(m==="prev"||m==="next"){m==="prev"&&b.reverse();const x=b.indexOf(v.currentTarget);b=l.loop?r9(b,x+1):b.slice(x+1)}setTimeout(()=>O1(b))}})})))}),e9={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function t9(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function n9(e,t,n){const r=t9(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return e9[r]}function O1(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function r9(e,t){return e.map((n,r)=>e[(t+r)%e.length])}const o9=qB,s9=JB,sh=["Enter"," "],i9=["ArrowDown","PageUp","Home"],R1=["ArrowUp","PageDown","End"],a9=[...i9,...R1],c9={ltr:[...sh,"ArrowRight"],rtl:[...sh,"ArrowLeft"]},l9={ltr:["ArrowLeft"],rtl:["ArrowRight"]},fu="Menu",[Hi,u9,d9]=U8(fu),[Mo,j1]=Os(fu,[d9,_1,M1]),hu=_1(),D1=M1(),[N1,Jr]=Mo(fu),[f9,pa]=Mo(fu),h9=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:o,onOpenChange:s,modal:i=!0}=e,a=hu(t),[c,l]=g.useState(null),u=g.useRef(!1),d=Nr(s),f=f1(o);return g.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),g.createElement($1,a,g.createElement(N1,{scope:t,open:n,onOpenChange:d,content:c,onContentChange:l},g.createElement(f9,{scope:t,onClose:g.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:f,modal:i},r)))},L1=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,o=hu(n);return g.createElement(zB,me({},o,r,{ref:t}))}),F1="MenuPortal",[p9,B1]=Mo(F1,{forceMount:void 0}),g9=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:o}=e,s=Jr(F1,t);return g.createElement(p9,{scope:t,forceMount:n},g.createElement(Tl,{present:n||s.open},g.createElement(VB,{asChild:!0,container:o},r)))},_n="MenuContent",[m9,vg]=Mo(_n),y9=g.forwardRef((e,t)=>{const n=B1(_n,e.__scopeMenu),{forceMount:r=n.forceMount,...o}=e,s=Jr(_n,e.__scopeMenu),i=pa(_n,e.__scopeMenu);return g.createElement(Hi.Provider,{scope:e.__scopeMenu},g.createElement(Tl,{present:r||s.open},g.createElement(Hi.Slot,{scope:e.__scopeMenu},i.modal?g.createElement(v9,me({},o,{ref:t})):g.createElement(b9,me({},o,{ref:t})))))}),v9=g.forwardRef((e,t)=>{const n=Jr(_n,e.__scopeMenu),r=g.useRef(null),o=Mt(t,r);return g.useEffect(()=>{const s=r.current;if(s)return kl(s)},[]),g.createElement(bg,me({},e,{ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Pe(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),b9=g.forwardRef((e,t)=>{const n=Jr(_n,e.__scopeMenu);return g.createElement(bg,me({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),bg=g.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:p,disableOutsideScroll:v,...m}=e,y=Jr(_n,n),b=pa(_n,n),x=hu(n),w=D1(n),S=u9(n),[C,P]=g.useState(null),E=g.useRef(null),_=Mt(t,E,y.onContentChange),$=g.useRef(0),T=g.useRef(""),M=g.useRef(0),O=g.useRef(null),j=g.useRef("right"),N=g.useRef(0),B=v?K_:g.Fragment,D=v?{as:Ri,allowPinchZoom:!0}:void 0,G=z=>{var W,Q;const oe=T.current+z,se=S().filter(de=>!de.disabled),ye=document.activeElement,ee=(W=se.find(de=>de.ref.current===ye))===null||W===void 0?void 0:W.textValue,be=se.map(de=>de.textValue),Se=j9(be,oe,ee),Ie=(Q=se.find(de=>de.textValue===Se))===null||Q===void 0?void 0:Q.ref.current;(function de(Ee){T.current=Ee,window.clearTimeout($.current),Ee!==""&&($.current=window.setTimeout(()=>de(""),1e3))})(oe),Ie&&setTimeout(()=>Ie.focus())};g.useEffect(()=>()=>window.clearTimeout($.current),[]),V_();const V=g.useCallback(z=>{var W,Q;return j.current===((W=O.current)===null||W===void 0?void 0:W.side)&&N9(z,(Q=O.current)===null||Q===void 0?void 0:Q.area)},[]);return g.createElement(m9,{scope:n,searchRef:T,onItemEnter:g.useCallback(z=>{V(z)&&z.preventDefault()},[V]),onItemLeave:g.useCallback(z=>{var W;V(z)||((W=E.current)===null||W===void 0||W.focus(),P(null))},[V]),onTriggerLeave:g.useCallback(z=>{V(z)&&z.preventDefault()},[V]),pointerGraceTimerRef:M,onPointerGraceIntentChange:g.useCallback(z=>{O.current=z},[])},g.createElement(B,D,g.createElement(q8,{asChild:!0,trapped:o,onMountAutoFocus:Pe(s,z=>{var W;z.preventDefault(),(W=E.current)===null||W===void 0||W.focus()}),onUnmountAutoFocus:i},g.createElement(G8,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:p},g.createElement(o9,me({asChild:!0},w,{dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:C,onCurrentTabStopIdChange:P,onEntryFocus:Pe(c,z=>{b.isUsingKeyboardRef.current||z.preventDefault()})}),g.createElement(UB,me({role:"menu","aria-orientation":"vertical","data-state":H1(y.open),"data-radix-menu-content":"",dir:b.dir},x,m,{ref:_,style:{outline:"none",...m.style},onKeyDown:Pe(m.onKeyDown,z=>{const Q=z.target.closest("[data-radix-menu-content]")===z.currentTarget,oe=z.ctrlKey||z.altKey||z.metaKey,se=z.key.length===1;Q&&(z.key==="Tab"&&z.preventDefault(),!oe&&se&&G(z.key));const ye=E.current;if(z.target!==ye||!a9.includes(z.key))return;z.preventDefault();const be=S().filter(Se=>!Se.disabled).map(Se=>Se.ref.current);R1.includes(z.key)&&be.reverse(),O9(be)}),onBlur:Pe(e.onBlur,z=>{z.currentTarget.contains(z.target)||(window.clearTimeout($.current),T.current="")}),onPointerMove:Pe(e.onPointerMove,Gi(z=>{const W=z.target,Q=N.current!==z.clientX;if(z.currentTarget.contains(W)&&Q){const oe=z.clientX>N.current?"right":"left";j.current=oe,N.current=z.clientX}}))})))))))}),S9=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return g.createElement(Rt.div,me({role:"group"},r,{ref:t}))}),x9=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return g.createElement(Rt.div,me({},r,{ref:t}))}),ih="MenuItem",gb="menu.itemSelect",z1=g.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...o}=e,s=g.useRef(null),i=pa(ih,e.__scopeMenu),a=vg(ih,e.__scopeMenu),c=Mt(t,s),l=g.useRef(!1),u=()=>{const d=s.current;if(!n&&d){const f=new CustomEvent(gb,{bubbles:!0,cancelable:!0});d.addEventListener(gb,p=>r==null?void 0:r(p),{once:!0}),Yb(d,f),f.defaultPrevented?l.current=!1:i.onClose()}};return g.createElement(U1,me({},o,{ref:c,disabled:n,onClick:Pe(e.onClick,u),onPointerDown:d=>{var f;(f=e.onPointerDown)===null||f===void 0||f.call(e,d),l.current=!0},onPointerUp:Pe(e.onPointerUp,d=>{var f;l.current||(f=d.currentTarget)===null||f===void 0||f.click()}),onKeyDown:Pe(e.onKeyDown,d=>{const f=a.searchRef.current!=="";n||f&&d.key===" "||sh.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})}))}),U1=g.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:o,...s}=e,i=vg(ih,n),a=D1(n),c=g.useRef(null),l=Mt(t,c),[u,d]=g.useState(!1),[f,p]=g.useState("");return g.useEffect(()=>{const v=c.current;if(v){var m;p(((m=v.textContent)!==null&&m!==void 0?m:"").trim())}},[s.children]),g.createElement(Hi.ItemSlot,{scope:n,disabled:r,textValue:o??f},g.createElement(s9,me({asChild:!0},a,{focusable:!r}),g.createElement(Rt.div,me({role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},s,{ref:l,onPointerMove:Pe(e.onPointerMove,Gi(v=>{r?i.onItemLeave(v):(i.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus())})),onPointerLeave:Pe(e.onPointerLeave,Gi(v=>i.onItemLeave(v))),onFocus:Pe(e.onFocus,()=>d(!0)),onBlur:Pe(e.onBlur,()=>d(!1))}))))}),w9=g.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...o}=e;return g.createElement(P9,{scope:e.__scopeMenu,checked:n},g.createElement(z1,me({role:"menuitemcheckbox","aria-checked":Pl(n)?"mixed":n},o,{ref:t,"data-state":G1(n),onSelect:Pe(o.onSelect,()=>r==null?void 0:r(Pl(n)?!0:!n),{checkForDefaultPrevented:!1})})))}),C9="MenuRadioGroup";Mo(C9,{value:void 0,onValueChange:()=>{}});const V1="MenuItemIndicator",[P9,E9]=Mo(V1,{checked:!1}),_9=g.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...o}=e,s=E9(V1,n);return g.createElement(Tl,{present:r||Pl(s.checked)||s.checked===!0},g.createElement(Rt.span,me({},o,{ref:t,"data-state":G1(s.checked)})))}),I9=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return g.createElement(Rt.div,me({role:"separator","aria-orientation":"horizontal"},r,{ref:t}))}),K1="MenuSub",[k9,W1]=Mo(K1),T9=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:o}=e,s=Jr(K1,t),i=hu(t),[a,c]=g.useState(null),[l,u]=g.useState(null),d=Nr(o);return g.useEffect(()=>(s.open===!1&&d(!1),()=>d(!1)),[s.open,d]),g.createElement($1,i,g.createElement(N1,{scope:t,open:r,onOpenChange:d,content:l,onContentChange:u},g.createElement(k9,{scope:t,contentId:ji(),triggerId:ji(),trigger:a,onTriggerChange:c},n)))},yc="MenuSubTrigger",$9=g.forwardRef((e,t)=>{const n=Jr(yc,e.__scopeMenu),r=pa(yc,e.__scopeMenu),o=W1(yc,e.__scopeMenu),s=vg(yc,e.__scopeMenu),i=g.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:e.__scopeMenu},u=g.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return g.useEffect(()=>u,[u]),g.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),c(null)}},[a,c]),g.createElement(L1,me({asChild:!0},l),g.createElement(U1,me({id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":H1(n.open)},e,{ref:Xb(t,o.onTriggerChange),onClick:d=>{var f;(f=e.onClick)===null||f===void 0||f.call(e,d),!(e.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Pe(e.onPointerMove,Gi(d=>{s.onItemEnter(d),!d.defaultPrevented&&!e.disabled&&!n.open&&!i.current&&(s.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:Pe(e.onPointerLeave,Gi(d=>{var f;u();const p=(f=n.content)===null||f===void 0?void 0:f.getBoundingClientRect();if(p){var v;const m=(v=n.content)===null||v===void 0?void 0:v.dataset.side,y=m==="right",b=y?-5:5,x=p[y?"left":"right"],w=p[y?"right":"left"];s.onPointerGraceIntentChange({area:[{x:d.clientX+b,y:d.clientY},{x,y:p.top},{x:w,y:p.top},{x:w,y:p.bottom},{x,y:p.bottom}],side:m}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(d),d.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Pe(e.onKeyDown,d=>{const f=s.searchRef.current!=="";if(!(e.disabled||f&&d.key===" ")&&c9[r.dir].includes(d.key)){var p;n.onOpenChange(!0),(p=n.content)===null||p===void 0||p.focus(),d.preventDefault()}})})))}),A9="MenuSubContent",M9=g.forwardRef((e,t)=>{const n=B1(_n,e.__scopeMenu),{forceMount:r=n.forceMount,...o}=e,s=Jr(_n,e.__scopeMenu),i=pa(_n,e.__scopeMenu),a=W1(A9,e.__scopeMenu),c=g.useRef(null),l=Mt(t,c);return g.createElement(Hi.Provider,{scope:e.__scopeMenu},g.createElement(Tl,{present:r||s.open},g.createElement(Hi.Slot,{scope:e.__scopeMenu},g.createElement(bg,me({id:a.contentId,"aria-labelledby":a.triggerId},o,{ref:l,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;i.isUsingKeyboardRef.current&&((d=c.current)===null||d===void 0||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:Pe(e.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Pe(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:Pe(e.onKeyDown,u=>{const d=u.currentTarget.contains(u.target),f=l9[i.dir].includes(u.key);if(d&&f){var p;s.onOpenChange(!1),(p=a.trigger)===null||p===void 0||p.focus(),u.preventDefault()}})})))))});function H1(e){return e?"open":"closed"}function Pl(e){return e==="indeterminate"}function G1(e){return Pl(e)?"indeterminate":e?"checked":"unchecked"}function O9(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function R9(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function j9(e,t,n){const o=t.length>1&&Array.from(t).every(l=>l===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let i=R9(e,Math.max(s,0));o.length===1&&(i=i.filter(l=>l!==n));const c=i.find(l=>l.toLowerCase().startsWith(o.toLowerCase()));return c!==n?c:void 0}function D9(e,t){const{x:n,y:r}=e;let o=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const a=t[s].x,c=t[s].y,l=t[i].x,u=t[i].y;c>r!=u>r&&n<(l-a)*(r-c)/(u-c)+a&&(o=!o)}return o}function N9(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return D9(n,t)}function Gi(e){return t=>t.pointerType==="mouse"?e(t):void 0}const L9=h9,F9=L1,B9=g9,z9=y9,U9=S9,V9=x9,K9=z1,W9=w9,H9=_9,G9=I9,Y9=T9,X9=$9,q9=M9,Y1="DropdownMenu",[Z9,tq]=Os(Y1,[j1]),nn=j1(),[Q9,X1]=Z9(Y1),J9=e=>{const{__scopeDropdownMenu:t,children:n,dir:r,open:o,defaultOpen:s,onOpenChange:i,modal:a=!0}=e,c=nn(t),l=g.useRef(null),[u=!1,d]=Mh({prop:o,defaultProp:s,onChange:i});return g.createElement(Q9,{scope:t,triggerId:ji(),triggerRef:l,contentId:ji(),open:u,onOpenChange:d,onOpenToggle:g.useCallback(()=>d(f=>!f),[d]),modal:a},g.createElement(L9,me({},c,{open:u,onOpenChange:d,dir:r,modal:a}),n))},ez="DropdownMenuTrigger",tz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...o}=e,s=X1(ez,n),i=nn(n);return g.createElement(F9,me({asChild:!0},i),g.createElement(Rt.button,me({type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},o,{ref:Xb(t,s.triggerRef),onPointerDown:Pe(e.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Pe(e.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})))}),nz=e=>{const{__scopeDropdownMenu:t,...n}=e,r=nn(t);return g.createElement(B9,me({},r,n))},rz="DropdownMenuContent",oz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=X1(rz,n),s=nn(n),i=g.useRef(!1);return g.createElement(z9,me({id:o.contentId,"aria-labelledby":o.triggerId},s,r,{ref:t,onCloseAutoFocus:Pe(e.onCloseAutoFocus,a=>{var c;i.current||(c=o.triggerRef.current)===null||c===void 0||c.focus(),i.current=!1,a.preventDefault()}),onInteractOutside:Pe(e.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;(!o.modal||u)&&(i.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),sz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(U9,me({},o,r,{ref:t}))}),iz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(V9,me({},o,r,{ref:t}))}),az=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(K9,me({},o,r,{ref:t}))}),cz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(W9,me({},o,r,{ref:t}))}),lz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(H9,me({},o,r,{ref:t}))}),uz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(G9,me({},o,r,{ref:t}))}),dz=e=>{const{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:o,defaultOpen:s}=e,i=nn(t),[a=!1,c]=Mh({prop:r,defaultProp:s,onChange:o});return g.createElement(Y9,me({},i,{open:a,onOpenChange:c}),n)},fz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(X9,me({},o,r,{ref:t}))}),hz=g.forwardRef((e,t)=>{const{__scopeDropdownMenu:n,...r}=e,o=nn(n);return g.createElement(q9,me({},o,r,{ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),Sg=J9,Ts=tz,pu=nz,xg=oz,pz=sz,nq=iz,ho=az,q1=cz,gz=lz,rq=uz,mz=dz,yz=fz,vz=hz;function Oo(e,t){const n=U(),r=g.useRef(!1),o=Ws(),s=g.useRef(0),i=g.useCallback(c=>{const l=Date.now();l-s.current<50||(s.current=l,r.current=c,n.batch(()=>{c?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(u=>!u.startsWith(e))}),t==null||t(c)}))},[n,e,t]),a=Y("is menu open",()=>n.getOpenMenus().includes(e),[n,e]);return g.useEffect(()=>(r.current&&(o("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{r.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach(c=>{c.startsWith(e)&&(o("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(c))}),r.current=!1)}),[n,e,o]),[a,i]}function Wr({id:e,children:t,modal:n=!1,debugOpen:r=!1}){const[o,s]=Oo(e);return h.jsx(Sg,{open:r||o,dir:"ltr",modal:n,onOpenChange:s,children:t})}function ga({children:e,"data-testid":t}){return h.jsx(Ts,{dir:"ltr","data-testid":t,asChild:!0,onTouchEnd:n=>_e(n),children:e})}function Hr({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:r=8,children:o}){const s=ut();return h.jsx(pu,{container:s,children:h.jsx(xg,{className:"tlui-menu",align:t,sideOffset:n,side:e,alignOffset:r,collisionPadding:4,children:o})})}function wg({id:e,children:t}){const[n,r]=Oo(e);return h.jsx(mz,{open:n,onOpenChange:r,children:t})}function Cg({label:e,"data-testid":t,"data-direction":n}){return h.jsx(yz,{dir:"ltr","data-direction":n,"data-testid":t,asChild:!0,children:h.jsx(te,{type:"menu",className:"tlui-menu__submenu__trigger",label:e,icon:"chevron-right"})})}function Pg({alignOffset:e=0,sideOffset:t=5,children:n}){const r=ut();return h.jsx(pu,{container:r,children:h.jsx(vz,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,children:n})})}function sr({children:e,size:t="medium"}){return h.jsx(pz,{dir:"ltr",className:"tlui-menu__group","data-size":t,children:e})}function Vt({noClose:e,...t}){return h.jsx(ho,{dir:"ltr",asChild:!0,onClick:e||t.isChecked!==void 0?_e:void 0,children:h.jsx(te,{...t})})}function Z1({children:e,onSelect:t,...n}){return h.jsxs(q1,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{t==null||t(r),_e(r)},...n,children:[h.jsx(Yt,{small:!0,icon:n.checked?"check":"checkbox-empty"}),e]})}function bz({children:e,onSelect:t,...n}){return h.jsxs(q1,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:r=>{t==null||t(r),_e(r)},...n,children:[h.jsx("div",{className:"tlui-button__checkbox__indicator",children:h.jsx(gz,{dir:"ltr",children:h.jsx(Yt,{icon:"check",small:!0})})}),e]})}let mb=0;function Sz(e,t){const n=Array(t),r=Math.floor(Math.sqrt(t));for(let o=0;o<t;o++)mb++,n[o]={id:Ln("box"+mb),type:"geo",x:o%r*132,y:Math.floor(o/r)*132};e.batch(()=>{e.createShapes(n).setSelectedShapes(n.map(o=>o.id))})}const xz=g.memo(function({renderDebugMenuItems:t}){const n=Ce();return h.jsxs("div",{className:"tlui-debug-panel",children:[h.jsx(wz,{}),h.jsx(Cz,{}),h.jsxs(Wr,{id:"debug",children:[h.jsx(ga,{children:h.jsx(te,{type:"icon",icon:"dots-horizontal",title:n("debug-panel.more")})}),h.jsx(Hr,{side:"top",align:"end",alignOffset:0,children:h.jsx(Pz,{renderDebugMenuItems:t})})]})]})}),wz=Te(function(){const t=U();return h.jsx("div",{className:"tlui-debug-panel__current-state",children:t.getPath()})}),Cz=function(){const t=U(),n=Y("rendering shapes count",()=>t.getRenderingShapes().length,[t]);return h.jsxs("div",{children:[n," Shapes"]})},Pz=Te(function({renderDebugMenuItems:t}){const n=U(),{addToast:r}=Gn(),{addDialog:o}=Hs(),[s,i]=g.useState(!1);return h.jsxs(h.Fragment,{children:[h.jsxs(sr,{children:[h.jsx(Vt,{type:"menu",onClick:()=>{r({id:je(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),r({id:je(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),r({id:je(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),h.jsx(Vt,{type:"menu",onClick:()=>{o({component:({onClose:a})=>h.jsx(_z,{displayDontShowAgain:!0,onCancel:()=>{a()},onContinue:()=>{a()}}),onClose:()=>{}})},label:"Show dialog"}),h.jsx(Vt,{type:"menu",onClick:()=>Sz(n,100),label:"Create 100 shapes"}),h.jsx(Vt,{type:"menu",onClick:()=>{function a({children:f}){let p=0;if(!f.length)return 0;for(const v of[...f])p++,p+=a(v);return p}const c=n.getSelectedShapes(),l=c.length===0?n.getRenderingShapes():c,u=l.map(f=>document.getElementById(f.id).parentElement);let d=u.length;for(const f of u)d+=a(f);window.alert(`Shapes ${l.length}, DOM nodes:${d}`)},label:"Count shapes / nodes"}),(()=>{if(s)throw Error("oh no!")})(),h.jsx(Vt,{type:"menu",onClick:()=>{i(!0)},label:"Throw error"}),h.jsx(Vt,{type:"menu",onClick:()=>{_S()},label:"Hard reset"})]}),h.jsxs(sr,{children:[h.jsx(yi,{flag:ze.debugSvg}),h.jsx(yi,{flag:ze.forceSrgb}),h.jsx(yi,{flag:ze.debugGeometry}),h.jsx(yi,{flag:ze.hideShapes})]}),h.jsx(sr,{children:Object.values(aT).map(a=>h.jsx(yi,{flag:a},a.name))}),t==null?void 0:t()]})});function Ez({label:e,value:t,onChange:n}){return h.jsx(Z1,{title:e,checked:t,onSelect:()=>n(!t),children:h.jsx("span",{className:"tlui-button__label",draggable:!1,children:e})})}const yi=Te(function({flag:t,onChange:n}){return h.jsx(Ez,{label:t.name.replace(/([a-z0-9])([A-Z])/g,r=>`${r[0]} ${r[1].toLowerCase()}`).replace(/^[a-z]/,r=>r.toUpperCase()),value:t.get(),onChange:r=>{t.set(r),n==null||n(r)}})});function _z({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:o=!1,onCancel:s,onContinue:i}){const[a,c]=g.useState(!1);return h.jsxs(h.Fragment,{children:[h.jsxs(iu,{children:[h.jsx(au,{children:e}),h.jsx(cu,{})]}),h.jsx(Ki,{style:{maxWidth:350},children:t}),h.jsxs(Yp,{className:"tlui-dialog__footer__actions",children:[o&&h.jsx(te,{type:"normal",onClick:()=>c(!a),iconLeft:a?"check":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),h.jsx(te,{type:"normal",onClick:s,children:n}),h.jsx(te,{type:"primary",onClick:async()=>i(),children:r})]})]})}const Iz=({id:e,component:t,onClose:n})=>{const{removeDialog:r}=Hs(),o=ut(),s=g.useCallback(i=>{if(!i){if(n)try{n()}catch(a){console.warn(a)}r(e)}},[e,n,r]);return h.jsx(j4,{onOpenChange:s,defaultOpen:!0,children:h.jsx(D4,{container:o,children:h.jsx(N4,{dir:"ltr",className:"tlui-dialog__overlay",children:h.jsx(L4,{dir:"ltr",className:"tlui-dialog__content",children:h.jsx(t,{onClose:()=>s(!1)})})})})})};function kz(){const{dialogs:e}=Hs();return h.jsx(h.Fragment,{children:e.map(t=>h.jsx(Iz,{...t},t.id))})}const Tz=Z.memo(kz);function $z(){const e=U(),t=Y("follow",()=>e.getInstanceState().followingUserId,[e]);return t?h.jsx(Az,{userId:t}):null}function Az({userId:e}){const t=GS(e);return t?h.jsx("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function Q1(){const e=U(),{languages:t,currentLanguage:n}=s1(),r=g.useCallback(o=>e.user.updateUserPreferences({locale:o}),[e]);return h.jsxs(wg,{id:"help menu language",children:[h.jsx(Cg,{label:"menu.language","data-direction":"left"}),h.jsx(Pg,{sideOffset:-4,children:h.jsx(sr,{children:t.map(({locale:o,label:s})=>h.jsx(bz,{title:o,checked:o===n,onSelect:()=>r(o),children:h.jsx("span",{className:"tlui-button__label",children:s})},o))})})]})}const Mz=g.memo(function(){const t=ut(),n=Ce(),[r,o]=Oo("help menu");return h.jsx("div",{className:"tlui-help-menu",children:h.jsxs(Sg,{dir:"ltr",open:r,onOpenChange:o,modal:!1,children:[h.jsx(Ts,{asChild:!0,dir:"ltr",children:h.jsx(te,{type:"help",className:"tlui-button",smallIcon:!0,title:n("help-menu.title"),icon:"question-mark"})}),h.jsx(pu,{container:t,children:h.jsx(xg,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:h.jsx(Oz,{})})})]})})});function Oz(){const e=$8(),t=gn();function n(r){if(!r||t&&!r.readonlyOk)return null;switch(r.type){case"custom":{if(r.id==="LANGUAGE_MENU")return h.jsx(Q1,{},"item");break}case"group":return h.jsx(sr,{size:"small",children:r.children.map(n)},r.id);case"submenu":return h.jsxs(wg,{id:`help menu ${r.id}`,children:[h.jsx(Cg,{label:r.label}),h.jsx(Pg,{children:r.children.map(n)})]},r.id);case"item":{const{id:o,kbd:s,label:i,onSelect:a,icon:c}=r.actionItem;return h.jsx(Vt,{type:"menu",kbd:s,label:i,onClick:()=>a("help-menu"),iconLeft:c},o)}}}return h.jsx(h.Fragment,{children:e.map(n)})}function Dr(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function Rz(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function J1(...e){return t=>e.forEach(n=>Rz(n,t))}function eo(...e){return g.useCallback(J1(...e),e)}function jz(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];const l=d=>{var b;const{scope:f,children:p,...v}=d,m=((b=f==null?void 0:f[e])==null?void 0:b[c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})};l.displayName=s+"Provider";function u(d,f){var m;const p=((m=f==null?void 0:f[e])==null?void 0:m[c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,Dz(o,...t)]}function Dz(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}var Eg=g.forwardRef((e,t)=>{const{children:n,...r}=e,o=g.Children.toArray(n),s=o.find(Lz);if(s){const i=s.props.children,a=o.map(c=>c===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(ah,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(ah,{...r,ref:t,children:n})});Eg.displayName="Slot";var ah=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const o=Bz(n);return g.cloneElement(n,{...Fz(r,n.props),ref:t?J1(t,o):o})}return g.Children.count(n)>1?g.Children.only(null):null});ah.displayName="SlotClone";var Nz=({children:e})=>h.jsx(h.Fragment,{children:e});function Lz(e){return g.isValidElement(e)&&e.type===Nz}function Fz(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function Bz(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var zz=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],vr=zz.reduce((e,t)=>{const n=g.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Eg:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Uz(e,t){e&&Eo.flushSync(()=>e.dispatchEvent(t))}function Gr(e){const t=g.useRef(e);return g.useEffect(()=>{t.current=e}),g.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function Vz(e,t=globalThis==null?void 0:globalThis.document){const n=Gr(e);g.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var Kz="DismissableLayer",ch="dismissableLayer.update",Wz="dismissableLayer.pointerDownOutside",Hz="dismissableLayer.focusOutside",yb,eC=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),tC=g.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...c}=e,l=g.useContext(eC),[u,d]=g.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=g.useState({}),v=eo(t,E=>d(E)),m=Array.from(l.layers),[y]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(y),x=u?m.indexOf(u):-1,w=l.layersWithOutsidePointerEventsDisabled.size>0,S=x>=b,C=Xz(E=>{const _=E.target,$=[...l.branches].some(T=>T.contains(_));!S||$||(o==null||o(E),i==null||i(E),E.defaultPrevented||a==null||a())},f),P=qz(E=>{const _=E.target;[...l.branches].some(T=>T.contains(_))||(s==null||s(E),i==null||i(E),E.defaultPrevented||a==null||a())},f);return Vz(E=>{x===l.layers.size-1&&(r==null||r(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},f),g.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(yb=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),vb(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=yb)}},[u,f,n,l]),g.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),vb())},[u,l]),g.useEffect(()=>{const E=()=>p({});return document.addEventListener(ch,E),()=>document.removeEventListener(ch,E)},[]),h.jsx(vr.div,{...c,ref:v,style:{pointerEvents:w?S?"auto":"none":void 0,...e.style},onFocusCapture:Dr(e.onFocusCapture,P.onFocusCapture),onBlurCapture:Dr(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:Dr(e.onPointerDownCapture,C.onPointerDownCapture)})});tC.displayName=Kz;var Gz="DismissableLayerBranch",Yz=g.forwardRef((e,t)=>{const n=g.useContext(eC),r=g.useRef(null),o=eo(t,r);return g.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(vr.div,{...e,ref:o})});Yz.displayName=Gz;function Xz(e,t=globalThis==null?void 0:globalThis.document){const n=Gr(e),r=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){nC(Wz,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=c,t.addEventListener("click",o.current,{once:!0})):c()}else t.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",s),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function qz(e,t=globalThis==null?void 0:globalThis.document){const n=Gr(e),r=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!r.current&&nC(Hz,n,{originalEvent:s},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function vb(){const e=new CustomEvent(ch);document.dispatchEvent(e)}function nC(e,t,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?Uz(o,s):o.dispatchEvent(s)}var Yd=0;function Zz(){g.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??bb()),document.body.insertAdjacentElement("beforeend",e[1]??bb()),Yd++,()=>{Yd===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),Yd--}},[])}function bb(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Xd="focusScope.autoFocusOnMount",qd="focusScope.autoFocusOnUnmount",Sb={bubbles:!1,cancelable:!0},Qz="FocusScope",rC=g.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=e,[a,c]=g.useState(null),l=Gr(o),u=Gr(s),d=g.useRef(null),f=eo(t,m=>c(m)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(r){let m=function(w){if(p.paused||!a)return;const S=w.target;a.contains(S)?d.current=S:Ir(d.current,{select:!0})},y=function(w){if(p.paused||!a)return;const S=w.relatedTarget;S!==null&&(a.contains(S)||Ir(d.current,{select:!0}))},b=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&Ir(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const x=new MutationObserver(b);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),x.disconnect()}}},[r,a,p.paused]),g.useEffect(()=>{if(a){wb.add(p);const m=document.activeElement;if(!a.contains(m)){const b=new CustomEvent(Xd,Sb);a.addEventListener(Xd,l),a.dispatchEvent(b),b.defaultPrevented||(Jz(oU(oC(a)),{select:!0}),document.activeElement===m&&Ir(a))}return()=>{a.removeEventListener(Xd,l),setTimeout(()=>{const b=new CustomEvent(qd,Sb);a.addEventListener(qd,u),a.dispatchEvent(b),b.defaultPrevented||Ir(m??document.body,{select:!0}),a.removeEventListener(qd,u),wb.remove(p)},0)}}},[a,l,u,p]);const v=g.useCallback(m=>{if(!n&&!r||p.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,b=document.activeElement;if(y&&b){const x=m.currentTarget,[w,S]=eU(x);w&&S?!m.shiftKey&&b===S?(m.preventDefault(),n&&Ir(w,{select:!0})):m.shiftKey&&b===w&&(m.preventDefault(),n&&Ir(S,{select:!0})):b===x&&m.preventDefault()}},[n,r,p.paused]);return h.jsx(vr.div,{tabIndex:-1,...i,ref:f,onKeyDown:v})});rC.displayName=Qz;function Jz(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(Ir(r,{select:t}),document.activeElement!==n)return}function eU(e){const t=oC(e),n=xb(t,e),r=xb(t.reverse(),e);return[n,r]}function oC(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function xb(e,t){for(const n of e)if(!tU(n,{upTo:t}))return n}function tU(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function nU(e){return e instanceof HTMLInputElement&&"select"in e}function Ir(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&nU(e)&&t&&e.select()}}var wb=rU();function rU(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=Cb(e,t),e.unshift(t)},remove(t){var n;e=Cb(e,t),(n=e[0])==null||n.resume()}}}function Cb(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function oU(e){return e.filter(t=>t.tagName!=="A")}var Co=globalThis!=null&&globalThis.document?g.useLayoutEffect:()=>{},sU=_h.useId||(()=>{}),iU=0;function aU(e){const[t,n]=g.useState(sU());return Co(()=>{e||n(r=>r??String(iU++))},[e]),e||(t?`radix-${t}`:"")}var cU="Arrow",sC=g.forwardRef((e,t)=>{const{children:n,width:r=10,height:o=5,...s}=e;return h.jsx(vr.svg,{...s,ref:t,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});sC.displayName=cU;var lU=sC;function uU(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:f,children:p,...v}=d,m=(f==null?void 0:f[e][c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})}function u(d,f){const p=(f==null?void 0:f[e][c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,dU(o,...t)]}function dU(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}function fU(e){const[t,n]=g.useState(void 0);return Co(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,a=l.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var _g="Popper",[iC,aC]=uU(_g),[hU,cC]=iC(_g),lC=e=>{const{__scopePopper:t,children:n}=e,[r,o]=g.useState(null);return h.jsx(hU,{scope:t,anchor:r,onAnchorChange:o,children:n})};lC.displayName=_g;var uC="PopperAnchor",dC=g.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...o}=e,s=cC(uC,n),i=g.useRef(null),a=eo(t,i);return g.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:h.jsx(vr.div,{...o,ref:a})});dC.displayName=uC;var Ig="PopperContent",[pU,gU]=iC(Ig),fC=g.forwardRef((e,t)=>{var Se,Ie,de,Ee,xe,Qe;const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:v,...m}=e,y=cC(Ig,n),[b,x]=g.useState(null),w=eo(t,Fe=>x(Fe)),[S,C]=g.useState(null),P=fU(S),E=(P==null?void 0:P.width)??0,_=(P==null?void 0:P.height)??0,$=r+(s!=="center"?"-"+s:""),T=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},M=Array.isArray(l)?l:[l],O=M.length>0,j={padding:T,boundary:M.filter(yU),altBoundary:O},{refs:N,floatingStyles:B,placement:D,isPositioned:G,middlewareData:V}=mg({strategy:"fixed",placement:$,whileElementsMounted:(...Fe)=>pg(...Fe,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[ag({mainAxis:o+_,alignmentAxis:i}),c&&cg({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?lg():void 0,...j}),c&&sg({...j}),ug({...j,apply:({elements:Fe,rects:et,availableWidth:Oe,availableHeight:tt})=>{const{width:kn,height:vn}=et.reference,Je=Fe.floating.style;Je.setProperty("--radix-popper-available-width",`${Oe}px`),Je.setProperty("--radix-popper-available-height",`${tt}px`),Je.setProperty("--radix-popper-anchor-width",`${kn}px`),Je.setProperty("--radix-popper-anchor-height",`${vn}px`)}}),S&&gg({element:S,padding:a}),vU({arrowWidth:E,arrowHeight:_}),f&&ig({strategy:"referenceHidden",...j})]}),[z,W]=gC(D),Q=Gr(v);Co(()=>{G&&(Q==null||Q())},[G,Q]);const oe=(Se=V.arrow)==null?void 0:Se.x,se=(Ie=V.arrow)==null?void 0:Ie.y,ye=((de=V.arrow)==null?void 0:de.centerOffset)!==0,[ee,be]=g.useState();return Co(()=>{b&&be(window.getComputedStyle(b).zIndex)},[b]),h.jsx("div",{ref:N.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:G?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ee,"--radix-popper-transform-origin":[(Ee=V.transformOrigin)==null?void 0:Ee.x,(xe=V.transformOrigin)==null?void 0:xe.y].join(" "),...((Qe=V.hide)==null?void 0:Qe.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:h.jsx(pU,{scope:n,placedSide:z,onArrowChange:C,arrowX:oe,arrowY:se,shouldHideArrow:ye,children:h.jsx(vr.div,{"data-side":z,"data-align":W,...m,ref:w,style:{...m.style,animation:G?void 0:"none"}})})})});fC.displayName=Ig;var hC="PopperArrow",mU={top:"bottom",right:"left",bottom:"top",left:"right"},pC=g.forwardRef(function(t,n){const{__scopePopper:r,...o}=t,s=gU(hC,r),i=mU[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(lU,{...o,ref:n,style:{...o.style,display:"block"}})})});pC.displayName=hC;function yU(e){return e!==null}var vU=e=>({name:"transformOrigin",options:e,fn(t){var y,b,x;const{placement:n,rects:r,middlewareData:o}=t,i=((y=o.arrow)==null?void 0:y.centerOffset)!==0,a=i?0:e.arrowWidth,c=i?0:e.arrowHeight,[l,u]=gC(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(((b=o.arrow)==null?void 0:b.x)??0)+a/2,p=(((x=o.arrow)==null?void 0:x.y)??0)+c/2;let v="",m="";return l==="bottom"?(v=i?d:`${f}px`,m=`${-c}px`):l==="top"?(v=i?d:`${f}px`,m=`${r.floating.height+c}px`):l==="right"?(v=`${-c}px`,m=i?d:`${p}px`):l==="left"&&(v=`${r.floating.width+c}px`,m=i?d:`${p}px`),{data:{x:v,y:m}}}});function gC(e){const[t,n="center"]=e.split("-");return[t,n]}var bU=lC,mC=dC,SU=fC,xU=pC,wU="Portal",yC=g.forwardRef((e,t)=>{var a;const{container:n,...r}=e,[o,s]=g.useState(!1);Co(()=>s(!0),[]);const i=n||o&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?Qi.createPortal(h.jsx(vr.div,{...r,ref:t}),i):null});yC.displayName=wU;function CU(e,t){return g.useReducer((n,r)=>t[n][r]??n,e)}var kg=e=>{const{present:t,children:n}=e,r=PU(t),o=typeof n=="function"?n({present:r.isPresent}):g.Children.only(n),s=eo(r.ref,EU(o));return typeof n=="function"||r.isPresent?g.cloneElement(o,{ref:s}):null};kg.displayName="Presence";function PU(e){const[t,n]=g.useState(),r=g.useRef({}),o=g.useRef(e),s=g.useRef("none"),i=e?"mounted":"unmounted",[a,c]=CU(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const l=vc(r.current);s.current=a==="mounted"?l:"none"},[a]),Co(()=>{const l=r.current,u=o.current;if(u!==e){const f=s.current,p=vc(l);e?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,c]),Co(()=>{if(t){let l;const u=t.ownerDocument.defaultView??window,d=p=>{const m=vc(r.current).includes(p.animationName);if(p.target===t&&m&&(c("ANIMATION_END"),!o.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",l=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},f=p=>{p.target===t&&(s.current=vc(r.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{u.clearTimeout(l),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:g.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function vc(e){return(e==null?void 0:e.animationName)||"none"}function EU(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function _U({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,o]=IU({defaultProp:t,onChange:n}),s=e!==void 0,i=s?e:r,a=Gr(n),c=g.useCallback(l=>{if(s){const d=typeof l=="function"?l(e):l;d!==e&&a(d)}else o(l)},[s,e,o,a]);return[i,c]}function IU({defaultProp:e,onChange:t}){const n=g.useState(e),[r]=n,o=g.useRef(r),s=Gr(t);return g.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var Fc="right-scroll-bar-position",Bc="width-before-scroll-bar",kU="with-scroll-bars-hidden",TU="--removed-body-scroll-bar-size",vC=Ih(),Zd=function(){},gu=g.forwardRef(function(e,t){var n=g.useRef(null),r=g.useState({onScrollCapture:Zd,onWheelCapture:Zd,onTouchMoveCapture:Zd}),o=r[0],s=r[1],i=e.forwardProps,a=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,f=e.sideCar,p=e.noIsolation,v=e.inert,m=e.allowPinchZoom,y=e.as,b=y===void 0?"div":y,x=e.gapMode,w=kh(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=f,C=Th([n,t]),P=rt(rt({},w),o);return g.createElement(g.Fragment,null,u&&g.createElement(S,{sideCar:vC,removeScrollBar:l,shards:d,noIsolation:p,inert:v,setCallbacks:s,allowPinchZoom:!!m,lockRef:n,gapMode:x}),i?g.cloneElement(g.Children.only(a),rt(rt({},P),{ref:C})):g.createElement(b,rt({},P,{className:c,ref:C}),a))});gu.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gu.classNames={fullWidth:Bc,zeroRight:Fc};var $U={left:0,top:0,right:0,gap:0},Qd=function(e){return parseInt(e||"",10)||0},AU=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[Qd(n),Qd(r),Qd(o)]},MU=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return $U;var t=AU(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},OU=Ms(),ms="data-scroll-locked",RU=function(e,t,n,r){var o=e.left,s=e.top,i=e.right,a=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(kU,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(ms,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Fc,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Bc,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Fc," .").concat(Fc,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Bc," .").concat(Bc,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ms,`] {
    `).concat(TU,": ").concat(a,`px;
  }
`)},Pb=function(){var e=parseInt(document.body.getAttribute(ms)||"0",10);return isFinite(e)?e:0},jU=function(){g.useEffect(function(){return document.body.setAttribute(ms,(Pb()+1).toString()),function(){var e=Pb()-1;e<=0?document.body.removeAttribute(ms):document.body.setAttribute(ms,e.toString())}},[])},DU=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;jU();var s=g.useMemo(function(){return MU(o)},[o]);return g.createElement(OU,{styles:RU(s,!t,o,n?"":"!important")})},lh=!1;if(typeof window<"u")try{var bc=Object.defineProperty({},"passive",{get:function(){return lh=!0,!0}});window.addEventListener("test",bc,bc),window.removeEventListener("test",bc,bc)}catch{lh=!1}var qo=lh?{passive:!1}:!1,NU=function(e){return e.tagName==="TEXTAREA"},bC=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!NU(e)&&n[t]==="visible")},LU=function(e){return bC(e,"overflowY")},FU=function(e){return bC(e,"overflowX")},Eb=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=SC(e,r);if(o){var s=xC(e,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},BU=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},zU=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},SC=function(e,t){return e==="v"?LU(t):FU(t)},xC=function(e,t){return e==="v"?BU(t):zU(t)},UU=function(e,t){return e==="h"&&t==="rtl"?-1:1},VU=function(e,t,n,r,o){var s=UU(e,window.getComputedStyle(t).direction),i=s*r,a=n.target,c=t.contains(a),l=!1,u=i>0,d=0,f=0;do{var p=xC(e,a),v=p[0],m=p[1],y=p[2],b=m-y-s*v;(v||b)&&SC(e,a)&&(d+=b,f+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(l=!0),l},Sc=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},_b=function(e){return[e.deltaX,e.deltaY]},Ib=function(e){return e&&"current"in e?e.current:e},KU=function(e,t){return e[0]===t[0]&&e[1]===t[1]},WU=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},HU=0,Zo=[];function GU(e){var t=g.useRef([]),n=g.useRef([0,0]),r=g.useRef(),o=g.useState(HU++)[0],s=g.useState(Ms)[0],i=g.useRef(e);g.useEffect(function(){i.current=e},[e]),g.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var m=$h([e.lockRef.current],(e.shards||[]).map(Ib),!0).filter(Boolean);return m.forEach(function(y){return y.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var a=g.useCallback(function(m,y){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var b=Sc(m),x=n.current,w="deltaX"in m?m.deltaX:x[0]-b[0],S="deltaY"in m?m.deltaY:x[1]-b[1],C,P=m.target,E=Math.abs(w)>Math.abs(S)?"h":"v";if("touches"in m&&E==="h"&&P.type==="range")return!1;var _=Eb(E,P);if(!_)return!0;if(_?C=E:(C=E==="v"?"h":"v",_=Eb(E,P)),!_)return!1;if(!r.current&&"changedTouches"in m&&(w||S)&&(r.current=C),!C)return!0;var $=r.current||C;return VU($,y,m,$==="h"?w:S)},[]),c=g.useCallback(function(m){var y=m;if(!(!Zo.length||Zo[Zo.length-1]!==s)){var b="deltaY"in y?_b(y):Sc(y),x=t.current.filter(function(C){return C.name===y.type&&(C.target===y.target||y.target===C.shadowParent)&&KU(C.delta,b)})[0];if(x&&x.should){y.cancelable&&y.preventDefault();return}if(!x){var w=(i.current.shards||[]).map(Ib).filter(Boolean).filter(function(C){return C.contains(y.target)}),S=w.length>0?a(y,w[0]):!i.current.noIsolation;S&&y.cancelable&&y.preventDefault()}}},[]),l=g.useCallback(function(m,y,b,x){var w={name:m,delta:y,target:b,should:x,shadowParent:YU(b)};t.current.push(w),setTimeout(function(){t.current=t.current.filter(function(S){return S!==w})},1)},[]),u=g.useCallback(function(m){n.current=Sc(m),r.current=void 0},[]),d=g.useCallback(function(m){l(m.type,_b(m),m.target,a(m,e.lockRef.current))},[]),f=g.useCallback(function(m){l(m.type,Sc(m),m.target,a(m,e.lockRef.current))},[]);g.useEffect(function(){return Zo.push(s),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",c,qo),document.addEventListener("touchmove",c,qo),document.addEventListener("touchstart",u,qo),function(){Zo=Zo.filter(function(m){return m!==s}),document.removeEventListener("wheel",c,qo),document.removeEventListener("touchmove",c,qo),document.removeEventListener("touchstart",u,qo)}},[]);var p=e.removeScrollBar,v=e.inert;return g.createElement(g.Fragment,null,v?g.createElement(s,{styles:WU(o)}):null,p?g.createElement(DU,{gapMode:e.gapMode}):null)}function YU(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const XU=Ah(vC,GU);var wC=g.forwardRef(function(e,t){return g.createElement(gu,rt({},e,{ref:t,sideCar:XU}))});wC.classNames=gu.classNames;var Tg="Popover",[CC,oq]=jz(Tg,[aC]),ma=aC(),[qU,to]=CC(Tg),PC=e=>{const{__scopePopover:t,children:n,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=e,a=ma(t),c=g.useRef(null),[l,u]=g.useState(!1),[d=!1,f]=_U({prop:r,defaultProp:o,onChange:s});return h.jsx(bU,{...a,children:h.jsx(qU,{scope:t,contentId:aU(),triggerRef:c,open:d,onOpenChange:f,onOpenToggle:g.useCallback(()=>f(p=>!p),[f]),hasCustomAnchor:l,onCustomAnchorAdd:g.useCallback(()=>u(!0),[]),onCustomAnchorRemove:g.useCallback(()=>u(!1),[]),modal:i,children:n})})};PC.displayName=Tg;var EC="PopoverAnchor",ZU=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=to(EC,n),s=ma(n),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return g.useEffect(()=>(i(),()=>a()),[i,a]),h.jsx(mC,{...s,...r,ref:t})});ZU.displayName=EC;var _C="PopoverTrigger",IC=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=to(_C,n),s=ma(n),i=eo(t,o.triggerRef),a=h.jsx(vr.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":MC(o.open),...r,ref:i,onClick:Dr(e.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:h.jsx(mC,{asChild:!0,...s,children:a})});IC.displayName=_C;var $g="PopoverPortal",[QU,JU]=CC($g,{forceMount:void 0}),kC=e=>{const{__scopePopover:t,forceMount:n,children:r,container:o}=e,s=to($g,t);return h.jsx(QU,{scope:t,forceMount:n,children:h.jsx(kg,{present:n||s.open,children:h.jsx(yC,{asChild:!0,container:o,children:r})})})};kC.displayName=$g;var $s="PopoverContent",TC=g.forwardRef((e,t)=>{const n=JU($s,e.__scopePopover),{forceMount:r=n.forceMount,...o}=e,s=to($s,e.__scopePopover);return h.jsx(kg,{present:r||s.open,children:s.modal?h.jsx(eV,{...o,ref:t}):h.jsx(tV,{...o,ref:t})})});TC.displayName=$s;var eV=g.forwardRef((e,t)=>{const n=to($s,e.__scopePopover),r=g.useRef(null),o=eo(t,r),s=g.useRef(!1);return g.useEffect(()=>{const i=r.current;if(i)return kl(i)},[]),h.jsx(wC,{as:Eg,allowPinchZoom:!0,children:h.jsx($C,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Dr(e.onCloseAutoFocus,i=>{var a;i.preventDefault(),s.current||(a=n.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Dr(e.onPointerDownOutside,i=>{const a=i.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,l=a.button===2||c;s.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:Dr(e.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),tV=g.forwardRef((e,t)=>{const n=to($s,e.__scopePopover),r=g.useRef(!1),o=g.useRef(!1);return h.jsx($C,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,a;(i=e.onCloseAutoFocus)==null||i.call(e,s),s.defaultPrevented||(r.current||(a=n.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{var c,l;(c=e.onInteractOutside)==null||c.call(e,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;((l=n.triggerRef.current)==null?void 0:l.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),$C=g.forwardRef((e,t)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:u,...d}=e,f=to($s,n),p=ma(n);return Zz(),h.jsx(rC,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:h.jsx(tC,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>f.onOpenChange(!1),children:h.jsx(SU,{"data-state":MC(f.open),role:"dialog",id:f.contentId,...p,...d,ref:t,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),AC="PopoverClose",nV=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=to(AC,n);return h.jsx(vr.button,{type:"button",...r,ref:t,onClick:Dr(e.onClick,()=>o.onOpenChange(!1))})});nV.displayName=AC;var rV="PopoverArrow",oV=g.forwardRef((e,t)=>{const{__scopePopover:n,...r}=e,o=ma(n);return h.jsx(xU,{...o,...r,ref:t})});oV.displayName=rV;function MC(e){return e?"open":"closed"}var sV=PC,iV=IC,OC=kC,RC=TC;const Ag=({id:e,children:t,onOpenChange:n,open:r})=>{const[o,s]=Oo(e,n);return h.jsx(sV,{onOpenChange:s,open:r||o,children:h.jsx("div",{className:"tlui-popover",children:t})})},Mg=({children:e,disabled:t,"data-testid":n})=>h.jsx(iV,{"data-testid":n,disabled:t,asChild:!0,dir:"ltr",children:e}),jC=({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:o=0})=>{const s=ut();return h.jsx(OC,{container:s,children:h.jsx(RC,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:o,dir:"ltr",children:t})})},DC=g.memo(function(){const t=Ce(),n=ut(),r=w8(),o=gn();function s(i){if(!i||o&&!i.readonlyOk)return null;switch(i.type){case"item":{const{id:a,icon:c,label:l,kbd:u,onSelect:d}=i.actionItem;return h.jsx(te,{"data-testid":`menu-item.${i.id}`,icon:c,type:"icon",title:l?u?`${t(l)} ${Un(u)}`:`${t(l)}`:u?`${Un(u)}`:"",onClick:()=>d("actions-menu"),disabled:i.disabled},a)}}}return h.jsxs(Ag,{id:"actions-menu",children:[h.jsx(Mg,{children:h.jsx(te,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:t("actions-menu.title"),type:"icon",smallIcon:!0})}),h.jsx(OC,{container:n,children:h.jsx(RC,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:h.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid",children:r.map(s)})})})]})}),NC=Te(function(){const t=U(),n=vt(),r=Ce(),o=n.duplicate;return h.jsx(te,{icon:o.icon,type:"icon",onClick:()=>o.onSelect("quick-actions"),disabled:!(t.isIn("select")&&t.getSelectedShapeIds().length>0),title:`${r(o.label)} ${Un(o.kbd)}`,smallIcon:!0})}),aV=g.memo(function(){const t=Ce();return h.jsxs(Wr,{id:"main menu",children:[h.jsx(ga,{children:h.jsx(te,{type:"icon",className:"tlui-menu__trigger","data-testid":"main.menu",title:t("menu.title"),icon:"menu",smallIcon:!0})}),h.jsx(Hr,{alignOffset:0,sideOffset:6,children:h.jsx(cV,{})})]})});function cV(){const e=U(),t=Ce(),n=M8(),r=mn(),o=gn();function s(i,a,c,l){if(!a)return null;switch(a.type){case"custom":return o&&!a.readonlyOk?null:a.id==="LANGUAGE_MENU"?h.jsx(Q1,{},"item"):null;case"group":return o&&!a.readonlyOk?null:h.jsx(sr,{size:l<=1?"medium":r<3||(c==null?void 0:c.type)==="submenu"&&l>2?"tiny":"medium",children:a.children.map(u=>s(i,u,a,l+1))},a.id);case"submenu":return o&&!a.readonlyOk?null:h.jsxs(wg,{id:`main menu ${c?c.id+" ":""}${a.id}`,children:[h.jsx(Cg,{label:a.label,"data-testid":`menu-item.${a.id}`}),h.jsx(Pg,{sideOffset:-4,alignOffset:-1,children:a.children.map(u=>s(i,u,a,l+1))})]},a.id);case"item":{if(o&&!a.readonlyOk)return null;const{id:u,checkbox:d,menuLabel:f,label:p,onSelect:v,kbd:m}=a.actionItem,y=f??p,b=y?t(y):void 0;return d?h.jsxs(Z1,{onSelect:()=>v("menu"),title:b||"",checked:a.checked,disabled:a.disabled,children:[b&&h.jsx("span",{className:"tlui-button__label",children:b}),m&&h.jsx(ru,{children:m})]},u):h.jsx(Vt,{type:"menu","data-testid":`menu-item.${a.id}`,kbd:m,label:y,onClick:()=>v("menu"),disabled:a.disabled},u)}}}return h.jsx(h.Fragment,{children:n.map(i=>s(e,i,null,0))})}const lV=function({name:t,id:n,isCurrentPage:r}){const o=U(),s=g.useRef(null),i=g.useCallback(c=>{o.renamePage(n,c||"New Page",{ephemeral:!0})},[o,n]),a=g.useCallback(c=>{o.mark("rename page"),o.renamePage(n,c||"New Page",{ephemeral:!1})},[o,n]);return h.jsx(Xp,{className:"tlui-page-menu__item__input",ref:c=>s.current=c,defaultValue:t,onValueChange:i,onComplete:a,onCancel:a,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:r,autoselect:!0})},uh=(e,t,n,r)=>{let o;const s=e.getPages(),i=n>r?s[r-1]:s[r],a=n>r?s[r]:s[r+1];i&&!a?o=Tr(i.index):!i&&a?o=RM(s[0].index):o=Tc(i.index,a.index),o!==s[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:o}))},kb=Te(function({index:t,listSize:n,item:r,onRename:o}){const s=U(),i=Ce(),a=s.getPages(),c=g.useCallback(()=>{s.mark("creating page");const f=Lr.createId();s.duplicatePage(r.id,f)},[s,r]),l=g.useCallback(()=>{uh(s,r.id,t,t-1)},[s,r,t]),u=g.useCallback(()=>{uh(s,r.id,t,t+1)},[s,r,t]),d=g.useCallback(()=>{s.mark("deleting page"),s.deletePage(r.id)},[s,r]);return h.jsxs(Wr,{id:`page item submenu ${t}`,children:[h.jsx(ga,{children:h.jsx(te,{type:"icon",title:i("page-menu.submenu.title"),icon:"dots-vertical"})}),h.jsxs(Hr,{alignOffset:0,children:[h.jsxs(sr,{children:[o&&h.jsx(ho,{dir:"ltr",onSelect:o,asChild:!0,children:h.jsx(te,{type:"menu",label:"page-menu.submenu.rename"})}),h.jsx(ho,{dir:"ltr",onSelect:c,disabled:a.length>=tl,asChild:!0,children:h.jsx(te,{type:"menu",label:"page-menu.submenu.duplicate-page"})}),t>0&&h.jsx(ho,{dir:"ltr",onSelect:l,asChild:!0,children:h.jsx(te,{type:"menu",label:"page-menu.submenu.move-up"})}),t<n-1&&h.jsx(ho,{dir:"ltr",onSelect:u,asChild:!0,children:h.jsx(te,{type:"menu",label:"page-menu.submenu.move-down"})})]}),n>1&&h.jsx(sr,{children:h.jsx(ho,{dir:"ltr",onSelect:d,asChild:!0,children:h.jsx(te,{type:"menu",label:"page-menu.submenu.delete"})})})]})]})}),uV=function(){const t=U(),n=Ce(),r=mn(),o=g.useCallback(()=>y(!1),[]),[s,i]=Oo("page-menu",o),a=36,c=g.useRef(null),l=Y("pages",()=>t.getPages(),[t]),u=Y("currentPage",()=>t.getCurrentPage(),[t]),d=Y("currentPageId",()=>t.getCurrentPageId(),[t]),f=gn(),p=Y("maxPageCountReached",()=>t.getPages().length>=tl,[t]),v=Y("isCoarsePointer",()=>t.getInstanceState().isCoarsePointer,[t]),[m,y]=g.useState(!1),b=g.useCallback(()=>{f||y(T=>!T)},[f]),x=g.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[w,S]=g.useState(Object.fromEntries(l.map((T,M)=>[T.id,{y:M*a,offsetY:0,isSelected:!1}])));g.useLayoutEffect(()=>{S(Object.fromEntries(l.map((T,M)=>[T.id,{y:M*a,offsetY:0,isSelected:!1}])))},[a,l]),g.useEffect(()=>{s&&requestAnimationFrame(()=>{const T=document.querySelector(`[data-testid="page-menu-item-${d}"]`);if(T){const M=c.current;if(!M)return;const O=T.offsetTop,j=M.scrollTop;O<j&&M.scrollTo({top:O});const N=O+a,B=M.scrollTop+M.offsetHeight;N>B&&M.scrollTo({top:N-M.offsetHeight})}})},[a,d,s]);const C=g.useCallback(T=>{const{clientY:M,currentTarget:O}=T,{dataset:{id:j,index:N}}=O;if(!j||!N)return;const B=x.current;ta(T.currentTarget,T),B.status="pointing",B.pointing={id:j,index:+N};const G=w[j].y;B.startY=M,B.startIndex=Math.max(0,Math.min(Math.round(G/a),l.length-1))},[a,l.length,w]),P=g.useCallback(T=>{const M=x.current;if(M.status==="pointing"){const{clientY:O}=T,j=O-M.startY;Math.abs(j)>5&&(M.status="dragging")}if(M.status==="dragging"){const{clientY:O}=T,j=O-M.startY,N=w[M.pointing.id],{startIndex:B,pointing:D}=M,G=N.y+j,V=Math.max(0,Math.min(Math.round(G/a),l.length-1)),z={...w};if(z[D.id]={y:N.y,offsetY:j,isSelected:!0},V!==M.dragIndex){M.dragIndex=V;for(let W=0;W<l.length;W++){const Q=l[W];if(Q.id===M.pointing.id)continue;let{y:oe}=z[Q.id];V===B?oe=W*a:V<B?V<=W&&W<B?oe=(W+1)*a:oe=W*a:V>B&&(V>=W&&W>B?oe=(W-1)*a:oe=W*a),oe!==z[Q.id].y&&(z[Q.id]={y:oe,offsetY:0,isSelected:!0})}}S(z)}},[a,l,w]),E=g.useCallback(T=>{const M=x.current;if(M.status==="dragging"){const{id:O,index:j}=M.pointing;uh(t,O,j,M.dragIndex)}na(T.currentTarget,T),M.status="idle"},[t]),_=g.useCallback(T=>{const M=x.current;T.key==="Escape"&&(M.status==="dragging"&&S(Object.fromEntries(l.map((O,j)=>[O.id,{y:j*a,offsetY:0,isSelected:!1}]))),M.status="idle")},[a,l]),$=g.useCallback(()=>{f||t.batch(()=>{t.mark("creating page");const T=Lr.createId();t.createPage({name:n("page-menu.new-page-initial-name"),id:T}),t.setCurrentPage(T),y(!0)})},[t,n,f]);return h.jsxs(Ag,{id:"pages",onOpenChange:i,open:s,children:[h.jsx(Mg,{children:h.jsx(te,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",type:"menu",title:u.name,children:h.jsx("div",{className:"tlui-page-menu__name",children:u.name})})}),h.jsx(jC,{side:"bottom",align:"start",sideOffset:6,children:h.jsxs("div",{className:"tlui-page-menu__wrapper",children:[h.jsxs("div",{className:"tlui-page-menu__header",children:[h.jsx("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!f&&h.jsxs("div",{className:"tlui-buttons__horizontal",children:[h.jsx(te,{type:"icon","data-testid":"page-menu.edit",title:n(m?"page-menu.edit-done":"page-menu.edit-start"),icon:m?"check":"edit",onClick:b}),h.jsx(te,{type:"icon","data-testid":"page-menu.create",icon:"plus",title:n(p?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:p,onClick:$})]})]}),h.jsx("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:a*l.length+4},ref:c,children:l.map((T,M)=>{const O=w[T.id]??{position:M*40,offsetY:0};return m?h.jsxs("div",{"data-testid":`page-menu-item-${T.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:T.id===u.id?888:M,transform:`translate(0px, ${O.y+O.offsetY}px)`},children:[h.jsx(te,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:C,onPointerUp:E,onPointerMove:P,onKeyDown:_,"data-id":T.id,"data-index":M}),r<5&&v?h.jsx(te,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const j=window.prompt("Rename page",T.name);j&&j!==T.name&&t.renamePage(T.id,j)},onDoubleClick:b,isChecked:T.id===u.id,children:h.jsx("span",{children:T.name})}):h.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:a},children:h.jsx(lV,{id:T.id,name:T.name,isCurrentPage:T.id===u.id})}),!f&&h.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":m,children:h.jsx(kb,{index:M,item:T,listSize:l.length})})]},T.id+"_editing"):h.jsxs("div",{"data-testid":`page-menu-item-${T.id}`,className:"tlui-page-menu__item",children:[h.jsxs(te,{type:"icon",className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>t.setCurrentPage(T.id),onDoubleClick:b,isChecked:T.id===u.id,title:n("page-menu.go-to-page"),children:[h.jsx("div",{className:"tlui-page-menu__item__button__check",children:T.id===u.id&&h.jsx(Yt,{icon:"check"})}),h.jsx("span",{children:T.name})]}),!f&&h.jsx("div",{className:"tlui-page_menu__item__submenu",children:h.jsx(kb,{index:M,item:T,listSize:l.length,onRename:()=>{if(t.environment.isIos){const j=window.prompt("Rename page",T.name);j&&j!==T.name&&t.renamePage(T.id,j)}else t.batch(()=>{y(!0),t.setCurrentPage(T.id)})}})})]},T.id)})})]})})]})},LC=g.memo(function(){const t=Ce(),n=a1(),o=vt().redo;return h.jsx(te,{"data-testid":"main.redo",icon:o.icon,type:"icon",title:`${t(o.label)} ${Un(o.kbd)}`,disabled:!n,onClick:()=>o.onSelect("quick-actions"),smallIcon:!0})}),FC=Te(function(){const t=U(),n=vt(),r=Ce(),o=n.delete;return gn()?null:h.jsx(te,{icon:o.icon,type:"icon",onClick:()=>o.onSelect("quick-actions"),disabled:!(t.isIn("select")&&t.getSelectedShapeIds().length>0),title:`${r(o.label)} ${Un(o.kbd)}`,smallIcon:!0})}),BC=g.memo(function(){const t=Ce(),n=c1(),o=vt().undo;return h.jsx(te,{"data-testid":"main.undo",icon:o.icon,type:"icon",title:`${t(o.label)} ${Un(o.kbd)}`,disabled:!n,onClick:()=>o.onSelect("quick-actions"),smallIcon:!0})}),dV=Te(function(){const t=U(),n=mn(),r=gn();return h.jsx("div",{className:"tlui-menu-zone",children:h.jsxs("div",{className:"tlui-buttons__horizontal",children:[h.jsx(aV,{}),h.jsx(uV,{}),n>=6&&!r&&!t.isInAny("hand","zoom")&&h.jsxs(h.Fragment,{children:[h.jsx(BC,{}),h.jsx(LC,{}),h.jsx(FC,{}),h.jsx(NC,{}),h.jsx(DC,{})]})]})})});function fV(e,t){const[n,r]=Z.useState(t);Z.useLayoutEffect(()=>{const s=localStorage.getItem(e);if(s)try{r(JSON.parse(s))}catch{console.error(`Could not restore value ${e} from local storage.`)}},[e]);const o=Z.useCallback(s=>{r(i=>{const a=typeof s=="function"?s(i):s;return localStorage.setItem(e,JSON.stringify(a)),a})},[e]);return[n,o]}class Mi{constructor(t){I(this,"dpr",1);I(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"});I(this,"id",je());I(this,"cvs",null);I(this,"pageBounds",[]);I(this,"collaborators",[]);I(this,"canvasScreenBounds",new ce);I(this,"canvasPageBounds",new ce);I(this,"contentPageBounds",new ce);I(this,"contentScreenBounds",new ce);I(this,"originPagePoint",new k);I(this,"originPageCenter",new k);I(this,"isInViewport",!1);I(this,"debug",!1);I(this,"updateContentScreenBounds",()=>{const{contentScreenBounds:t,contentPageBounds:n,canvasScreenBounds:r}=this;let{x:o,y:s,w:i,h:a}=t;if(n.w>n.h){const c=r.w/(n.w/n.h);c>r.h?(o=(r.w-r.w*(r.h/c))/2,s=0,i=r.w*(r.h/c),a=r.h):(o=0,s=(r.h-c)/2,i=r.w,a=c)}else if(n.w<n.h){const c=r.h/(n.h/n.w);o=(r.w-c)/2,s=0,i=c,a=r.h}else o=r.h/2,s=0,i=r.h,a=r.h;t.set(o,s,i,a)});I(this,"updateCanvasPageBounds",()=>{const{canvasPageBounds:t,canvasScreenBounds:n,contentPageBounds:r,contentScreenBounds:o}=this;t.set(0,0,r.width/(o.width/n.width),r.height/(o.height/n.height)),t.center=r.center});I(this,"getScreenPoint",(t,n)=>{const{canvasScreenBounds:r}=this,o=(t-r.minX)*this.dpr,s=(n-r.minY)*this.dpr;return{x:o,y:s}});I(this,"getPagePoint",(t,n)=>{const{contentPageBounds:r,contentScreenBounds:o,canvasPageBounds:s}=this,{x:i,y:a}=this.getScreenPoint(t,n);return new k(s.minX+i*r.width/o.width,s.minY+a*r.height/o.height,1)});I(this,"minimapScreenPointToPagePoint",(t,n,r=!1,o=!1)=>{const{editor:s}=this,i=s.getViewportPageBounds();let{x:a,y:c}=this.getPagePoint(t,n);if(o){const l=this.editor.getCurrentPageBounds(),u=i,d=((l==null?void 0:l.minX)??0)-u.width/2,f=((l==null?void 0:l.maxX)??0)+u.width/2,p=((l==null?void 0:l.minY)??0)-u.height/2,v=((l==null?void 0:l.maxY)??0)+u.height/2,m=Math.max(0,d+u.width-a),y=Math.max(0,-(f-u.width-a)),b=Math.max(0,p+u.height-c),x=Math.max(0,-(v-u.height-c)),w=Math.max(0,m-y),S=Math.max(0,y-m),C=Math.max(0,b-x),P=Math.max(0,x-b);w&&w>S?a+=w/2:S&&(a-=S/2),C&&C>P?c+=C/2:P&&(c-=P/2),a=jn(a,d,f),c=jn(c,p,v)}if(r){const{originPagePoint:l}=this,u=Math.abs(a-l.x),d=Math.abs(c-l.y);u>d?c=l.y:a=l.x}return new k(a,c)});I(this,"render",()=>{const{cvs:t,pageBounds:n}=this;this.updateCanvasPageBounds();const{editor:r,canvasScreenBounds:o,canvasPageBounds:s,contentPageBounds:i,contentScreenBounds:a}=this,{width:c,height:l}=o,u=r.getSelectedShapeIds(),d=r.getViewportPageBounds();if(!t||!n)return;const f=t.getContext("2d");if(!f)throw new Error("Minimap (shapes): Could not get context");f.resetTransform(),f.globalAlpha=1,f.clearRect(0,0,c,l);const p=a.width/i.width,v=a.height/i.height;f.translate((c-a.width)/2,(l-a.height)/2),f.scale(p,v),f.translate(-i.minX,-i.minY);const m=8/p,y=8/p,b=1/p,x=1/p,w=m/4,S=y/4,C=new Path2D,P=new Path2D,{shapeFill:E,selectFill:_,viewportFill:$}=this.colors;let T;for(let B=0,D=n.length;B<D;B++)T=n[B],Mi.roundedRect(u.includes(T.id)?P:C,T.minX,T.minY,T.width,T.height,jn(m,b,T.width/w),jn(y,x,T.height/S));if(f.fillStyle=E,f.fill(C),f.fillStyle=_,f.fill(P),this.debug){const B=ce.Common(n),{minX:D,minY:G,width:V,height:z}=B;f.strokeStyle="green",f.lineWidth=2/p,f.strokeRect(D+1/p,G+1/v,V-2/p,z-2/v)}{const{brush:B}=r.getInstanceState();if(B){const{x:D,y:G,w:V,h:z}=B;f.beginPath(),Mi.sharpRect(f,D,G,V,z),f.closePath(),f.fillStyle=$,f.fill()}}{const{minX:B,minY:D,width:G,height:V}=d;f.beginPath();const z=12/p,W=12/p;Mi.roundedRect(f,B,D,G,V,Math.min(G/4,z),Math.min(V/4,W)),f.closePath(),f.fillStyle=$,f.fill(),this.debug&&(f.strokeStyle="orange",f.strokeRect(B+1/p,D+1/v,G-2/p,V-2/v))}const M=2.5/p,O=2.5/v,j=r.getCurrentPageId();let N;for(let B=0;B<this.collaborators.length;B++)N=this.collaborators[B],N.currentPageId===j&&(f.beginPath(),f.ellipse(jn(N.cursor.x,s.minX+M,s.maxX-M),jn(N.cursor.y,s.minY+O,s.maxY-O),5/p,5/v,0,0,He),f.fillStyle=N.color,f.fill());if(this.debug){f.lineWidth=2/p;{const{minX:B,minY:D,width:G,height:V}=i;f.strokeStyle="red",f.strokeRect(B+1/p,D+1/v,G-2/p,V-2/v)}{const{minX:B,minY:D,width:G,height:V}=s;f.strokeStyle="blue",f.strokeRect(B+1/p,D+1/v,G-2/p,V-2/v)}}});this.editor=t}setDpr(t){this.dpr=+t.toFixed(2)}static roundedRect(t,n,r,o,s,i,a){if(i<1&&a<1){t.rect(n,r,o,s);return}t.moveTo(n+i,r),t.lineTo(n+o-i,r),t.quadraticCurveTo(n+o,r,n+o,r+a),t.lineTo(n+o,r+s-a),t.quadraticCurveTo(n+o,r+s,n+o-i,r+s),t.lineTo(n+i,r+s),t.quadraticCurveTo(n,r+s,n,r+s-a),t.lineTo(n,r+a),t.quadraticCurveTo(n,r,n+i,r)}static sharpRect(t,n,r,o,s,i,a){t.rect(n,r,o,s)}}function hV({shapeFill:e,selectFill:t,viewportFill:n}){const r=U(),o=g.useRef(null),s=g.useRef(!1),i=Vl(),a=aS("dpr",()=>r.getInstanceState().devicePixelRatio,[r]),c=g.useMemo(()=>r.store.query.records("instance_presence"),[r]),l=g.useMemo(()=>new Mi(r),[r]);g.useEffect(()=>{const v=requestAnimationFrame(()=>{const m=getComputedStyle(r.getContainer());l.colors={shapeFill:m.getPropertyValue(e).trim(),selectFill:m.getPropertyValue(t).trim(),viewportFill:m.getPropertyValue(n).trim()},l.render()});return()=>{cancelAnimationFrame(v)}},[r,t,e,n,l,i]);const u=g.useCallback(v=>{if(!r.getCurrentPageShapeIds().size)return;const m=l.minimapScreenPointToPagePoint(v.clientX,v.clientY,!1,!1),y=l.minimapScreenPointToPagePoint(v.clientX,v.clientY,!1,!0);l.originPagePoint.setTo(y),l.originPageCenter.setTo(r.getViewportPageBounds().center),r.centerOnPoint(m,{duration:tr})},[r,l]),d=g.useCallback(v=>{const m=v.currentTarget;if(ta(m,v),!r.getCurrentPageShapeIds().size)return;s.current=!0,l.isInViewport=!1;const y=l.minimapScreenPointToPagePoint(v.clientX,v.clientY,!1,!1),b=l.minimapScreenPointToPagePoint(v.clientX,v.clientY,!1,!0),x=r.getViewportPageBounds();if(l.isInViewport=x.containsPoint(b),l.isInViewport)l.originPagePoint.setTo(b),l.originPageCenter.setTo(x.center);else{const S=k.Sub(x.center,x.point),C=k.Add(y,S);l.originPagePoint.setTo(C),l.originPageCenter.setTo(y),r.centerOnPoint(y,{duration:tr})}function w(S){m&&na(m,S),s.current=!1,document.body.removeEventListener("pointerup",w)}document.body.addEventListener("pointerup",w)},[r,l]),f=g.useCallback(v=>{const m=l.minimapScreenPointToPagePoint(v.clientX,v.clientY,v.shiftKey,!0);if(s.current){if(l.isInViewport){const w=l.originPagePoint.clone().sub(l.originPageCenter);r.centerOnPoint(k.Sub(m,w));return}r.centerOnPoint(m)}const y=l.getPagePoint(v.clientX,v.clientY),b=r.pageToScreen(y),x={type:"pointer",target:"canvas",name:"pointer_move",...Ht(v),point:b,isPen:r.getInstanceState().isPenMode};r.dispatch(x)},[r,l]),p=g.useCallback(v=>{const m=BS(v);r.dispatch({type:"wheel",name:"wheel",delta:m,point:new k(v.clientX,v.clientY),shiftKey:v.shiftKey,altKey:v.altKey,ctrlKey:v.metaKey||v.ctrlKey})},[r]);return mo("update when dpr changes",()=>{const v=a.get();l.setDpr(v);const m=o.current,y=m.getBoundingClientRect(),b=y.width*v,x=y.height*v;m.width=b,m.height=x,l.canvasScreenBounds.set(y.x,y.y,b,x),l.cvs=o.current},[a,l]),mo("minimap render when pagebounds or collaborators changes",()=>{const v=r.getCurrentPageShapeIds(),m=r.getCurrentPageBounds(),y=r.getViewportPageBounds();a.get(),l.contentPageBounds=m?ce.Expand(m,y):y,l.updateContentScreenBounds();const b=[];v.forEach(x=>{let w=r.getShapePageBounds(x);if(!w)return;const S=r.getShapeMask(x);if(S){const C=Cf(S,w.corners);if(!C)return;w=ce.FromPoints(C)}w&&(w.id=x,b.push(w))}),l.pageBounds=b,l.collaborators=c.get(),l.render()},[r,l]),h.jsx("div",{className:"tlui-minimap",children:h.jsx("canvas",{ref:o,className:"tlui-minimap__canvas",onDoubleClick:u,onPointerMove:f,onPointerDown:d,onWheel:p})})}const Jd=Te(function(){const t=U(),n=Ce(),r=mn(),o=t.getZoomLevel(),s=t.getCurrentPageShapeIds().size>0,i=t.getSelectedShapeIds().length>0,a=t.getZoomLevel()===1,c=g.useCallback(()=>{t.resetZoom(t.getViewportScreenCenter(),{duration:tr})},[t]);return h.jsxs(Wr,{id:"zoom",children:[h.jsx(ga,{children:h.jsx(te,{type:"icon",title:`${n("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:r<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:c,icon:r<4?"zoom-in":void 0,children:r<4?null:h.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(o*100),"%"]})})}),h.jsx(Hr,{side:"top",align:"start",alignOffset:0,children:h.jsxs(sr,{children:[h.jsx(vi,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),h.jsx(vi,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),h.jsx(vi,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:a}),h.jsx(vi,{action:"zoom-to-fit",disabled:!s,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),h.jsx(vi,{action:"zoom-to-selection",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function vi(e){const{action:t,disabled:n=!1,noClose:r=!1}=e,o=vt();return h.jsx(Vt,{type:"menu",label:o[t].label,kbd:o[t].kbd,"data-testid":e["data-testid"],onClick:()=>o[t].onSelect("zoom-menu"),noClose:r,disabled:n})}const pV=g.memo(function(){const t=vt(),n=Ce(),r=mn(),[o,s]=fV("minimap",!0),i=g.useCallback(()=>{s(a=>!a)},[s]);return r<4?null:h.jsxs("div",{className:"tlui-navigation-zone",children:[h.jsx("div",{className:"tlui-buttons__horizontal",children:r<6?h.jsx(Jd,{}):o?h.jsxs(h.Fragment,{children:[h.jsx(Jd,{}),h.jsx(te,{type:"icon",icon:o?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:i})]}):h.jsxs(h.Fragment,{children:[h.jsx(te,{type:"icon",icon:"minus","data-testid":"minimap.zoom-out",title:`${n(t["zoom-out"].label)} ${Un(t["zoom-out"].kbd)}`,onClick:()=>t["zoom-out"].onSelect("navigation-zone")}),h.jsx(Jd,{}),h.jsx(te,{type:"icon",icon:"plus","data-testid":"minimap.zoom-in",title:`${n(t["zoom-in"].label)} ${Un(t["zoom-in"].kbd)}`,onClick:()=>t["zoom-in"].onSelect("navigation-zone")}),h.jsx(te,{type:"icon",icon:o?"chevrons-ne":"chevrons-sw","data-testid":"minimap.toggle",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:i})]})}),r>=6&&!o&&h.jsx(hV,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),gV=Te(function(){const n=U().getInstanceState().isPenMode,r=vt();if(!n)return null;const o=r["exit-pen-mode"];return h.jsx(te,{type:"normal",label:o.label,iconLeft:o.icon,onClick:()=>o.onSelect("helper-buttons")})}),mV=Te(function(){const t=U(),n=vt();if(!t.getInstanceState().followingUserId)return null;const r=n["stop-following"];return h.jsx(te,{type:"normal",label:r.label,iconLeft:r.icon,onClick:()=>r.onSelect("people-menu")})}),yV=[Zt,Fn,Cs,Fr];function zC(){const e=U();return Y("getRelevantStyles",()=>{var r;const t=new Ef(e.getSharedStyles()),n=e.getSelectedShapeIds().length>0||!!((r=e.root.getCurrent())!=null&&r.shapeType);if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of yV)t.applyValue(o,e.getStyleForNextShape(o));return t.size===0&&!n?null:{styles:t,opacity:e.getSharedOpacity()}},[e])}function vV(e){const{uiType:t,items:n,title:r,style:o,value:s,onValueChange:i}=e,a=U(),c=Ce(),l=g.useRef(!1),{handleButtonClick:u,handleButtonPointerDown:d,handleButtonPointerEnter:f,handleButtonPointerUp:p}=g.useMemo(()=>{const m=()=>{l.current=!1,window.removeEventListener("pointerup",m)};return{handleButtonClick:S=>{const{id:C}=S.currentTarget.dataset;s.type==="shared"&&s.value===C||(a.mark("point picker item"),i(o,C,!1))},handleButtonPointerDown:S=>{const{id:C}=S.currentTarget.dataset;a.mark("point picker item"),i(o,C,!0),l.current=!0,window.addEventListener("pointerup",m)},handleButtonPointerEnter:S=>{if(!l.current)return;const{id:C}=S.currentTarget.dataset;i(o,C,!0)},handleButtonPointerUp:S=>{const{id:C}=S.currentTarget.dataset;i(o,C,!1)}}},[s,a,i,o]),v=Y("theme",()=>Dl({isDarkMode:a.user.getIsDarkMode()}),[a]);return h.jsx("div",{className:ue("tlui-buttons__grid"),children:n.map(m=>h.jsx(te,{type:"icon","data-id":m.value,"data-testid":`style.${t}.${m.value}`,"aria-label":m.value,"data-state":s.type==="shared"&&s.value===m.value?"hinted":void 0,title:r+" — "+c(`${t}-style.${m.value}`),className:ue("tlui-button-grid__button"),style:o===Zt?{color:v[m.value].solid}:void 0,onPointerEnter:f,onPointerDown:d,onPointerUp:p,onClick:u,icon:m.icon},m.value))})}const as=g.memo(vV);function UC(e,[t,n]){return Math.min(n,Math.max(t,e))}function cs(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function bV(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function VC(...e){return t=>e.forEach(n=>bV(n,t))}function ya(...e){return g.useCallback(VC(...e),e)}function SV(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];const l=d=>{var b;const{scope:f,children:p,...v}=d,m=((b=f==null?void 0:f[e])==null?void 0:b[c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})};l.displayName=s+"Provider";function u(d,f){var m;const p=((m=f==null?void 0:f[e])==null?void 0:m[c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,xV(o,...t)]}function xV(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}function KC(e){const t=g.useRef(e);return g.useEffect(()=>{t.current=e}),g.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function wV({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,o]=CV({defaultProp:t,onChange:n}),s=e!==void 0,i=s?e:r,a=KC(n),c=g.useCallback(l=>{if(s){const d=typeof l=="function"?l(e):l;d!==e&&a(d)}else o(l)},[s,e,o,a]);return[i,c]}function CV({defaultProp:e,onChange:t}){const n=g.useState(e),[r]=n,o=g.useRef(r),s=KC(t);return g.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var PV=g.createContext(void 0);function EV(e){const t=g.useContext(PV);return e||t||"ltr"}function _V(e){const t=g.useRef({value:e,previous:e});return g.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var IV=globalThis!=null&&globalThis.document?g.useLayoutEffect:()=>{};function kV(e){const[t,n]=g.useState(void 0);return IV(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,a=l.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var WC=g.forwardRef((e,t)=>{const{children:n,...r}=e,o=g.Children.toArray(n),s=o.find($V);if(s){const i=s.props.children,a=o.map(c=>c===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(dh,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(dh,{...r,ref:t,children:n})});WC.displayName="Slot";var dh=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const o=MV(n);return g.cloneElement(n,{...AV(r,n.props),ref:t?VC(t,o):o})}return g.Children.count(n)>1?g.Children.only(null):null});dh.displayName="SlotClone";var TV=({children:e})=>h.jsx(h.Fragment,{children:e});function $V(e){return g.isValidElement(e)&&e.type===TV}function AV(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function MV(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var OV=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],mu=OV.reduce((e,t)=>{const n=g.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?WC:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{}),HC=["PageUp","PageDown"],GC=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],YC={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Xs="Slider",[fh,RV,jV]=eu(Xs),[XC,sq]=SV(Xs,[jV]),[DV,yu]=XC(Xs),qC=g.forwardRef((e,t)=>{const{name:n,min:r=0,max:o=100,step:s=1,orientation:i="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:u,onValueChange:d=()=>{},onValueCommit:f=()=>{},inverted:p=!1,form:v,...m}=e,y=g.useRef(new Set),b=g.useRef(0),w=i==="horizontal"?NV:LV,[S=[],C]=wV({prop:u,defaultProp:l,onChange:M=>{var j;(j=[...y.current][b.current])==null||j.focus(),d(M)}}),P=g.useRef(S);function E(M){const O=VV(S,M);T(M,O)}function _(M){T(M,b.current)}function $(){const M=P.current[b.current];S[b.current]!==M&&f(S)}function T(M,O,{commit:j}={commit:!1}){const N=GV(s),B=YV(Math.round((M-r)/s)*s+r,N),D=UC(B,[r,o]);C((G=[])=>{const V=zV(G,D,O);if(HV(V,c*s)){b.current=V.indexOf(D);const z=String(V)!==String(G);return z&&j&&f(V),z?V:G}else return G})}return h.jsx(DV,{scope:e.__scopeSlider,name:n,disabled:a,min:r,max:o,valueIndexToChangeRef:b,thumbs:y.current,values:S,orientation:i,form:v,children:h.jsx(fh.Provider,{scope:e.__scopeSlider,children:h.jsx(fh.Slot,{scope:e.__scopeSlider,children:h.jsx(w,{"aria-disabled":a,"data-disabled":a?"":void 0,...m,ref:t,onPointerDown:cs(m.onPointerDown,()=>{a||(P.current=S)}),min:r,max:o,inverted:p,onSlideStart:a?void 0:E,onSlideMove:a?void 0:_,onSlideEnd:a?void 0:$,onHomeKeyDown:()=>!a&&T(r,0,{commit:!0}),onEndKeyDown:()=>!a&&T(o,S.length-1,{commit:!0}),onStepKeyDown:({event:M,direction:O})=>{if(!a){const B=HC.includes(M.key)||M.shiftKey&&GC.includes(M.key)?10:1,D=b.current,G=S[D],V=s*B*O;T(G+V,D,{commit:!0})}}})})})})});qC.displayName=Xs;var[ZC,QC]=XC(Xs,{startEdge:"left",endEdge:"right",size:"width",direction:1}),NV=g.forwardRef((e,t)=>{const{min:n,max:r,dir:o,inverted:s,onSlideStart:i,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...u}=e,[d,f]=g.useState(null),p=ya(t,w=>f(w)),v=g.useRef(),m=EV(o),y=m==="ltr",b=y&&!s||!y&&s;function x(w){const S=v.current||d.getBoundingClientRect(),C=[0,S.width],E=Og(C,b?[n,r]:[r,n]);return v.current=S,E(w-S.left)}return h.jsx(ZC,{scope:e.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:h.jsx(JC,{dir:m,"data-orientation":"horizontal",...u,ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const S=x(w.clientX);i==null||i(S)},onSlideMove:w=>{const S=x(w.clientX);a==null||a(S)},onSlideEnd:()=>{v.current=void 0,c==null||c()},onStepKeyDown:w=>{const C=YC[b?"from-left":"from-right"].includes(w.key);l==null||l({event:w,direction:C?-1:1})}})})}),LV=g.forwardRef((e,t)=>{const{min:n,max:r,inverted:o,onSlideStart:s,onSlideMove:i,onSlideEnd:a,onStepKeyDown:c,...l}=e,u=g.useRef(null),d=ya(t,u),f=g.useRef(),p=!o;function v(m){const y=f.current||u.current.getBoundingClientRect(),b=[0,y.height],w=Og(b,p?[r,n]:[n,r]);return f.current=y,w(m-y.top)}return h.jsx(ZC,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:h.jsx(JC,{"data-orientation":"vertical",...l,ref:d,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const y=v(m.clientY);s==null||s(y)},onSlideMove:m=>{const y=v(m.clientY);i==null||i(y)},onSlideEnd:()=>{f.current=void 0,a==null||a()},onStepKeyDown:m=>{const b=YC[p?"from-bottom":"from-top"].includes(m.key);c==null||c({event:m,direction:b?-1:1})}})})}),JC=g.forwardRef((e,t)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:o,onSlideEnd:s,onHomeKeyDown:i,onEndKeyDown:a,onStepKeyDown:c,...l}=e,u=yu(Xs,n);return h.jsx(mu.span,{...l,ref:t,onKeyDown:cs(e.onKeyDown,d=>{d.key==="Home"?(i(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):HC.concat(GC).includes(d.key)&&(c(d),d.preventDefault())}),onPointerDown:cs(e.onPointerDown,d=>{const f=d.target;f.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(f)?f.focus():r(d)}),onPointerMove:cs(e.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&o(d)}),onPointerUp:cs(e.onPointerUp,d=>{const f=d.target;f.hasPointerCapture(d.pointerId)&&(f.releasePointerCapture(d.pointerId),s(d))})})}),eP="SliderTrack",tP=g.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,o=yu(eP,n);return h.jsx(mu.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...r,ref:t})});tP.displayName=eP;var hh="SliderRange",nP=g.forwardRef((e,t)=>{const{__scopeSlider:n,...r}=e,o=yu(hh,n),s=QC(hh,n),i=g.useRef(null),a=ya(t,i),c=o.values.length,l=o.values.map(f=>oP(f,o.min,o.max)),u=c>1?Math.min(...l):0,d=100-Math.max(...l);return h.jsx(mu.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...r,ref:a,style:{...e.style,[s.startEdge]:u+"%",[s.endEdge]:d+"%"}})});nP.displayName=hh;var ph="SliderThumb",rP=g.forwardRef((e,t)=>{const n=RV(e.__scopeSlider),[r,o]=g.useState(null),s=ya(t,a=>o(a)),i=g.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return h.jsx(FV,{...e,ref:s,index:i})}),FV=g.forwardRef((e,t)=>{const{__scopeSlider:n,index:r,name:o,...s}=e,i=yu(ph,n),a=QC(ph,n),[c,l]=g.useState(null),u=ya(t,x=>l(x)),d=c?i.form||!!c.closest("form"):!0,f=kV(c),p=i.values[r],v=p===void 0?0:oP(p,i.min,i.max),m=UV(r,i.values.length),y=f==null?void 0:f[a.size],b=y?KV(y,v,a.direction):0;return g.useEffect(()=>{if(c)return i.thumbs.add(c),()=>{i.thumbs.delete(c)}},[c,i.thumbs]),h.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${b}px)`},children:[h.jsx(fh.ItemSlot,{scope:e.__scopeSlider,children:h.jsx(mu.span,{role:"slider","aria-label":e["aria-label"]||m,"aria-valuemin":i.min,"aria-valuenow":p,"aria-valuemax":i.max,"aria-orientation":i.orientation,"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,tabIndex:i.disabled?void 0:0,...s,ref:u,style:p===void 0?{display:"none"}:e.style,onFocus:cs(e.onFocus,()=>{i.valueIndexToChangeRef.current=r})})}),d&&h.jsx(BV,{name:o??(i.name?i.name+(i.values.length>1?"[]":""):void 0),form:i.form,value:p},r)]})});rP.displayName=ph;var BV=e=>{const{value:t,...n}=e,r=g.useRef(null),o=_V(t);return g.useEffect(()=>{const s=r.current,i=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(i,"value").set;if(o!==t&&c){const l=new Event("input",{bubbles:!0});c.call(s,t),s.dispatchEvent(l)}},[o,t]),h.jsx("input",{style:{display:"none"},...n,ref:r,defaultValue:t})};function zV(e=[],t,n){const r=[...e];return r[n]=t,r.sort((o,s)=>o-s)}function oP(e,t,n){const s=100/(n-t)*(e-t);return UC(s,[0,100])}function UV(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function VV(e,t){if(e.length===1)return 0;const n=e.map(o=>Math.abs(o-t)),r=Math.min(...n);return n.indexOf(r)}function KV(e,t,n){const r=e/2,s=Og([0,50],[0,r]);return(r-s(t)*n)*n}function WV(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function HV(e,t){if(t>0){const n=WV(e);return Math.min(...n)>=t}return!0}function Og(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function GV(e){return(String(e).split(".")[1]||"").length}function YV(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var XV=qC,qV=tP,ZV=nP,QV=rP;const JV=g.memo(function(t){const{title:n,steps:r,value:o,label:s,onValueChange:i}=t,a=U(),c=Ce(),l=g.useCallback(f=>{i(f[0],!0)},[i]),u=g.useCallback(()=>{a.mark("click slider")},[a]),d=g.useCallback(()=>{o&&i(o,!1)},[o,i]);return h.jsx("div",{className:"tlui-slider__container",children:h.jsxs(XV,{"data-testid":t["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:o?[o]:void 0,onPointerDown:u,onValueChange:l,onPointerUp:d,title:n+" — "+c(s),children:[h.jsx(qV,{className:"tlui-slider__track",dir:"ltr",children:o!==null&&h.jsx(ZV,{className:"tlui-slider__range",dir:"ltr"})}),o!==null&&h.jsx(QV,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),eK=g.memo(function({label:t,uiTypeA:n,uiTypeB:r,labelA:o,labelB:s,itemsA:i,itemsB:a,styleA:c,styleB:l,valueA:u,valueB:d,onValueChange:f}){const p=Ce(),v=g.useMemo(()=>{var y;return((y=i.find(b=>u.type==="shared"&&u.value===b.value))==null?void 0:y.icon)??"mixed"},[i,u]),m=g.useMemo(()=>{var y;return((y=a.find(b=>d.type==="shared"&&d.value===b.value))==null?void 0:y.icon)??"mixed"},[a,d]);return u===void 0&&d===void 0?null:h.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[h.jsx("div",{title:p(t),className:"tlui-style-panel__double-select-picker-label",children:p(t)}),h.jsxs("div",{className:"tlui-buttons__horizontal",children:[h.jsxs(Wr,{id:`style panel ${n} A`,children:[h.jsx(Ts,{asChild:!0,onTouchEnd:y=>_e(y),children:h.jsx(te,{type:"icon","data-testid":`style.${n}`,title:p(o)+" — "+(u===null||u.type==="mixed"?p("style-panel.mixed"):p(`${n}-style.${u.value}`)),icon:v,invertIcon:!0,smallIcon:!0})}),h.jsx(Hr,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:h.jsx("div",{className:"tlui-buttons__grid",children:i.map(y=>h.jsx(Vt,{type:"icon",title:p(o)+" — "+p(`${n}-style.${y.value}`),"data-testid":`style.${n}.${y.value}`,icon:y.icon,onClick:()=>f(c,y.value,!1),invertIcon:!0},y.value))})})]}),h.jsxs(Wr,{id:`style panel ${r}`,children:[h.jsx(Ts,{asChild:!0,onTouchEnd:y=>_e(y),children:h.jsx(te,{type:"icon","data-testid":`style.${r}`,title:p(s)+" — "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${r}-style.${d.value}`)),icon:m,smallIcon:!0})}),h.jsx(Hr,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:h.jsx("div",{className:"tlui-buttons__grid",children:a.map(y=>h.jsx(Vt,{type:"icon",title:p(s)+" — "+p(`${r}-style.${y.value}`),"data-testid":`style.${r}.${y.value}`,icon:y.icon,onClick:()=>f(l,y.value,!1)},y.value))})})]})]})]})}),Rg=g.memo(function({id:t,label:n,uiType:r,style:o,items:s,type:i,value:a,onValueChange:c}){const l=Ce(),u=g.useMemo(()=>{var d;return(d=s.find(f=>a.type==="shared"&&f.value===a.value))==null?void 0:d.icon},[s,a]);return h.jsxs(Wr,{id:`style panel ${t}`,children:[h.jsx(Ts,{asChild:!0,onTouchEnd:d=>_e(d),children:h.jsx(te,{type:i,"data-testid":`style.${r}`,title:a.type==="mixed"?l("style-panel.mixed"):l(`${r}-style.${a.value}`),label:n,icon:u??"mixed"})}),h.jsx(Hr,{side:"left",align:"center",alignOffset:0,children:h.jsx("div",{className:"tlui-buttons__grid",children:s.map(d=>h.jsx(Vt,{type:"icon","data-testid":`style.${r}.${d.value}`,title:l(`${r}-style.${d.value}`),icon:d.icon,onClick:()=>c(o,d.value,!1)},d.value))})})]})}),Cn={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},sP=function({isMobile:t}){const n=U(),r=zC(),o=g.useCallback(()=>{t||n.updateInstanceState({isChangingStyle:!1})},[n,t]);if(!r)return null;const{styles:s,opacity:i}=r,a=s.get(Es),c=s.get(Qc),l=s.get(Zc),u=s.get(Jc),d=s.get(Bn),f=a===void 0,p=c===void 0&&l===void 0,v=u===void 0,m=d===void 0;return h.jsxs("div",{className:"tlui-style-panel","data-ismobile":t,onPointerLeave:o,children:[h.jsx(tK,{styles:s,opacity:i}),!m&&h.jsx(nK,{styles:s}),!(f&&p&&v)&&h.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[h.jsx(rK,{styles:s}),h.jsx(sK,{styles:s}),h.jsx(oK,{styles:s})]})]})};function va(){const e=U();return Z.useMemo(()=>function(n,r,o){e.batch(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(n,r,{squashing:o}),e.setStyleForNextShapes(n,r,{squashing:o}),e.updateInstanceState({isChangingStyle:!0})})},[e])}const bi=[.1,.25,.5,.75,1];function tK({styles:e,opacity:t}){const n=U(),r=Ce(),o=va(),s=Z.useCallback((f,p)=>{const v=bi[f];n.batch(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(v,{ephemeral:p}),n.setOpacityForNextShapes(v,{ephemeral:p}),n.updateInstanceState({isChangingStyle:!0})})},[n]),i=e.get(Zt),a=e.get(Cs),c=e.get(Fn),l=e.get(Fr),u=a!==void 0||c!==void 0||l!==void 0,d=t.type==="mixed"?-1:bi.indexOf(II(bi,f=>Math.abs(f-t.value)));return h.jsxs(h.Fragment,{children:[h.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[i===void 0?null:h.jsx(as,{title:r("style-panel.color"),uiType:"color",style:Zt,items:Cn.color,value:i,onValueChange:o}),t===void 0?null:h.jsx(JV,{"data-testid":"style.opacity",value:d>=0?d:bi.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:s,steps:bi.length-1,title:r("style-panel.opacity")})]}),u&&h.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:h.jsx(as,{title:r("style-panel.fill"),uiType:"fill",style:Cs,items:Cn.fill,value:a,onValueChange:o}),c===void 0?null:h.jsx(as,{title:r("style-panel.dash"),uiType:"dash",style:Fn,items:Cn.dash,value:c,onValueChange:o}),l===void 0?null:h.jsx(as,{title:r("style-panel.size"),uiType:"size",style:Fr,items:Cn.size,value:l,onValueChange:o})]})]})}function nK({styles:e}){const t=Ce(),n=va(),r=e.get(Bn),o=e.get(xs),s=e.get(ws);return r===void 0&&o===void 0?null:h.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:h.jsx(as,{title:t("style-panel.font"),uiType:"font",style:Bn,items:Cn.font,value:r,onValueChange:n}),o===void 0?null:h.jsxs("div",{className:"tlui-style-panel__row",children:[h.jsx(as,{title:t("style-panel.align"),uiType:"align",style:xs,items:Cn.horizontalAlign,value:o,onValueChange:n}),h.jsx("div",{className:"tlui-style-panel__row__extra-button",children:s===void 0?h.jsx(te,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):h.jsx(Rg,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:ws,items:Cn.verticalAlign,value:s,onValueChange:n})})]})]})}function rK({styles:e}){const t=va(),n=e.get(Es);return n===void 0?null:h.jsx(Rg,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Es,items:Cn.geo,value:n,onValueChange:t})}function oK({styles:e}){const t=va(),n=e.get(Jc);return n===void 0?null:h.jsx(Rg,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Jc,items:Cn.spline,value:n,onValueChange:t})}function sK({styles:e}){const t=va(),n=e.get(Qc),r=e.get(Zc);return!n||!r?null:h.jsx(eK,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Zc,itemsA:Cn.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Qc,itemsB:Cn.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function iK({toast:e}){const{removeToast:t}=Gn(),n=Ce(),r=s=>{s||t(e.id)},o=e.actions&&e.actions.length>0;return h.jsxs(l7,{onOpenChange:r,className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,children:[e.icon&&h.jsx("div",{className:"tlui-toast__icon",children:h.jsx(Yt,{icon:e.icon})}),h.jsxs("div",{className:"tlui-toast__main",children:[h.jsxs("div",{className:"tlui-toast__content",children:[e.title&&h.jsx(u7,{className:"tlui-toast__title",children:e.title}),e.description&&h.jsx(d7,{className:"tlui-toast__description",children:e.description})]}),e.actions&&h.jsxs("div",{className:"tlui-toast__actions",children:[e.actions.map((s,i)=>h.jsx(f7,{altText:s.label,asChild:!0,onClick:s.onClick,children:h.jsx(te,{type:s.type,children:s.label})},i)),h.jsx(Nv,{asChild:!0,children:h.jsx(te,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:e.closeLabel??n("toast.close")})})]})]}),!o&&h.jsx(Nv,{asChild:!0,children:h.jsx(te,{type:"normal",className:"tlui-toast__close",children:e.closeLabel??n("toast.close")})})]})}function aK(){const{toasts:e}=Gn();return h.jsx(h.Fragment,{children:e.map(t=>h.jsx(iK,{toast:t},t.id))})}const cK=g.memo(aK);function lK(){const{toasts:e}=Gn(),[t,n]=g.useState(!1);return g.useEffect(()=>{let r=!1;return e.length?n(!0):setTimeout(()=>{r||n(!1)},1e3),()=>{r=!0}},[e.length,n]),t?h.jsx(Zw,{className:"tlui-toast__viewport"}):null}function uK(){const e=U(),t=Ce(),n=zC(),r=n==null?void 0:n.styles.get(Zt),o=Dl({isDarkMode:e.user.getIsDarkMode()}),s=((r==null?void 0:r.type)==="shared"?o[r.value]:o.black).solid,i=Y("isHandOrEraserToolActive",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),a=g.useCallback(c=>{c||e.updateInstanceState({isChangingStyle:!1})},[e]);return h.jsxs(Ag,{id:"style menu",onOpenChange:a,children:[h.jsx(Mg,{disabled:i,children:h.jsx(te,{type:"tool","data-testid":"mobile.styles",style:{color:i?"var(--color-muted-1)":s},title:t("style-panel.title"),children:h.jsx(Yt,{icon:i?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),h.jsx(jC,{side:"top",align:"end",children:h.jsx(sP,{isMobile:!0})})]})}const dK=["select","hand","draw","eraser","text","zoom","laser","highlight"];function fK({activeToolId:e}){const t=U(),n=mn(),r=Ce(),o=Y("is tool locked",()=>t.getInstanceState().isToolLocked,[t]);return!e||dK.includes(e)?null:h.jsx(te,{type:"normal",title:r("action.toggle-tool-lock"),className:ue("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<5}),icon:o?"lock":"unlock",onClick:()=>t.updateInstanceState({isToolLocked:!o}),smallIcon:!0})}const hK=g.memo(function(){const t=U(),n=Ce(),r=mn(),o=Z.useRef(void 0),s=gn(),i=R8(),a=i.find(y=>y.toolItem.id==="laser"),c=Y("current tool id",()=>t.getCurrentToolId(),[t]),l=Y("geo",()=>t.getSharedStyles().getAsKnownValue(Es),[t]),u=!s,d=y=>y.label?`${n(y.label)} ${y.kbd?Un(y.kbd):""}`:"",f=i.find(y=>Qo(y.toolItem,c,l)),{itemsInPanel:p,itemsInDropdown:v,dropdownFirstItem:m}=Z.useMemo(()=>{const y=[],b=[];let x;const w=Math.min(8,5+r);for(let S=4;S<i.length;S++){const C=i[S];S<w?y.push(C):(C===f&&(x=C),b.push(C))}return x||(o.current||(o.current=b[0]),x=o.current,b.includes(x)||(x=b[0])),o.current=x,b.length<=2&&(y.push(...b),b.length=0),{itemsInPanel:y,itemsInDropdown:b,dropdownFirstItem:x}},[i,f,r]);return h.jsx("div",{className:"tlui-toolbar",children:h.jsxs("div",{className:"tlui-toolbar__inner",children:[h.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&h.jsxs("div",{className:"tlui-toolbar__extras",children:[r<6&&!(c==="hand"||c==="zoom")&&h.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[h.jsx(BC,{}),h.jsx(LC,{}),h.jsx(FC,{}),h.jsx(NC,{}),h.jsx(DC,{})]}),h.jsx(fK,{activeToolId:c})]}),h.jsxs("div",{className:ue("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<5}),children:[i.slice(0,2).map(({toolItem:y})=>h.jsx(Si,{item:y,title:d(y),isSelected:Qo(y,c,l)},y.id)),s&&a&&h.jsx(Si,{item:a.toolItem,title:d(a.toolItem),isSelected:Qo(a.toolItem,c,l)},a.toolItem.id),u&&h.jsxs(h.Fragment,{children:[i.slice(2,4).map(({toolItem:y})=>h.jsx(Si,{item:y,title:d(y),isSelected:Qo(y,c,l)},y.id)),p.map(({toolItem:y})=>h.jsx(Si,{item:y,title:d(y),isSelected:Qo(y,c,l)},y.id)),v.length?h.jsxs(h.Fragment,{children:[h.jsx(Si,{item:m.toolItem,title:d(m.toolItem),isSelected:Qo(m.toolItem,c,l)},m.toolItem.id),h.jsxs(Wr,{id:"toolbar overflow",modal:!1,children:[h.jsx(ga,{children:h.jsx(te,{className:"tlui-toolbar__overflow",icon:"chevron-up",type:"tool","data-testid":"tools.more",title:n("tool-panel.more")})}),h.jsx(Hr,{side:"top",align:"center",children:h.jsx(pK,{toolbarItems:v})})]})]}):null]})]})]}),r<5&&!s&&h.jsx("div",{className:"tlui-toolbar__tools",children:h.jsx(uK,{})})]})})}),pK=Te(function({toolbarItems:t}){const n=Ce();return h.jsx("div",{className:"tlui-buttons__grid",children:t.map(({toolItem:{id:r,meta:o,kbd:s,label:i,onSelect:a,icon:c}})=>h.jsx(Vt,{type:"icon",className:"tlui-button-grid__button","data-testid":`tools.more.${r}`,"data-tool":r,"data-geo":(o==null?void 0:o.geo)??"","aria-label":i,onClick:()=>a("toolbar"),title:i?`${n(i)} ${s?Un(s):""}`:"",icon:c},r))})});function Si({item:e,title:t,isSelected:n}){var r;return h.jsx(te,{type:"tool","data-testid":`tools.${e.id}`,"data-tool":e.id,"data-geo":((r=e.meta)==null?void 0:r.geo)??"","aria-label":e.label,title:t,icon:e.icon,"data-state":n?"selected":void 0,onClick:()=>e.onSelect("toolbar"),onTouchStart:o=>{_e(o),e.onSelect("toolbar")}})}const Qo=(e,t,n)=>{var r,o;return(r=e.meta)!=null&&r.geo?t==="geo"&&n===((o=e.meta)==null?void 0:o.geo):t===e.id};function gK(){const e=U(),{addToast:t}=Gn();g.useEffect(()=>{function n({name:r,count:o}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${o}). Please delete some shapes or move to a different page to continue.`})}return e.addListener("max-shapes",n),()=>{e.removeListener("max-shapes",n)}},[e,t])}const ef=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function tf(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),n)}function xi(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on".concat(t),n)}function iP(e,t){const n=t.slice(0,t.length-1);for(let r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function aP(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function mK(e,t){const n=e.length>=t.length?e:t,r=e.length>=t.length?t:e;let o=!0;for(let s=0;s<n.length;s++)r.indexOf(n[s])===-1&&(o=!1);return o}const Yi={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":ef?173:189,"=":ef?61:187,";":ef?59:186,"'":222,"[":219,"]":221,"\\":220},Kn={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},gh={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},at={16:!1,18:!1,17:!1,91:!1},Ye={};for(let e=1;e<20;e++)Yi["f".concat(e)]=111+e;let Re=[],Oi=null,cP="all";const er=new Map,ba=e=>Yi[e.toLowerCase()]||Kn[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),yK=e=>Object.keys(Yi).find(t=>Yi[t]===e),vK=e=>Object.keys(Kn).find(t=>Kn[t]===e);function lP(e){cP=e||"all"}function Xi(){return cP||"all"}function bK(){return Re.slice(0)}function SK(){return Re.map(e=>yK(e)||vK(e)||String.fromCharCode(e))}function xK(){const e=[];return Object.keys(Ye).forEach(t=>{Ye[t].forEach(n=>{let{key:r,scope:o,mods:s,shortcut:i}=n;e.push({scope:o,shortcut:i,mods:s,keys:r.split("+").map(a=>ba(a))})})}),e}function wK(e){const t=e.target||e.srcElement,{tagName:n}=t;let r=!0;const o=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(o||n==="TEXTAREA"||n==="SELECT")&&!t.readOnly)&&(r=!1),r}function CK(e){return typeof e=="string"&&(e=ba(e)),Re.indexOf(e)!==-1}function PK(e,t){let n,r;e||(e=Xi());for(const o in Ye)if(Object.prototype.hasOwnProperty.call(Ye,o))for(n=Ye[o],r=0;r<n.length;)n[r].scope===e?n.splice(r,1).forEach(i=>{let{element:a}=i;return jg(a)}):r++;Xi()===e&&lP(t||"all")}function EK(e){let t=e.keyCode||e.which||e.charCode;const n=Re.indexOf(t);if(n>=0&&Re.splice(n,1),e.key&&e.key.toLowerCase()==="meta"&&Re.splice(0,Re.length),(t===93||t===224)&&(t=91),t in at){at[t]=!1;for(const r in Kn)Kn[r]===t&&(Pn[r]=!1)}}function uP(e){if(typeof e>"u")Object.keys(Ye).forEach(o=>{Array.isArray(Ye[o])&&Ye[o].forEach(s=>xc(s)),delete Ye[o]}),jg(null);else if(Array.isArray(e))e.forEach(o=>{o.key&&xc(o)});else if(typeof e=="object")e.key&&xc(e);else if(typeof e=="string"){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[o,s]=n;typeof o=="function"&&(s=o,o=""),xc({key:e,scope:o,method:s,splitKey:"+"})}}const xc=e=>{let{key:t,scope:n,method:r,splitKey:o="+"}=e;aP(t).forEach(i=>{const a=i.split(o),c=a.length,l=a[c-1],u=l==="*"?"*":ba(l);if(!Ye[u])return;n||(n=Xi());const d=c>1?iP(Kn,a):[],f=[];Ye[u]=Ye[u].filter(p=>{const m=(r?p.method===r:!0)&&p.scope===n&&mK(p.mods,d);return m&&f.push(p.element),!m}),f.forEach(p=>jg(p))})};function Tb(e,t,n,r){if(t.element!==r)return;let o;if(t.scope===n||t.scope==="all"){o=t.mods.length>0;for(const s in at)Object.prototype.hasOwnProperty.call(at,s)&&(!at[s]&&t.mods.indexOf(+s)>-1||at[s]&&t.mods.indexOf(+s)===-1)&&(o=!1);(t.mods.length===0&&!at[16]&&!at[18]&&!at[17]&&!at[91]||o||t.shortcut==="*")&&(t.keys=[],t.keys=t.keys.concat(Re),t.method(e,t)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function $b(e,t){const n=Ye["*"];let r=e.keyCode||e.which||e.charCode;if(!Pn.filter.call(this,e))return;if((r===93||r===224)&&(r=91),Re.indexOf(r)===-1&&r!==229&&Re.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const c=gh[a];e[a]&&Re.indexOf(c)===-1?Re.push(c):!e[a]&&Re.indexOf(c)>-1?Re.splice(Re.indexOf(c),1):a==="metaKey"&&e[a]&&Re.length===3&&(e.ctrlKey||e.shiftKey||e.altKey||(Re=Re.slice(Re.indexOf(c))))}),r in at){at[r]=!0;for(const a in Kn)Kn[a]===r&&(Pn[a]=!0);if(!n)return}for(const a in at)Object.prototype.hasOwnProperty.call(at,a)&&(at[a]=e[gh[a]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(Re.indexOf(17)===-1&&Re.push(17),Re.indexOf(18)===-1&&Re.push(18),at[17]=!0,at[18]=!0);const o=Xi();if(n)for(let a=0;a<n.length;a++)n[a].scope===o&&(e.type==="keydown"&&n[a].keydown||e.type==="keyup"&&n[a].keyup)&&Tb(e,n[a],o,t);if(!(r in Ye))return;const s=Ye[r],i=s.length;for(let a=0;a<i;a++)if((e.type==="keydown"&&s[a].keydown||e.type==="keyup"&&s[a].keyup)&&s[a].key){const c=s[a],{splitKey:l}=c,u=c.key.split(l),d=[];for(let f=0;f<u.length;f++)d.push(ba(u[f]));d.sort().join("")===Re.sort().join("")&&Tb(e,c,o,t)}}function Pn(e,t,n){Re=[];const r=aP(e);let o=[],s="all",i=document,a=0,c=!1,l=!0,u="+",d=!1,f=!1;for(n===void 0&&typeof t=="function"&&(n=t),Object.prototype.toString.call(t)==="[object Object]"&&(t.scope&&(s=t.scope),t.element&&(i=t.element),t.keyup&&(c=t.keyup),t.keydown!==void 0&&(l=t.keydown),t.capture!==void 0&&(d=t.capture),typeof t.splitKey=="string"&&(u=t.splitKey),t.single===!0&&(f=!0)),typeof t=="string"&&(s=t),f&&uP(e,s);a<r.length;a++)e=r[a].split(u),o=[],e.length>1&&(o=iP(Kn,e)),e=e[e.length-1],e=e==="*"?"*":ba(e),e in Ye||(Ye[e]=[]),Ye[e].push({keyup:c,keydown:l,scope:s,mods:o,shortcut:r[a],method:n,key:r[a],splitKey:u,element:i});if(typeof i<"u"&&window){if(!er.has(i)){const p=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return $b(m,i)},v=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;$b(m,i),EK(m)};er.set(i,{keydownListener:p,keyupListenr:v,capture:d}),tf(i,"keydown",p,d),tf(i,"keyup",v,d)}if(!Oi){const p=()=>{Re=[]};Oi={listener:p,capture:d},tf(window,"focus",p,d)}}}function _K(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Ye).forEach(n=>{Ye[n].filter(o=>o.scope===t&&o.shortcut===e).forEach(o=>{o&&o.method&&o.method()})})}function jg(e){const t=Object.values(Ye).flat();if(t.findIndex(r=>{let{element:o}=r;return o===e})<0){const{keydownListener:r,keyupListenr:o,capture:s}=er.get(e)||{};r&&o&&(xi(e,"keyup",o,s),xi(e,"keydown",r,s),er.delete(e))}if((t.length<=0||er.size<=0)&&(Object.keys(er).forEach(o=>{const{keydownListener:s,keyupListenr:i,capture:a}=er.get(o)||{};s&&i&&(xi(o,"keyup",i,a),xi(o,"keydown",s,a),er.delete(o))}),er.clear(),Object.keys(Ye).forEach(o=>delete Ye[o]),Oi)){const{listener:o,capture:s}=Oi;xi(window,"focus",o,s),Oi=null}}const nf={getPressedKeyString:SK,setScope:lP,getScope:Xi,deleteScope:PK,getPressedKeyCodes:bK,getAllKeyCodes:xK,isPressed:CK,filter:wK,trigger:_K,unbind:uP,keyMap:Yi,modifier:Kn,modifierMap:gh};for(const e in nf)Object.prototype.hasOwnProperty.call(nf,e)&&(Pn[e]=nf[e]);if(typeof window<"u"){const e=window.hotkeys;Pn.noConflict=t=>(t&&window.hotkeys===Pn&&(window.hotkeys=e),Pn),window.hotkeys=Pn}const Ab=["copy","cut","paste","asset"];function IK(){const e=U(),t=gn(),n=vt(),r=tg(),o=Y("is focused",()=>e.getInstanceState().isFocused,[e]);g.useEffect(()=>{if(!o)return;const s=e.getContainer();Pn.setScope(e.store.id);const i=(c,l)=>{Pn(c,{element:s,scope:e.store.id},l)},a=()=>e.getIsMenuOpen()||e.getEditingShapeId()!==null||e.getCrashingError();for(const c of Object.values(n))c.kbd&&(t&&!c.readonlyOk||Ab.includes(c.id)||i(Mb(c.kbd),l=>{a()||(_e(l),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&e.getInstanceState().isReadonly||Ab.includes(c.id)||i(Mb(c.kbd),l=>{a()||(_e(l),c.onSelect("kbd"))});return()=>{Pn.deleteScope(e.store.id)}},[n,r,t,e,o])}function Mb(e){return kK(e).map(t=>{let n="";const r=t.split("");return r.length===1?n=r[0]:r[0]==="!"?n=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?n=`alt+shift+${r[2]}`:n=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?n=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?n=`cmd+⌥+${r[2]},ctrl+alt+${r[2]}`:n=`cmd+${r[1]},ctrl+${r[1]}`:n=t,n}).join(",")}function kK(e){typeof e!="string"&&(e=""),e=e.replace(/\s/g,"");const t=e.split(",");let n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}const iq=Z.memo(function({shareZone:t,topZone:n,renderDebugMenuItems:r,children:o,hideUi:s,...i}){return h.jsx(F8,{...i,children:h.jsx(TK,{hideUi:s,shareZone:t,topZone:n,renderDebugMenuItems:r,children:o})})}),TK=Z.memo(function({children:t,hideUi:n,...r}){return h.jsxs(h.Fragment,{children:[t,n?null:h.jsx($K,{...r})]})}),$K=Z.memo(function({shareZone:t,topZone:n,renderDebugMenuItems:r}){const o=U(),s=Ce(),i=mn(),a=Y("isReadonlyMode",()=>o.getInstanceState().isReadonly,[o]),c=Y("focus",()=>o.getInstanceState().isFocusMode,[o]),l=Y("debug",()=>o.getInstanceState().isDebugMode,[o]);IK(),a8(),gK();const{"toggle-focus-mode":u}=vt();return h.jsx(Xw,{children:h.jsxs("div",{className:ue("tlui-layout",{"tlui-layout__mobile":i<5}),"data-breakpoint":i,children:[c?h.jsx("div",{className:"tlui-layout__top",children:h.jsx(te,{type:"icon",className:"tlui-focus-button",title:`${s("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>u.onSelect("menu")})}):h.jsxs(h.Fragment,{children:[h.jsxs("div",{className:"tlui-layout__top",children:[h.jsxs("div",{className:"tlui-layout__top__left",children:[h.jsx(dV,{}),h.jsxs("div",{className:"tlui-helper-buttons",children:[h.jsx(gV,{}),h.jsx(z8,{}),h.jsx(mV,{})]})]}),h.jsx("div",{className:"tlui-layout__top__center",children:n}),h.jsxs("div",{className:"tlui-layout__top__right",children:[t,i>=5&&!a&&h.jsx("div",{className:"tlui-style-panel__wrapper",children:h.jsx(sP,{})})]})]}),h.jsxs("div",{className:"tlui-layout__bottom",children:[h.jsxs("div",{className:"tlui-layout__bottom__main",children:[h.jsx(pV,{}),h.jsx(hK,{}),i>=4&&h.jsx(Mz,{})]}),l&&h.jsx(xz,{renderDebugMenuItems:r??null})]})]}),h.jsx(cK,{}),h.jsx(Tz,{}),h.jsx(lK,{}),h.jsx($z,{})]})})});function we(e,t,{checkForDefaultPrevented:n=!0}={}){return function(o){if(e==null||e(o),n===!1||!o.defaultPrevented)return t==null?void 0:t(o)}}function dP(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];const l=d=>{var b;const{scope:f,children:p,...v}=d,m=((b=f==null?void 0:f[e])==null?void 0:b[c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})};l.displayName=s+"Provider";function u(d,f){var m;const p=((m=f==null?void 0:f[e])==null?void 0:m[c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,AK(o,...t)]}function AK(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}function MK(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function Dg(...e){return t=>e.forEach(n=>MK(n,t))}function yn(...e){return g.useCallback(Dg(...e),e)}var Ng=g.forwardRef((e,t)=>{const{children:n,...r}=e,o=g.Children.toArray(n),s=o.find(RK);if(s){const i=s.props.children,a=o.map(c=>c===s?g.Children.count(i)>1?g.Children.only(null):g.isValidElement(i)?i.props.children:null:c);return h.jsx(mh,{...r,ref:t,children:g.isValidElement(i)?g.cloneElement(i,void 0,a):null})}return h.jsx(mh,{...r,ref:t,children:n})});Ng.displayName="Slot";var mh=g.forwardRef((e,t)=>{const{children:n,...r}=e;if(g.isValidElement(n)){const o=DK(n);return g.cloneElement(n,{...jK(r,n.props),ref:t?Dg(t,o):o})}return g.Children.count(n)>1?g.Children.only(null):null});mh.displayName="SlotClone";var OK=({children:e})=>h.jsx(h.Fragment,{children:e});function RK(e){return g.isValidElement(e)&&e.type===OK}function jK(e,t){const n={...t};for(const r in t){const o=e[r],s=t[r];/^on[A-Z]/.test(r)?o&&s?n[r]=(...a)=>{s(...a),o(...a)}:o&&(n[r]=o):r==="style"?n[r]={...o,...s}:r==="className"&&(n[r]=[o,s].filter(Boolean).join(" "))}return{...e,...n}}function DK(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}var NK=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],kt=NK.reduce((e,t)=>{const n=g.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?Ng:t;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),h.jsx(a,{...i,ref:o})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function fP(e,t){e&&Eo.flushSync(()=>e.dispatchEvent(t))}var LK=g.createContext(void 0);function hP(e){const t=g.useContext(LK);return e||t||"ltr"}function Qt(e){const t=g.useRef(e);return g.useEffect(()=>{t.current=e}),g.useMemo(()=>(...n)=>{var r;return(r=t.current)==null?void 0:r.call(t,...n)},[])}function FK(e,t=globalThis==null?void 0:globalThis.document){const n=Qt(e);g.useEffect(()=>{const r=o=>{o.key==="Escape"&&n(o)};return t.addEventListener("keydown",r,{capture:!0}),()=>t.removeEventListener("keydown",r,{capture:!0})},[n,t])}var BK="DismissableLayer",yh="dismissableLayer.update",zK="dismissableLayer.pointerDownOutside",UK="dismissableLayer.focusOutside",Ob,pP=g.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gP=g.forwardRef((e,t)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...c}=e,l=g.useContext(pP),[u,d]=g.useState(null),f=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=g.useState({}),v=yn(t,E=>d(E)),m=Array.from(l.layers),[y]=[...l.layersWithOutsidePointerEventsDisabled].slice(-1),b=m.indexOf(y),x=u?m.indexOf(u):-1,w=l.layersWithOutsidePointerEventsDisabled.size>0,S=x>=b,C=WK(E=>{const _=E.target,$=[...l.branches].some(T=>T.contains(_));!S||$||(o==null||o(E),i==null||i(E),E.defaultPrevented||a==null||a())},f),P=HK(E=>{const _=E.target;[...l.branches].some(T=>T.contains(_))||(s==null||s(E),i==null||i(E),E.defaultPrevented||a==null||a())},f);return FK(E=>{x===l.layers.size-1&&(r==null||r(E),!E.defaultPrevented&&a&&(E.preventDefault(),a()))},f),g.useEffect(()=>{if(u)return n&&(l.layersWithOutsidePointerEventsDisabled.size===0&&(Ob=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),l.layersWithOutsidePointerEventsDisabled.add(u)),l.layers.add(u),Rb(),()=>{n&&l.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=Ob)}},[u,f,n,l]),g.useEffect(()=>()=>{u&&(l.layers.delete(u),l.layersWithOutsidePointerEventsDisabled.delete(u),Rb())},[u,l]),g.useEffect(()=>{const E=()=>p({});return document.addEventListener(yh,E),()=>document.removeEventListener(yh,E)},[]),h.jsx(kt.div,{...c,ref:v,style:{pointerEvents:w?S?"auto":"none":void 0,...e.style},onFocusCapture:we(e.onFocusCapture,P.onFocusCapture),onBlurCapture:we(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:we(e.onPointerDownCapture,C.onPointerDownCapture)})});gP.displayName=BK;var VK="DismissableLayerBranch",KK=g.forwardRef((e,t)=>{const n=g.useContext(pP),r=g.useRef(null),o=yn(t,r);return g.useEffect(()=>{const s=r.current;if(s)return n.branches.add(s),()=>{n.branches.delete(s)}},[n.branches]),h.jsx(kt.div,{...e,ref:o})});KK.displayName=VK;function WK(e,t=globalThis==null?void 0:globalThis.document){const n=Qt(e),r=g.useRef(!1),o=g.useRef(()=>{});return g.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){mP(zK,n,l,{discrete:!0})};const l={originalEvent:a};a.pointerType==="touch"?(t.removeEventListener("click",o.current),o.current=c,t.addEventListener("click",o.current,{once:!0})):c()}else t.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",s),t.removeEventListener("click",o.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function HK(e,t=globalThis==null?void 0:globalThis.document){const n=Qt(e),r=g.useRef(!1);return g.useEffect(()=>{const o=s=>{s.target&&!r.current&&mP(UK,n,{originalEvent:s},{discrete:!1})};return t.addEventListener("focusin",o),()=>t.removeEventListener("focusin",o)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Rb(){const e=new CustomEvent(yh);document.dispatchEvent(e)}function mP(e,t,n,{discrete:r}){const o=n.originalEvent.target,s=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&o.addEventListener(e,t,{once:!0}),r?fP(o,s):o.dispatchEvent(s)}var rf=0;function GK(){g.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??jb()),document.body.insertAdjacentElement("beforeend",e[1]??jb()),rf++,()=>{rf===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(t=>t.remove()),rf--}},[])}function jb(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var of="focusScope.autoFocusOnMount",sf="focusScope.autoFocusOnUnmount",Db={bubbles:!1,cancelable:!0},YK="FocusScope",yP=g.forwardRef((e,t)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=e,[a,c]=g.useState(null),l=Qt(o),u=Qt(s),d=g.useRef(null),f=yn(t,m=>c(m)),p=g.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;g.useEffect(()=>{if(r){let m=function(w){if(p.paused||!a)return;const S=w.target;a.contains(S)?d.current=S:kr(d.current,{select:!0})},y=function(w){if(p.paused||!a)return;const S=w.relatedTarget;S!==null&&(a.contains(S)||kr(d.current,{select:!0}))},b=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&kr(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",y);const x=new MutationObserver(b);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",y),x.disconnect()}}},[r,a,p.paused]),g.useEffect(()=>{if(a){Lb.add(p);const m=document.activeElement;if(!a.contains(m)){const b=new CustomEvent(of,Db);a.addEventListener(of,l),a.dispatchEvent(b),b.defaultPrevented||(XK(eW(vP(a)),{select:!0}),document.activeElement===m&&kr(a))}return()=>{a.removeEventListener(of,l),setTimeout(()=>{const b=new CustomEvent(sf,Db);a.addEventListener(sf,u),a.dispatchEvent(b),b.defaultPrevented||kr(m??document.body,{select:!0}),a.removeEventListener(sf,u),Lb.remove(p)},0)}}},[a,l,u,p]);const v=g.useCallback(m=>{if(!n&&!r||p.paused)return;const y=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,b=document.activeElement;if(y&&b){const x=m.currentTarget,[w,S]=qK(x);w&&S?!m.shiftKey&&b===S?(m.preventDefault(),n&&kr(w,{select:!0})):m.shiftKey&&b===w&&(m.preventDefault(),n&&kr(S,{select:!0})):b===x&&m.preventDefault()}},[n,r,p.paused]);return h.jsx(kt.div,{tabIndex:-1,...i,ref:f,onKeyDown:v})});yP.displayName=YK;function XK(e,{select:t=!1}={}){const n=document.activeElement;for(const r of e)if(kr(r,{select:t}),document.activeElement!==n)return}function qK(e){const t=vP(e),n=Nb(t,e),r=Nb(t.reverse(),e);return[n,r]}function vP(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function Nb(e,t){for(const n of e)if(!ZK(n,{upTo:t}))return n}function ZK(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function QK(e){return e instanceof HTMLInputElement&&"select"in e}function kr(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&QK(e)&&t&&e.select()}}var Lb=JK();function JK(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=Fb(e,t),e.unshift(t)},remove(t){var n;e=Fb(e,t),(n=e[0])==null||n.resume()}}}function Fb(e,t){const n=[...e],r=n.indexOf(t);return r!==-1&&n.splice(r,1),n}function eW(e){return e.filter(t=>t.tagName!=="A")}var Po=globalThis!=null&&globalThis.document?g.useLayoutEffect:()=>{},tW=_h.useId||(()=>{}),nW=0;function vh(e){const[t,n]=g.useState(tW());return Po(()=>{n(r=>r??String(nW++))},[e]),t?`radix-${t}`:""}var rW="Arrow",bP=g.forwardRef((e,t)=>{const{children:n,width:r=10,height:o=5,...s}=e;return h.jsx(kt.svg,{...s,ref:t,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:h.jsx("polygon",{points:"0,0 30,0 15,10"})})});bP.displayName=rW;var oW=bP;function sW(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:f,children:p,...v}=d,m=(f==null?void 0:f[e][c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})}function u(d,f){const p=(f==null?void 0:f[e][c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,iW(o,...t)]}function iW(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}function aW(e){const[t,n]=g.useState(void 0);return Po(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const c=s.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,a=l.blockSize}else i=e.offsetWidth,a=e.offsetHeight;n({width:i,height:a})});return r.observe(e,{box:"border-box"}),()=>r.unobserve(e)}else n(void 0)},[e]),t}var Lg="Popper",[SP,xP]=sW(Lg),[cW,wP]=SP(Lg),CP=e=>{const{__scopePopper:t,children:n}=e,[r,o]=g.useState(null);return h.jsx(cW,{scope:t,anchor:r,onAnchorChange:o,children:n})};CP.displayName=Lg;var PP="PopperAnchor",EP=g.forwardRef((e,t)=>{const{__scopePopper:n,virtualRef:r,...o}=e,s=wP(PP,n),i=g.useRef(null),a=yn(t,i);return g.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:h.jsx(kt.div,{...o,ref:a})});EP.displayName=PP;var Fg="PopperContent",[lW,uW]=SP(Fg),_P=g.forwardRef((e,t)=>{var Se,Ie,de,Ee,xe,Qe;const{__scopePopper:n,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:l=[],collisionPadding:u=0,sticky:d="partial",hideWhenDetached:f=!1,updatePositionStrategy:p="optimized",onPlaced:v,...m}=e,y=wP(Fg,n),[b,x]=g.useState(null),w=yn(t,Fe=>x(Fe)),[S,C]=g.useState(null),P=aW(S),E=(P==null?void 0:P.width)??0,_=(P==null?void 0:P.height)??0,$=r+(s!=="center"?"-"+s:""),T=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},M=Array.isArray(l)?l:[l],O=M.length>0,j={padding:T,boundary:M.filter(fW),altBoundary:O},{refs:N,floatingStyles:B,placement:D,isPositioned:G,middlewareData:V}=mg({strategy:"fixed",placement:$,whileElementsMounted:(...Fe)=>pg(...Fe,{animationFrame:p==="always"}),elements:{reference:y.anchor},middleware:[ag({mainAxis:o+_,alignmentAxis:i}),c&&cg({mainAxis:!0,crossAxis:!1,limiter:d==="partial"?lg():void 0,...j}),c&&sg({...j}),ug({...j,apply:({elements:Fe,rects:et,availableWidth:Oe,availableHeight:tt})=>{const{width:kn,height:vn}=et.reference,Je=Fe.floating.style;Je.setProperty("--radix-popper-available-width",`${Oe}px`),Je.setProperty("--radix-popper-available-height",`${tt}px`),Je.setProperty("--radix-popper-anchor-width",`${kn}px`),Je.setProperty("--radix-popper-anchor-height",`${vn}px`)}}),S&&gg({element:S,padding:a}),hW({arrowWidth:E,arrowHeight:_}),f&&ig({strategy:"referenceHidden",...j})]}),[z,W]=TP(D),Q=Qt(v);Po(()=>{G&&(Q==null||Q())},[G,Q]);const oe=(Se=V.arrow)==null?void 0:Se.x,se=(Ie=V.arrow)==null?void 0:Ie.y,ye=((de=V.arrow)==null?void 0:de.centerOffset)!==0,[ee,be]=g.useState();return Po(()=>{b&&be(window.getComputedStyle(b).zIndex)},[b]),h.jsx("div",{ref:N.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:G?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ee,"--radix-popper-transform-origin":[(Ee=V.transformOrigin)==null?void 0:Ee.x,(xe=V.transformOrigin)==null?void 0:xe.y].join(" "),...((Qe=V.hide)==null?void 0:Qe.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:h.jsx(lW,{scope:n,placedSide:z,onArrowChange:C,arrowX:oe,arrowY:se,shouldHideArrow:ye,children:h.jsx(kt.div,{"data-side":z,"data-align":W,...m,ref:w,style:{...m.style,animation:G?void 0:"none"}})})})});_P.displayName=Fg;var IP="PopperArrow",dW={top:"bottom",right:"left",bottom:"top",left:"right"},kP=g.forwardRef(function(t,n){const{__scopePopper:r,...o}=t,s=uW(IP,r),i=dW[s.placedSide];return h.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:h.jsx(oW,{...o,ref:n,style:{...o.style,display:"block"}})})});kP.displayName=IP;function fW(e){return e!==null}var hW=e=>({name:"transformOrigin",options:e,fn(t){var y,b,x;const{placement:n,rects:r,middlewareData:o}=t,i=((y=o.arrow)==null?void 0:y.centerOffset)!==0,a=i?0:e.arrowWidth,c=i?0:e.arrowHeight,[l,u]=TP(n),d={start:"0%",center:"50%",end:"100%"}[u],f=(((b=o.arrow)==null?void 0:b.x)??0)+a/2,p=(((x=o.arrow)==null?void 0:x.y)??0)+c/2;let v="",m="";return l==="bottom"?(v=i?d:`${f}px`,m=`${-c}px`):l==="top"?(v=i?d:`${f}px`,m=`${r.floating.height+c}px`):l==="right"?(v=`${-c}px`,m=i?d:`${p}px`):l==="left"&&(v=`${r.floating.width+c}px`,m=i?d:`${p}px`),{data:{x:v,y:m}}}});function TP(e){const[t,n="center"]=e.split("-");return[t,n]}var $P=CP,pW=EP,gW=_P,mW=kP,yW="Portal",AP=g.forwardRef((e,t)=>{var a;const{container:n,...r}=e,[o,s]=g.useState(!1);Po(()=>s(!0),[]);const i=n||o&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?Qi.createPortal(h.jsx(kt.div,{...r,ref:t}),i):null});AP.displayName=yW;function vW(e,t){return g.useReducer((n,r)=>t[n][r]??n,e)}var Sa=e=>{const{present:t,children:n}=e,r=bW(t),o=typeof n=="function"?n({present:r.isPresent}):g.Children.only(n),s=yn(r.ref,SW(o));return typeof n=="function"||r.isPresent?g.cloneElement(o,{ref:s}):null};Sa.displayName="Presence";function bW(e){const[t,n]=g.useState(),r=g.useRef({}),o=g.useRef(e),s=g.useRef("none"),i=e?"mounted":"unmounted",[a,c]=vW(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return g.useEffect(()=>{const l=wc(r.current);s.current=a==="mounted"?l:"none"},[a]),Po(()=>{const l=r.current,u=o.current;if(u!==e){const f=s.current,p=wc(l);e?c("MOUNT"):p==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),o.current=e}},[e,c]),Po(()=>{if(t){let l;const u=t.ownerDocument.defaultView??window,d=p=>{const m=wc(r.current).includes(p.animationName);if(p.target===t&&m&&(c("ANIMATION_END"),!o.current)){const y=t.style.animationFillMode;t.style.animationFillMode="forwards",l=u.setTimeout(()=>{t.style.animationFillMode==="forwards"&&(t.style.animationFillMode=y)})}},f=p=>{p.target===t&&(s.current=wc(r.current))};return t.addEventListener("animationstart",f),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{u.clearTimeout(l),t.removeEventListener("animationstart",f),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:g.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function wc(e){return(e==null?void 0:e.animationName)||"none"}function SW(e){var r,o;let t=(r=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:r.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(t=(o=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:o.get,n=t&&"isReactWarning"in t&&t.isReactWarning,n?e.props.ref:e.props.ref||e.ref)}function xW(e,t=[]){let n=[];function r(s,i){const a=g.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:f,children:p,...v}=d,m=(f==null?void 0:f[e][c])||a,y=g.useMemo(()=>v,Object.values(v));return h.jsx(m.Provider,{value:y,children:p})}function u(d,f){const p=(f==null?void 0:f[e][c])||a,v=g.useContext(p);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,u]}const o=()=>{const s=n.map(i=>g.createContext(i));return function(a){const c=(a==null?void 0:a[e])||s;return g.useMemo(()=>({[`__scope${e}`]:{...a,[e]:c}}),[a,c])}};return o.scopeName=e,[r,wW(o,...t)]}function wW(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const r=e.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(s)[`__scope${l}`];return{...a,...d}},{});return g.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}function MP({prop:e,defaultProp:t,onChange:n=()=>{}}){const[r,o]=CW({defaultProp:t,onChange:n}),s=e!==void 0,i=s?e:r,a=Qt(n),c=g.useCallback(l=>{if(s){const d=typeof l=="function"?l(e):l;d!==e&&a(d)}else o(l)},[s,e,o,a]);return[i,c]}function CW({defaultProp:e,onChange:t}){const n=g.useState(e),[r]=n,o=g.useRef(r),s=Qt(t);return g.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),n}var af="rovingFocusGroup.onEntryFocus",PW={bubbles:!1,cancelable:!0},vu="RovingFocusGroup",[bh,OP,EW]=eu(vu),[_W,RP]=xW(vu,[EW]),[IW,kW]=_W(vu),jP=g.forwardRef((e,t)=>h.jsx(bh.Provider,{scope:e.__scopeRovingFocusGroup,children:h.jsx(bh.Slot,{scope:e.__scopeRovingFocusGroup,children:h.jsx(TW,{...e,ref:t})})}));jP.displayName=vu;var TW=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:o=!1,dir:s,currentTabStopId:i,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,preventScrollOnEntryFocus:u=!1,...d}=e,f=g.useRef(null),p=yn(t,f),v=hP(s),[m=null,y]=MP({prop:i,defaultProp:a,onChange:c}),[b,x]=g.useState(!1),w=Qt(l),S=OP(n),C=g.useRef(!1),[P,E]=g.useState(0);return g.useEffect(()=>{const _=f.current;if(_)return _.addEventListener(af,w),()=>_.removeEventListener(af,w)},[w]),h.jsx(IW,{scope:n,orientation:r,dir:v,loop:o,currentTabStopId:m,onItemFocus:g.useCallback(_=>y(_),[y]),onItemShiftTab:g.useCallback(()=>x(!0),[]),onFocusableItemAdd:g.useCallback(()=>E(_=>_+1),[]),onFocusableItemRemove:g.useCallback(()=>E(_=>_-1),[]),children:h.jsx(kt.div,{tabIndex:b||P===0?-1:0,"data-orientation":r,...d,ref:p,style:{outline:"none",...e.style},onMouseDown:we(e.onMouseDown,()=>{C.current=!0}),onFocus:we(e.onFocus,_=>{const $=!C.current;if(_.target===_.currentTarget&&$&&!b){const T=new CustomEvent(af,PW);if(_.currentTarget.dispatchEvent(T),!T.defaultPrevented){const M=S().filter(D=>D.focusable),O=M.find(D=>D.active),j=M.find(D=>D.id===m),B=[O,j,...M].filter(Boolean).map(D=>D.ref.current);LP(B,u)}}C.current=!1}),onBlur:we(e.onBlur,()=>x(!1))})})}),DP="RovingFocusGroupItem",NP=g.forwardRef((e,t)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:o=!1,tabStopId:s,...i}=e,a=vh(),c=s||a,l=kW(DP,n),u=l.currentTabStopId===c,d=OP(n),{onFocusableItemAdd:f,onFocusableItemRemove:p}=l;return g.useEffect(()=>{if(r)return f(),()=>p()},[r,f,p]),h.jsx(bh.ItemSlot,{scope:n,id:c,focusable:r,active:o,children:h.jsx(kt.span,{tabIndex:u?0:-1,"data-orientation":l.orientation,...i,ref:t,onMouseDown:we(e.onMouseDown,v=>{r?l.onItemFocus(c):v.preventDefault()}),onFocus:we(e.onFocus,()=>l.onItemFocus(c)),onKeyDown:we(e.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){l.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const m=MW(v,l.orientation,l.dir);if(m!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let b=d().filter(x=>x.focusable).map(x=>x.ref.current);if(m==="last")b.reverse();else if(m==="prev"||m==="next"){m==="prev"&&b.reverse();const x=b.indexOf(v.currentTarget);b=l.loop?OW(b,x+1):b.slice(x+1)}setTimeout(()=>LP(b))}})})})});NP.displayName=DP;var $W={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function AW(e,t){return t!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function MW(e,t,n){const r=AW(e.key,n);if(!(t==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(t==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return $W[r]}function LP(e,t=!1){const n=document.activeElement;for(const r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}function OW(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var RW=jP,jW=NP,zc="right-scroll-bar-position",Uc="width-before-scroll-bar",DW="with-scroll-bars-hidden",NW="--removed-body-scroll-bar-size",FP=Ih(),cf=function(){},bu=g.forwardRef(function(e,t){var n=g.useRef(null),r=g.useState({onScrollCapture:cf,onWheelCapture:cf,onTouchMoveCapture:cf}),o=r[0],s=r[1],i=e.forwardProps,a=e.children,c=e.className,l=e.removeScrollBar,u=e.enabled,d=e.shards,f=e.sideCar,p=e.noIsolation,v=e.inert,m=e.allowPinchZoom,y=e.as,b=y===void 0?"div":y,x=e.gapMode,w=kh(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),S=f,C=Th([n,t]),P=rt(rt({},w),o);return g.createElement(g.Fragment,null,u&&g.createElement(S,{sideCar:FP,removeScrollBar:l,shards:d,noIsolation:p,inert:v,setCallbacks:s,allowPinchZoom:!!m,lockRef:n,gapMode:x}),i?g.cloneElement(g.Children.only(a),rt(rt({},P),{ref:C})):g.createElement(b,rt({},P,{className:c,ref:C}),a))});bu.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};bu.classNames={fullWidth:Uc,zeroRight:zc};var LW={left:0,top:0,right:0,gap:0},lf=function(e){return parseInt(e||"",10)||0},FW=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],r=t[e==="padding"?"paddingTop":"marginTop"],o=t[e==="padding"?"paddingRight":"marginRight"];return[lf(n),lf(r),lf(o)]},BW=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return LW;var t=FW(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},zW=Ms(),ys="data-scroll-locked",UW=function(e,t,n,r){var o=e.left,s=e.top,i=e.right,a=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(DW,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(ys,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zc,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Uc,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(zc," .").concat(zc,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Uc," .").concat(Uc,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(ys,`] {
    `).concat(NW,": ").concat(a,`px;
  }
`)},Bb=function(){var e=parseInt(document.body.getAttribute(ys)||"0",10);return isFinite(e)?e:0},VW=function(){g.useEffect(function(){return document.body.setAttribute(ys,(Bb()+1).toString()),function(){var e=Bb()-1;e<=0?document.body.removeAttribute(ys):document.body.setAttribute(ys,e.toString())}},[])},KW=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,o=r===void 0?"margin":r;VW();var s=g.useMemo(function(){return BW(o)},[o]);return g.createElement(zW,{styles:UW(s,!t,o,n?"":"!important")})},Sh=!1;if(typeof window<"u")try{var Cc=Object.defineProperty({},"passive",{get:function(){return Sh=!0,!0}});window.addEventListener("test",Cc,Cc),window.removeEventListener("test",Cc,Cc)}catch{Sh=!1}var Jo=Sh?{passive:!1}:!1,WW=function(e){return e.tagName==="TEXTAREA"},BP=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!WW(e)&&n[t]==="visible")},HW=function(e){return BP(e,"overflowY")},GW=function(e){return BP(e,"overflowX")},zb=function(e,t){var n=t.ownerDocument,r=t;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=zP(e,r);if(o){var s=UP(e,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},YW=function(e){var t=e.scrollTop,n=e.scrollHeight,r=e.clientHeight;return[t,n,r]},XW=function(e){var t=e.scrollLeft,n=e.scrollWidth,r=e.clientWidth;return[t,n,r]},zP=function(e,t){return e==="v"?HW(t):GW(t)},UP=function(e,t){return e==="v"?YW(t):XW(t)},qW=function(e,t){return e==="h"&&t==="rtl"?-1:1},ZW=function(e,t,n,r,o){var s=qW(e,window.getComputedStyle(t).direction),i=s*r,a=n.target,c=t.contains(a),l=!1,u=i>0,d=0,f=0;do{var p=UP(e,a),v=p[0],m=p[1],y=p[2],b=m-y-s*v;(v||b)&&zP(e,a)&&(d+=b,f+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(t.contains(a)||t===a));return(u&&Math.abs(d)<1||!u&&Math.abs(f)<1)&&(l=!0),l},Pc=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},Ub=function(e){return[e.deltaX,e.deltaY]},Vb=function(e){return e&&"current"in e?e.current:e},QW=function(e,t){return e[0]===t[0]&&e[1]===t[1]},JW=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},eH=0,es=[];function tH(e){var t=g.useRef([]),n=g.useRef([0,0]),r=g.useRef(),o=g.useState(eH++)[0],s=g.useState(Ms)[0],i=g.useRef(e);g.useEffect(function(){i.current=e},[e]),g.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(o));var m=$h([e.lockRef.current],(e.shards||[]).map(Vb),!0).filter(Boolean);return m.forEach(function(y){return y.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),m.forEach(function(y){return y.classList.remove("allow-interactivity-".concat(o))})}}},[e.inert,e.lockRef.current,e.shards]);var a=g.useCallback(function(m,y){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!i.current.allowPinchZoom;var b=Pc(m),x=n.current,w="deltaX"in m?m.deltaX:x[0]-b[0],S="deltaY"in m?m.deltaY:x[1]-b[1],C,P=m.target,E=Math.abs(w)>Math.abs(S)?"h":"v";if("touches"in m&&E==="h"&&P.type==="range")return!1;var _=zb(E,P);if(!_)return!0;if(_?C=E:(C=E==="v"?"h":"v",_=zb(E,P)),!_)return!1;if(!r.current&&"changedTouches"in m&&(w||S)&&(r.current=C),!C)return!0;var $=r.current||C;return ZW($,y,m,$==="h"?w:S)},[]),c=g.useCallback(function(m){var y=m;if(!(!es.length||es[es.length-1]!==s)){var b="deltaY"in y?Ub(y):Pc(y),x=t.current.filter(function(C){return C.name===y.type&&(C.target===y.target||y.target===C.shadowParent)&&QW(C.delta,b)})[0];if(x&&x.should){y.cancelable&&y.preventDefault();return}if(!x){var w=(i.current.shards||[]).map(Vb).filter(Boolean).filter(function(C){return C.contains(y.target)}),S=w.length>0?a(y,w[0]):!i.current.noIsolation;S&&y.cancelable&&y.preventDefault()}}},[]),l=g.useCallback(function(m,y,b,x){var w={name:m,delta:y,target:b,should:x,shadowParent:nH(b)};t.current.push(w),setTimeout(function(){t.current=t.current.filter(function(S){return S!==w})},1)},[]),u=g.useCallback(function(m){n.current=Pc(m),r.current=void 0},[]),d=g.useCallback(function(m){l(m.type,Ub(m),m.target,a(m,e.lockRef.current))},[]),f=g.useCallback(function(m){l(m.type,Pc(m),m.target,a(m,e.lockRef.current))},[]);g.useEffect(function(){return es.push(s),e.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:f}),document.addEventListener("wheel",c,Jo),document.addEventListener("touchmove",c,Jo),document.addEventListener("touchstart",u,Jo),function(){es=es.filter(function(m){return m!==s}),document.removeEventListener("wheel",c,Jo),document.removeEventListener("touchmove",c,Jo),document.removeEventListener("touchstart",u,Jo)}},[]);var p=e.removeScrollBar,v=e.inert;return g.createElement(g.Fragment,null,v?g.createElement(s,{styles:JW(o)}):null,p?g.createElement(KW,{gapMode:e.gapMode}):null)}function nH(e){for(var t=null;e!==null;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}const rH=Ah(FP,tH);var VP=g.forwardRef(function(e,t){return g.createElement(bu,rt({},e,{ref:t,sideCar:rH}))});VP.classNames=bu.classNames;var xh=["Enter"," "],oH=["ArrowDown","PageUp","Home"],KP=["ArrowUp","PageDown","End"],sH=[...oH,...KP],iH={ltr:[...xh,"ArrowRight"],rtl:[...xh,"ArrowLeft"]},aH={ltr:["ArrowLeft"],rtl:["ArrowRight"]},xa="Menu",[qi,cH,lH]=eu(xa),[Ro,WP]=dP(xa,[lH,xP,RP]),wa=xP(),HP=RP(),[GP,no]=Ro(xa),[uH,Ca]=Ro(xa),YP=e=>{const{__scopeMenu:t,open:n=!1,children:r,dir:o,onOpenChange:s,modal:i=!0}=e,a=wa(t),[c,l]=g.useState(null),u=g.useRef(!1),d=Qt(s),f=hP(o);return g.useEffect(()=>{const p=()=>{u.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>u.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),h.jsx($P,{...a,children:h.jsx(GP,{scope:t,open:n,onOpenChange:d,content:c,onContentChange:l,children:h.jsx(uH,{scope:t,onClose:g.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:f,modal:i,children:r})})})};YP.displayName=xa;var dH="MenuAnchor",Bg=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,o=wa(n);return h.jsx(pW,{...o,...r,ref:t})});Bg.displayName=dH;var zg="MenuPortal",[fH,XP]=Ro(zg,{forceMount:void 0}),qP=e=>{const{__scopeMenu:t,forceMount:n,children:r,container:o}=e,s=no(zg,t);return h.jsx(fH,{scope:t,forceMount:n,children:h.jsx(Sa,{present:n||s.open,children:h.jsx(AP,{asChild:!0,container:o,children:r})})})};qP.displayName=zg;var fn="MenuContent",[hH,Ug]=Ro(fn),ZP=g.forwardRef((e,t)=>{const n=XP(fn,e.__scopeMenu),{forceMount:r=n.forceMount,...o}=e,s=no(fn,e.__scopeMenu),i=Ca(fn,e.__scopeMenu);return h.jsx(qi.Provider,{scope:e.__scopeMenu,children:h.jsx(Sa,{present:r||s.open,children:h.jsx(qi.Slot,{scope:e.__scopeMenu,children:i.modal?h.jsx(pH,{...o,ref:t}):h.jsx(gH,{...o,ref:t})})})})}),pH=g.forwardRef((e,t)=>{const n=no(fn,e.__scopeMenu),r=g.useRef(null),o=yn(t,r);return g.useEffect(()=>{const s=r.current;if(s)return kl(s)},[]),h.jsx(Vg,{...e,ref:o,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:we(e.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),gH=g.forwardRef((e,t)=>{const n=no(fn,e.__scopeMenu);return h.jsx(Vg,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Vg=g.forwardRef((e,t)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:p,disableOutsideScroll:v,...m}=e,y=no(fn,n),b=Ca(fn,n),x=wa(n),w=HP(n),S=cH(n),[C,P]=g.useState(null),E=g.useRef(null),_=yn(t,E,y.onContentChange),$=g.useRef(0),T=g.useRef(""),M=g.useRef(0),O=g.useRef(null),j=g.useRef("right"),N=g.useRef(0),B=v?VP:g.Fragment,D=v?{as:Ng,allowPinchZoom:!0}:void 0,G=z=>{var Se,Ie;const W=T.current+z,Q=S().filter(de=>!de.disabled),oe=document.activeElement,se=(Se=Q.find(de=>de.ref.current===oe))==null?void 0:Se.textValue,ye=Q.map(de=>de.textValue),ee=IH(ye,W,se),be=(Ie=Q.find(de=>de.textValue===ee))==null?void 0:Ie.ref.current;(function de(Ee){T.current=Ee,window.clearTimeout($.current),Ee!==""&&($.current=window.setTimeout(()=>de(""),1e3))})(W),be&&setTimeout(()=>be.focus())};g.useEffect(()=>()=>window.clearTimeout($.current),[]),GK();const V=g.useCallback(z=>{var Q,oe;return j.current===((Q=O.current)==null?void 0:Q.side)&&TH(z,(oe=O.current)==null?void 0:oe.area)},[]);return h.jsx(hH,{scope:n,searchRef:T,onItemEnter:g.useCallback(z=>{V(z)&&z.preventDefault()},[V]),onItemLeave:g.useCallback(z=>{var W;V(z)||((W=E.current)==null||W.focus(),P(null))},[V]),onTriggerLeave:g.useCallback(z=>{V(z)&&z.preventDefault()},[V]),pointerGraceTimerRef:M,onPointerGraceIntentChange:g.useCallback(z=>{O.current=z},[]),children:h.jsx(B,{...D,children:h.jsx(yP,{asChild:!0,trapped:o,onMountAutoFocus:we(s,z=>{var W;z.preventDefault(),(W=E.current)==null||W.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:h.jsx(gP,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:f,onDismiss:p,children:h.jsx(RW,{asChild:!0,...w,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:C,onCurrentTabStopIdChange:P,onEntryFocus:we(c,z=>{b.isUsingKeyboardRef.current||z.preventDefault()}),preventScrollOnEntryFocus:!0,children:h.jsx(gW,{role:"menu","aria-orientation":"vertical","data-state":pE(y.open),"data-radix-menu-content":"",dir:b.dir,...x,...m,ref:_,style:{outline:"none",...m.style},onKeyDown:we(m.onKeyDown,z=>{const Q=z.target.closest("[data-radix-menu-content]")===z.currentTarget,oe=z.ctrlKey||z.altKey||z.metaKey,se=z.key.length===1;Q&&(z.key==="Tab"&&z.preventDefault(),!oe&&se&&G(z.key));const ye=E.current;if(z.target!==ye||!sH.includes(z.key))return;z.preventDefault();const be=S().filter(Se=>!Se.disabled).map(Se=>Se.ref.current);KP.includes(z.key)&&be.reverse(),EH(be)}),onBlur:we(e.onBlur,z=>{z.currentTarget.contains(z.target)||(window.clearTimeout($.current),T.current="")}),onPointerMove:we(e.onPointerMove,Zi(z=>{const W=z.target,Q=N.current!==z.clientX;if(z.currentTarget.contains(W)&&Q){const oe=z.clientX>N.current?"right":"left";j.current=oe,N.current=z.clientX}}))})})})})})})});ZP.displayName=fn;var mH="MenuGroup",Kg=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return h.jsx(kt.div,{role:"group",...r,ref:t})});Kg.displayName=mH;var yH="MenuLabel",QP=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return h.jsx(kt.div,{...r,ref:t})});QP.displayName=yH;var El="MenuItem",Kb="menu.itemSelect",Su=g.forwardRef((e,t)=>{const{disabled:n=!1,onSelect:r,...o}=e,s=g.useRef(null),i=Ca(El,e.__scopeMenu),a=Ug(El,e.__scopeMenu),c=yn(t,s),l=g.useRef(!1),u=()=>{const d=s.current;if(!n&&d){const f=new CustomEvent(Kb,{bubbles:!0,cancelable:!0});d.addEventListener(Kb,p=>r==null?void 0:r(p),{once:!0}),fP(d,f),f.defaultPrevented?l.current=!1:i.onClose()}};return h.jsx(JP,{...o,ref:c,disabled:n,onClick:we(e.onClick,u),onPointerDown:d=>{var f;(f=e.onPointerDown)==null||f.call(e,d),l.current=!0},onPointerUp:we(e.onPointerUp,d=>{var f;l.current||(f=d.currentTarget)==null||f.click()}),onKeyDown:we(e.onKeyDown,d=>{const f=a.searchRef.current!=="";n||f&&d.key===" "||xh.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})})});Su.displayName=El;var JP=g.forwardRef((e,t)=>{const{__scopeMenu:n,disabled:r=!1,textValue:o,...s}=e,i=Ug(El,n),a=HP(n),c=g.useRef(null),l=yn(t,c),[u,d]=g.useState(!1),[f,p]=g.useState("");return g.useEffect(()=>{const v=c.current;v&&p((v.textContent??"").trim())},[s.children]),h.jsx(qi.ItemSlot,{scope:n,disabled:r,textValue:o??f,children:h.jsx(jW,{asChild:!0,...a,focusable:!r,children:h.jsx(kt.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:l,onPointerMove:we(e.onPointerMove,Zi(v=>{r?i.onItemLeave(v):(i.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:we(e.onPointerLeave,Zi(v=>i.onItemLeave(v))),onFocus:we(e.onFocus,()=>d(!0)),onBlur:we(e.onBlur,()=>d(!1))})})})}),vH="MenuCheckboxItem",eE=g.forwardRef((e,t)=>{const{checked:n=!1,onCheckedChange:r,...o}=e;return h.jsx(sE,{scope:e.__scopeMenu,checked:n,children:h.jsx(Su,{role:"menuitemcheckbox","aria-checked":_l(n)?"mixed":n,...o,ref:t,"data-state":Gg(n),onSelect:we(o.onSelect,()=>r==null?void 0:r(_l(n)?!0:!n),{checkForDefaultPrevented:!1})})})});eE.displayName=vH;var tE="MenuRadioGroup",[bH,SH]=Ro(tE,{value:void 0,onValueChange:()=>{}}),nE=g.forwardRef((e,t)=>{const{value:n,onValueChange:r,...o}=e,s=Qt(r);return h.jsx(bH,{scope:e.__scopeMenu,value:n,onValueChange:s,children:h.jsx(Kg,{...o,ref:t})})});nE.displayName=tE;var rE="MenuRadioItem",oE=g.forwardRef((e,t)=>{const{value:n,...r}=e,o=SH(rE,e.__scopeMenu),s=n===o.value;return h.jsx(sE,{scope:e.__scopeMenu,checked:s,children:h.jsx(Su,{role:"menuitemradio","aria-checked":s,...r,ref:t,"data-state":Gg(s),onSelect:we(r.onSelect,()=>{var i;return(i=o.onValueChange)==null?void 0:i.call(o,n)},{checkForDefaultPrevented:!1})})})});oE.displayName=rE;var Wg="MenuItemIndicator",[sE,xH]=Ro(Wg,{checked:!1}),iE=g.forwardRef((e,t)=>{const{__scopeMenu:n,forceMount:r,...o}=e,s=xH(Wg,n);return h.jsx(Sa,{present:r||_l(s.checked)||s.checked===!0,children:h.jsx(kt.span,{...o,ref:t,"data-state":Gg(s.checked)})})});iE.displayName=Wg;var wH="MenuSeparator",aE=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e;return h.jsx(kt.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});aE.displayName=wH;var CH="MenuArrow",cE=g.forwardRef((e,t)=>{const{__scopeMenu:n,...r}=e,o=wa(n);return h.jsx(mW,{...o,...r,ref:t})});cE.displayName=CH;var Hg="MenuSub",[PH,lE]=Ro(Hg),uE=e=>{const{__scopeMenu:t,children:n,open:r=!1,onOpenChange:o}=e,s=no(Hg,t),i=wa(t),[a,c]=g.useState(null),[l,u]=g.useState(null),d=Qt(o);return g.useEffect(()=>(s.open===!1&&d(!1),()=>d(!1)),[s.open,d]),h.jsx($P,{...i,children:h.jsx(GP,{scope:t,open:r,onOpenChange:d,content:l,onContentChange:u,children:h.jsx(PH,{scope:t,contentId:vh(),triggerId:vh(),trigger:a,onTriggerChange:c,children:n})})})};uE.displayName=Hg;var Ei="MenuSubTrigger",dE=g.forwardRef((e,t)=>{const n=no(Ei,e.__scopeMenu),r=Ca(Ei,e.__scopeMenu),o=lE(Ei,e.__scopeMenu),s=Ug(Ei,e.__scopeMenu),i=g.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,l={__scopeMenu:e.__scopeMenu},u=g.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return g.useEffect(()=>u,[u]),g.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),c(null)}},[a,c]),h.jsx(Bg,{asChild:!0,...l,children:h.jsx(JP,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":o.contentId,"data-state":pE(n.open),...e,ref:Dg(t,o.onTriggerChange),onClick:d=>{var f;(f=e.onClick)==null||f.call(e,d),!(e.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:we(e.onPointerMove,Zi(d=>{s.onItemEnter(d),!d.defaultPrevented&&!e.disabled&&!n.open&&!i.current&&(s.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:we(e.onPointerLeave,Zi(d=>{var p,v;u();const f=(p=n.content)==null?void 0:p.getBoundingClientRect();if(f){const m=(v=n.content)==null?void 0:v.dataset.side,y=m==="right",b=y?-5:5,x=f[y?"left":"right"],w=f[y?"right":"left"];s.onPointerGraceIntentChange({area:[{x:d.clientX+b,y:d.clientY},{x,y:f.top},{x:w,y:f.top},{x:w,y:f.bottom},{x,y:f.bottom}],side:m}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(d),d.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:we(e.onKeyDown,d=>{var p;const f=s.searchRef.current!=="";e.disabled||f&&d.key===" "||iH[r.dir].includes(d.key)&&(n.onOpenChange(!0),(p=n.content)==null||p.focus(),d.preventDefault())})})})});dE.displayName=Ei;var fE="MenuSubContent",hE=g.forwardRef((e,t)=>{const n=XP(fn,e.__scopeMenu),{forceMount:r=n.forceMount,...o}=e,s=no(fn,e.__scopeMenu),i=Ca(fn,e.__scopeMenu),a=lE(fE,e.__scopeMenu),c=g.useRef(null),l=yn(t,c);return h.jsx(qi.Provider,{scope:e.__scopeMenu,children:h.jsx(Sa,{present:r||s.open,children:h.jsx(qi.Slot,{scope:e.__scopeMenu,children:h.jsx(Vg,{id:a.contentId,"aria-labelledby":a.triggerId,...o,ref:l,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;i.isUsingKeyboardRef.current&&((d=c.current)==null||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:we(e.onFocusOutside,u=>{u.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:we(e.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:we(e.onKeyDown,u=>{var p;const d=u.currentTarget.contains(u.target),f=aH[i.dir].includes(u.key);d&&f&&(s.onOpenChange(!1),(p=a.trigger)==null||p.focus(),u.preventDefault())})})})})})});hE.displayName=fE;function pE(e){return e?"open":"closed"}function _l(e){return e==="indeterminate"}function Gg(e){return _l(e)?"indeterminate":e?"checked":"unchecked"}function EH(e){const t=document.activeElement;for(const n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function _H(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function IH(e,t,n){const o=t.length>1&&Array.from(t).every(l=>l===t[0])?t[0]:t,s=n?e.indexOf(n):-1;let i=_H(e,Math.max(s,0));o.length===1&&(i=i.filter(l=>l!==n));const c=i.find(l=>l.toLowerCase().startsWith(o.toLowerCase()));return c!==n?c:void 0}function kH(e,t){const{x:n,y:r}=e;let o=!1;for(let s=0,i=t.length-1;s<t.length;i=s++){const a=t[s].x,c=t[s].y,l=t[i].x,u=t[i].y;c>r!=u>r&&n<(l-a)*(r-c)/(u-c)+a&&(o=!o)}return o}function TH(e,t){if(!t)return!1;const n={x:e.clientX,y:e.clientY};return kH(n,t)}function Zi(e){return t=>t.pointerType==="mouse"?e(t):void 0}var $H=YP,AH=Bg,MH=qP,OH=ZP,RH=Kg,jH=QP,DH=Su,NH=eE,LH=nE,FH=oE,BH=iE,zH=aE,UH=cE,VH=uE,KH=dE,WH=hE,Yg="ContextMenu",[HH,aq]=dP(Yg,[WP]),bt=WP(),[GH,gE]=HH(Yg),mE=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,dir:o,modal:s=!0}=e,[i,a]=g.useState(!1),c=bt(t),l=Qt(r),u=g.useCallback(d=>{a(d),l(d)},[l]);return h.jsx(GH,{scope:t,open:i,onOpenChange:u,modal:s,children:h.jsx($H,{...c,dir:o,open:i,onOpenChange:u,modal:s,children:n})})};mE.displayName=Yg;var yE="ContextMenuTrigger",vE=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,disabled:r=!1,...o}=e,s=gE(yE,n),i=bt(n),a=g.useRef({x:0,y:0}),c=g.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=g.useRef(0),u=g.useCallback(()=>window.clearTimeout(l.current),[]),d=f=>{a.current={x:f.clientX,y:f.clientY},s.onOpenChange(!0)};return g.useEffect(()=>u,[u]),g.useEffect(()=>void(r&&u()),[r,u]),h.jsxs(h.Fragment,{children:[h.jsx(AH,{...i,virtualRef:c}),h.jsx(kt.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...o,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:we(e.onContextMenu,f=>{u(),d(f),f.preventDefault()}),onPointerDown:r?e.onPointerDown:we(e.onPointerDown,Ec(f=>{u(),l.current=window.setTimeout(()=>d(f),700)})),onPointerMove:r?e.onPointerMove:we(e.onPointerMove,Ec(u)),onPointerCancel:r?e.onPointerCancel:we(e.onPointerCancel,Ec(u)),onPointerUp:r?e.onPointerUp:we(e.onPointerUp,Ec(u))})]})});vE.displayName=yE;var YH="ContextMenuPortal",bE=e=>{const{__scopeContextMenu:t,...n}=e,r=bt(t);return h.jsx(MH,{...r,...n})};bE.displayName=YH;var SE="ContextMenuContent",xE=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=gE(SE,n),s=bt(n),i=g.useRef(!1);return h.jsx(OH,{...s,...r,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=e.onCloseAutoFocus)==null||c.call(e,a),!a.defaultPrevented&&i.current&&a.preventDefault(),i.current=!1},onInteractOutside:a=>{var c;(c=e.onInteractOutside)==null||c.call(e,a),!a.defaultPrevented&&!o.modal&&(i.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});xE.displayName=SE;var XH="ContextMenuGroup",wE=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(RH,{...o,...r,ref:t})});wE.displayName=XH;var qH="ContextMenuLabel",ZH=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(jH,{...o,...r,ref:t})});ZH.displayName=qH;var QH="ContextMenuItem",CE=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(DH,{...o,...r,ref:t})});CE.displayName=QH;var JH="ContextMenuCheckboxItem",PE=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(NH,{...o,...r,ref:t})});PE.displayName=JH;var eG="ContextMenuRadioGroup",tG=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(LH,{...o,...r,ref:t})});tG.displayName=eG;var nG="ContextMenuRadioItem",rG=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(FH,{...o,...r,ref:t})});rG.displayName=nG;var oG="ContextMenuItemIndicator",sG=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(BH,{...o,...r,ref:t})});sG.displayName=oG;var iG="ContextMenuSeparator",aG=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(zH,{...o,...r,ref:t})});aG.displayName=iG;var cG="ContextMenuArrow",lG=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(UH,{...o,...r,ref:t})});lG.displayName=cG;var uG="ContextMenuSub",EE=e=>{const{__scopeContextMenu:t,children:n,onOpenChange:r,open:o,defaultOpen:s}=e,i=bt(t),[a,c]=MP({prop:o,defaultProp:s,onChange:r});return h.jsx(VH,{...i,open:a,onOpenChange:c,children:n})};EE.displayName=uG;var dG="ContextMenuSubTrigger",_E=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(KH,{...o,...r,ref:t})});_E.displayName=dG;var fG="ContextMenuSubContent",IE=g.forwardRef((e,t)=>{const{__scopeContextMenu:n,...r}=e,o=bt(n);return h.jsx(WH,{...o,...r,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});IE.displayName=fG;function Ec(e){return t=>t.pointerType!=="mouse"?e(t):void 0}var hG=mE,pG=vE,Il=bE,gG=xE,wh=wE,Ch=CE,mG=PE,kE=EE,TE=_E,$E=IE;const yG=Te(function(){const t=U(),n=ut(),r=t.getPages(),o=t.getCurrentPageId(),s=Ce(),{addToast:i}=Gn();return h.jsxs(kE,{children:[h.jsx(TE,{dir:"ltr",asChild:!0,children:h.jsx(te,{type:"menu",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),h.jsx(Il,{container:n,children:h.jsxs($E,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[h.jsx(wh,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:r.map(a=>h.jsx(Ch,{disabled:o===a.id,onSelect:()=>{t.mark("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),a.id);const c=t.getPage(a.id);c&&i({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.mark("change-page"),t.setCurrentPage(o)}}]})},asChild:!0,children:h.jsx(te,{type:"menu",title:a.name,className:"tlui-context-menu__move-to-page__name",children:h.jsx("span",{className:"tlui-button__label",children:a.name})})},a.id))},"pages"),h.jsx(wh,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:h.jsx(Ch,{onSelect:()=>{const a=Lr.createId(),c=t.getSelectedShapeIds();t.batch(()=>{t.mark("move_shapes_to_page"),t.createPage({name:s("page-menu.new-page-initial-name"),id:a}),t.moveShapesToPage(c,a)})},asChild:!0,children:h.jsx(te,{type:"menu",title:s("context.pages.new-page"),className:"tlui-context-menu__move-to-page__name",children:h.jsx("span",{className:"tlui-button__label",children:s("context.pages.new-page")})})},"new-page")},"new-page")]})})]})}),cq=function({children:t}){const n=U(),r=n1(),o=g.useCallback(f=>{if(f){if(n.getInstanceState().isCoarsePointer){const p=n.getSelectedShapes(),{inputs:{currentPagePoint:v}}=n,m=n.getShapesAtPoint(v);if(!n.getSelectedShapes().length||!m.some(y=>p.includes(y))){const y=m.filter(b=>n.isShapeOrAncestorLocked(b));y.length&&n.select(...y.map(b=>b.id))}}}else{const p=n.getOnlySelectedShape();p&&n.isShapeOrAncestorLocked(p)&&n.setSelectedShapes([])}},[n]),s=ut(),[i,a]=Oo("context menu",o),c=gn(),l=r.length===0||c&&r.every(f=>!f.readonlyOk),d=!Y("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n])||l;return h.jsxs(hG,{dir:"ltr",onOpenChange:a,children:[h.jsx(pG,{onContextMenu:d?_e:void 0,dir:"ltr",disabled:d,children:t}),h.jsx(Il,{container:s,children:h.jsx(vG,{})})]})},vG=g.forwardRef(function(){const t=U(),n=Ce(),r=n1(),[o,s]=Oo("context menu sub"),i=gn(),a=mn(),c=ut(),[l,u]=g.useState(!1);function d(f,p,v,m){if(!p||i&&!p.readonlyOk)return null;switch(p.type){case"custom":{switch(p.id){case"MOVE_TO_PAGE_MENU":return h.jsx(yG,{},p.id)}break}case"group":return h.jsx(wh,{dir:"ltr",className:ue("tlui-menu__group",{"tlui-menu__group__small":(v==null?void 0:v.type)==="submenu"}),"data-testid":`menu-item.${p.id}`,children:p.children.map(y=>d(f,y,p,m+1))},p.id);case"submenu":return h.jsxs(kE,{onOpenChange:s,children:[h.jsx(TE,{dir:"ltr",disabled:p.disabled,asChild:!0,children:h.jsx(te,{type:"menu",label:p.label,"data-testid":`menu-item.${p.id}`,icon:"chevron-right"})}),h.jsx(Il,{container:c,children:h.jsx($E,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:p.children.map(y=>d(f,y,p,m+1))})})]},p.id);case"item":{if(i&&!p.readonlyOk)return null;const{id:y,checkbox:b,contextMenuLabel:x,label:w,onSelect:S,kbd:C,icon:P}=p.actionItem;let E=x??w;y==="toggle-lock"&&(E=f.isShapeOrAncestorLocked(f.getSelectedShapes()[0])?"action.unlock":"action.lock");const _=E?n(E):void 0;return b?h.jsxs(mG,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",disabled:p.disabled,onSelect:$=>{S("context-menu"),_e($)},title:_||void 0,checked:p.checked,children:[h.jsx(Yt,{small:!0,icon:p.checked?"check":"checkbox-empty"}),_&&h.jsx("span",{className:"tlui-button__label",draggable:!1,children:_}),C&&h.jsx(ru,{children:C})]},y):h.jsx(Ch,{dir:"ltr",asChild:!0,children:h.jsx(te,{type:"menu","data-testid":`menu-item.${y}`,kbd:C,label:E,disabled:p.disabled,iconLeft:a<3&&m>2?P:void 0,onClick:()=>{l?u(!1):S("context-menu")}})},y)}}}return h.jsx(Il,{container:c,children:h.jsx(gG,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:_e,children:r.map(f=>d(t,f,null,0))})})});ge({tldrawFileFormatVersion:qI,schema:ge({schemaVersion:Ra,storeVersion:Ra,recordVersions:bs(q,ge({version:Ra,subTypeVersions:bs(q,Ra).optional(),subTypeKey:q.optional()}))}),records:Ze(ge({id:q,typeName:q}).allowUnknownProperties())});const Wb="Invariant failed";function Ph(e,t){if(e)return;const n=typeof t=="function"?t():t,r=n?`${Wb}: ${n}`:Wb;throw new Error(r)}async function bG(e,t,n){const r=ku.info(e,{...n,progress:0});let o=0;for(const s of t)s instanceof Promise&&s.finally(()=>{o++,ku.update(r,{progress:o/t.length})});try{return await Promise.all(t)}finally{ku.dismiss(r)}}function AE(e,t){const n=W_(t);Ph(n,"Media has no url");const r=Ol.createId(t.id);return e.createAssets([{id:r,type:"image",typeName:"asset",props:{name:"Generated Image "+r,src:n,w:t.width??0,h:t.height??0,mimeType:t.imageType||"image/png",isAnimated:!1},meta:{mediaId:t.id,media:t}}]),new Image().src=n,r}async function lq(e,t){return(await bG("Loading images...",H_(t).map(r=>G_.getMedia({id:r})))).map(({media:r})=>r).filter(r=>r!=null).map(r=>AE(e,r))}function SG(){let e=null;const t=[],n=s=>{e?s(e):t.push(s)};return{get editor(){return e},set editor(s){if(e!==s&&(e=s,e)){for(const i of t)try{i(e)}catch(a){console.error(a)}t.length=0}},queueOp:n,setBaseImageFromMedia:(s,{task:i,cate:a}={})=>n(c=>{const l=Ln(),u=AE(c,s);c.deleteShapes([...c.getCurrentPageShapeIds()]).createShape({id:l,type:"genmedia",x:0,y:0,props:{w:s.width??0,h:s.height??0,prompts:(i==null?void 0:i.parameters.prompts)||null,currentAssetId:u,assetIds:[u],pending:null},meta:{generationTask:JSON.parse(JSON.stringify(i??null)),pixai_isBaseImage:!0}}).select(l).zoomToBounds(c.getShapePageBounds(l)),Vc("panel_image_import",{scene:"fill",cate:a})}),setBaseImageFromFile:(s,{cate:i}={})=>n(async a=>{const c=Ln(),l=await a.getAssetForExternalContent({type:"file",file:s});Ph(l,"Failed to get asset for file"),Ph(l.type==="image","Asset type is not an image"),a.deleteShapes([...a.getCurrentPageShapeIds()]).createAssets([l]).createShape({id:c,type:"image",x:0,y:0,props:{w:l.props.w??0,h:l.props.h??0,assetId:l.id},meta:{pixai_isBaseImage:!0}}).select(c).zoomToBounds(a.getShapePageBounds(c)),Vc("panel_image_import",{scene:"fill",cate:i})})}}const[xG,uq]=Yr([]);xG.displayName="GeneratedItemsContext";const[wG,dq]=Yr({});wG.displayName="SelectedTaskContext";const[CG,fq]=Yr(void 0);CG.displayName="HoveredItemContext";const[PG,hq]=Yr({open:!1});PG.displayName="OpenHistoryPanelContext";const[pq,gq]=Yr({showEditor:!1,isInpaintOn:!1,dirty:!1}),[mq,yq]=Yr(void 0),[vq,bq]=Yr(!1),EG=g.createContext({current:SG()});EG.displayName="FillEditorContext";const[Sq,xq]=Yr({inputPrompts:"",originalPrompts:""});function wq(e){return X_(e).with("editor",()=>$r.Fill).with("enhancement",()=>$r.EnhanceImage).with("animation",()=>$r.ImageToVideo).otherwise(()=>$r.Generate)}function _G(e){switch(e){case $r.Fill:return"//pixai/editor";case $r.EnhanceImage:return"//pixai/enhancement";case $r.ImageToVideo:return"//pixai/animation";default:return"//pixai"}}var Hb;(function(e){e.Image="image",e.Realtime="realtime",e.Manga="manga",e.AnimatedComic="animated-comic",e.Workflow="workflow",e.Upscaler="upscaler",e.ImageStitching="image-sticthing"})(Hb||(Hb={}));const[Cq,Pq]=tI((e,t)=>{var n;switch(t.type){case"set-mode":return(n=e.navigate)==null||n.call(e,_G(t.value)),e;case"set-mode-value":return{...e,mode:t.value};case"set-type":return{...e,type:t.value}}throw new Error(`Unknown action type ${t.type}`)},{navigate:void 0,mode:$r.Generate,type:"image"}),IG=Y_([]),Eq=()=>{const e=q_(IG);function t(s){e(i=>{const a=i.slice(),c=a.findIndex(l=>l.id===s.id);return c>=0?a.splice(c,1,s):a.push(s),a})}function n(s,i){e(a=>{const c=a.slice(),l=c.findIndex(u=>u.id===s);if(l>=0){const u=a[l],d=i(u);c.splice(l,1,d)}return c})}function r(s){e(i=>{const a=i.slice(),c=a.findIndex(l=>l.id===s);return c>=0&&a.splice(c,1),a})}function o(s,i){const a=i.type==="favorite"?"favoritedAt":"deletedAt";return!i.mediaId&&i.type==="delete"&&i.target?r(s):n(s,c=>{if(i.mediaId&&c.outputs.batch){const l=[...c.outputs.batch],u=l.findIndex(d=>d.mediaId===i.mediaId);return u>=0?(l[u][a]=i.target?new Date().toISOString():void 0,{...c,outputs:{...c.outputs,batch:l}}):c}return{...c,[a]:i.target?new Date().toISOString():void 0}})}return{setTask:t,updateTask:n,updateTaskFavoriteDelete:o}},kG=g.createContext({current:null});function _q(e){const t=g.useRef({});return h.jsx(kG.Provider,{value:t,children:e.children})}const TG=e=>h.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:h.jsxs("g",{fill:"currentColor",children:[h.jsx("path",{fillRule:"evenodd",d:"M2.774 12.481a.759.759 0 0 1 0 1.074l-.156.155a.34.34 0 0 0 0 .48a.34.34 0 0 0 .483 0l1.713-1.71a.76.76 0 0 1 1.072 1.075l-1.712 1.71a1.86 1.86 0 0 1-2.629 0a1.857 1.857 0 0 1 0-2.629l.156-.155a.76.76 0 0 1 1.073 0Zm4.913 1.009a.76.76 0 0 1 0 1.073l-2.143 2.143a.76.76 0 0 1-1.073-1.074l2.142-2.142a.76.76 0 0 1 1.074 0Zm2.809 2.805a.76.76 0 0 1 0 1.074l-2.128 2.128a.76.76 0 0 1-1.073-1.074l2.127-2.128a.76.76 0 0 1 1.074 0Zm-3.199.401c.293.3.288.78-.012 1.073l-1.73 1.692a.759.759 0 0 1-1.061-1.085l1.73-1.692a.759.759 0 0 1 1.073.012Zm4.184 1.422a.76.76 0 0 1 0 1.074l-1.713 1.71a.34.34 0 0 0 0 .48c.134.133.35.133.484 0l.156-.155A.759.759 0 0 1 11.48 22.3l-.155.155a1.86 1.86 0 0 1-2.63 0a1.857 1.857 0 0 1 0-2.629l1.713-1.71a.759.759 0 0 1 1.073.001Z",clipRule:"evenodd"}),h.jsx("path",{d:"M10.846 5.41L8.66 7.59c-.402.401-.771.769-1.063 1.101a5.23 5.23 0 0 0-.532.706l-.021-.022l-.081-.08a4.178 4.178 0 0 0-1.318-.864l-.106-.043l-.326-.129a.658.658 0 0 1-.223-1.077c.963-.961 2.12-2.114 2.679-2.346a2.907 2.907 0 0 1 1.537-.197c.47.07.915.311 1.641.77Zm3.736 11.483c.176.18.293.305.399.44c.14.179.265.368.373.567c.123.223.218.462.408.939c.155.388.67.491.969.193l.072-.072c.963-.96 2.12-2.114 2.353-2.671c.205-.49.273-1.021.197-1.533c-.07-.468-.312-.912-.772-1.636l-2.195 2.189c-.411.41-.788.786-1.13 1.08a5.164 5.164 0 0 1-.674.504Z"}),h.jsx("path",{fillRule:"evenodd",d:"m15.502 14.367l5.03-5.014c.724-.722 1.087-1.083 1.277-1.543C22 7.351 22 6.84 22 5.82v-.49c0-1.57 0-2.355-.49-2.843C21.022 2 20.235 2 18.659 2h-.489c-1.024 0-1.537 0-1.997.19c-.46.19-.823.551-1.547 1.274l-5.03 5.014c-.846.844-1.371 1.367-1.574 1.873c-.064.16-.097.317-.097.483c0 .69.557 1.245 1.671 2.356l.15.149l1.754-1.78a.645.645 0 0 1 .919.906l-1.76 1.785l.119.117c1.114 1.11 1.67 1.666 2.362 1.666c.153 0 .3-.027.447-.081c.519-.191 1.048-.72 1.916-1.585Zm2.363-5.888c-.652.65-1.71.65-2.363 0a1.662 1.662 0 0 1 0-2.356c.653-.65 1.71-.65 2.363 0s.653 1.705 0 2.356Z",clipRule:"evenodd"})]})}),$G=e=>{const{t}=Oh(["growth"]),{className:n,surveyUrl:r}=e,o=t("growth:generation.click-for-credits.new-survey.label");return r?h.jsx("a",{href:r,className:At("text-sm",n),target:"_blank",rel:"noreferrer",children:o}):null};function AG({className:e,style:t}){const{t:n}=Oh(["growth"]),r=n("growth:generation.events.label",{defaultValue:" ",context:"short"}).trim(),o=n("growth:generation.click-for-credits.new-survey.link",{defaultValue:" "}).trim(),s=iI(o);if(!r)return null;const i=h.jsxs("div",{className:"p-4 flex flex-col prose dark:prose-invert",children:[h.jsx("h3",{children:n(s?"growth:generation.click-for-credits.new-survey.title":"growth:generation.click-for-credits.title")}),h.jsx("p",{className:"whitespace-pre-wrap",children:n(s?"growth:generation.click-for-credits.new-survey.content":"growth:generation.click-for-credits.content")})]});return h.jsx("div",{className:At("flex items-center gap-1 py-1 bg-background-secondary border border-black/50 dark:border-white/50 transition duration-75 max-mlg:self-start",s?"rounded-md":"cursor-help rounded-full",e),style:t,children:h.jsx(Z_,{className:"w-full !justify-start",trigger:s?h.jsxs("div",{className:"font-quicksand flex items-center gap-1 text-orange-600 dark:text-orange-500 py-[3px] px-2 underline",children:[h.jsx($G,{surveyUrl:o,className:"font-bold no-underline"}),h.jsx(Q_,{className:"size-5"})]}):r?h.jsxs("h2",{className:"inline-flex items-center gap-1 font-quicksand py-[3px] px-3",children:[h.jsx(TG,{}),r]}):null,children:i})})}const Gb={"purple-pink":{wrapper:At("ring-violet-600 hover:ring-violet-700 bg-background-secondary pl-1 py-[2px] rounded-lg p-[2px]"),meter:At("[&>span>svg>path]:fill-[url(#member-purple-pink-gradient)]")},monochrome:{wrapper:At("ring-neutral-300 hover:ring-neutral-600 rounded p-px"),meter:At("hover:bg-black/10 dark:hover:bg-white/10")}};function MG({className:e,style:t,onClick:n,variant:r="monochrome",...o}){const{t:s}=Oh(["action"]),{data:i}=Eh(),{data:a,isValidating:c}=J_(),l=!i;return h.jsxs("span",{className:At("inline-flex gap-px hover:ring-1 group",Gb[r].wrapper,e),style:t,children:[h.jsx(eI,{as:qb,to:i?`/@${i.username}/credits`:"",target:"_blank",value:a,updating:c,className:At("flex-none h-6 px-1 flex items-center no-underline  rounded-[3px] transition",Gb[r].meter,l&&"pointer-events-none"),...o,onClick:(...u)=>{Vc("credit_balance_click"),n==null||n(...u)}}),!l&&r==="monochrome"&&h.jsx("button",{className:"flex-none w-6 h-6 -ml-1 flex justify-center items-center hover:bg-theme-primary text-neutral-500 dark:text-neutral-400 hover:!text-white rounded-[3px] transition",onClick:()=>{hm({scene:"gen-plan",trackingLocation:"gen-plan",defaultMode:"packs"})},children:h.jsx(pm,{className:"w-5 h-5"})}),!l&&r==="purple-pink"&&h.jsxs("button",{className:"flex justify-center items-center bg-gradient-purple-pink text-white text-xs font-medium px-1 mlg:px-3 rounded-md transition",onClick:()=>{hm({scene:"gen-plan",trackingLocation:"gen-plan",defaultMode:"packs"})},children:[h.jsx("span",{className:"hidden mlg:inline",children:s("action:manage")}),h.jsx(pm,{className:"size-4 inline mlg:hidden"})]})]})}const OG=e=>h.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:h.jsx("path",{fill:"currentColor",d:"M22 12c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2s10 4.477 10 10m-7.97-4.53a.75.75 0 0 0-1.06 0l-4 4a.75.75 0 0 0 0 1.06l4 4a.75.75 0 1 0 1.06-1.06L10.56 12l3.47-3.47a.75.75 0 0 0 0-1.06"})}),RG={"workbench-layout":"_workbench-layout_noywb_1"};function Iq({scene:e,headerSlot:t,main:n,left:r,right:o,children:s,mainProps:i}){return h.jsxs(jG,{scene:e,headerSlot:t,children:[r&&h.jsx("div",{className:"hidden mlg:flex flex-col mlg:overflow-hidden",style:{gridArea:"left"},children:r}),n&&h.jsx("main",{className:At("relative flex flex-col",i==null?void 0:i.className),style:{gridArea:"main",gridColumnStart:r?2:1,gridColumnEnd:o?-2:-1,...i==null?void 0:i.style},children:n}),o&&h.jsx("div",{className:"flex flex-col mlg:border-l border-neutral-300 dark:border-neutral-700 mlg:overflow-hidden",style:{gridArea:"right"},children:o}),s]})}function jG({scene:e,headerSlot:t,children:n}){return h.jsxs("div",{id:"workbench-layout",className:At(RG["workbench-layout"],"mlg:h-screen min-h-screen grid text-sm text-[var(--fg-color)] bg-[var(--bg-color)] overflow-visible mlg:overflow-hidden","relative z-0"),children:[h.jsx(DG,{scene:e,className:"bg-background backdrop-blur-lg border-b border-neutral-100 dark:border-neutral-700",style:{gridArea:"header"},children:t}),n,h.jsx("div",{id:"workbench-layout-overlays",className:"fixed top-0 left-0 z-20 w-full h-0"})]})}function DG({scene:e,className:t,style:n,children:r}){const{data:o}=Eh();return h.jsxs("div",{className:At("sticky top-0 z-30",t),style:n,children:[h.jsx(rI,{}),h.jsxs("header",{className:"relative h-12 pr-3 mlg:pr-4 flex items-center gap-2 mlg:gap-4 overflow-auto",children:[h.jsx(NG,{scene:e}),h.jsx("div",{className:"ml-9 mlg:ml-[40px] flex items-center",children:r}),h.jsx("div",{className:"flex-1"}),o&&h.jsx(MG,{variant:"purple-pink",className:"relative md:absolute md:right-[50%] md:translate-x-[50%]"}),o&&h.jsx(AG,{className:"max-mlg:hidden"}),o&&h.jsx(oI,{}),h.jsx(sI,{})]})]})}function NG(e){return h.jsxs(qb,{to:"/",className:"absolute flex-none h-full px-2 md:px-4 grid items-center gap-2 no-underline hover:bg-black/5 group",onClick:()=>{Vc("panel_home_select",{scene:e.scene})},children:[h.jsx("span",{className:"contents group-hover:invisible",children:h.jsx(aI,{className:"row-start-1 col-start-1 size-7 dark:invert"})}),h.jsx("span",{className:"contents invisible group-hover:visible w-full",children:h.jsx(OG,{className:"row-start-1 col-start-1 size-7"})})]})}function kq(e){const[t,n]=g.useState(!1),r=e.items.find(i=>i.value===e.value),[o,s]=g.useState(null);return g.useEffect(()=>{s(document.getElementById("workbench-layout-overlays")??document.body)},[]),h.jsxs(Sg,{open:t,onOpenChange:()=>n(i=>!i),children:[h.jsxs(Ts,{className:At("inline-flex items-center px-3 mlg:px-4 py-2 font-normal rounded-md text-lg outline-violet-600",e.className),style:e.style,children:[((r==null?void 0:r.label)??e.value)||" ",h.jsx(cI,{className:At("mlg:ml-2 -mr-2 size-6 transition-transform text-neutral-500","rotate-90 mlg:rotate-0",t&&"mlg:rotate-90")})]}),h.jsx(pu,{container:o,children:h.jsx(xg,{sideOffset:4,className:"flex flex-col gap-5 p-5 bg-white dark:bg-background rounded-xl shadow-lg",children:e.items.map(({value:i,label:a,icon:c,className:l,style:u})=>h.jsxs(ho,{"data-current":i===e.value||null,className:At("-m-2 flex items-center gap-3 p-2 data-[current]:text-purple-600 dark:data-[current]:text-purple-500 hover:bg-black/10 dark:hover:bg-white/10 rounded cursor-pointer",l),style:u,onClick:()=>{var d;(d=e.onChange)==null||d.call(e,i)},children:[c,a]},i))})})]})}function Tq(e){const t=g.useRef(null);if(!t.current){const n=document.getElementById("workbench-layout-overlays");n&&(t.current=n)}return t.current?Eo.createPortal(e.children,document.getElementById("workbench-layout-overlays")):(console.warn("Rendering null due to Portal Container not found."),null)}export{M1 as $,fq as A,Pq as B,Iq as C,JX as D,MB as E,EG as F,xG as G,CG as H,pq as I,mg as J,pg as K,mq as L,kq as M,ag as N,cg as O,lg as P,sg as Q,ug as R,wG as S,gg as T,ig as U,rq as V,Tq as W,nq as X,Rn as Y,k as Z,tX as _,Eq as a,L as a$,xt as a0,$t as a1,$c as a2,Ln as a3,qG as a4,$I as a5,U as a6,Y as a7,zl as a8,ap as a9,vo as aA,Vk as aB,Ns as aC,KT as aD,Bn as aE,QG as aF,ts as aG,Xm as aH,ze as aI,Dm as aJ,ds as aK,IY as aL,kY as aM,Bf as aN,dX as aO,Ev as aP,lx as aQ,Ul as aR,fo as aS,Or as aT,fX as aU,oX as aV,iX as aW,zn as aX,rX as aY,sX as aZ,sx as a_,wT as aa,He as ab,aR as ac,ax as ad,Pf as ae,ce as af,eX as ag,Ll as ah,s5 as ai,l5 as aj,c5 as ak,Br as al,$S as am,ue as an,JT as ao,je as ap,XG as aq,ie as ar,JY as as,Sf as at,Ql as au,XY as av,Es as aw,QY as ax,Dn as ay,Tr as az,Cq as b,FX as b$,Jt as b0,hX as b1,oR as b2,Dl as b3,en as b4,_s as b5,ZG as b6,JG as b7,eY as b8,cx as b9,rY as bA,oY as bB,sY as bC,iY as bD,z5 as bE,aY as bF,cY as bG,U5 as bH,uX as bI,mX as bJ,RY as bK,jY as bL,ZY as bM,SX as bN,Sw as bO,pl as bP,hl as bQ,Jl as bR,Ow as bS,Mw as bT,kX as bU,zX as bV,OX as bW,wX as bX,jX as bY,$X as bZ,_X as b_,yX as ba,rR as bb,Nh as bc,o5 as bd,cn as be,ln as bf,GY as bg,gY as bh,mY as bi,cR as bj,Fh as bk,x5 as bl,Cx as bm,$Y as bn,AY as bo,Ap as bp,_5 as bq,wx as br,TY as bs,y5 as bt,tY as bu,nY as bv,vX as bw,MY as bx,OY as by,or as bz,f1 as c,qY as c$,PX as c0,NX as c1,AX as c2,BX as c3,IX as c4,MX as c5,LX as c6,EX as c7,DX as c8,CX as c9,HX as cA,GX as cB,UY as cC,VY as cD,bY as cE,SY as cF,xY as cG,wY as cH,CY as cI,PY as cJ,EY as cK,_Y as cL,KY as cM,WY as cN,bw as cO,Ct as cP,Ed as cQ,Td as cR,kd as cS,Gu as cT,nX as cU,Sn as cV,fe as cW,CT as cX,FM as cY,BM as cZ,HY as c_,RX as ca,xX as cb,TX as cc,lY as cd,uY as ce,DY as cf,NY as cg,lX as ch,LY as ci,FY as cj,BY as ck,zY as cl,Tc as cm,bX as cn,TM as co,yY as cp,vY as cq,dY as cr,fY as cs,Rw as ct,WX as cu,VX as cv,UX as cw,KX as cx,hY as cy,pY as cz,o9 as d,YY as d0,CM as d1,Lt as d2,Lr as d3,h6 as d4,YX as d5,Ol as d6,TI as d7,Pd as d8,gX as d9,pX as da,cX as db,qX as dc,tR as dd,eR as de,aX as df,iq as dg,cq as dh,ZS as di,Ph as dj,K0 as dk,Te as dl,Zh as dm,ai as dn,mo as dp,kS as dq,IK as dr,a8 as ds,lq as dt,s9 as e,Sg as f,Ts as g,pu as h,xg as i,ho as j,vz as k,wq as l,IG as m,vq as n,kG as o,xq as p,SG as q,jG as r,Hb as s,gq as t,GG as u,uq as v,_q as w,yq as x,bq as y,dq as z};
//# sourceMappingURL=index-COYvdw4o.js.map
