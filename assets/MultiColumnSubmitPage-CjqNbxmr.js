const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-C3uFo3B7.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-BTMYyhc6.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-CTvaRJPh.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-COYvdw4o.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/contextState-BhHzyxk5.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/___vite-browser-external_commonjs-proxy-DtbFeITm.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/AppLayout-Bx68cLmY.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/Logo-BmlVHmIW.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/SiteName-B1nS1wd2.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/instagram-Bdv7Dlly.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/Disclosure-DgCWlw5X.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/add-24-filled-BdM6xnA7.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/Tab-BLMS8a9U.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/MenuItem-DLax9T5L.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/NotificationNewsButton-BDIEeogD.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-Cpf8OWOQ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/Empty-CnG_cY_l.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-add-XAdAsUn_.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/artwork-D9vxumxJ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/utils-CORjiwlf.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/imageUtil-NFh1c57i.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/UserLink-D-ltrUye.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/useIsomorphicLayoutEffect-1Q5YRNQV.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-m6nh9vV8.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-Ceq4Zp6u.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-add-DUpMb-CB.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/rx-DaL_68pT.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-check-Bx2631SZ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/uniqBy-DWZdfvgJ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/CircularSpinner-nWd4HBSC.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-clear-lRfcqXaV.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/createContainer-DXz_vXnk.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/AppLayout-BCnb9HXI.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/QuotaBalance-DP6pnxJ0.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-keyboard-arrow-right-BlgxAuax.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-BlC5yim8.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/pixchan-yay-DE_BM0Ji.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/download-358Ar2ai.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/unFile-B3RwQvIR.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/upload-DDvru8Za.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-circle-DKv3JZ6t.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-circle-CbazPpJ2.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ArtworkListPage-9LI_MBMs.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/seo-D6wIoyVq.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/DropdownMenu-YH0VlLXg.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/InspectDialog-BPHcKRwz.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/MangaBaseInfoFormItems-BVy3ZBjO.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/formatNum-CBDReyYg.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/seo-DtNI5RQz.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/GeneratorStage-DJGZB2wF.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-delete-outline-B3-PwQHh.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-edit-CrCwmctU.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/defaults-DtvpRUtA.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/_baseRest-nOujwdUV.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/_isIterateeCall-Bz6vLv_6.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ArtworkInfoForm-BbAax4Gm.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/optionalControlled-BaStM4vH.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/isArrayLikeObject-DMsoF54N.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/last-BiHEEoNf.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/TagSelect-D6CyfPkY.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/MediaPreview-CrisSWrJ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/Slider-0j-9tQ0Y.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ControlSection-BIQjDNv8.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-keyboard-arrow-down-CRihOzH-.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/cursorPagingUtils-YTUXhLAt.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/dismiss-24-filled-DmGl87MD.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/TableRow-qxF9QOyo.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/_baseSlice-CD5g_G3g.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/pagination-B34yMghJ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/round-plus-RCIMN6sR.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/GeneratorStage-CUfjN3FO.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/omitBy-8uwoqLo8.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-file-upload-CCpLAcZk.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-cancel-RNUwgBax.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ModelInfoForm-DCsOkC3d.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/UploadImage-DewQdK81.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-C-ypkS9u.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-qPceTsh8.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ModelSubmitFormProvider-phtQjuMT.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/camelCase-2j1YSjKF.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/_stringToArray-Btltjdey.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ModelAssetForm-CSHNk3Nd.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/async-DCNJOliF.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-D334VmL8.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/outline-add-photo-alternate-BAWueb6h.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ModelEditRequest-ZSfXOuoq.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/NotLogin-6OH84l9f.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ModelVersionForm-BG9Yypwf.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/omit-Crs8IPcz.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/SubmitForm-DI3f5b6W.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/GenerationTaskSelect-BF3aji-F.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/BaseCursorPaging-CwwekXMf.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ButtonGroup-DYBxluzJ.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/formUtil-BZLyjGym.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/useEvent-D4asvikd.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/ArtworkListPage-18keADL6.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/LCMRealtime-CnTFsb2j.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/util-BeU8Prtb.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/objectDestructuringEmpty-BTFSYSYG.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/baseline-arrow-downward-DqsrtYvs.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/GenerationModeNavigation-nSoy0Q7r.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/LCMRealtime-Dzzp4BTj.css","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/TaskMediaPicker-DGDnLnzY.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/useNumberFormatter-DED76umx.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/checkmark-circle-32-filled-snNJSQSg.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/TaskOutputGrid-BsjhBE4B.js","https://cdn.pixai.art/artifacts/app-2a97546287d4bdd7d7b76367efd818c8351c44e2/assets/index-BGtDd_cd.css"])))=>i.map(i=>d[i]);
var Za=Object.defineProperty;var Wa=(t,s,n)=>s in t?Za(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var N=(t,s,n)=>Wa(t,typeof s!="symbol"?s+"":s,n);import{j as e,e as c,K as w,C as T,a0 as R,U as $,cH as We,f3 as Ke,u as C,b as vn,o as Cn,a6 as qe,ho as B,da as Qe,fk as yn,fl as wn,db as Zt,h6 as wt,bv as J,P as Wt,$ as Je,bw as Kt,gx as qt,fs as kn,f as ne,f4 as Ka,fg as kt,i as gt,t as D,fy as Fe,c4 as Qt,ca as oe,fb as qa,ec as Qa,hD as Nn,B as z,ap as Sn,aV as Jt,bn as Nt,g7 as P,kC as Ja,aM as Xt,kD as Xa,a as Xe,gg as X,kE as Ya,kF as eo,s as Zs,kG as to,fj as ft,kH as Ws,D as se,dp as so,gw as no,bo as ao,cG as Yt,gK as In,cI as Oe,cB as oo,dx as _n,e7 as xt,dy as Mn,cL as es,ch as Tn,bT as Pn,gb as ts,aa as ss,ab as Ln,ac as pt,bm as Ks,cK as ns,F as as,de as En,kI as io,gm as ro,gn as Ht,kJ as lo,aP as os,bS as Ye,ii as is,gA as te,bU as rs,bV as ls,bW as cs,kK as qs,g$ as Qs,gl as mt,cN as An,kL as co,di as ds,dj as bt,kM as jt,hz as Rn,fU as uo,dz as mo,fv as ho,a8 as xe,aE as go,c9 as fo,kN as xo,kO as po,eh as bo,kP as jo,kQ as vo,kR as Co,kS as yo,hp as wo,hq as ko,hr as No,hv as Dn,hs as $n,ai as le,ht as Ee,hu as Fn,kT as So,h_ as Io,i4 as _o,h$ as Mo,i3 as To,kU as Po,kV as Lo,kW as Eo,cy as Ao,cz as Ro,jg as us,j$ as Do,ge as _e,b8 as $o,fA as On,cV as Fo,bi as Oo,J as Y,_ as zo,fH as ms,kX as zn,E as Vo,T as hs,hg as gs,a3 as fs,a4 as vt,jI as xs,kY as Js,kZ as Xs,gs as ze,gt as Ve,k_ as Bo,fr as Vn,ia as rt,fp as Rt,k$ as Dt,ib as Ne,l0 as Ho,l1 as lt,fn as Le,l2 as Uo,h as et,ft as Go,ir as Zo,aB as Wo,b7 as Ko,fY as qo,l3 as Bn,l4 as Qo,l5 as Jo,a7 as Hn,l6 as Xo,l7 as Yo,l8 as ei,a5 as ti,bH as Un,bX as si,b2 as ke,aI as ni,jE as ai,jH as oi,cO as Ys,aS as ii,gC as Gn,eb as Zn,bx as ri,he as li,h9 as ci,cc as di,gy as ui,hE as mi,bE as en,l9 as hi,y as gi,gP as $t,cD as tn,h5 as fi,gN as xi,M as pi}from"./index-BTMYyhc6.js";import{$ as ps,f as bs,g as Be,b as Me}from"./Tab-BLMS8a9U.js";import{t as bi,r as ji,T as Wn,J as St,v as tt,w as js,x as vi,f as Ci,k as Kn,y as yi,z as wi,A as ki,B as qn,E as sn,F as nn,G as an,H as Ni,I as Si,K as Ii,D as _i,L as Mi,M as Ti,N as Pi,$ as Li,O as Ei,l as Ai,V as Ri,W as Di}from"./GeneratorStage-DJGZB2wF.js";import{C as $i}from"./GenerationModeNavigation-nSoy0Q7r.js";import{b as pe,l as Qn,u as Jn,G as ce,S as Xn,H as Fi,a as Oi,L as vs,n as Yn,o as ea,I as Cs,p as zi,F as ys,q as Vi,r as Bi,s as ta,t as Hi,v as ws,w as Ui,x as Gi,y as Zi,z as Wi,A as Ki,B as qi}from"./index-COYvdw4o.js";import{n as Qi,f as Ji}from"./ModelSubmitFormProvider-phtQjuMT.js";import{U as be,u as on,a as ks}from"./unFile-B3RwQvIR.js";import{M as Xi,a as Yi,u as er}from"./index-1TSpBygz.js";import{e as tr,f as sr,d as nr,u as Ns,a as It,i as ar}from"./baseline-cancel-RNUwgBax.js";import{i as sa,h as or,a as na,b as aa,p as ir,g as rr,L as lr,N as cr,B as dr,C as ur}from"./LCMRealtime-CnTFsb2j.js";import{i as Ss}from"./baseline-edit-CrCwmctU.js";import{a as Is,b as st,d as oa}from"./utils-CORjiwlf.js";import{S as Te,a as ia}from"./baseline-circle-DKv3JZ6t.js";import{Z as ra,_ as mr,a0 as _s,a1 as Ae,a2 as Re,Y as Ft,a3 as la,a4 as hr,a5 as gr,a6 as Ms,a7 as De,a8 as fr,a9 as xr,aa as pr,ab as br,ac as jr,ad as vr,ae as Cr,af as ve,y as yr,z as ca,ag as wr,ah as kr,ai as Nr,aj as Sr,ak as Ir,o as _r,k as Mr,al as Tr,am as Pr,an as Lr,ao as Er,ap as Ar,aq as Rr,ar as Ts,as as da,at as Dr,au as $r}from"./ArtworkListPage-9LI_MBMs.js";import{Q as ua}from"./QuotaBalance-DP6pnxJ0.js";import{e as ma}from"./AppLayout-Bx68cLmY.js";import{v as ha}from"./seo-D6wIoyVq.js";import{i as ga}from"./round-plus-RCIMN6sR.js";import{C as Fr}from"./CircularSpinner-nWd4HBSC.js";import{S as nt}from"./Slider-0j-9tQ0Y.js";import{M as He}from"./MenuItem-DLax9T5L.js";import{E as fa}from"./Empty-CnG_cY_l.js";import{C as ie,a as re}from"./ControlSection-BIQjDNv8.js";import{Q as Or}from"./ModelInfoForm-DCsOkC3d.js";import{c as Ps,a as zr}from"./contextState-BhHzyxk5.js";import{U as Vr,T as Br}from"./TaskMediaPicker-DGDnLnzY.js";import{U as Hr}from"./UploadImage-DewQdK81.js";import{i as Ur}from"./baseline-delete-outline-B3-PwQHh.js";import{$ as xa,a as Gr,b as Zr,c as Wr,d as Kr,L as qr}from"./LoraParams-ByTwqYlb.js";import{e as Qr}from"./async-DCNJOliF.js";import{C as Jr}from"./index-D334VmL8.js";import{u as Xr}from"./index-C-ypkS9u.js";import{g as Ls}from"./rand-CWZpxDtu.js";import{u as Yr}from"./upload-DDvru8Za.js";import{E as el,f as H,m as tl,B as sl}from"./util-BeU8Prtb.js";import"./fixAllowTouchScrolling-DXyvIPMq.js";import{S as nl,a as al,C as ol}from"./ModelVersionForm-BG9Yypwf.js";import{c as pa,a as il}from"./imageUtil-NFh1c57i.js";import{i as rl}from"./baseline-add-XAdAsUn_.js";import{i as ll}from"./baseline-clear-lRfcqXaV.js";import{b as ba,a as cl}from"./baseline-file-upload-CCpLAcZk.js";import{C as dl}from"./ArtworkInfoForm-BbAax4Gm.js";import{i as ul}from"./baseline-check-Bx2631SZ.js";import{i as ml}from"./baseline-delete-d3ZG6Cxd.js";import{B as rn}from"./ButtonGroup-DYBxluzJ.js";import{d as hl}from"./InspectDialog-BPHcKRwz.js";import{u as Se}from"./useEvent-D4asvikd.js";import"./defaults-DtvpRUtA.js";import"./_baseRest-nOujwdUV.js";import"./_isIterateeCall-Bz6vLv_6.js";import"./baseline-keyboard-arrow-down-CRihOzH-.js";import"./cursorPagingUtils-YTUXhLAt.js";import"./dismiss-24-filled-DmGl87MD.js";import"./TableRow-qxF9QOyo.js";import"./baseline-keyboard-arrow-right-BlgxAuax.js";import"./index-Cpf8OWOQ.js";import"./_baseSlice-CD5g_G3g.js";import"./MediaPreview-CrisSWrJ.js";import"./pagination-B34yMghJ.js";import"./uniqBy-DWZdfvgJ.js";import"./___vite-browser-external_commonjs-proxy-DtbFeITm.js";import"./artwork-D9vxumxJ.js";import"./Logo-BmlVHmIW.js";import"./camelCase-2j1YSjKF.js";import"./_stringToArray-Btltjdey.js";import"./objectDestructuringEmpty-BTFSYSYG.js";import"./baseline-arrow-downward-DqsrtYvs.js";import"./formatNum-CBDReyYg.js";import"./UserLink-D-ltrUye.js";import"./useIsomorphicLayoutEffect-1Q5YRNQV.js";import"./index-m6nh9vV8.js";import"./omitBy-8uwoqLo8.js";import"./Disclosure-DgCWlw5X.js";import"./ModelAssetForm-CSHNk3Nd.js";import"./index-qPceTsh8.js";import"./add-24-filled-BdM6xnA7.js";import"./outline-add-photo-alternate-BAWueb6h.js";import"./ModelEditRequest-ZSfXOuoq.js";import"./NotLogin-6OH84l9f.js";import"./omit-Crs8IPcz.js";import"./last-BiHEEoNf.js";import"./SubmitForm-DI3f5b6W.js";import"./GenerationTaskSelect-BF3aji-F.js";import"./optionalControlled-BaStM4vH.js";import"./BaseCursorPaging-CwwekXMf.js";import"./formUtil-BZLyjGym.js";import"./SiteName-B1nS1wd2.js";import"./instagram-Bdv7Dlly.js";import"./NotificationNewsButton-BDIEeogD.js";import"./rx-DaL_68pT.js";import"./createContainer-DXz_vXnk.js";import"./DropdownMenu-YH0VlLXg.js";import"./MangaBaseInfoFormItems-BVy3ZBjO.js";import"./TagSelect-D6CyfPkY.js";import"./useNumberFormatter-DED76umx.js";import"./checkmark-circle-32-filled-snNJSQSg.js";import"./TaskOutputGrid-BsjhBE4B.js";import"./TrainLoraEvent-ByLNm43A.js";import"./LoraSelectContext-C0mob3fK.js";import"./isArrayLikeObject-DMsoF54N.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},s=new Error().stack;s&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[s]="4eb5e41e-9789-4c73-8909-3cb1810cb7c9",t._sentryDebugIdIdentifier="sentry-dbid-4eb5e41e-9789-4c73-8909-3cb1810cb7c9")}catch{}})();{var it=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};it._sentryModuleMetadata=it._sentryModuleMetadata||{},it._sentryModuleMetadata[new Error().stack]=Object.assign({},it._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}const Es=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M4 15V9h8V4.16L19.84 12L12 19.84V15H4Z"})});function ja(t){return e.jsx(tr,{children:e.jsx(sr,{children:e.jsx(gl,{...t})})})}function gl(t){const s=nr(),n=c.useCallback(({open:a})=>e.jsx(fl,{open:a,...t}),[t]);return e.jsxs("div",{className:"flex flex-col mlg:h-full justify-center bg-background overflow-y-auto relative",children:[e.jsx(Xi,{wrapperProps:{className:w("py-8 !cursor-default mlg:!cursor-pointer",s&&"hidden")},uploadTrigger:n,maxAllowedMedia:1,dropzoneOpts:{noClick:!0},onUploadSuccess:()=>{T("panel_image_import",{scene:t.trackingScene,cate:"local"})}}),s&&e.jsxs("div",{className:"w-full flex flex-col mlg:justify-between h-full p-4 gap-2",children:[e.jsx("p",{children:e.jsx(R,{i18nKey:"generation:enhance-image.image-select.selected-title"})}),e.jsx(Yi,{wrapperProps:{className:"bg-neutral-100 dark:bg-neutral-700 rounded-lg min-h-40"},imgProps:{className:"max-mlg:max-h-[max(calc(50vh-132px),320px)] max-mlg:w-full object-contain rounded-lg"},usePublicUrl:!0}),e.jsx("div",{className:"hidden mlg:block h-[1lh]"}),e.jsx(Es,{className:"mlg:hidden size-8 text-gray-300 dark:text-gray-700 rotate-90 self-center"})]})]})}function fl(t){const{open:s,...n}=t;return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"pt-1 hidden mlg:block",children:e.jsx(R,{i18nKey:"generation:enhance-image.image-select.import-from-tasks"})}),e.jsx("p",{className:"hidden mlg:block",children:e.jsx(R,{i18nKey:"generation:enhance-image.image-select.select-to-upload"})}),e.jsx(xl,{...n,trigger:a=>e.jsx($,{variant:"outlined",className:"mlg:hidden rounded-full font-medium",onPress:()=>{T("generator_tab_select_task_history_click",{scene:t.trackingScene}),a()},children:e.jsx(R,{i18nKey:"generation:enhance-image.image-select.select-from-task"})})}),e.jsx($,{variant:"outlined",className:"rounded-full font-medium",onPress:()=>{s()},children:e.jsx(R,{i18nKey:"generation:enhance-image.image-select.upload-image"})})]})}function xl(t){const s=document.getElementById("workbench-layout-overlays"),n=c.useCallback(({onClose:a,item:o})=>{var i;o.media&&(T("panel_image_import",{scene:t.trackingScene,cate:"task"}),(i=t.onImageSelect)==null||i.call(t,o)),a()},[t.onImageSelect]);return e.jsx(bi,{onSelectItem:n,enableBatchMediaSelect:!0,trigger:({onOpen:a})=>t.trigger(a),DrawerProps:{container:s}})}const pl=We({slots:{root:"group relative inline-grid grid-cols-[auto_1fr_auto] items-center rounded-md focus:outline outline-1 outline-offset-0 transition duration-75 w-fit",label:"row-start-1 col-start-2",startIcon:"row-start-1 col-start-1",endIcon:"row-start-1 col-start-3",selectedIndicator:"absolute -bottom-px left-4 right-4 border-b group-focus:border-none"},variants:{size:{small:{},normal:{},large:{}},hasLabel:{false:{label:"hidden"}},hasStartIcon:{false:{startIcon:"hidden"}},hasEndIcon:{false:{endIcon:"hidden"}},isSelected:{false:{root:"outline-black/50 dark:outline-white/50 hover:bg-black/10 dark:hover:bg-white/10",selectedIndicator:"border-black/50 dark:border-white/50"},true:{root:"outline-purple-600 dark:outline-purple-500 hover:bg-purple-600/10 dark:hover:bg-purple-500/10 text-purple-500 dark:text-purple-600 font-semibold",selectedIndicator:"border-purple-600 dark:border-purple-500"}}},compoundVariants:[{size:["small","normal"],className:{root:"text-sm"}},{size:"large",className:{root:"text-base"}},{size:"small",className:{root:"h-7"}},{size:"normal",className:{root:"h-8"}},{size:"large",className:{root:"h-10"}},{hasStartIcon:!0,className:{startIcon:"grid place-content-center"}},{hasEndIcon:!0,className:{endIcon:"grid place-content-center"}},{hasStartIcon:!1,size:"small",className:{root:"pl-2"}},{hasLabel:!0,hasEndIcon:!1,size:"small",className:{root:"pr-2"}},{hasStartIcon:!1,size:"normal",className:{root:"pl-2.5"}},{hasLabel:!0,hasEndIcon:!1,size:"normal",className:{root:"pr-2.5"}},{hasStartIcon:!1,size:"large",className:{root:"pl-3"}},{hasLabel:!0,hasEndIcon:!1,size:"large",className:{root:"pr-3"}}],compoundSlots:[{slots:["startIcon","endIcon"],className:"h-full aspect-square"}],defaultVariants:{size:"normal",hasLabel:!1,hasStartIcon:!1,hasEndIcon:!1,isSelected:!1}}),va=c.forwardRef(function(s,n){const{isSelected:a,icon:o,endIcon:i,className:r,startIconClassName:l,labelClassName:d,endIconClassName:u,size:m,children:g,...h}=s,x=pl({size:m,hasLabel:!!g,hasStartIcon:!!o,hasEndIcon:!!i,isSelected:a});return e.jsxs(Ke,{...h,ref:n,className:x.root({className:r}),children:[e.jsx("span",{className:x.startIcon({className:l}),children:o}),e.jsx("span",{className:x.label({className:d}),children:g}),e.jsx("span",{className:x.endIcon({className:u}),children:i}),e.jsx("span",{className:x.selectedIndicator()})]})});va.displayName="UIButtonTab";const bl=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M4.854 8.146a2.84 2.84 0 0 1 .685 1.114l.448 1.377a.544.544 0 0 0 1.026 0l.448-1.377a2.84 2.84 0 0 1 1.798-1.796l1.378-.448a.544.544 0 0 0 0-1.025l-.028-.007l-1.378-.448A2.84 2.84 0 0 1 7.433 3.74l-.447-1.377a.544.544 0 0 0-1.027 0L5.511 3.74l-.011.034a2.84 2.84 0 0 1-1.759 1.762l-1.378.448a.544.544 0 0 0 0 1.025l1.378.448c.42.14.8.376 1.113.689M20 7a1 1 0 0 1 1 1v5a1 1 0 1 1-2 0v-2.586l-5.793 5.793a1 1 0 0 1-1.414 0L10 14.414l-5.293 5.293a1 1 0 0 1-1.414-1.414l6-6a1 1 0 0 1 1.414 0l1.793 1.793L17.586 9H15a1 1 0 1 1 0-2zm.017 10.965l.766.248l.015.004a.303.303 0 0 1 .147.46a.3.3 0 0 1-.147.11l-.765.248a1.58 1.58 0 0 0-1 .999l-.248.764a.302.302 0 0 1-.57 0l-.249-.764a1.58 1.58 0 0 0-.999-1.002l-.765-.249a.303.303 0 0 1-.147-.46a.3.3 0 0 1 .147-.11l.765-.248a1.58 1.58 0 0 0 .984-.998l.249-.765a.302.302 0 0 1 .57 0l.249.764a1.58 1.58 0 0 0 .999.999"})});function Ue(t){const{t:s}=C(["generation"]),{state:n,dispatch:a}=c.useContext(pe),o=vn(),i=Cn(),r=qe("lg");c.useEffect(()=>{const d=Qn(i.tab);n.mode!==d&&a({type:"set-mode-value",value:d})},[i.tab]);const l=[[B.Generate,s("generation:generate.tab.generate.label"),sa,"/generator/image"],[B.Fill,s("generation:generate.tab.edit.label"),Ss,"/generator/image/editor"],[B.EnhanceImage,s("generation:generate.tab.enhance-image.label"),bl,"/generator/image/enhancement"],[B.ImageToVideo,s("generation:generate.tab.image-to-video.label"),ji,"/generator/image/animation"]];return e.jsx("div",{className:w("flex",t.className),children:l.filter(([d])=>r&&!t.alwaysShowFillTab?d!==B.Fill:!0).map(([d,u,m,g])=>e.jsx(va,{className:"shrink-0",icon:e.jsx(m,{}),isSelected:n.mode===d,onPress:()=>{T("gen_page_panel_tab_click",{mode:d}),o(g)},children:u},d))})}const at=wn(),Ca=Qe({}),jl=t=>yn({children:t.children,store:at}),ya=Qe({selectedPresetPlugin:"handfix",extraArgs:{}});function wa(){return ra(ya,{store:at})}function vl(){return Zt(ya,{store:at})}function Cl(){return mr(Ca,{store:at})}function yl(){return Zt(Ca,{store:at})}function wl(){var u,m;const t=Ns(),{lastResultTaskId:s}=yl(),{data:n,isLoading:a}=wt(s),o=(m=(u=n==null?void 0:n.parameters)==null?void 0:u.inputs)==null?void 0:m.image.media_id,{data:i}=J(o),r=n==null?void 0:n.media,l=i!=null&&i.width&&i.height?{width:i.width,height:i.height}:void 0,d=o===t[0];return e.jsx("div",{className:"bg-background dark:border-neutral-700 flex w-full overflow-y-auto",children:s?e.jsxs("div",{className:"w-full flex flex-col mlg:justify-between mlg:h-full p-4 gap-2",children:[e.jsx("p",{children:e.jsx(R,{i18nKey:"generation:enhance-image.result.result-title"})}),n?r?e.jsx(Te,{id:n.id,originalUrl:Je(n.media),thumbnailUrl:Kt(n.media),fileName:`${Is({task:n})}.${st({task:n})}`,width:r.width,height:r.height,imgClassName:w("rounded-lg self-center",!d&&"opacity-50")}):e.jsx(Wn,{className:w("rounded-lg",!l&&"w-full h-full"),id:n==null?void 0:n.id,status:n.status,contentStyleProps:{className:w("rounded-lg",!l&&"py-8"),style:l?{aspectRatio:(l.width??1)/(l.height??1)}:void 0}}):e.jsx(Wt,{}),e.jsx("div",{className:"hidden mlg:block h-[1lh]"})]}):e.jsx("p",{className:"text-center w-full py-8 text-2xl text-neutral-400 my-auto",children:e.jsx(R,{i18nKey:"generation:enhance-image.result.display-placeholder"})})})}function kl(t){const{plugin:s,events:n,isMember:a}=t;if(!n)return null;const i=(s?n.filter(r=>{var l;return(l=r.workflows)==null?void 0:l.includes(s.workflowName)}):[])[0];return i&&i.userType==="member"&&a?i:null}function Nl(t){if(t)return[t.workflowName,t.workflowVersion].join(":")}function Sl(){const{data:t}=qt(),{data:s,mutate:n}=kn(),{t:a}=C(["generation"]),{data:o}=ne(),i=Ka(o),r=Ns()[0],l=r!=null&&r.startsWith("upload")?void 0:r,d=Cl(),{selectedPresetPlugin:u,extraArgs:m}=vl(),g=c.useMemo(()=>{const v=t&&u?t[u]:Object.values(t??{})[0];return{workflowName:Nl(v),inputs:{image:{type:"media",media_id:l},...m},model:"pixai-panelplugin"}},[u,l,m]),{data:h,isValidating:x}=Jn(g),[f,b]=kt(async()=>{try{T("enhance_generate_click",{cate:u});const v=await gt.createGenerationTask({parameters:g});d(k=>{var _;k.lastResultTaskId=(_=v.createGenerationTask)==null?void 0:_.id}),n(),D.success(a("generation:submit.notice.task-submitted"))}catch(v){D.error(v.message)}},[g,u]),p=kl({events:s,plugin:t==null?void 0:t.handfix,isMember:i}),j=p!=null&&p.countRemains>0;return e.jsxs(_s,{onSubmit:v=>v.preventDefault(),className:"bg-background mlg:border-l mlg:border-t max-mlg:sticky max-mlg:bottom-0 dark:border-neutral-700",children:[e.jsx(Il,{}),e.jsx("div",{className:"p-4",children:e.jsx($,{disabled:!l,busy:f.loading,onPress:()=>{b()},color:"theme",variant:"filled",className:"w-full rounded-lg items-center font-semibold px-4 h-auto py-2",labelClassName:"w-full items-center justify-center gap-2",children:e.jsxs("p",{className:"flex gap-1 items-center mx-auto w-fit",children:[a(j?"generation:submit.free-generation.label":"generation:submit.lets-go.label"),o&&!j&&e.jsx(Fe,{iconClassName:"",children:e.jsx(ua,{value:(h==null?void 0:h.actualPrice)??0,loading:x,className:"!text-inherit font-normal",iconClassName:"hidden",valueClassName:"text-xs"})}),o&&j&&e.jsxs(Fe,{children:[e.jsx("span",{className:"font-bold",children:p==null?void 0:p.countRemains}),"/",e.jsx("span",{className:"text-xs",children:a("generation:submit.free-generation.remaining-times",{remaining:p.countTotal})})]})]})})})]})}const ln=We({base:["relative -mb-px p-2 text-sm text-center cursor-default","after:absolute after:inset-x-0 after:-bottom-1 after:h-0.5 after:bg-black dark:after:bg-white"],variants:{selected:{true:"",false:"after:hidden"},disabled:{true:"text-black/50 dark:text-white/50"}}});function Il(){return e.jsxs(ps,{children:[e.jsxs(bs,{className:"flex *:flex-1 px-4 py-1 border-b border-black/10 dark:border-white/10",children:[e.jsx(Be,{id:"preset",className:({isSelected:t,isDisabled:s})=>ln({selected:t,disabled:s}),children:e.jsx(R,{i18nKey:"generation:enhance-image.parameters.tabs.preset.label"})}),e.jsxs(Be,{id:"custom",isDisabled:!0,className:({isSelected:t,isDisabled:s})=>ln({selected:t,disabled:s}),children:[e.jsx(R,{i18nKey:"generation:enhance-image.parameters.tabs.custom.label"}),e.jsx("span",{className:"ml-2 inline-block px-1.5 text-[10px] leading-4 uppercase tracking-wide text-neutral-500 dark:text-neutral-400 bg-zinc-200 dark:bg-zinc-700 rounded-full",children:"Coming soon"})]})]}),e.jsx(Me,{id:"preset",children:e.jsx(Ml,{})})]})}const _l=We({slots:{root:"flex flex-col items-center gap-2 outline-none group",image:"w-full aspect-square rounded-lg",label:"-mb-1 text-center"},variants:{skeleton:{true:{image:"bg-black dark:bg-white animate-pulse"},false:{image:"group-data-[selected]:outline outline-2 outline-offset-2 outline-theme-primary"}}},defaultVariants:{skeleton:!1}});function Ml(){const{data:t,isLoading:s,mutate:n}=qt(),a=Object.entries(t??{}).map(([l,d])=>({id:l,...d})),[o,i]=wa(),r=_l();return e.jsxs(ps,{selectedKey:o.selectedPresetPlugin,onSelectionChange:l=>i(d=>{const u=l;d.selectedPresetPlugin=u,d.extraArgs=Pl(t[u])}),children:[e.jsx("div",{className:"relative grid grid-flow-col auto-cols-[72px] gap-4 p-4 border-b border-black/10 dark:border-white/10",children:s||!a.length?e.jsxs(e.Fragment,{children:[Array.from({length:3}).map((l,d)=>e.jsxs("div",{className:r.root({className:!s&&!a.length&&"invisible"}),style:{opacity:.3-.3/3*d},children:[e.jsx("div",{className:r.image({skeleton:!0})}),e.jsx("p",{className:r.label({className:"prepend-zws"})})]},`skeleton-${d}`)),!s&&!a.length&&e.jsxs("div",{className:"absolute inset-0 grid place-content-center place-items-center",children:[e.jsx("p",{children:e.jsx(R,{i18nKey:"generation:enhance-image.messages.load-plugin-list-failed"})}),e.jsx($,{variant:"ghost",className:"h-7 px-2",onPress:()=>void n(),children:e.jsx(R,{i18nKey:"action:retry.label"})})]})]}):e.jsx(bs,{items:a,className:"contents",children:l=>e.jsxs(Be,{className:r.root(),children:[e.jsx("img",{src:l.image,alt:"",className:r.image()}),e.jsx("p",{className:r.label(),children:e.jsx(R,{i18nKey:l.label})})]})})}),e.jsx(Me,{id:"face-detailer",className:"p-4 pb-0",children:e.jsx(Tl,{pluginName:o.selectedPresetPlugin})})]})}function Tl(t){const{data:s}=qt(),n=t.pluginName?s==null?void 0:s[t.pluginName]:void 0,a=Object.entries((n==null?void 0:n.args)??{}).map(([r,l])=>({name:r,...l})),[o,i]=wa();return e.jsx(e.Fragment,{children:a.map(r=>Qt(r).with({hidden:!0},()=>null).with({value:oe.string},()=>{var l;return e.jsxs(Ae,{value:(l=o.extraArgs)==null?void 0:l[r.name],onChange:d=>i(u=>{u.extraArgs??(u.extraArgs={}),u.extraArgs[r.name]=d}),className:"flex flex-col",children:[e.jsx(Re,{className:"mb-2",children:e.jsx("span",{className:"block -my-1",children:e.jsx(R,{i18nKey:r.label,defaults:r.label||r.name})})}),e.jsx(qa,{className:"h-14 min-h-8 px-2.5 py-1.5 bg-transparent rounded-md ring-1 ring-inset ring-black/15 dark:ring-white/15 focus:outline outline-2 -outline-offset-1 outline-black/80 dark:outline-white/80 resize-y"})]},r.name)}).otherwise(()=>null))})}function Pl(t){const s={};if(t.args)for(const[n,a]of Object.entries(t.args))s[n]=a.value;return s}function Ll(){return e.jsxs(jl,{children:[e.jsx("div",{className:"hidden mlg:flex flex-col mlg:overflow-hidden",style:{gridArea:"left"},children:e.jsx(Al,{})}),e.jsx(Me,{id:B.EnhanceImage,className:"contents",children:e.jsxs("main",{className:w("relative flex flex-col bg-dot-pattern min-h-0 mlg:[grid-area:main/2/main/-1] max-mlg:row-end-[-1]"),children:[e.jsx(St,{className:w("m-3 mlg:hidden","[&>div]:flex [&>div]:flex-col [&>div]:items-center [&>div>p]:text-center","[&>div>a]:mx-auto [&>div>a]:py-1")}),e.jsx("div",{className:"flex px-4 py-1",children:e.jsx(Ue,{className:"flex-wrap"})}),e.jsxs("div",{className:"grid grid-rows-[auto_1fr_auto] mlg:grid-rows-none mlg:grid-cols-[2fr_1fr] flex-1 gap-x-4 min-h-0 relative",children:[e.jsxs("div",{className:"flex flex-col mlg:grid mlg:grid-cols-2 border-x border-t dark:border-neutral-700 relative mlg:overflow-y-auto",children:[e.jsx(Rl,{}),e.jsx(Es,{className:"hidden mlg:block absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 size-8 text-gray-300 dark:text-gray-700 mlg:rotate-0 rotate-90"}),e.jsx(wl,{})]}),e.jsx(Sl,{})]})]})})]})}const El=c.memo(js);function Al(){const[,t]=c.useContext(ce),s=It(),n=c.useCallback(a=>{a.media&&(T("panel_image_import",{scene:"enhance",cate:"task"}),s([a.media.id])),a.task&&t(tt(a.task)??[])},[]);return e.jsx(El,{className:"flex-1",onSelectItem:n,enableBatchMediaSelect:!0})}function Rl(){const t=It(),s=c.useCallback(n=>{n!=null&&n.media&&t([n.media.id])},[]);return e.jsx(ja,{onImageSelect:s,trackingScene:"enhance"})}var cn;(function(t){t.Reroll="reroll"})(cn||(cn={}));function Dl(t){var d;const s=c.useRef(null),[,n]=c.useContext(Xn),a=vi(t.task,(d=t.task.media)==null?void 0:d.id),o=Qa(t.task),i=Nn(t.task)===0;function r(){T("publish_btn_click",{path:"animated",scene:"panel"}),n({taskId:t.task.id,mediaIdx:a,baseMedia:t.task.media,openPublishDialog:!0})}const{t:l}=C(["artwork","generation"]);return e.jsxs("div",{className:w("flex items-center gap-2",t.className),style:t.style,children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"outlined",className:"flex-none px-3 text-purple-600 dark:text-purple-400 border border-purple-700 dark:border-purple-600 whitespace-nowrap",onClick:()=>{var u;T("animate_reroll_click"),(u=s.current)==null||u.open()},children:[e.jsx(Ci,{className:"w-5 h-5 -ml-1 mr-1"}),l("generation:animated-image.reroll-button.label")]}),e.jsx($l,{ref:s,task:t.task,itemIdx:t.itemIdx,mode:"reroll"})]}),e.jsx("span",{className:"flex-1 -mx-1"}),i&&e.jsxs(z,{className:"flex-none box-content px-3 bg-purple-700 text-white font-medium whitespace-nowrap",onClick:r,children:[e.jsx(Kn,{className:"w-5 h-5 -ml-1 mr-1"}),l("artwork:publish")]})]})}const $l=c.forwardRef(function(s,n){const[a,o]=c.useState(!1);return c.useImperativeHandle(n,()=>({open:()=>o(!0),close:()=>o(!1)})),e.jsx(Sn,{open:a,onClose:()=>o(!1),className:"max-w-xl p-2",children:e.jsx(Fl,{...s,onClose:()=>o(!1)})})});function Fl(t){const{onClose:s,task:n,...a}=t,[o,i]=c.useState(yi),{computingPrice:r,price:l,creatingTask:d,createTask:u}=wi({...a,taskParameters:n,...o.selectedTab==="v1"?{v1Params:o.v1}:{v2Params:o.v2}}),{t:m}=C(["action","generation"]);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4",children:[e.jsx("h4",{className:"text-lg mb-4 font-medium",children:m({reroll:"generation:animated-image.reroll-dialog.title"}[t.mode])}),e.jsx(Jt,{className:"prose dark:prose-invert",children:m({reroll:"generation:animated-image.reroll-dialog.description"}[t.mode])})]}),e.jsx("div",{className:"p-4 flex items-center justify-center",children:e.jsx(ki,{params:o,setParams:i})}),e.jsxs(Nt,{children:[e.jsx($,{variant:"outlined",onPress:s,children:m("action:cancel")}),e.jsx($,{color:"theme",busy:d,variant:"filled",onPress:async()=>{T({reroll:"animate_reroll_confirm_click"}[t.mode]);try{await u(t.mode==="reroll"?!0:void 0)}catch(g){D.error(g.message)}},children:e.jsxs("div",{className:"inline-flex",children:[m({reroll:"generation:animated-image.reroll-button.label"}[t.mode]),e.jsx(Fe,{value:l==null?void 0:l.actualPrice,originalValue:l==null?void 0:l.originalPrice,updating:r,className:"ml-4"})]})})]})]})}const ka=c.forwardRef(function(s,n){const{style:a,className:o}=s,{t:i}=C(["artwork","common"]),{loading:r,values:l,handleChange:d,validation:u,submit:m}=P(),[,g]=c.useContext(ce),[,h]=c.useContext(Fi),x=c.useMemo(()=>l,[l]),{data:f,isValidating:b}=Jn(x,O=>Ja({...O,prompts:void 0})),{me:p,beingMember:j,beingAdmin:v}=Xt(),{data:k}=Xa({revalidateOnFocus:!1}),_=k==null?void 0:k.dailyClaimAvailable,[y,E]=Xe(),M=X(l.modelId),S=Ya(M==null?void 0:M.extra),{data:A,mutate:W}=kn(),[I,U]=c.useState(void 0),q=((I==null?void 0:I.remaining)??0)>0,Q=c.useCallback((O,Z)=>m({},me=>{W();const we=tt(me.createGenerationTask);we&&(g(we),h(we[0].mediaId)),window.scrollTo({top:0,behavior:"smooth"})},{throwError:Z==null?void 0:Z.throwError}),[]),V=c.useCallback(async(O,Z)=>{try{Z&&await eo(),await Q(O,{throwError:!0})}catch(me){const we=Zs(me);if(typeof we!="string")return D.error("Error submitting task");if(we==="INSUFFICIENT_BALANCE"){let At=!1;if(_?to({closeAfterClaim:!0,afterClaim:async()=>{try{await Q(O,{throwError:!0})}catch(Ga){Ga==="INSUFFICIENT_BALANCE"&&(At=!0)}}}):At=!0,!At)return;ft({afterPurchaseSuccess:()=>{Q(O)},extraParamsForSubscribeRedirection:{submitTask:1,initialValues:Ft(l)},trackingLocation:"insufficient-credit-task-gen"})}else Ws(i,me,{taskParameters:l})}},[Q,_,l]),K=c.useCallback(async O=>{try{await Q(O,{throwError:!0})}catch(Z){Zs(Z)==="INSUFFICIENT_BALANCE"?ft({afterPurchaseSuccess:()=>{Q(O)},extraParamsForSubscribeRedirection:{submitTask:1,initialValues:Ft(l)},trackingLocation:"insufficient-credit-task-gen"}):Ws(i,Z,{taskParameters:l})}},[Q,l]),L=c.useCallback(O=>{p!=null&&p.id?K(O):se({oauthRedirectUrl:so(`${no(window.location.origin,"generator")}`,{submitTask:1,initialValues:Ft(l)}),onSuccess:Z=>V(O,Z),skipAfterAuthDialogs:!0},{fromPath:"gen-submit"})},[p==null?void 0:p.id,K,V,l]);c.useImperativeHandle(n,()=>({onClickSubmit:L}),[L]);const F=ha(async O=>{await ao(2e3),V(void 0,O)});c.useEffect(()=>{s.handleSubmitFromQs&&p!=null&&p.id&&(Number(y.submitTask)&&F(y.isNew==="true"),E(O=>({...O,submitTask:null,isNew:null})))},[y.submitTask,s.handleSubmitFromQs,p==null?void 0:p.id]),c.useEffect(()=>{if(Array.isArray(A)&&M){const O=A.find(Z=>{var me;return Z.countRemains>0&&(Z.userType==="member"&&j||Z.userType==="admin"&&v)&&((me=Z.modelVersions)==null?void 0:me.includes(M.id))});if(O){U({type:O.type,remaining:O.countRemains,total:O.countTotal});return}}U(void 0)},[A,M,j,v]);const ue=qe("lg"),{denseMode:Pe}=qn();return e.jsxs("div",{className:w(o),style:a,id:s.id,children:[s.showPriorityCheckbox&&e.jsx("div",{className:"px-2 pb-2 flex flex-col gap-2 mlg:hidden bg-[rgb(var(--bg-color))]",children:e.jsx(sn,{value:l.priority,onChange:d("priority")})}),e.jsxs("div",{className:w("[--height:50px] mlg:[--height:auto] dense:[--height:32px] h-[--height] flex items-center"),children:[!ue&&s.showPriorityCheckbox&&e.jsx(sn,{value:l.priority,onChange:d("priority"),className:"flex-none",forceHighPriorityForNonMember:S}),e.jsxs($,{variant:"filled",color:"theme",busy:r,busyLabel:e.jsx("span",{className:"pr-2",children:e.jsx(R,{i18nKey:"generation:submit.generating.label"})}),disabled:r||b||!u.ok,className:w("w-full mlg:w-auto h-[--height] flex items-center transition font-semibold dense:text-sm","px-4 mlg:py-2 dense:px-3 dense:py-0.5","rounded-xl mlg:rounded-lg dense:rounded-md",(r||b)&&"opacity-80",!u.ok&&"!bg-zinc-200 dark:!bg-zinc-600 !text-neutral-600 dark:!text-neutral-400"),labelClassName:"w-full flex items-center justify-center gap-2",onPress:L,children:[q?i("generation:submit.free-generation.label",{context:Pe}):i("generation:submit.lets-go.label",{context:Pe}),p&&!q&&e.jsx(Fe,{iconClassName:"!size-3",children:e.jsx("span",{className:"flex items-center gap-1",children:e.jsx(ua,{value:(f==null?void 0:f.actualPrice)??0,loading:b,className:"!text-inherit font-normal",iconClassName:"hidden",valueClassName:"text-xs"})})}),p&&q&&e.jsxs(Fe,{children:[e.jsx("span",{className:"font-bold",children:I==null?void 0:I.remaining}),"/",e.jsx("span",{className:"text-xs",children:i("generation:submit.free-generation.remaining-times",{remaining:I==null?void 0:I.total})})]}),e.jsx("span",{className:"hidden mlg:flex dark:bg-neutral-700/50 bg-neutral-200/50 shadow-md items-center px-1 rounded-md text-white text-xs",children:ma?"⌘+⏎":"Ctrl+⏎"})]})]})]})}),Ot="generator::prompts-helper",Ol=In(),zl=Yt(Ot,window.localStorage.getItem(Ot)?JSON.parse(window.localStorage.getItem(Ot)):void 0),_t=()=>Oe(zl,{store:Ol});let dn=!1;function Vl(){const t=oo("auto-prompt-helper",""),[s,n]=_t();return!dn&&t==="treatment"&&!s&&(n("auto"),dn=!0),t==="treatment"}const Bl=We({base:"placement-bottom:mt-2 placement-top:mb-2 placement-right:mr-2 placement-left:ml-2 group rounded-lg drop-shadow-lg bg-modal-background",variants:{isEntering:{true:"animate-in fade-in placement-bottom:slide-in-from-top-1 placement-top:slide-in-from-bottom-1 placement-left:slide-in-from-right-1 placement-right:slide-in-from-left-1 ease-out duration-200"},isExiting:{true:"animate-out fade-out placement-bottom:slide-out-to-top-1 placement-top:slide-out-to-bottom-1 placement-left:slide-out-to-right-1 placement-right:slide-out-to-left-1 ease-in duration-150"}}});function Hl(){return e.jsx(Mn,{className:"group",children:e.jsx("svg",{width:12,height:12,viewBox:"0 0 12 12",className:"block fill-modal-background group-placement-bottom:rotate-180 group-placement-left:-rotate-90 group-placement-right:rotate-90",children:e.jsx("path",{d:"M0 0 L6 6 L12 0"})})})}function Ul({className:t,children:s,showArrow:n,PopoverProps:a}){return e.jsx(_n,{...a,className:xt(t,(o,i)=>Bl({...i,className:o})),children:xt(s,(o,i)=>e.jsxs(e.Fragment,{children:[n&&e.jsx(Hl,{}),o]}))})}const un=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10s10-4.47 10-10S17.53 2 12 2zm4.3 14.3a.996.996 0 0 1-1.41 0L12 13.41L9.11 16.3a.996.996 0 1 1-1.41-1.41L10.59 12L7.7 9.11A.996.996 0 1 1 9.11 7.7L12 10.59l2.89-2.89a.996.996 0 1 1 1.41 1.41L13.41 12l2.89 2.89c.38.38.38 1.02 0 1.41z"})});function Mt(t){const{t:s}=C(["generation"]);return e.jsxs("div",{className:w("grid items-center grid-cols-[16px_1fr_auto] gap-1 w-full py-3",t.checked?"text-neutral-400 dark:text-neutral-500":"",t.disabled&&"cursor-not-allowed text-neutral-400 dark:text-neutral-500"),children:[e.jsx(t.startIcon,{className:"size-4"}),e.jsx(es,{placement:"bottom start",className:"justify-self-start max-w-md",delay:250,trigger:e.jsx(Ke,{className:"justify-self-start font-medium text-sm ",children:t.label}),children:e.jsx("div",{className:"p-4",children:t.helpText})}),e.jsx("button",{disabled:t.disabled,className:w("px-3 h-[22px] flex items-center justify-center gap-1 rounded-md bg-neutral-50 dark:bg-neutral-600","ring-1 ring-neutral-300 dark:ring-neutral-500 ",t.disabled&&"cursor-not-allowed","w-[78px]","relative"),onClick:()=>{var n;return(n=t.onCheckedChange)==null?void 0:n.call(t,!t.checked)},children:t.checked?e.jsx("span",{className:"truncate leading-none text-sm",children:s("generation:booster.action.remove.label")}):e.jsxs(e.Fragment,{children:[t.shouldShowMembershipBadge?e.jsx(Tn,{className:"size-4"}):e.jsx(ga,{className:"size-4 shrink-0"}),e.jsx("span",{className:"truncate leading-none text-sm",children:s("generation:booster.action.add.label")})]})})]})}function Tt(t){const s=e.jsxs(e.Fragment,{children:[e.jsx(t.startIcon,{className:"[@media(any-hover:hover)]:group-hover:hidden"}),t.enableClose&&e.jsx("button",{onClick:t.onClose,className:"hidden [@media(any-hover:hover)]:group-hover:block",children:e.jsx(un,{className:"text-neutral-600 dark:text-neutral-400"})})]}),n=t.endIcons?e.jsx(t.endIcons,{className:w("text-neutral-600 dark:text-neutral-400",t.disabled?"text-neutral-200 dark:text-neutral-700":"hover:text-feat-brand-100")}):null;return e.jsxs("div",{className:w("flex items-center gap-1",t.className),style:t.style,children:[e.jsxs("div",{className:w("group","py-[3px] grid grid-flow-col gap-1 items-center rounded-full transition duration-75 ease-out","pl-2 pr-3 dense:pl-2 dense:pr-2","bg-neutral-50 dark:bg-neutral-700","ring-1 ring-neutral-300 dark:ring-neutral-500 hover:ring-feat-brand-100","outline-none select-none","text-sm font-medium",t.disabled&&"cursor-not-allowed text-neutral-200 dark:text-neutral-800 line-through hover:ring-neutral-300 hover:dark:ring-neutral-700",t.endIcons?"grid-cols-[1rem_1fr_auto] dense:grid-cols-[1rem_auto]":"grid-cols-[1rem_1fr]"),children:[e.jsx("div",{className:"flex items-center",children:s}),e.jsx("div",{className:w("content",t.contentClassName),children:t.children}),n&&e.jsx("div",{className:"flex items-center dense:col-span-2",children:n})]}),t.enableClose&&e.jsx("button",{onClick:t.onClose,className:"block [@media(any-hover:hover)]:hidden",children:e.jsx(un,{className:"size-4 text-neutral-600 dark:text-neutral-400"})})]})}const Gl=c.forwardRef(function(s,n){const{className:a,shouldHighLight:o,...i}=s,{t:r}=C(["generation"]),{denseMode:l}=qn();return e.jsxs(Ke,{className:w("relative","py-[3px] flex items-center pl-[14px] gap-1 pr-2 rounded-full transition duration-75 ease-out","bg-neutral-50 dark:bg-neutral-700","ring-1","outline-none","text-sm font-medium",o?"ring-feat-brand-100/40":"ring-neutral-300 dark:ring-neutral-500",a),...i,ref:n,style:o?{"--size":48,"--duration":4,"--anchor":90,"--border-width":2,"--color-from":"#9535EA","--color-via":"#EA79F1","--color-to":"#FB7188","--delay":"-9s"}:void 0,children:[e.jsx("div",{className:w("pointer-events-none absolute inset-[-1px] rounded-[inherit] [border:calc(var(--border-width)*1px)_solid_transparent]","![mask-clip:padding-box,border-box] ![mask-composite:intersect] [mask:linear-gradient(transparent,transparent),linear-gradient(white,white)]","after:absolute after:aspect-[3/1] after:w-[calc(var(--size)*1px)] after:animate-border-beam after:[animation-delay:var(--delay)] after:[background:linear-gradient(to_left,var(--color-from),var(--color-via),var(--color-to),transparent)] after:[offset-anchor:calc(var(--anchor)*1%)_50%] after:[offset-path:rect(0_auto_auto_0_round_calc(var(--size)*1px))]")}),r("generation:booster.add-booster.label",{context:l}),e.jsx(ga,{className:"size-4"})]})}),Na=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11S7 10.33 7 9.5S7.67 8 8.5 8zm8.25 6.75c-.95 1.64-2.72 2.75-4.75 2.75s-3.8-1.11-4.75-2.75c-.19-.33.06-.75.44-.75h8.62c.39 0 .63.42.44.75zM15.5 11c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"})});function As(){const{setValues:t,values:s}=P(),{enableADetailer:n}=s,a=!!n,o=c.useCallback(i=>{T("facefix_select",{checked:i}),t(i?r=>({...r,enableADetailer:!0}):Pn(r=>{delete r.enableADetailer}))},[]);return[{enabled:a},o]}function Zl(t){const{t:s}=C(["generation"]),[n,a]=As();return n.enabled?e.jsx(e.Fragment,{children:e.jsx(Tt,{enableClose:!0,contentClassName:"dense:hidden",startIcon:Na,onClose:()=>{a(!1)},...t,children:s("generation:booster.face-fix.label")})}):null}function Wl(t){const{t:s}=C(["generation"]),[{enabled:n},a]=As();return e.jsx(Mt,{startIcon:Na,label:s("generation:booster.face-fix.label"),checked:n,helpText:s("generation:booster.face-fix.help"),onCheckedChange:o=>{var i;(i=t.afterCheckedChange)==null||i.call(t,o),a(o)}})}const Rs=t=>e.jsx("svg",{viewBox:"0 0 48 48",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:4,d:"M41.5 10h-6m-8-4v8m0-4h-22m8 14h-8m16-4v8m22-4h-22m20 14h-6m-8-4v8m0-4h-22"})}),Kl=2,ql=28,Ql=.6,Jl=1.5,Xl=15,Yl=.55;function ec(t){return t?{scale:Jl,step:Xl,strength:Yl}:{scale:Kl,step:ql,strength:Ql}}function Ds(){const{setValues:t,values:s}=P(),{upscale:n,modelId:a,width:o,height:i}=s,r=X(a),l=ts(r==null?void 0:r.modelType),d=ec(l),u=(n??1)>1,m=c.useCallback(f=>{T("hires_enabled_selected",{checked:f}),t(f?b=>({...b,batchSize:1,upscale:d.scale}):b=>{const p={...b};return delete p.upscale,delete p.upscaleDenoisingSteps,delete p.upscaleDenoisingStrength,delete p.upscaleSampler,p})},[]),g=c.useMemo(()=>({scale:s.upscale>1?s.upscale:d.scale,step:d.step,strength:d.strength,upscaleSampler:""}),[d,s.upscale]),h=c.useCallback(f=>{t(b=>({...b,upscale:f.scale,upscaleDenoisingSteps:f.step,upscaleDenoisingStrength:f.strength,upscaleSampler:f.upscaleSampler}))},[]),x=c.useMemo(()=>({width:o,height:i}),[o,i]);return[{enabled:u},m,{formDefaults:g,setHiresValues:h,hiresValues:x}]}function tc(t){const{t:s}=C(["generation"]),[n,a,{formDefaults:o,setHiresValues:i,hiresValues:r}]=Ds(),l=c.useRef(null);return n.enabled?e.jsxs(e.Fragment,{children:[e.jsx(Tt,{enableClose:!0,contentClassName:"dense:hidden",startIcon:la,onClose:()=>{a(!1)},endIcons:d=>e.jsx("button",{onClick:()=>{var u;(u=l.current)==null||u.open()},disabled:d.disabled,children:e.jsx(Rs,{className:d.className})}),...t,children:s("generation:booster.hires.label")}),e.jsx(nc,{ref:l,width:r.width,height:r.height,formDefaults:o,onConfirm:d=>{i(d)}})]}):null}function sc(t){const{t:s}=C(["generation"]),[{enabled:n},a]=Ds();return e.jsx(Mt,{startIcon:la,label:s("generation:booster.hires.label"),checked:n,helpText:s("generation:booster.hires.help"),onCheckedChange:o=>{var i;(i=t.afterCheckedChange)==null||i.call(t,o),a(o)}})}const nc=c.forwardRef(function({width:s,height:n,onConfirm:a,formDefaults:o},i){const{t:r}=C(["generation","action"]),l=Ni({width:s,height:n}),d=l&&l>1&&s&&n,u={min:.4,max:.6},[{scale:m,step:g,strength:h,upscaleSampler:x},f]=c.useState(o),[b,p]=c.useState(!1),j=()=>{T("add_composition_success"),a({scale:m,step:g,strength:h,upscaleSampler:x}),p(!1)};return c.useImperativeHandle(i,()=>({open:()=>p(!0),close:()=>p(!1),reset:v=>f(v)}),[]),e.jsxs(ss,{open:b,onClose:()=>p(!1),PaperProps:{sx:{minWidth:400}},children:[e.jsx(Ln,{className:"font-bold",children:r("generation:hires.dialog.title")}),d?e.jsxs(pt,{children:[e.jsx(Ks,{className:"text-base text-primary-light",children:r("generation:hires.resolution.label")}),e.jsxs("div",{className:"flex gap-4 pt-2 items-center",children:[e.jsx(nt,{className:"max-w-[400px]",value:m,onChange:(v,k)=>{f(_=>({..._,scale:k}))},min:1,max:l,step:.1,valueLabelDisplay:"auto"}),e.jsx("p",{children:m.toFixed(1)})]}),e.jsxs("p",{children:[s,"×",n," → ",nn(s,m),"×",nn(n,m)]}),e.jsxs("div",{className:"pt-8",children:[e.jsx(an,{title:r("generation:hires.strength.label"),value:h,inputProps:{min:.01,max:.99,step:.01},safeRange:u,handleChange:v=>{f(k=>({...k,strength:v}))}}),e.jsx("p",{className:w("text-sm text-gray-400",h<u.min||h>u.max?"text-red-500":""),children:r("generation:hires.strength.description")})]}),e.jsx("div",{className:"pt-8",children:e.jsx(an,{title:r("generation:hires.steps.label"),value:g,inputProps:{min:1,max:50,step:1},handleChange:v=>{f(k=>({...k,step:v}))}})}),e.jsx("div",{className:"pt-8",children:e.jsx(ac,{value:x,onChange:v=>{const k=v.target.value;f(_=>({..._,upscaleSampler:k}))},selectClassName:"mt-1"})})]}):e.jsx(pt,{children:e.jsx(Ks,{children:r("generation:upscale.limit-reached")})}),e.jsxs(Nt,{className:"pb-4",children:[e.jsx(z,{onClick:()=>p(!1),children:r("action:cancel")}),d&&e.jsx(z,{variant:"contained",className:"font-bold",onClick:j,children:r("action:confirm")})]})]})});function ac({value:t="",onChange:s,selectClassName:n,disabled:a}){const{t:o}=C(["generation"]),{data:i,isValidating:r}=ns(),{samplingMethods:l=[]}=i??{};return e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-base text-primary-light",children:o("generation:hires.sampler-select.label")}),e.jsx(as,{className:"flex gap-2 items-center",children:r&&l.length<1?e.jsx(Fr,{}):e.jsxs(En,{fullWidth:!0,disabled:a,className:w("max-w-[500px]",n),value:t,displayEmpty:!0,onChange:s,children:[e.jsx(He,{value:"",children:o("generation:hires.sampler-select.empty-placeholder")}),l.map(d=>e.jsx(He,{value:d,children:d},d))]})})]})}const oc=We({base:"group relative grid grid-cols-[1fr_auto] items-center gap-8 cursor-default select-none py-1.5 px-2.5 rounded-md will-change-transform text-sm forced-color-adjust-none",variants:{isSelected:{false:"text-neutral-700 dark:text-neutral-200 hover:bg-violet-200 dark:hover:bg-violet-500 -outline-offset-2",true:"bg-violet-700 text-white forced-colors:bg-[Highlight] forced-colors:text-[HighlightText] [&:has(+[data-selected])]:rounded-b-none [&+[data-selected]]:rounded-t-none -outline-offset-4 outline-white dark:outline-white forced-colors:outline-[HighlightText]"},isDisabled:{true:"text-slate-300 dark:text-zinc-600 forced-colors:text-[GrayText]"}}});function ic(t){const{startIcon:s,endIcon:n,className:a,...o}=t;return e.jsx(hr,{...o,className:xt(a,(i,r)=>oc({...r,className:i})),children:xt(t.children,i=>e.jsxs(e.Fragment,{children:[s,i,n]}))})}const rc=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"m9.4 16.5l2.6-2.6l2.6 2.6l1.4-1.4l-2.6-2.6L16 9.9l-1.4-1.4l-2.6 2.6l-2.6-2.6L8 9.9l2.6 2.6L8 15.1l1.4 1.4ZM7 21q-.825 0-1.413-.588T5 19V6H4V4h5V3h6v1h5v2h-1v13q0 .825-.588 1.413T17 21H7Z"})}),Sa=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M5.5 7A1.5 1.5 0 0 1 4 5.5A1.5 1.5 0 0 1 5.5 4A1.5 1.5 0 0 1 7 5.5A1.5 1.5 0 0 1 5.5 7m15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59c.55 0 1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41c0-.56-.23-1.06-.59-1.42Z"})}),[Pt,lc]=Ps({order:[]});Pt.displayName="BoosterControlItemOrderContext";function cc(t){const[,s]=c.useContext(Pt);return c.useCallback(a=>{s(o=>{const{order:i}=o,r=i.filter(l=>l===t);return{...o,order:a?[...r,t]:r}})},[t])}const Ia="COMMON",dc={tags:{}},uc=Yt(io,dc),mc=Qe(!1),hc=Qe(!1);function $s(){var K;const t=cc("QualityTag"),{t:s}=C(["generation"]),{beingMember:n,me:a}=Xt(),o=!!(a!=null&&a.id),{data:i,isLoading:r,mutate:l}=ro(n?{type:Ht.QualityTag,last:1}:void 0),[d,u]=Oe(mc),[m,g]=Oe(hc),{setValues:h,values:x}=P(),{modelId:f}=x,b=X(f),p=b==null?void 0:b.modelId,[j,v]=ra(uc),k=c.useMemo(()=>{var L;return p?(L=j==null?void 0:j.tags)==null?void 0:L[p]:void 0},[p,j]),_=lo((K=b==null?void 0:b.model)==null?void 0:K.extra),y=c.useMemo(()=>_==null?void 0:_[0],[_]),E=c.useMemo(()=>k??y,[k,y]),M=c.useMemo(()=>{var L,F;return!!((L=x.qualityTag)!=null&&L.prefix)||!!((F=x.qualityTag)!=null&&F.suffix)},[x.qualityTag]),S=c.useMemo(()=>x.qualityTag,[x.qualityTag]),A=c.useCallback(L=>{T("quality_tag_enabled_selected",{checked:L}),h(F=>({...F,qualityTag:L&&!F.qualityTag?E:void 0})),t(L)},[E]),W=c.useCallback(L=>{p&&(v(F=>{F.tags[p]=L}),h(F=>({...F,qualityTag:L})))},[p,v]),I=c.useMemo(()=>{var L,F,ue;return((ue=(F=(L=os(i))==null?void 0:L[0])==null?void 0:F.data)==null?void 0:ue[Ia])??[]},[i]),U=_&&_.length>0,q=I.length>0,Q=c.useCallback(L=>{if(!L)return A(L);if(U)return g(!0);if(!o)return se();if(!n)return V();q?g(!0):u(!0)},[U,n,q,A,o]),V=c.useCallback(()=>{Ye.confirm({heading:s("generation:booster.quality-tag.membership-confirm-dialog.title"),content:s("generation:booster.quality-tag.membership-confirm-dialog.description")}).then(L=>{L&&ft({trackingLocation:"add-booster-add-quality-tag"})})},[]);return[{enabled:M,modelHasPresetTags:U,userCanAddCustomTags:n,openAddDialog:d,openDialog:m},{toggleQualityTag:A,setOpenAddDialog:u,setOpenDialog:g,onAddRemoveClick:Q,mutateSettings:l,setQualityTagValue:W},{presetQualityTags:_,customQualityTags:I,qualityTagValue:S,modelId:p}]}async function _a(t){var h,x;const s=Ia,{payload:n,type:a}=t;a==="add"&&is(Or,n);const o=await gt.getMySettings({type:Ht.QualityTag,last:1}),i=(x=os((h=o.me)==null?void 0:h.settings))==null?void 0:x[0],r=i==null?void 0:i.id,l=i==null?void 0:i.data,d=(l==null?void 0:l[s])??[];if(a==="add"&&d.some(f=>f.prefix===n.prefix&&f.suffix===n.suffix))throw new Error("Tag already added");const m=Pn(d,f=>{a==="add"&&f.push(n),a==="remove"&&f.splice(n.index,1)}),g={...l,[s]:m};return gt.upsertMySetting({id:r,type:Ht.QualityTag,data:g})}const gc=3;function fc(t){const{t:s}=C(["generation"]),[n,a,{presetQualityTags:o=[],qualityTagValue:i,customQualityTags:r,modelId:l}]=$s();return e.jsxs(e.Fragment,{children:[n.enabled&&e.jsx(Tt,{enableClose:!0,contentClassName:"dense:hidden",startIcon:Sa,onClose:()=>{a.toggleQualityTag(!1)},endIcons:d=>e.jsx("button",{onClick:()=>{a.setOpenDialog(!0)},disabled:d.disabled,children:e.jsx(Rs,{className:d.className})}),...t,children:s("generation:quality-tag.label")}),e.jsx(pc,{qualityTag:i,presetQualityTags:o,customQualityTags:r,setQualityTagValue:a.setQualityTagValue,mutateSettings:a.mutateSettings,toggleQualityTag:a.toggleQualityTag,onCustomize:()=>{n.userCanAddCustomTags?a.setOpenAddDialog(!0):ft({trackingLocation:"quality-tag-dialog-customize"})},open:n.openDialog,onClose:()=>a.setOpenDialog(!1),modelId:l,userCanAddCustomTags:n.userCanAddCustomTags}),e.jsx(vc,{open:n.openAddDialog,onClose:()=>a.setOpenAddDialog(!1),modelId:l,openQualityTagDialog:()=>a.setOpenDialog(!0),mutateSettings:a.mutateSettings,customQualityTags:r})]})}function xc(t){const{t:s}=C(["generation"]),[{enabled:n,userCanAddCustomTags:a,modelHasPresetTags:o},i]=$s();return e.jsx(Mt,{startIcon:Sa,label:s("generation:booster.quality-tag.label"),checked:n,helpText:s("generation:booster.quality-tag.help"),onCheckedChange:r=>{var l,d;i.onAddRemoveClick(r),(l=t.closeMenu)==null||l.call(t),(d=t.afterCheckedChange)==null||d.call(t)},shouldShowMembershipBadge:!o&&!a})}function pc(t){const{open:s,onClose:n,...a}=t;return e.jsx(Ye,{open:s,onClose:n,dismissable:!0,className:"w-screen max-w-screen-sm",children:e.jsx(bc,{onClose:n,...a})})}function bc(t){const{t:s}=C(["generation"]),{setQualityTagValue:n,toggleQualityTag:a,onCustomize:o,onClose:i,presetQualityTags:r,customQualityTags:l,qualityTag:d}=t,[u,m]=c.useState(d??{}),g=te(u),h=c.useCallback(()=>{n(u),i()},[i,u]),x=c.useCallback(b=>{var p;te(b)===g&&m({}),te(b)===te(d??{})&&(a(!1),n({})),(p=t.mutateSettings)==null||p.call(t)},[d,g]),f=l.length>=gc;return e.jsxs(e.Fragment,{children:[e.jsx(rs,{heading:s("generation:quality-tag.label")}),e.jsxs(ls,{children:[e.jsxs("div",{className:"flex flex-col pb-6 gap-1",children:[e.jsx("label",{children:s("generation:quality-tag.use-for-current-model")}),e.jsx("p",{className:"p-2 bg-background-light rounded-md",children:u.prefix||u.suffix?g:s("generation:booster.quality-tag.select-dialog.not-set")})]}),e.jsx(jc,{value:g,customQualityTags:l,presetQualityTags:r,onChange:b=>{const j=[...l,...r].find(v=>{if(te(v)===b)return v});m(j??{})},onCustomTagDeleted:x}),f&&e.jsx(ie,{type:re.Warning,className:"mt-4 text-sm",children:s("generation:booster.quality-tag.add-dialog.no-more-than-3-message")})]}),e.jsxs(cs,{children:[e.jsx($,{variant:"outlined",endIcon:e.jsx(Tn,{className:"size-4"}),disabled:f,onPress:()=>o(),children:s("generation:booster.quality-tag.select-dialog.customize.label")}),e.jsx($,{variant:"outlined",className:"ml-auto",onPress:i,children:s("action:cancel")}),e.jsx($,{variant:"filled",className:"font-medium",onPress:h,children:s("action:confirm")})]})]})}function jc({value:t="",presetQualityTags:s=[],customQualityTags:n=[],onChange:a,onCustomTagDeleted:o}){const{t:i}=C(["generation"]),r=n.length<1,l=s.length<1;return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-base text-primary-light mb-2",children:i("generation:quality-tag.select")}),r&&l?e.jsx(fa,{description:"No preset tags"}):e.jsxs(gr,{"aria-label":"Model Preset Tag",selectionMode:"single",className:"border-2 p-1 rounded-xl flex flex-col gap-1",selectedKeys:[t],onSelectionChange:d=>a==null?void 0:a([...d][0]),children:[!r&&e.jsxs(qs,{children:[e.jsx(Qs,{className:"px-1 font-semibold text-sm pb-0.5",children:i("generation:booster.quality-tag.select-dialog.header.custom")}),n.map((d,u)=>e.jsx(mn,{id:te(d),qualityTag:d,isPreset:!1,onCustomTagDeleted:o,index:u},`${te(d)}-${u}`))]}),!l&&e.jsxs(qs,{children:[e.jsx(Qs,{className:"px-1 font-semibold text-sm pb-0.5",children:i("generation:booster.quality-tag.select-dialog.header.preset")}),s.map((d,u)=>e.jsx(mn,{id:te(d),qualityTag:d,isPreset:!0},`${te(d)}-${u}`))]})]})]})}function mn(t){const{t:s}=C(["generation"]),n=te(t.qualityTag),a=!t.isPreset&&t.index!=null,[o,i]=kt(async()=>{var l;try{if(t.index==null||!await Ye.confirm({content:s("generation:booster.quality-tag.select-dialog.delete-confirm.title")}))return;await _a({payload:{index:t.index},type:"remove"}),(l=t.onCustomTagDeleted)==null||l.call(t,t.qualityTag),D.success(s("generation:booster.quality-tag.select-dialog.notice.tag-delete-success"))}catch(d){D.error(`${s("generation:booster.quality-tag.select-dialog.notice.tag-delete-failed")}: ${d.message}`)}},[t.qualityTag,t.index]),r=a?e.jsx($,{variant:"ghost",onPress:i,busy:o.loading,busyLabel:e.jsx(e.Fragment,{}),children:e.jsx(rc,{className:"text-red-400 size-4"})}):void 0;return e.jsx(ic,{id:t.id,textValue:t.id,endIcon:r,children:e.jsx("span",{className:"truncate",title:n,children:n})})}function vc(t){const s=()=>{var n,a;(n=t.mutateSettings)==null||n.call(t),(a=t.openQualityTagDialog)==null||a.call(t),t.onClose()};return e.jsx(Ye,{open:t.open,onClose:()=>t.onClose(),dismissable:!0,className:"w-screen max-w-screen-sm",children:e.jsx(Cc,{onConfirm:s,onCancel:()=>t.onClose(),modelId:t.modelId,customQualityTags:t.customQualityTags})})}function Cc(t){var l;const{t:s}=C(["action"]),[n,a]=c.useState(!1),[o,i]=kt(async d=>{d.preventDefault();const u=Object.fromEntries(new FormData(d.currentTarget));try{await _a({payload:u,type:"add"}),T("customize_quality_tag_success"),D.success(s("generation:booster.quality-tag.add-dialog.notice.tag-add-success")),t.onConfirm()}catch(m){D.error(`${s("generation:booster.quality-tag.add-dialog.notice.tag-add-failed")}: ${m.message}`)}},[]),r=((l=t.customQualityTags??[])==null?void 0:l.length)<3;return e.jsxs(e.Fragment,{children:[e.jsx(rs,{heading:s("generation:booster.quality-tag.add-dialog.title")}),e.jsxs(_s,{className:"contents",onSubmit:i,children:[e.jsxs(ls,{children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs(Ae,{name:"prefix",className:"flex flex-col",children:[e.jsx(Re,{className:"font-medium",children:s("generation:booster.quality-tag.add-dialog.prefix.label")}),e.jsx(mt,{variant:"rounded-normal",maxLength:250})]}),e.jsx($,{variant:"ghost",className:"flex items-center justify-center w-full rounded-lg focus:outline-none my-2",onPress:()=>{a(d=>!d)},children:e.jsx(An,{className:"size-6"})}),e.jsxs("section",{className:w(!n&&"hidden"),children:[e.jsxs(Ae,{className:"flex flex-col",children:[e.jsx(Re,{className:"font-medium",children:s("generation:booster.quality-tag.add-dialog.prompts.label")}),e.jsx(mt,{value:co,disabled:!0,variant:"rounded-normal"})]}),e.jsxs(Ae,{name:"suffix",className:"flex flex-col",children:[e.jsx(Re,{className:"font-medium",children:s("generation:booster.quality-tag.add-dialog.suffix.label")}),e.jsx(mt,{variant:"rounded-normal",maxLength:250})]})]})]}),!r&&e.jsx(ie,{type:re.Warning,className:"mt-4",children:s("generation:booster.quality-tag.add-dialog.no-more-than-3-message")})]}),e.jsxs(cs,{children:[e.jsx($,{busy:o.loading,className:"ml-auto",onPress:t.onCancel,children:s("action:cancel")}),e.jsx($,{busy:o.loading,type:"submit",className:"font-semibold",variant:"filled",disabled:!r,children:s("action:confirm")})]})]})]})}const Ma=t=>e.jsx("svg",{viewBox:"0 0 256 256",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M240.49 175.51a12 12 0 0 1 0 17l-24 24a12 12 0 0 1-17-17L203 196h-2.09a76.17 76.17 0 0 1-61.85-31.83l-41.68-58.39A52.1 52.1 0 0 0 55.06 84H32a12 12 0 0 1 0-24h23.06a76.17 76.17 0 0 1 61.85 31.83l41.71 58.39A52.1 52.1 0 0 0 200.94 172H203l-3.52-3.51a12 12 0 0 1 17-17Zm-95.62-72.62a12 12 0 0 0 16.93-1.13A52 52 0 0 1 200.94 84H203l-3.52 3.51a12 12 0 0 0 17 17l24-24a12 12 0 0 0 0-17l-24-24a12 12 0 0 0-17 17L203 60h-2.09a76 76 0 0 0-57.2 26a12 12 0 0 0 1.16 16.89Zm-33.74 50.22a12 12 0 0 0-16.93 1.13A52 52 0 0 1 55.06 172H32a12 12 0 0 0 0 24h23.06a76 76 0 0 0 57.2-26a12 12 0 0 0-1.13-16.89Z"})});function yc(t){const{t:s}=C(["generation"]),[n,a,{updateStyleMix:o,canStyleMix:i,shuffleStyleMix:r}]=Ms(),l=c.useRef(null);if(!n.enabled)return null;const d=({className:m,disabled:g})=>e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("button",{disabled:g,onClick:()=>{T("stylemix_shuffle_click"),r()},children:e.jsx(Ma,{className:w(m,"size-4")})}),e.jsx("button",{disabled:g,onClick:()=>{var h;T("stylemix_settings_click"),(h=l.current)==null||h.open()},children:e.jsx(Rs,{className:w(m,"size-4")})})]}),u=typeof n.seed=="number";return e.jsxs(e.Fragment,{children:[e.jsx(Tt,{enableClose:!0,startIcon:Ta,onClose:()=>{a(!1)},endIcons:d,...t,disabled:!i,children:e.jsxs("div",{className:"relative select-none",children:[e.jsx("span",{className:"opacity-0",children:De({withPrefix:!0,seed:0})}),e.jsxs(ds,{children:[!u&&e.jsx(bt.span,{className:w("absolute left-0 overflow-hidden"),initial:{width:0,opacity:0},animate:{width:"100%",opacity:1},exit:{width:0,opacity:0},transition:{type:"ease-linear",duration:.5},children:s("generation:booster.style-mix.label")},n.seed),u&&e.jsx(bt.span,{className:"absolute overflow-hidden flex top-0",initial:{width:0,opacity:0},animate:{width:"100%",opacity:1},exit:{width:0,opacity:0},transition:{type:"ease-linear",duration:.5},children:De({seed:n.seed,withPrefix:!0})},n.seed)]})]})}),e.jsx(kc,{ref:l,onConfirm:m=>{o(m)},initState:{seed:typeof n.seed=="number"?fr(n.seed):void 0,weight:n.weight??jt}},`${n.seed}-${n.weight}`)]})}function wc(t){const{t:s}=C(["generation"]),[{enabled:n},a,{canStyleMix:o}]=Ms();return e.jsx(Mt,{startIcon:Ta,label:s("generation:booster.style-mix.label"),checked:n,helpText:e.jsx(Jt,{className:"prose dark:prose-invert mx-auto text-sm",children:s("generation:booster.style-mix.help")}),onCheckedChange:i=>{var r;(r=t.afterCheckedChange)==null||r.call(t,i),a(i)},disabled:!o})}const kc=c.forwardRef(function({onConfirm:s,initState:n},a){const{t:o}=C(["generation","action"]),[i,r]=c.useState({seed:De({padStart:!0}),weight:jt,...n}),[l,d]=c.useState(!1);c.useImperativeHandle(a,()=>({open:()=>d(!0),close:()=>d(!1),reset:h=>r({seed:De({padStart:!0,seed:h.seed}),weight:n.weight??jt})}),[]);const u=c.useCallback(()=>{T("stylemix_settings_shuffle_click"),r(h=>({...h,seed:De({padStart:!0})}))},[]),m=/^\d{1,5}$/,g=c.useCallback(h=>{h.preventDefault(),m.test(i.seed)?(T("stylemix_settings_confirm"),d(!1),s(i)):D.error(o("generation:style-mix.notice.invalid-seed"))},[i]);return e.jsxs(Ye,{open:l,onClose:()=>d(!1),dismissable:!0,className:"w-screen max-w-screen-xs",children:[e.jsx(rs,{heading:o("generation:style-mix.dialog.title")}),e.jsxs(_s,{onSubmit:g,autoCapitalize:"off",autoComplete:"off",className:"contents",children:[e.jsx(ls,{children:e.jsxs("section",{children:[e.jsxs(Ae,{isRequired:!0,name:"seed",type:"text",className:"grid grid-cols-[1fr_auto] gap-y-[10px] gap-x-1",validationBehavior:"native",children:[e.jsx(Re,{className:"col-span-2 font-semibold",children:o("generation:style-mix.style-seed")}),e.jsx(mt,{variant:"rounded-normal",className:"text-md font-medium",value:i.seed,onChange:h=>r(x=>({...x,seed:h.target.value})),required:!0,maxLength:5,inputMode:"numeric",placeholder:o("generation:style-mix.dialog.style-seed.placeholder")}),e.jsx(Ke,{className:"p-3",onPress:u,children:e.jsx(Ma,{className:"size-5"})})]}),e.jsx(Nc,{value:i.weight,onChange:h=>r(x=>({...x,weight:h})),className:"mt-8 pr-2 w-full"})]})}),e.jsx(cs,{children:e.jsx($,{variant:"filled",type:"submit",disabled:i.seed.length<1,className:"w-full",children:o("action:confirm")})})]})]})});function Nc({value:t=jt,disabled:s,className:n,onChange:a}){const{t:o}=C(["generation"]);return e.jsx(Vr,{onChange:i=>{a==null||a(i)},className:n,value:t,maxValue:1,minValue:0,step:.1,isDisabled:s,label:e.jsx("span",{className:"font-semibold",children:o("generation:style-mix.weight")}),sliderOutputProps:{className:"font-medium text-sm"},variant:"half-filled"})}function Ta(t){return e.jsx("svg",{width:"16",height:"17",viewBox:"0 0 16 17",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.5055 4.76012L14.5188 4.82012C14.5188 4.83345 14.5222 4.85845 14.5255 4.88345C14.5288 4.90845 14.5322 4.93345 14.5322 4.94678V4.99345C14.5322 5.01345 14.5322 5.07345 14.5255 5.09345L14.5188 5.17345C14.5122 5.18678 14.4988 5.24678 14.4988 5.25345C14.4903 5.29794 14.4746 5.34074 14.4522 5.38012C14.4522 5.38678 14.4188 5.46678 14.4122 5.46678C14.3855 5.52012 14.3722 5.54012 14.3522 5.56678C14.3488 5.57012 14.3405 5.58178 14.3322 5.59345C14.3238 5.60511 14.3155 5.61678 14.3122 5.62012C14.3088 5.62678 14.2988 5.63845 14.2888 5.65012C14.2788 5.66178 14.2688 5.67345 14.2655 5.68012L14.1655 5.76678C14.1588 5.77345 14.1388 5.78678 14.1188 5.80012C14.1055 5.81345 14.0855 5.82678 14.0722 5.83345C14.0722 5.83345 14.0588 5.84012 14.0522 5.84678C14.0175 5.86908 13.9791 5.88489 13.9388 5.89345C13.9388 5.89719 13.9346 5.89883 13.9298 5.90074C13.926 5.90222 13.9218 5.90386 13.9188 5.90678L13.7855 5.94678C13.7722 5.94678 13.7188 5.95345 13.7055 5.96012C13.6965 5.96012 13.6817 5.9606 13.664 5.96118C13.6163 5.96275 13.548 5.96498 13.5188 5.96012C13.5188 5.96012 13.4855 5.96012 13.4588 5.95345C13.4488 5.95012 13.4305 5.94678 13.4122 5.94345C13.3938 5.94012 13.3755 5.93678 13.3655 5.93345C13.3544 5.92901 13.3433 5.9253 13.3322 5.9216C13.3167 5.91645 13.3013 5.9113 13.2858 5.90416C14.0998 7.07246 14.533 8.42808 14.533 9.84608C14.533 11.8128 13.6997 13.6594 12.1797 15.0527C12.1547 15.0749 12.1279 15.0949 12.0997 15.1127C12.093 15.1194 12.033 15.1594 12.033 15.1594L11.9464 15.2061C11.9397 15.2128 11.873 15.2394 11.873 15.2394C11.8697 15.2394 11.8647 15.2411 11.8597 15.2427C11.8547 15.2444 11.8497 15.2461 11.8464 15.2461C11.813 15.2594 11.773 15.2728 11.7464 15.2794L11.6864 15.2928C11.673 15.2928 11.648 15.2961 11.623 15.2994C11.598 15.3028 11.573 15.3061 11.5597 15.3061H11.513C11.493 15.3061 11.433 15.3061 11.413 15.2994L11.333 15.2928C11.3197 15.2861 11.2597 15.2727 11.253 15.2727C11.2085 15.2642 11.1658 15.2485 11.1264 15.2261C11.1197 15.2261 11.0397 15.1928 11.0397 15.1861C10.9864 15.1594 10.9664 15.1461 10.9397 15.1261C10.9364 15.1228 10.9247 15.1144 10.913 15.1061C10.9014 15.0978 10.8897 15.0894 10.8864 15.0861C10.8797 15.0828 10.868 15.0727 10.8564 15.0627C10.8447 15.0527 10.833 15.0427 10.8264 15.0394L10.7397 14.9394C10.733 14.9328 10.7197 14.9128 10.7064 14.8927C10.693 14.8794 10.6797 14.8594 10.673 14.8461C10.673 14.8461 10.6664 14.8328 10.6597 14.8261C10.6374 14.7914 10.6216 14.753 10.613 14.7128C10.6093 14.7128 10.6077 14.7085 10.6058 14.7037C10.6043 14.6999 10.6026 14.6957 10.5997 14.6927L10.5597 14.5594C10.5597 14.5461 10.553 14.4927 10.5464 14.4794C10.5464 14.4704 10.5459 14.4556 10.5453 14.4379C10.5437 14.3902 10.5415 14.3219 10.5464 14.2928C10.5464 14.2928 10.5464 14.2594 10.553 14.2327C10.5564 14.2227 10.5597 14.2044 10.563 14.1861C10.5664 14.1678 10.5697 14.1494 10.573 14.1394C10.5775 14.1283 10.5812 14.1172 10.5849 14.1061C10.5901 14.0904 10.5954 14.0747 10.6027 14.059C9.43589 14.8725 8.07864 15.3068 6.65885 15.3068C4.69218 15.3068 2.84551 14.4735 1.45218 12.9535C1.43648 12.9296 1.41862 12.9073 1.39885 12.8868C1.39551 12.8801 1.38718 12.8685 1.37885 12.8568C1.37051 12.8451 1.36218 12.8335 1.35885 12.8268C1.11885 12.4535 1.15218 11.9468 1.45218 11.6135C1.59885 11.4601 1.77885 11.3601 1.97885 11.3268C2.05885 11.3135 2.12551 11.3135 2.18551 11.3201C2.19151 11.3201 2.20289 11.3215 2.21542 11.3229C2.23077 11.3248 2.24784 11.3268 2.25885 11.3268C2.26484 11.3268 2.27218 11.3281 2.28026 11.3296C2.29016 11.3314 2.30117 11.3335 2.31218 11.3335C2.32549 11.3335 2.38533 11.3534 2.44524 11.3734C1.63323 10.2073 1.19971 8.85124 1.19971 7.43275C1.19971 5.46608 2.03304 3.61942 3.55304 2.22608C3.57685 2.21038 3.59916 2.19253 3.61971 2.17275C3.62637 2.16942 3.63804 2.16108 3.64971 2.15275C3.66137 2.14442 3.67304 2.13608 3.67971 2.13275C4.05304 1.89275 4.55971 1.92608 4.89304 2.22608C5.04637 2.37275 5.14637 2.55275 5.17971 2.75275C5.19304 2.83275 5.19304 2.89942 5.18637 2.95942C5.18637 2.96541 5.18503 2.97679 5.18354 2.98932C5.18173 3.00467 5.17971 3.02174 5.17971 3.03275C5.17971 3.03874 5.17836 3.04608 5.17688 3.05417C5.17506 3.06406 5.17304 3.07507 5.17304 3.08608C5.17304 3.09935 5.15324 3.15881 5.13335 3.2185C6.30094 2.40591 7.65542 1.97345 9.07218 1.97345C11.0388 1.97345 12.8855 2.80678 14.2788 4.32678C14.3009 4.35181 14.321 4.37856 14.3388 4.40678C14.3455 4.41345 14.3855 4.47345 14.3855 4.47345L14.4322 4.56012C14.4388 4.56678 14.4655 4.63345 14.4655 4.63345C14.4655 4.63678 14.4672 4.64178 14.4688 4.64678C14.4705 4.65178 14.4722 4.65678 14.4722 4.66012C14.4855 4.69345 14.4988 4.73345 14.5055 4.76012ZM9.90593 10.6786C8.76308 11.6551 6.98514 11.6597 5.84246 10.6922C4.85107 9.56397 4.83999 7.77598 5.80923 6.62081C6.94193 5.6208 8.74392 5.61236 9.90029 6.59547C10.8854 7.74297 10.8872 9.53477 9.90593 10.6786Z",fill:"currentColor"})})}const Sc="generator::add-booster-help-shown";function Ic(){const[t]=As(),[s]=Ds(),[n]=$s(),[a]=Ms();return c.useMemo(()=>t.enabled||s.enabled||n.enabled||a.enabled,[t.enabled,s.enabled,n.enabled,a.enabled])}function _c(t){const s=Ic(),[n,a]=Rn(Sc,!1),o=c.useRef(null),[,i]=c.useContext(Pt),{t:r}=C(["generation"]),[l,d]=c.useState(!1),u=c.useCallback((x,f)=>{d(!1),f!=null&&i(b=>{const{order:p}=b,j=p.filter(v=>v===x);return{...b,order:f?[...j,x]:j}})},[]);c.useEffect(()=>{n||d(!0)},[n]);const m=e.jsx(Gl,{ref:o,className:t.className,onPress:()=>{T("booster_click")},shouldHighLight:!s}),g=c.useCallback(x=>[e.jsx(Wl,{afterCheckedChange:f=>u("FaceFix",f)},"face-fix"),e.jsx(sc,{afterCheckedChange:f=>u("HiRes",f)},"hires"),e.jsx(xc,{afterCheckedChange:f=>u("QualityTag",f),closeMenu:x.closeMenu},"quality-tag"),e.jsx(wc,{afterCheckedChange:f=>u("StyleMix",f)},"style-mix")],[u]),h=e.jsx(Ul,{isOpen:l,PopoverProps:{triggerRef:o,crossOffset:76},onOpenChange:x=>{d(x),a(!0)},placement:"bottom",showArrow:!0,className:"w-[280px]",children:e.jsx("p",{className:"p-4",children:r("generation:booster.add-booster.help")})});return e.jsxs(e.Fragment,{children:[!n&&h,e.jsxs(uo,{children:[m,e.jsxs(_n,{placement:"bottom start",className:"min-w-[268px] bg-modal-background rounded-2xl shadow-[0_0_20px_0_rgba(0,0,0,0.25)]",offset:16,children:[e.jsx(Mn,{className:"group",children:e.jsx("svg",{viewBox:"0 0 12 12",className:"block fill-modal-background group-placement-bottom:rotate-180 group-placement-left:-rotate-90 group-placement-right:rotate-90 w-4 h-4",children:e.jsx("path",{d:"M0 0L6 6L12 0"})})}),e.jsx(mo,{className:"outline-none",children:({close:x})=>e.jsxs(e.Fragment,{children:[e.jsxs(ho,{className:"flex p-4 items-center border-b dark:border-zinc-600 border-zinc-200 [&>button]:ml-auto [&>button]:cursor-pointer [&>button>svg]:size-4 [&>button>svg]:text-zinc-500 [&>button>svg]:dark:text-zinc-400",children:[e.jsx("span",{className:"font-medium",children:r("generation:booster.add-booster.title")}),e.jsx("button",{onClick:x,children:e.jsx(xe,{})})]}),e.jsx("ul",{className:"px-4 py-1",children:g({closeMenu:x}).map((f,b)=>e.jsx("li",{children:f},b))})]})})]})]})]})}function Mc(){return e.jsx("section",{className:"flex flex-wrap gap-2 items-center",children:e.jsxs(lc,{children:[e.jsx(_c,{className:"order-1"}),e.jsx(Pc,{})]})})}const Tc=[{name:"HiRes",control:tc},{name:"FaceFix",control:Zl},{name:"QualityTag",control:fc},{name:"StyleMix",control:yc}];function Pc(){const[{order:t}]=c.useContext(Pt);return e.jsx(e.Fragment,{children:Tc.map(s=>e.jsx(s.control,{style:{order:t.indexOf(s.name)>=0?t.indexOf(s.name)+2:1}},s.name))})}function Lc(t){const{data:s}=ne(),{t:n}=C(["generation"]),[a,o]=c.useState(!1),{setValues:i}=P(),[r,l]=c.useState(),d=u=>{i(m=>({...m,prompts:u==null?void 0:u.prompt})),o(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(es,{delay:250,placement:"bottom end",trigger:e.jsx(Ke,{className:w("px-2 min-w-0 outline-none",t.className),onPress:()=>{if(T("base_image_captioning_click"),!s)return se();o(!0)},children:e.jsx(Ec,{className:"size-6"})}),children:e.jsx("p",{className:"p-4",children:n("generation:image-to-prompt.label")})}),e.jsx(Si,{open:a,onClose:()=>o(!1),children:r?e.jsx(Ii,{type:"upload",media:r,mediaId:r.id,onRemoveMedia:()=>l(void 0),onConfirmPrompt:d}):e.jsx("div",{className:"w-full p-6 pt-4 flex justify-center",children:e.jsx(Hr,{onChange:u=>l(u),value:r})})})]})}function Ec(t){return e.jsxs("svg",{width:"25",height:"25",viewBox:"0 0 25 25",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t,children:[e.jsx("rect",{x:"0.982518",y:"5.13584",width:"11.4884",height:"11.4884",rx:"1.8277",stroke:"currentColor",strokeWidth:"1.5666"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9.31189 9.52168C9.95565 9.52168 10.4775 8.99981 10.4775 8.35605C10.4775 7.7123 9.95565 7.19043 9.31189 7.19043C8.66814 7.19043 8.14627 7.7123 8.14627 8.35605C8.14627 8.99981 8.66814 9.52168 9.31189 9.52168ZM6.16954 11.8371C6.45866 12.3743 7.22941 12.374 7.51807 11.8365C7.76889 11.3694 8.40705 11.2925 8.76161 11.6867L11.9206 15.1982C12.5252 15.8703 12.0482 16.9411 11.1441 16.9411H4.77681L4.77679 16.9411L4.77678 16.941H1.65721C0.863057 16.941 0.359466 16.0898 0.741857 15.3938L3.52583 10.3263C3.92447 9.60074 4.96857 9.60528 5.36088 10.3343L6.16954 11.8371Z",fill:"currentColor"}),e.jsxs("mask",{id:"path-3-outside-1_5820_7111",maskUnits:"userSpaceOnUse",x:"8.12109",y:"8.61914",width:"17",height:"17",fill:"black",children:[e.jsx("rect",{x:"8.12109",y:"8.61914",width:"17",height:"17"}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.2099 10.6191C11.0563 10.6191 10.1211 11.5543 10.1211 12.7079V21.0631C10.1211 22.2167 11.0563 23.1519 12.2099 23.1519H20.5651C21.7187 23.1519 22.6539 22.2167 22.6539 21.0631V12.7079C22.6539 11.5543 21.7187 10.6191 20.5651 10.6191H12.2099ZM14.3709 19.9902V20.4665H18.5494V19.9902C17.7599 19.9902 17.3651 19.6726 17.3651 19.0376V13.9119C17.3651 13.7153 17.5253 13.617 17.8456 13.617C18.3669 13.617 18.7319 13.7645 18.9405 14.0593C19.1565 14.3541 19.2831 14.8002 19.3203 15.3974L19.9683 15.3407V12.8573C19.7747 12.8875 19.5587 12.9102 19.3203 12.9253C19.082 12.9404 18.8809 12.948 18.717 12.948H14.3039C14.1698 12.948 13.9873 12.9404 13.7564 12.9253C13.5255 12.9102 13.3132 12.8875 13.1196 12.8573L12.8067 15.3748L13.4994 15.4768C13.5665 15.1593 13.641 14.8834 13.7229 14.649C13.8123 14.4071 13.9166 14.2067 14.0357 14.048C14.1623 13.8892 14.3076 13.772 14.4715 13.6964C14.6428 13.6133 14.8439 13.5717 15.0748 13.5717C15.3802 13.5717 15.5328 13.6851 15.5328 13.9119V19.0376C15.5328 19.6726 15.1455 19.9902 14.3709 19.9902Z"})]}),e.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.2099 10.6191C11.0563 10.6191 10.1211 11.5543 10.1211 12.7079V21.0631C10.1211 22.2167 11.0563 23.1519 12.2099 23.1519H20.5651C21.7187 23.1519 22.6539 22.2167 22.6539 21.0631V12.7079C22.6539 11.5543 21.7187 10.6191 20.5651 10.6191H12.2099ZM14.3709 19.9902V20.4665H18.5494V19.9902C17.7599 19.9902 17.3651 19.6726 17.3651 19.0376V13.9119C17.3651 13.7153 17.5253 13.617 17.8456 13.617C18.3669 13.617 18.7319 13.7645 18.9405 14.0593C19.1565 14.3541 19.2831 14.8002 19.3203 15.3974L19.9683 15.3407V12.8573C19.7747 12.8875 19.5587 12.9102 19.3203 12.9253C19.082 12.9404 18.8809 12.948 18.717 12.948H14.3039C14.1698 12.948 13.9873 12.9404 13.7564 12.9253C13.5255 12.9102 13.3132 12.8875 13.1196 12.8573L12.8067 15.3748L13.4994 15.4768C13.5665 15.1593 13.641 14.8834 13.7229 14.649C13.8123 14.4071 13.9166 14.2067 14.0357 14.048C14.1623 13.8892 14.3076 13.772 14.4715 13.6964C14.6428 13.6133 14.8439 13.5717 15.0748 13.5717C15.3802 13.5717 15.5328 13.6851 15.5328 13.9119V19.0376C15.5328 19.6726 15.1455 19.9902 14.3709 19.9902Z",className:"fill-black dark:fill-[#CCC]"}),e.jsx("path",{d:"M14.3709 20.4665H12.8043V22.0331H14.3709V20.4665ZM14.3709 19.9902V18.4236H12.8043V19.9902H14.3709ZM18.5494 20.4665V22.0331H20.116V20.4665H18.5494ZM18.5494 19.9902H20.116V18.4236H18.5494V19.9902ZM18.9405 14.0593L17.6615 14.964L17.669 14.9746L17.6767 14.9851L18.9405 14.0593ZM19.3203 15.3974L17.7568 15.4949L17.8567 17.0981L19.4569 16.9581L19.3203 15.3974ZM19.9683 15.3407L20.1049 16.9014L21.5349 16.7762V15.3407H19.9683ZM19.9683 12.8573H21.5349V11.027L19.7266 11.3094L19.9683 12.8573ZM19.3203 12.9253L19.4195 14.4888L19.4195 14.4888L19.3203 12.9253ZM13.7564 12.9253L13.654 14.4885L13.654 14.4886L13.7564 12.9253ZM13.1196 12.8573L13.3613 11.3094L11.7643 11.06L11.5649 12.6641L13.1196 12.8573ZM12.8067 15.3748L11.2521 15.1816L11.0633 16.7014L12.5784 16.9246L12.8067 15.3748ZM13.4994 15.4768L13.2711 17.0267L14.728 17.2413L15.0323 15.8004L13.4994 15.4768ZM13.7229 14.649L12.2534 14.1061L12.2486 14.119L12.2441 14.132L13.7229 14.649ZM14.0357 14.048L12.811 13.0711L12.7966 13.0891L12.7828 13.1075L14.0357 14.048ZM14.4715 13.6964L15.1277 15.1189L15.1417 15.1125L15.1556 15.1057L14.4715 13.6964ZM11.6877 12.7079C11.6877 12.4195 11.9215 12.1857 12.2099 12.1857V9.05254C10.1911 9.05254 8.55449 10.6891 8.55449 12.7079H11.6877ZM11.6877 21.0631V12.7079H8.55449V21.0631H11.6877ZM12.2099 21.5853C11.9215 21.5853 11.6877 21.3515 11.6877 21.0631H8.55449C8.55449 23.082 10.1911 24.7185 12.2099 24.7185V21.5853ZM20.5651 21.5853H12.2099V24.7185H20.5651V21.5853ZM21.0873 21.0631C21.0873 21.3515 20.8535 21.5853 20.5651 21.5853V24.7185C22.5839 24.7185 24.2205 23.0819 24.2205 21.0631H21.0873ZM21.0873 12.7079V21.0631H24.2205V12.7079H21.0873ZM20.5651 12.1857C20.8535 12.1857 21.0873 12.4195 21.0873 12.7079H24.2205C24.2205 10.6891 22.5839 9.05254 20.5651 9.05254V12.1857ZM12.2099 12.1857H20.5651V9.05254H12.2099V12.1857ZM15.9375 20.4665V19.9902H12.8043V20.4665H15.9375ZM18.5494 18.8999H14.3709V22.0331H18.5494V18.8999ZM16.9828 19.9902V20.4665H20.116V19.9902H16.9828ZM15.7985 19.0376C15.7985 19.698 16.0206 20.4429 16.6793 20.9727C17.2729 21.4502 17.9858 21.5568 18.5494 21.5568V18.4236C18.3235 18.4236 18.4443 18.3714 18.6431 18.5313C18.7529 18.6196 18.837 18.7354 18.8864 18.8546C18.9318 18.9642 18.9317 19.0368 18.9317 19.0376H15.7985ZM15.7985 13.9119V19.0376H18.9317V13.9119H15.7985ZM17.8456 12.0504C17.5761 12.0504 17.1105 12.0826 16.6658 12.3556C16.0961 12.7052 15.7985 13.2995 15.7985 13.9119H18.9317C18.9317 14.0789 18.8963 14.3014 18.7718 14.5306C18.6456 14.763 18.47 14.9245 18.3047 15.026C18.1498 15.121 18.0165 15.1565 17.9494 15.1703C17.9131 15.1777 17.8858 15.1809 17.8698 15.1823C17.8615 15.183 17.8553 15.1833 17.8514 15.1835C17.8495 15.1836 17.848 15.1836 17.847 15.1836C17.8465 15.1836 17.8462 15.1836 17.8459 15.1836C17.8457 15.1836 17.8456 15.1836 17.8456 15.1836V12.0504ZM20.2195 13.1546C19.6017 12.2813 18.6355 12.0504 17.8456 12.0504V15.1836C17.9669 15.1836 17.9773 15.2019 17.9236 15.1802C17.8939 15.1682 17.8488 15.1455 17.7981 15.1064C17.7465 15.0667 17.6997 15.018 17.6615 14.964L20.2195 13.1546ZM20.8839 15.2999C20.8387 14.5755 20.6772 13.7791 20.2042 13.1335L17.6767 14.9851C17.6496 14.9481 17.6649 14.9529 17.6904 15.0428C17.7158 15.1322 17.7432 15.2777 17.7568 15.4949L20.8839 15.2999ZM19.8318 13.7801L19.1838 13.8368L19.4569 16.9581L20.1049 16.9014L19.8318 13.7801ZM18.4017 12.8573V15.3407H21.5349V12.8573H18.4017ZM19.4195 14.4888C19.6957 14.4712 19.9603 14.4441 20.21 14.4051L19.7266 11.3094C19.5891 11.3309 19.4217 11.3491 19.2212 11.3618L19.4195 14.4888ZM18.717 14.5146C18.9251 14.5146 19.1616 14.5051 19.4195 14.4888L19.2212 11.3618C19.0024 11.3757 18.8366 11.3814 18.717 11.3814V14.5146ZM14.3039 14.5146H18.717V11.3814H14.3039V14.5146ZM13.654 14.4886C13.8984 14.5046 14.1199 14.5146 14.3039 14.5146V11.3814C14.2197 11.3814 14.0762 11.3763 13.8588 11.362L13.654 14.4886ZM12.8779 14.4051C13.1251 14.4437 13.3846 14.4709 13.654 14.4885L13.8588 11.362C13.6665 11.3495 13.5014 11.3313 13.3613 11.3094L12.8779 14.4051ZM14.3614 15.5679L14.6742 13.0504L11.5649 12.6641L11.2521 15.1816L14.3614 15.5679ZM13.7278 13.927L13.0351 13.8249L12.5784 16.9246L13.2711 17.0267L13.7278 13.927ZM12.2441 14.132C12.1345 14.4454 12.0436 14.7888 11.9666 15.1532L15.0323 15.8004C15.0894 15.5298 15.1474 15.3213 15.2017 15.166L12.2441 14.132ZM12.7828 13.1075C12.5501 13.4176 12.3805 13.7619 12.2534 14.1061L15.1924 15.1919C15.244 15.0522 15.283 14.9959 15.2886 14.9884L12.7828 13.1075ZM13.8152 12.2739C13.4033 12.464 13.0705 12.7457 12.811 13.0711L15.2605 15.0248C15.2587 15.027 15.2471 15.0411 15.2233 15.0603C15.199 15.0799 15.1668 15.1009 15.1277 15.1189L13.8152 12.2739ZM15.0748 12.0051C14.6565 12.0051 14.2124 12.0808 13.7873 12.2871L15.1556 15.1057C15.0732 15.1458 15.0313 15.1383 15.0748 15.1383V12.0051ZM17.0994 13.9119C17.0994 13.4104 16.9058 12.8101 16.3524 12.3991C15.8863 12.0529 15.3757 12.0051 15.0748 12.0051V15.1383C15.0593 15.1383 14.9945 15.1374 14.8987 15.1136C14.8015 15.0896 14.6476 15.0357 14.4843 14.9144C14.3119 14.7864 14.1678 14.6114 14.075 14.4045C13.9861 14.2066 13.9662 14.0295 13.9662 13.9119H17.0994ZM17.0994 19.0376V13.9119H13.9662V19.0376H17.0994ZM14.3709 21.5568C14.9324 21.5568 15.6446 21.448 16.2356 20.9635C16.8861 20.4303 17.0994 19.6878 17.0994 19.0376H13.9662C13.9662 19.0376 13.9662 19.0336 13.9669 19.026C13.9675 19.0184 13.9687 19.0069 13.9713 18.9919C13.9766 18.9619 13.9873 18.9176 14.009 18.8643C14.0563 18.7479 14.1383 18.6314 14.2492 18.5405C14.4528 18.3736 14.584 18.4236 14.3709 18.4236V21.5568Z",fill:"currentColor",mask:"url(#path-3-outside-1_5820_7111)"}),e.jsx("path",{d:"M15.8051 7.90967L22.7321 7.90946L20.0974 4.75835",stroke:"currentColor",strokeWidth:"1.5666",strokeLinecap:"round",strokeLinejoin:"round"})]})}function Ac(t){return e.jsx(Rc,{...t,showPriorityCheckbox:!0,footerSlot:e.jsx(Mc,{})})}function Rc(t){const{style:s,className:n,showPriorityCheckbox:a,footerSlot:o}=t,[i]=_t(),{values:{prompts:r},handleChange:l}=P(),d=c.useRef({onClickSubmit:()=>{}}),u=qe("lg")||i===!0,{t:m}=C(["generation"]),g=c.useRef(null);c.useLayoutEffect(()=>{const b=g.current;b&&(b.style.height="auto",b.style.height=b.scrollHeight+"px")},[r]);const[h,x]=xr();c.useEffect(()=>{go({auto_complete_checked:h??"null"})},[h]);const f=b=>{var p,j,v;b.which===13&&(ma?b.metaKey:b.ctrlKey)&&(b.preventDefault(),(j=(p=d.current).onClickSubmit)==null||j.call(p),(v=g.current)==null||v.blur())};return e.jsx(pr,{enable:h&&!u,setEnable:x,children:e.jsxs("div",{className:w("relative flex flex-col @container",n),style:s,children:[e.jsx(Ue,{className:"@4xl:hidden flex flex-wrap mx-3"}),e.jsxs("div",{className:"px-4 py-1 flex gap-4 items-center",children:[e.jsx(Ue,{className:"@4xl:flex hidden flex-auto"}),e.jsx("div",{className:"flex-1"}),e.jsx(Fc,{className:"py-[6px] mlg:py-2"}),!u&&e.jsxs(e.Fragment,{children:[e.jsx(br,{className:"py-1"}),e.jsx(jr,{})]}),i!==!0&&e.jsx(Lc,{})]}),e.jsx("section",{className:w("z-10 px-4 py-3 pb-2 bg-neutral-100 dark:bg-neutral-700 rounded-xl mx-4 flex flex-col"),children:e.jsx(vr,{ref:g,className:"w-full min-h-[3em] max-h-[9em] dense:max-h-[5em] bg-transparent outline-none resize-none",placeholder:i?m("generation:prompts.prompt-helper-placeholder",{context:i==="auto"?"auto":void 0}):m("generation:prompts.prompts-placeholder"),value:r||"",onChange:l("prompts"),onKeyDown:f})}),e.jsxs("div",{className:w("flex items-center z-10","px-4 py-2 dense:px-3 dense:py-1"),onClick:b=>{var p;b.target===b.currentTarget&&((p=g.current)==null||p.focus())},children:[o,e.jsx("span",{className:"ml-auto"}),e.jsx(ka,{showPriorityCheckbox:a,handleSubmitFromQs:!0,className:"flex-none max-mlg:w-full max-mlg:hidden",ref:d})]})]})})}const Dc=.1,$c=5;function Fc(t){const{values:{prompts:s,lora:n},handleChange:a}=P(),o=Object.keys(n??{}).length,i=c.useMemo(()=>a("enablePromptsRewrite"),[a]),r=c.useMemo(()=>s?Cr(s.replaceAll(/\s/g,"")):{},[s]),[l]=_t();return c.useEffect(()=>{i(l==="auto"?fo({loraCount:0,nonAsciiStats:oe.union({nonAsciiRatio:oe.number.gte(Dc)},{nonAsciiCount:oe.number.gte($c)})},{loraCount:o,nonAsciiStats:r}):l)},[l,r,i,o]),e.jsx("div",{className:w("ml-auto",t.className),children:e.jsxs(xo,{delay:0,children:[e.jsx(Oc,{}),e.jsx(po,{children:e.jsx("p",{className:"p-4 text-sm max-w-[24rem]",children:e.jsx(R,{i18nKey:"generation:prompt-helper.help.description",context:l==="auto"?"auto":void 0})})})]})})}function Oc(){const t=Vl(),[s,n]=_t();function a(r){const l=t&&s===!0?"auto":r;T("magic_switch",{checked:l}),n(l)}const o=c.useRef(null),{focusableProps:i}=bo({},o);return e.jsx(jo,{ref:o,isSelected:!!s,onChange:a,className:r=>vo({...r,labelPlacement:"start",className:"items-center"}),children:r=>e.jsxs("div",{...i,className:"contents",children:[e.jsxs("div",{className:Co({...r,size:"xsmall"}),children:[e.jsx("div",{className:yo({...r,size:"xsmall",className:s==="auto"&&"hidden"})}),e.jsx("span",{className:w("mx-auto text-[10px] leading-none font-bold text-white dark:text-black",s!=="auto"&&"hidden"),children:"A"})]}),e.jsx("span",{className:"font-medium text-xs",children:e.jsx(R,{i18nKey:"generation:prompt-helper.label"})})]})})}const zc=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"m14 7l-5 5l5 5V7z"})}),Vc=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M19 9h-4V3H9v6H5l7 7l7-7zm-8 2V5h2v6h1.17L12 13.17L9.83 11H11zm-6 7h14v2H5z"})});function Bc(t){var M;const{task:s}=t,{t:n}=C(["artwork","generation"]),a=tt(s),o=a?a.map(S=>S.mediaId):[],[i,r]=c.useState("disabled"),{data:l,isValidating:d}=J(o[0]),{data:u,isValidating:m}=J(o[1]),{data:g,isValidating:h}=J(o[2]),{data:x,isValidating:f}=J(o[3]);c.useEffect(()=>{r(d||m||h||f?"loading":!l&&!u&&!g&&!x?"disabled":"ok")},[l,u,g,x,d,m,h,f]);const b=c.useMemo(()=>[l,u,g,x].map(S=>Je(S)).filter(S=>S!=null),[l,u,g,x]);async function p(){T("image_dl_all_click");try{r("loading"),await Promise.all(b.map((S,A)=>j(S,A)))}catch{D.error(n("generation:image-operation.notice.batch-image-download-failed"))}finally{r("ok")}}function j(S,A){return oa(S,`${Is({task:s,mediaIdx:A})}.${st({task:s})}`,{skipConversion:!1})}const[,v]=c.useContext(Xn),[,k]=c.useContext(ce),{updateTaskFavoriteDelete:_}=Oi(),[y,E]=c.useState(!0);return e.jsxs("div",{className:w("flex items-center mlg:h-24 justify-end",t.className),children:[e.jsxs("div",{className:w("flex items-center gap-1","p-1 m-0 rounded-md","flex-row mlg:flex-col mlg:bg-neutral-200 mlg:dark:bg-neutral-700",!y&&"hidden"),style:t.style,children:[e.jsx(_i,{variant:"ghost",className:w("max-mlg:bg-neutral-5 max-mlg:dark:bg-neutral-700","h-9 px-2"),task:s,onSuccess:async()=>{v({}),k(A=>[...A].filter(I=>I.taskId!==s.id)),_(s.id,{type:"delete",target:!0}),Math.random()<.25&&await Mi()},children:e.jsx(Ur,{className:"size-6"})}),s.status==="completed"&&(((M=s.parameters)==null?void 0:M.batchSize)??0)>1&&e.jsx(es,{delay:250,placement:"left",trigger:e.jsx($,{disabled:i==="disabled",onPress:p,variant:"ghost",busy:i==="loading",className:w("max-mlg:bg-neutral-5 max-mlg:dark:bg-neutral-700","h-9 px-2"),children:e.jsxs("span",{className:"flex items-center",children:[e.jsx(Vc,{className:"size-6"}),e.jsx("p",{className:"mlg:hidden p-1",children:n("generation:image-operation.download-all-images")})]})}),children:e.jsx("p",{className:"p-2",children:n("generation:image-operation.download-all-images")})})]}),e.jsx($,{variant:"ghost",className:w("invisible mlg:visible w-2 h-8 outline-transparent dark:outline-transparent rounded-none",!y&&"rounded-l-md",y?"bg-neutral-200 dark:bg-neutral-700":"bg-neutral-300 dark:bg-neutral-600",y?"text-neutral-400 dark:text-neutral-500":"text-neutral-700 dark:text-neutral-300"),onPress:()=>E(S=>!S),children:e.jsx(zc,{className:w("size-6 absolute -right-2 top-8 transition-all duration-150",y&&"rotate-180")})})]})}const Pa="Popover",[La,jh]=wo(Pa,[xa]),Lt=xa(),[Hc,Ce]=La(Pa),Uc=t=>{const{__scopePopover:s,children:n,open:a,defaultOpen:o,onOpenChange:i,modal:r=!1}=t,l=Lt(s),d=c.useRef(null),[u,m]=c.useState(!1),[g=!1,h]=ko({prop:a,defaultProp:o,onChange:i});return c.createElement(Gr,l,c.createElement(Hc,{scope:s,contentId:No(),triggerRef:d,open:g,onOpenChange:h,onOpenToggle:c.useCallback(()=>h(x=>!x),[h]),hasCustomAnchor:u,onCustomAnchorAdd:c.useCallback(()=>m(!0),[]),onCustomAnchorRemove:c.useCallback(()=>m(!1),[]),modal:r},n))},Gc="PopoverTrigger",Zc=c.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,o=Ce(Gc,n),i=Lt(n),r=Dn(s,o.triggerRef),l=c.createElement($n.button,le({type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":Ra(o.open)},a,{ref:r,onClick:Ee(t.onClick,o.onOpenToggle)}));return o.hasCustomAnchor?l:c.createElement(Zr,le({asChild:!0},i),l)}),Ea="PopoverPortal",[Wc,Kc]=La(Ea,{forceMount:void 0}),qc=t=>{const{__scopePopover:s,forceMount:n,children:a,container:o}=t,i=Ce(Ea,s);return c.createElement(Wc,{scope:s,forceMount:n},c.createElement(Fn,{present:n||i.open},c.createElement(So,{asChild:!0,container:o},a)))},Ge="PopoverContent",Qc=c.forwardRef((t,s)=>{const n=Kc(Ge,t.__scopePopover),{forceMount:a=n.forceMount,...o}=t,i=Ce(Ge,t.__scopePopover);return c.createElement(Fn,{present:a||i.open},i.modal?c.createElement(Jc,le({},o,{ref:s})):c.createElement(Xc,le({},o,{ref:s})))}),Jc=c.forwardRef((t,s)=>{const n=Ce(Ge,t.__scopePopover),a=c.useRef(null),o=Dn(s,a),i=c.useRef(!1);return c.useEffect(()=>{const r=a.current;if(r)return Io(r)},[]),c.createElement(_o,{as:Mo,allowPinchZoom:!0},c.createElement(Aa,le({},t,{ref:o,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ee(t.onCloseAutoFocus,r=>{var l;r.preventDefault(),i.current||(l=n.triggerRef.current)===null||l===void 0||l.focus()}),onPointerDownOutside:Ee(t.onPointerDownOutside,r=>{const l=r.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0,u=l.button===2||d;i.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Ee(t.onFocusOutside,r=>r.preventDefault(),{checkForDefaultPrevented:!1})})))}),Xc=c.forwardRef((t,s)=>{const n=Ce(Ge,t.__scopePopover),a=c.useRef(!1),o=c.useRef(!1);return c.createElement(Aa,le({},t,{ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var r;if((r=t.onCloseAutoFocus)===null||r===void 0||r.call(t,i),!i.defaultPrevented){var l;a.current||(l=n.triggerRef.current)===null||l===void 0||l.focus(),i.preventDefault()}a.current=!1,o.current=!1},onInteractOutside:i=>{var r,l;(r=t.onInteractOutside)===null||r===void 0||r.call(t,i),i.defaultPrevented||(a.current=!0,i.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const d=i.target;((l=n.triggerRef.current)===null||l===void 0?void 0:l.contains(d))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&o.current&&i.preventDefault()}}))}),Aa=c.forwardRef((t,s)=>{const{__scopePopover:n,trapFocus:a,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:r,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:m,...g}=t,h=Ce(Ge,n),x=Lt(n);return To(),c.createElement(Po,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:o,onUnmountAutoFocus:i},c.createElement(Lo,{asChild:!0,disableOutsidePointerEvents:r,onInteractOutside:m,onEscapeKeyDown:l,onPointerDownOutside:d,onFocusOutside:u,onDismiss:()=>h.onOpenChange(!1)},c.createElement(Wr,le({"data-state":Ra(h.open),role:"dialog",id:h.contentId},x,g,{ref:s,style:{...g.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),Yc="PopoverClose",ed=c.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,o=Ce(Yc,n);return c.createElement($n.button,le({type:"button"},a,{ref:s,onClick:Ee(t.onClick,()=>o.onOpenChange(!1))}))}),td=c.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,o=Lt(n);return c.createElement(Kr,le({},o,a,{ref:s}))});function Ra(t){return t?"open":"closed"}const sd=Uc,nd=Zc,ad=qc,od=Qc,hn=ed,id=td,rd=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M13 3a9 9 0 0 0-9 9H1l3.89 3.89l.07.14L9 12H6a7 7 0 0 1 7-7a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42A8.896 8.896 0 0 0 13 21a9 9 0 0 0 9-9a9 9 0 0 0-9-9Z"})});function ld(t){const{reset:s}=P(),[,n]=c.useContext(ce),[a,o]=c.useContext(vs),{t:i}=C(["generation","action"]),r=document.getElementById("workbench-layout-overlays"),l={...t.classes,contentButton:"px-2 py-0.5 capitalize bg-zinc-200 hover:bg-zinc-300 dark:bg-zinc-700 dark:hover:bg-zinc-600 rounded transition"},d=c.useCallback(()=>{T("panel_reset_click"),s(),n([]),a!=null?o(""):(o(""),setTimeout(()=>{o(void 0)},0))},[a]);return e.jsxs(sd,{children:[e.jsx(nd,{asChild:!0,children:e.jsxs("button",{className:w(t.className,l==null?void 0:l.button),children:[e.jsx(rd,{className:l==null?void 0:l.icon}),!t.iconOnly&&e.jsx("span",{children:i("generation:reset.label")})]})}),e.jsx(ad,{container:r,children:e.jsxs(od,{className:w("p-4 bg-background ring-1 ring-black/10 rounded-lg drop-shadow-md","data-[state=open]:animate-[fade-in_75ms_var(--ease-out),scale-in_100ms_var(--ease-out)] data-[state=closed]:animate-[fade-out_100ms_var(--ease-out),scale-out_100ms_var(--ease-out)] origin-[--radix-popover-content-transform-origin]"),children:[e.jsx(id,{className:"fill-background",style:{filter:"drop-shadow(0 1px rgb(0 0 0 / 10%))"}}),e.jsx("p",{children:i("generation:reset.confirm-dialog.content")}),e.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[e.jsx(hn,{className:l.contentButton,children:i("action:cancel")}),e.jsx(hn,{className:l.contentButton,onClick:d,children:i("action:confirm")})]})]})})]})}async function cd(t){const{data:s}=await Eo.post("",{inputs:t.mediaUrls});return s}const dd=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})}),ud=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"m20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8l8-8z"})}),md=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z"})}),hd=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M19 12.998h-6v6h-2v-6H5v-2h6v-6h2v6h6z"})}),Et=wn(),Fs=Ao({}),gd=Qe(t=>Object.entries(t(Fs)).length),Os=()=>Oe(Fs,{store:Et}),fd=t=>yn({children:t.children,store:Et}),zs=()=>Zt(gd,{store:Et}),Da=()=>Ro(Fs,{store:Et}),ht=4;function xd(){const[t]=c.useContext(vs),[s]=c.useContext(Yn);return s?e.jsx(fd,{children:e.jsx(pd,{children:e.jsx(bd,{})})},t):null}function pd(t){const{getValues:s,handleChange:n}=P(),[a,o]=Os(),i=c.useRef(!1);c.useEffect(()=>{var d;(d=s())==null||d.then(u=>{var m;(m=u.ipAdapter)!=null&&m.referenceImages?o(Object.fromEntries(u.ipAdapter.referenceImages.map(g=>[g,{mediaId:g,progress:1,valid:!0}]))):o({})}),i.current=!0},[]);const r=c.useMemo(()=>Object.values(a).some(d=>!d.valid),[a]),l=c.useMemo(()=>Object.values(a).length>0,[a]);return c.useEffect(()=>{n("ipAdapter.imagesAreValid")(!r)},[r]),c.useEffect(()=>{i.current&&n("ipAdapter.enabled")(l)},[l]),e.jsx(e.Fragment,{children:t.children})}function bd(){const{t}=C(["artwork","generation"]),{values:s}=P(),[n]=Os(),a=zs(),o=c.useRef({open:()=>{}}),i=X(s.modelId),r=us(i==null?void 0:i.modelType),l=c.useMemo(()=>Object.values(n).some(d=>!d.valid),[n]);return e.jsx(ve,{children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("h2",{className:"font-semibold text-[14px]",children:t("generation:character-reference.label")}),e.jsx(yd,{onUploadClick:o.current.open}),e.jsx("label",{className:"text-xs text-neutral-500 ml-auto font-medium",children:`${a}/${ht}`})]}),l||r&&e.jsx(ie,{type:re.Warning,children:t(r?"generation:character-reference.incompatible-model-used-hint":"generation:character-reference.without-face-hint")}),e.jsxs("div",{className:"flex gap-3 w-full items-center",children:[e.jsx(vd,{}),e.jsx(jd,{ref:o})]})]})})}const jd=c.forwardRef(function(s,n){const{setValues:a}=P(),{data:o}=ne(),i=Da(),r=zs(),{t:l}=C(["generation"]),d=c.useCallback(x=>{if(r+x.length>ht)return D.error(l("generation:character-reference.notice.max-allowed",{number:ht}));const f=Object.fromEntries(x.map(b=>[Ls(),{file:b,controller:new AbortController}]));u(f)},[r]),u=async x=>{const f=Object.entries(x);f.forEach(b=>{const[p,{file:j,controller:v}]=b;i(k=>{k[p]={progress:0,file:j,abortController:v}})}),await Qr(f,4,async b=>{const[p,{file:j,controller:v}]=b;try{const k=await Yr(j,{signal:v.signal,onProgress:M=>{i(S=>{S[p].progress=M})}});if(!k.media)throw new Error("Upload media failed");Do(k.media.id,k.media),i(M=>{var S;M[p].mediaId=(S=k.media)==null?void 0:S.id,delete M[p].file});const _=Je(k.media);if(!_)return;const E=!!(await cd({mediaUrls:[_]}))[0].hasFace;i(M=>{M[p].valid=E}),a(M=>{var S;return{...M,ipAdapter:{...M.ipAdapter,referenceImages:[...((S=M.ipAdapter)==null?void 0:S.referenceImages)??[],k.media.id]}}})}catch(k){k instanceof Jr||D.error(k.message),i(_=>{delete _[p]})}}),T("face_detection_image_upload_success")},{getRootProps:m,getInputProps:g,open:h}=Xr({onDrop:d,onFileDialogOpen:()=>{T("face_detection_image_upload_click")},accept:{"image/png":[],"image/jpeg":[],"image/webp":[]}});return c.useImperativeHandle(n,()=>({open:h}),[h]),r===ht?null:e.jsxs(_e,{variant:r>0?void 0:"grayish-sidebar",className:w(r>0?"font-medium cursor-pointer flex flex-col gap-3 items-center justify-center text-xs rounded-lg w-[72px] h-[72px] bg-neutral-200 dark:bg-neutral-600 text-black dark:text-white":"w-full"),onClick:x=>{if(x.preventDefault(),T("character_img"),o){const f=m();f&&f.onClick&&f.onClick(x)}else se()},children:[e.jsx("input",{...g(),disabled:o===void 0}),r>0?e.jsx(dd,{className:"size-6"}):e.jsx("label",{children:l("generation:character-reference.add-image")})]})});function vd(){const[t]=Os();return e.jsx(e.Fragment,{children:Object.entries(t).map(([s,n])=>e.jsx(Cd,{id:s,...n},s))})}function Cd(t){const{setValues:s}=P(),{data:n}=J(t.mediaId),a=Da(),o=c.useCallback(()=>{var g;T("remove_face_detection_image_click"),(g=t.abortController)==null||g.abort(),a(h=>{delete h[t.id]}),s(h=>{var x;return(x=h.ipAdapter)!=null&&x.referenceImages?{...h,ipAdapter:{...h.ipAdapter,referenceImages:h.ipAdapter.referenceImages.filter(f=>f!==t.mediaId)}}:h})},[t.abortController,t.id,a]),i=Kt(n),r=er(t.file),l=i??r,d=!t.mediaId||t.valid==null,u=t.valid===!1,{t:m}=C(["generation"]);return e.jsxs("div",{className:"relative group h-[72px] w-[72px] bg-white dark:bg-neutral-700 rounded-lg",children:[l&&e.jsx("img",{className:"aspect-1 object-cover rounded-lg h-full w-full",src:l,loading:"lazy",decoding:"async"}),d&&e.jsx("div",{className:"absolute top-0 left-0 w-full h-full backdrop-blur bg-white/40 flex items-center justify-center rounded-lg",children:e.jsx($o,{variant:t.progress>15?"determinate":void 0,value:t.progress})}),u&&e.jsx("div",{className:"absolute top-0 left-0 w-full h-full backdrop-blur bg-black/40 flex items-center justify-center rounded-lg",children:e.jsx("p",{className:"text-center text-xs text-white scale-75",children:m("generation:character-reference.face-not-recognized-hint")})}),e.jsx("button",{title:"Remove",className:w("absolute right-0 top-0 translate-x-1/2 -translate-y-1/2 bg-white text-black p-0 rounded-full"),onClick:()=>{o()},children:e.jsx(ar,{className:"size-4"})})]})}function yd(t){const s=c.useContext(ea),{t:n}=C(["generation"]);return e.jsx(On,{wrapperClassName:"py-6 px-4",TooltipProps:{placement:"start"},children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-3",children:n("generation:character-reference.help.suggested-images")}),e.jsx("section",{className:"flex gap-3 mb-8",children:["front-view","slightly-side-view","side-view"].map(a=>e.jsxs("figure",{children:[e.jsx("img",{className:"w-[120px] h-[180px] object-cover rounded-xl",src:n(`generation:character-reference.help.${a}.image-url`)}),e.jsx("figcaption",{className:"text-sm mt-1",children:n(`generation:character-reference.help.${a}.label`)})]},a))}),e.jsx("h2",{className:"text-xl font-bold mb-3",children:n("generation:character-reference.help.not-suggested")}),e.jsx("section",{className:"flex gap-3",children:e.jsxs("figure",{children:[e.jsx("img",{className:"w-[120px] h-[180px] object-cover rounded-xl",src:n("generation:character-reference.help.back-view.image-url")}),e.jsx("figcaption",{className:"text-sm mt-1",children:n("generation:character-reference.help.back-view.label")})]})}),e.jsxs("button",{className:"font-bold mt-4 text-[#7c38c4] underline max-w-80 text-left",onClick:()=>{var a;return wd({onUploadClick:t.onUploadClick,onControlNetClick:(a=s.current)==null?void 0:a.openControlNet})},children:[">",e.jsx(Fo,{t:n,i18nKey:"generation:character-reference.tips.title",components:{br:e.jsx("br",{})}})]})]})})}function wd(t){return new Promise((s,n)=>{const a=Oo({children:e.jsx(kd,{onClose:()=>{var o;return(o=a.current)==null?void 0:o.close()},addCharacterImage:()=>{var o;return(o=t==null?void 0:t.onUploadClick)==null?void 0:o.call(t)},addControlNet:()=>{var o;(o=t==null?void 0:t.onControlNetClick)==null||o.call(t)}}),onClose:()=>s,fullWidth:!1,responsive:!0,dialogProps:{maxWidth:"md"}})})}function kd(t){const{t:s}=C(["generation"]),{data:n}=ne(),o=zs()>0;return e.jsxs("div",{className:"px-4 py-6 relative",children:[e.jsx(Y,{onClick:t.onClose,className:"absolute right-2 top-2",children:e.jsx(md,{className:"size-6"})}),e.jsx("h2",{className:"font-bold",children:s("generation:character-reference.tips.title")}),e.jsx("p",{children:s("generation:character-reference.tips.description")}),e.jsxs("section",{className:"grid grid-cols-[minmax(0,160px),120px,minmax(0,160px)] items-center justify-items-center pt-4 justify-center",children:[e.jsxs("figure",{className:"flex flex-col items-center",children:[e.jsx("figcaption",{className:"font-bold mb-4 sm:leading-3",children:s("generation:character-reference.tips.original.caption")}),e.jsx("img",{className:"rounded-xl object-cover max-w-[120px] mt-auto",src:s("generation:character-reference.tips.original.image-url")})]}),e.jsx(hd,{className:"size-6"}),e.jsxs("figure",{className:"flex flex-col items-center h-full",children:[e.jsx("figcaption",{className:"font-bold sm:leading-3",children:s("generation:character-reference.tips.openpose.caption")}),e.jsx("figcaption",{className:"font-light mb-1 text-xs",children:s("generation:character-reference.tips.openpose.subcaption")}),e.jsx("img",{className:"rounded-xl object-cover max-w-[120px] mt-auto",src:s("generation:character-reference.tips.openpose.image-url")})]})]}),e.jsx("section",{children:e.jsxs("figure",{className:"flex flex-col items-center col-start-2 col-span-1",children:[e.jsx(ud,{className:"size-6 mb-2"}),e.jsx("img",{className:"rounded-xl object-cover max-w-[120px]",src:s("generation:character-reference.tips.result.image-url")})]})}),e.jsxs("section",{className:"flex items-center gap-3 mt-5",children:[e.jsx(_e,{variant:"normal",className:"ml-auto",onClick:()=>{var r,l;n?((r=t.addCharacterImage)==null||r.call(t),(l=t.onClose)==null||l.call(t),T("hover_character_img")):se()},children:s("generation:character-reference.tips.action.add-character-image")}),e.jsx(_e,{variant:"normal",onClick:()=>{var r,l;o?((r=t.addControlNet)==null||r.call(t),(l=t.onClose)==null||l.call(t),T("hover_character_cnet")):D.error(s("generation:character-reference.tips.add-character-first-waring"))},children:s("generation:character-reference.tips.action.add-control-net")})]})]})}const zt=zo("pixai:LatentEditor");class Nd extends el{constructor(n,a){super();N(this,"canvasEl");N(this,"containerEl");N(this,"_canvas");N(this,"_mode");N(this,"_creationStartPos");N(this,"_creationObj");N(this,"defaultTextColor");N(this,"defaultFillColor");N(this,"count");this.canvasEl=n,this.containerEl=a,this._mode="rectangle",this.defaultTextColor="#fff",this.defaultFillColor="rgba(0, 0, 0, 0.4)",this.count=1;const o=H.fabric.Object.prototype.toObject,i=["id"];H.fabric.Object.prototype.toObject=function(r){if(r)return o.call(this,i.concat(r))}}get canvas(){if(!this._canvas)throw new Error("editor not initialized");return this._canvas}get mode(){return this._mode}init(n){const a=new H.fabric.Canvas(this.canvasEl,{preserveObjectStacking:!0,stopContextMenu:!0,width:n.width,height:n.height,allowTouchScrolling:!0,selection:!1});this._canvas=a,n.width&&n.height&&this.setSize(n.width,n.height,n.accordAxis),a.on("mouse:down",o=>{const i=this.getSelection(),r=this.canvas.getObjects().filter(l=>l.type==="rect");i!=null||r.length>=6?this.setMode("select"):this.setMode("rectangle"),this.mode!=="select"&&(this._creationStartPos=o.pointer,this.canvas.selection=!1)}),a.on("mouse:up",o=>{this._creationStartPos=void 0;const i=this._creationObj;i&&(i.width&&i.height&&i.width>=50&&i.height>=50&&(i.clone(r=>this.addLatentBox(this.count.toString(),r)),this.count+=1,this._creationObj=void 0),a.remove(i),this._creationObj=void 0),this.setMode("select")}),a.on("mouse:move",o=>{if(o.pointer&&this._creationStartPos){if(!this._creationObj){this.setMode("rectangle");const i=this._handleObjectCreation();i&&(this._creationObj=i,this.canvas.add(i),this.canvas.setActiveObject(i),this.canvas.selectionColor="#0000")}if(this._creationObj){const i=this._creationObj,r=this.canvas.getZoom(),l=this._creationStartPos.x-o.pointer.x,d=this._creationStartPos.y-o.pointer.y,u=l<0?this._creationStartPos.x:this._creationStartPos.x-l,m=d<0?this._creationStartPos.y:this._creationStartPos.y-d;i.set({left:u/r,top:m/r,width:Math.abs(l)/r,height:Math.abs(d)/r}),this.canvas.requestRenderAll()}}}),a.on("selection:created",o=>{zt("selection:created %o",o),this.emit("selection_change")}),a.on("selection:updated",o=>{zt("selection:updated %o",o),this.emit("selection_change")}),a.on("selection:cleared",o=>{zt("selection:cleared %o",o),this.emit("selection_change")}),a.on("object:added",o=>{var i;if((i=o.target)!=null&&i.shouldParse){const r=o.target,l=Number(r.id);r.clone(d=>{var u;return this.addLatentBox((u=o.target)==null?void 0:u.id,d)}),!isNaN(l)&&this.count<=l&&(this.count=l+1),a.remove(r)}})}on(n,a){return super.on(n,a)}dispose(){if(this.removeAllListeners(),!!this._canvas)try{this._canvas.dispose()}catch(n){console.warn(`dispose with error: ${n}`)}}setSize(n,a,o){const i=this.containerEl.getBoundingClientRect(),r=o==="y"?1/0:i.width/n,l=o==="x"?1/0:i.height/a,d=Math.min(r,l),u=d;this.canvas.setDimensions({width:n*d,height:a*d}),this.canvas.setViewportTransform([u,0,0,u,0,0])}_handleObjectCreation(){if(this._mode==="rectangle"){const n=new H.fabric.Rect({fill:this.defaultFillColor,lockRotation:!0,lockScalingFlip:!0,originX:"left",originY:"top"});return n.setControlVisible("mtr",!1),n}}async addLatentBox(n,a){this.canvas.discardActiveObject(),a.type==="activeSelection"?(a.canvas=this.canvas,a.setCoords(),this.canvas.add(a)):this.canvas.add(a);const o=a;return o.setControlVisible("mtr",!1),await this.addTextToRect(n,o),this.canvas.setActiveObject(o),this.emit("latent_creation",{item:o}),o}async addTextToRect(n,a){const o=a.getCenterPoint(),i=new H.fabric.Text(n,{fontSize:32,fontWeight:700,lockRotation:!0,originX:"center",originY:"center",left:o.x,top:o.y,lockScalingX:!0,lockScalingY:!0,fill:"#FEE2E2",fontFamily:"monospace",selectable:!1,evented:!1});a.on("moving",()=>{const r=a.getCenterPoint();i.set({left:r.x,top:r.y})}),a.on("scaling",()=>{const r=a.getCenterPoint();i.set({left:r.x,top:r.y})}),a.on("removed",()=>{this.canvas.remove(i)}),this.canvas.add(i),a.id=n}setMode(n){this._mode=n,this.emit("mode_change")}getSelection(){return this.canvas.getActiveObject()}removeSelection(){const n=this.canvas.getActiveObjects();this.canvas.remove(...n),this.canvas.discardActiveObject(),this.emit("selection:change")}}const $a=c.forwardRef((t,s)=>{const n=c.useRef(null),a=c.useRef(null),o=c.useRef(null),[i,r]=c.useState(!1),[l,d]=c.useState({left:0,top:0});c.useImperativeHandle(s,()=>o);const u=h=>{const x=o.current;if(!x)return;const f=x.canvas._offset;if(h.left==null||h.top==null||f==null||f.left==null||f.top==null)return;const b=x.canvas.getZoom();d({left:h.left*b,top:h.top*b})},m=c.useCallback(async({width:h=600,height:x=600})=>{var j;(j=o.current)==null||j.dispose();const f=n.current;if(!f)return;const b=a.current;if(!b)return;const p=new Nd(f,b);o.current=p,window.editor=p,p.init({width:h,height:x}),p.on("latent_creation",({item:v})=>{var _;const k=v.id??Ls().toString();r(!0),u(v),(_=t.dispatchRegions)==null||_.call(t,{type:"add",payload:k}),v.on("selected",()=>{r(!0),u(v)}),v.on("editing:entered",()=>{r(!1)}),v.on("deselected",()=>{r(!1)}),v.on("moving",()=>{u(v)}),v.on("scaling",()=>{u(v)}),v.on("resizing",()=>{u(v)}),v.on("removed",()=>{var y;(y=t.dispatchRegions)==null||y.call(t,{type:"remove",payload:k})})})},[]);c.useEffect(()=>(m({width:t.width,height:t.height}),()=>{var h;(h=o.current)==null||h.dispose()}),[]);const g=e.jsxs("div",{className:w("relative overflow-hidden"),ref:a,children:[e.jsx("canvas",{ref:n,className:"border w-full"}),e.jsx(z,{className:w("absolute -translate-x-1/2 -translate-y-1/2 rounded-full","bg-white text-black min-w-0 p-1",{hidden:!i}),variant:"contained",style:{...l},onClick:()=>{const h=o==null?void 0:o.current;h&&(h.removeSelection(),r(!1))},children:e.jsx(xe,{className:"size-6"})})]});return e.jsx("div",{className:w("w-full flex items-stretch justify-center",t.className),children:g})});$a.displayName="DivisionEditor";const Sd=(t,s)=>{if(!t.width||!t.height)return;const n=t.getZoom(),a=t.width/n,o=t.height/n;return s.sort((r,l)=>Number(r.id)-Number(l.id)).flatMap(r=>{if(!r.width||!r.height||r.top==null||r.left==null)return[];const{width:l,left:d,top:u,height:m}=r,g=Math.max(0,Math.min(a,d)),h=Math.max(0,Math.min(o,u)),x=a/l,f=o/m;return[{id:r.id,division:[f,x],position:[h/(o/f),g/(a/x)]}]})},Id=t=>({type:"rect",...t.reduce((n,a)=>({divisions:[...n.divisions,a.division.join(":")],positions:[...n.positions,a.position.join(":")],weights:[...n.weights,a.weight]}),{divisions:[],positions:[],weights:[]})}),_d=t=>{const s=t.objects.filter(n=>n.type==="rect").map(n=>({...n,shouldParse:!0}));return{...t,objects:s}};function Md(t){var s;return gs((s=X(t))==null?void 0:s.modelType)}function Td(){const{values:{latentCouple:t,modelId:s}}=P(),n=Md(s),{t:a}=C(["generation"]),[o,i]=c.useState(!1);return n||t?e.jsx(ve,{help:e.jsx("img",{className:"w-[400px] min-h-[600px] rounded-lg",src:a("generation:composition.help-image-url")}),title:a("generation:composition.composition"),children:e.jsx(Dd,{children:e.jsx(Fd,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[!n&&e.jsx(ie,{type:re.Warning,children:a("generation:composition.incompatible-model-used-hint")}),e.jsx(Pd,{openDialog:()=>i(!0)}),e.jsx(Ld,{open:o,onClose:()=>i(!1)})]})})})}):null}function Pd(t){const{t:s}=C(["generation"]),[{previewImage:n},a]=c.useContext(Vs),{handleChange:o}=P(),{dispatch:i}=c.useContext(ot),r=()=>{a(l=>({...l,savedEditor:void 0,previewImage:void 0})),i({type:"RESET"}),o("latentCouple")(void 0)};return e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"w-[128px] h-[128px] rounded-xl border border-neutral-300",children:e.jsxs("div",{className:"flex relative w-full h-full",style:{aspectRatio:ms(n)},children:[e.jsx(Te,{originalUrl:n.url,fileName:`pixai-composition-preview_${Date.now()}.png`,imgClassName:"flex object-contain w-full h-full rounded-xl !object-center",height:n==null?void 0:n.height,width:n==null?void 0:n.width}),e.jsx(Y,{onClick:r,className:"rounded-full bg-background absolute top-0 right-0 translate-x-3 -translate-y-3 shadow",children:e.jsx(xe,{className:"size-[14px]"})})]})}),e.jsx(_e,{variant:"grayish-sidebar",className:"w-full",onClick:()=>{t.openDialog(),T("add_composition_click")},children:s(n?"generation:composition.edit-composition":"generation:composition.add-composition")})]})}function Ld(t){const{values:s,handleChange:n}=P(),[{editorRef:a},o]=c.useContext(Vs),{state:i,dispatch:r}=c.useContext(ot),{t:l}=C(["action","generation"]),d=c.useRef(!0),u=qe(),m=zn(s);c.useEffect(()=>{!s.width&&!s.height&&!m&&i.length>1&&(r({type:"RESET"}),o(h=>({...h,savedEditor:void 0,previewImage:void 0})),D.info("Compositions cleared due to size changes"),d.current=!0)},[s.width,s.height,m]);const g=()=>{var b,p;const h=(p=(b=a==null?void 0:a.current)==null?void 0:b.current)==null?void 0:p.canvas;if(!h)return D.error("Canvas is invalid");if(i.some(j=>!j.prompts))return D.error("Some prompts are empty");const{objects:x}=h.toObject(),f=x.filter(j=>j.type==="rect");try{const j=Sd(h,f);if(!j)throw new Error("Division data is invalid");const v=i.flatMap(k=>{const _=j.find(y=>y.id===k.id);return _?[{division:_.division,position:_.position,weight:k.weight}]:k.id==="0"?{weight:k.weight,division:[1,1],position:[0,0]}:[]});o(k=>({...k,previewImage:{url:h.toDataURL({format:"PNG"}),height:h.height,width:h.width},savedEditor:_d(h.toJSON(["id"]))})),n("latentCouple")(Id(v)),n("prompts")(i.map(k=>k.prompts).join(`
AND `)),T("add_composition_success"),t.onClose()}catch(j){D.error(j.message)}};return e.jsxs(ss,{open:t.open,onClose:t.onClose,maxWidth:"md",fullWidth:!0,fullScreen:u,children:[e.jsxs(Ln,{className:"font-semibold",children:[l("generation:composition.composition"),e.jsx(Jt,{inline:!0,className:"prose text-sm text-primary-light font-normal",children:l("generation:composition.helper")})]}),e.jsx(pt,{className:"pt-2",children:e.jsx(Ed,{})}),e.jsxs(Nt,{children:[e.jsx(z,{onClick:t.onClose,className:"capitalize",children:l("action:cancel")}),e.jsx(z,{variant:"contained",className:"font-bold",onClick:g,children:l("action:confirm")})]})]})}function Ed(){const{dispatch:t}=c.useContext(ot),[{savedEditor:s},n]=c.useContext(Vs),{values:a}=P(),o=c.useRef(null);return c.useEffect(()=>{var r;const i=(r=o.current)==null?void 0:r.current;requestAnimationFrame(()=>{i==null||i.canvas.loadFromJSON(s,i==null?void 0:i.canvas.renderAll.bind(i==null?void 0:i.canvas))})},[]),c.useEffect(()=>{n(i=>({...i,editorRef:o}))},[]),e.jsxs(e.Fragment,{children:[e.jsx($a,{width:a.width,height:a.height,dispatchRegions:t,className:"max-w-[600px] max-h-[480px] md:max-w-[1024px]",ref:o}),e.jsx(Ad,{})]})}function Ad(){const{t}=C(["generation"]),{state:s}=c.useContext(ot);return e.jsx("div",{className:"flex flex-col gap-4 py-4",children:s.map(n=>e.jsx(Rd,{title:n.id==="0"?t(["generation:composition.global-region"]):`Area ${n.id}`,regionId:n.id},n.id))})}const Vt=Array.from(Array(10).fill(void 0),(t,s)=>(s+1)/10);function Rd(t){const{state:s,dispatch:n}=c.useContext(ot),a=s.find(i=>i.id===t.regionId),o=c.useCallback(({weight:i,input:r})=>{i!=null?n({type:"change-weight",payload:{id:t.regionId,weight:i}}):r!=null&&n({type:"change-prompt",payload:{id:t.regionId,prompts:r}})},[t.regionId]);return a?e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-lg mb-2",children:t.title}),e.jsxs("div",{className:"flex gap-4 items-end",children:[e.jsx(Vo,{multiline:!0,className:"flex-1",minRows:2,placeholder:"prompts",onChange:i=>o({input:i.target.value}),value:a.prompts}),e.jsxs(hs,{className:"min-w-[96px]",label:"Weight",value:a.weight,select:!0,SelectProps:{renderValue:i=>typeof i=="number"?i.toFixed(1):null},children:[e.jsx("div",{className:"px-6 w-[300px] max-w-full flex items-center",children:e.jsx(nt,{min:.1,max:1,step:.1,value:a.weight,onChange:(i,r)=>typeof r=="number"&&o({weight:r}),marks:Vt.map((i,r)=>({value:i,label:r===0||r===Vt.length-1?i.toFixed(1):""}))})}),Vt.map(i=>e.jsx(He,{value:i,className:"hidden",children:i.toFixed(1)},i))]})]})]}):null}const[Vs,Dd]=Ps({}),Fa=[{id:"0",weight:.2,prompts:""}];function $d(t,s){switch(s.type){case"RESET":return Fa;case"init":return s.payload;case"add":{const n=s.payload;return t.some(a=>a.id===n.toString())?t:[...t,{id:n.toString(),weight:.8,prompts:""}]}case"remove":{const n=s.payload,a=t.findIndex(i=>i.id===n.toString()),o=[...t];return o.splice(a,1),o}case"change-weight":{const{id:n,weight:a}=s.payload,o=t.findIndex(r=>r.id===n.toString());if(o<0)return t;const i=[...t];return i.splice(o,1,{...i[o],weight:a}),i}case"change-prompt":{const{id:n,prompts:a}=s.payload,o=t.findIndex(r=>r.id===n.toString());if(o<0)return t;const i=[...t];return i.splice(o,1,{...i[o],prompts:a}),i}default:throw new Error}}const[ot,Fd]=zr($d,Fa);function Od(t){var n,a,o;const{t:s}=C(["common","artwork"]);return e.jsx(as,{className:t.className,children:e.jsxs(fs,{sx:{".Mui-selected":{color:"white",backgroundColor:"rgb(var(--colors-theme-primary))",fontWeight:700,"&:hover":{backgroundColor:"rgb(var(--colors-theme-primary))"}}},fullWidth:!0,exclusive:!0,value:((n=t.value)==null?void 0:n.toString())??"1",onChange:t.onChange,disabled:t.disabled,children:[e.jsx(vt,{value:"4",disabled:((a=t.value)==null?void 0:a.toString())==="4",children:s("artwork:generation.multiple-images")}),e.jsx(vt,{value:"1",disabled:((o=t.value)==null?void 0:o.toString())==="1",children:s("artwork:generation.single-images")})]})})}const zd=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M1 21h22L12 2L1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})}),Vd=()=>{const{values:t,handleChange:s}=P(),n=zn(t),{value:a}=xs(async()=>{const{baseImage:i,upscale:r=1,width:l,height:d}=t;if(n){if(i&&!Ti(await i.getDimensions()))return!0}else if(r>1&&Math.max(l||0,d||0)*r>1024)return!0;return!1},[t.upscale,t.baseImage,t.width,t.height,n]),o=c.useMemo(()=>{if(a)return!0;const{enlarge:i=1,upscale:r=1}=t;return!!(i>1||r>1&&n)},[n,t.enlarge,t.upscale,a]);return c.useEffect(()=>{o&&s("batchSize")(1)},[o]),e.jsx(ve,{title:e.jsx(R,{i18nKey:"generation:numbers-of-image.label"}),help:a?e.jsx(R,{i18nKey:"generation:numbers-of-image.disabled-by-size"}):void 0,helpIconProps:{iconComp:zd,iconClassName:"text-amber-500",variant:"normal"},children:e.jsx(Od,{className:"flex",disabled:o,value:t.batchSize,onChange:(i,r)=>{const l=Number(r);Number.isNaN(l)||(T("number_image_switch",{target:l}),s("batchSize")(l))}})})},Bd=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"m12 8l-6 6l1.41 1.41L12 10.83l4.59 4.58L18 14z"})}),Hd=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17L7.41 8.59L6 10l6 6l6-6z"})}),Ud=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"m21.5 9.5l-1.41 1.42L17 7.83v5.67a6.5 6.5 0 0 1-6.5 6.5H4v-2h6.5c2.5 0 4.5-2 4.5-4.5V7.83l-3.09 3.08L10.5 9.5L16 4l5.5 5.5Z"})}),ct=1,dt=12,Gd=1;function Zd(t){var s;return gs((s=X(t))==null?void 0:s.modelType)}function Wd(){var d;const{values:t,handleChange:s}=P(),{clipSkip:n,modelId:a}=t,o=(d=X(a))==null?void 0:d.modelType,i=!gs(o),r=c.useRef(i);c.useEffect(()=>{o&&(i?s("clipSkip")(Js):r.current&&s("clipSkip")(Xs),r.current=i)},[o,i]),c.useEffect(()=>{(n==null||n<ct||n>dt)&&s("clipSkip")(Js)},[n]);const l=e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(nt,{disabled:i,value:n||Xs,onChange:(u,m)=>{s("clipSkip")(m)},min:ct,max:dt,step:Gd,valueLabelDisplay:"auto"}),e.jsx(ze,{type:"number",className:"w-[60px]",disabled:i,value:n,onChange:u=>{const m=+u.target.value,g=Math.round(Ve(m,ct,dt)*10)/10;s("clipSkip")(g)},inputProps:{min:ct,max:dt}})]});return e.jsx("div",{className:"flex flex-col gap-4",children:l})}function Kd(){var h,x;const{values:t,handleChange:s}=P(),{vaeModelId:n="",modelId:a}=t,{t:o}=C(["generation","action"]),i=(h=X(a))==null?void 0:h.modelType,r=ts(i),{data:l,isLoading:d}=Qi(i),u=us(i),m=c.useMemo(()=>os(l).filter(f=>!!f.latestAvailableVersion).sort((f,b)=>(b.extra.weightOffset??0)-(f.extra.weightOffset??0)),[(x=l==null?void 0:l.edges)==null?void 0:x.length]);c.useEffect(()=>{r&&s("vaeModelId")(void 0)},[r]);const g=e.jsxs(En,{size:"small",value:n,disabled:d||m.length<1||u,onChange:f=>{s("vaeModelId")(f.target.value)},displayEmpty:!0,children:[e.jsx(He,{value:"",children:e.jsx("em",{className:"opacity-50",children:o("generation:vae-model.select-placeholder")})}),m.map(f=>e.jsx(He,{value:f.latestAvailableVersion.id,children:f.title},f.id))]});return e.jsxs("div",{className:"flex flex-col",children:[u&&e.jsx(ie,{type:re.Warning,className:"mt-2",children:o("generation:vae-model.incompatible-model-used-hint")}),g]})}const ye=function(t){const s=t.help?e.jsx(On,{TooltipProps:{placement:"start",UNSTABLE_portalContainer:document.getElementById("workbench-layout-overlays")},variant:"normal",children:e.jsx("p",{className:"text-sm w-80 whitespace-pre-wrap",children:t.help})}):null;return e.jsxs("section",{children:[e.jsx("header",{children:e.jsxs("h3",{className:"flex items-center gap-2",children:[t.title," ",s]})}),e.jsx("div",{className:"mt-2",children:t.children})]})};function qd(){const{values:t,handleChange:s}=P(),{t:n}=C(["generation"]);return e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:negative-prompts.label"}),children:e.jsx(hs,{fullWidth:!0,multiline:!0,minRows:4,maxRows:4,placeholder:n("generation:negative-prompts.placeholder"),value:t.negativePrompts??"",onChange:s("negativePrompts"),onBlur:()=>{T("neg_input_blur")},InputLabelProps:{shrink:!0}})})}function Qd(){const{values:t,handleChange:s}=P(),n=t.lightning,{t:a}=C(["generation"]);return e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:sampling-steps.label"}),help:a("generation:sampling-steps.help"),children:e.jsx(nl,{lightningMode:n,disabled:n,value:t.samplingSteps,handleChange:s})})}function Jd(){var o;const{values:t,handleChange:s}=P(),n=(o=X(t.modelId))==null?void 0:o.modelType,{t:a}=C(["generation"]);return e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:sampling-method.label"}),help:a("generation:sampling-method.help"),children:e.jsx(al,{value:t.samplingMethod,handleChange:s,modelType:n,hideLabel:!0})})}function Xd(){const{values:t,handleChange:s}=P(),n=t.lightning,{state:a}=c.useContext(pe),{t:o}=C(["generation"]);return e.jsx(e.Fragment,{children:a.mode===B.Generate&&e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:cfg-scale.label"}),help:o("generation:cfg-scale.help"),children:e.jsx(ol,{lightningMode:n,disabled:n,value:t.cfgScale,handleChange:s})})})}function Yd(t){const{t:s}=C(["generation","action"]),{handleChange:n}=P();return t.seed?e.jsxs("div",{className:"flex  items-center gap-0",children:[e.jsxs("p",{className:"opacity-40 text-xs pl-3",children:[s("generation:seed.task-seed.label"),e.jsxs("span",{className:"text-xs",children:[": ",t.seed]})]}),e.jsx(Y,{onClick:()=>{n("seed")(t.seed)},children:e.jsx(Ud,{className:"size-4 opacity-80"})})]}):null}function e1(){var d,u,m;const{t}=C(["generation","action"]),[s]=c.useContext(ce),n=(d=s[0])==null?void 0:d.taskId,{data:a}=wt(n,{revalidateOnFocus:!1}),o=(m=(u=a==null?void 0:a.outputs)==null?void 0:u.detailParameters)==null?void 0:m.seed,{values:i,handleChange:r}=P(),l=o!=null&&o===i.seed;return e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:seed.label"}),children:e.jsxs("div",{className:"flex flex-col gap-1",children:[l&&e.jsx(ie,{type:re.Warning,className:"mb-2",children:t("generation:seed.task-seed.warning")}),e.jsx(hs,{type:"number",size:"small",className:"max-w-[500px]",InputLabelProps:{shrink:!0},placeholder:t("generation:seed.placeholder"),value:i.seed??"",onChange:r("seed")}),e.jsx(Yd,{seed:o})]})})}function t1(){const{t}=C(["generation"]),{values:s}=P();return Zd(s.modelId)?e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:clip-skip.label"}),help:t("generation:clip-skip.help"),children:e.jsx(Wd,{})}):null}function s1(){const{t}=C(["generation"]);return e.jsx(ye,{title:e.jsx(R,{i18nKey:"generation:vae-model.label"}),help:t("generation:vae-model.help"),children:e.jsx(Kd,{})})}const n1=[qd,Qd,Jd,Xd,e1,t1,s1],a1=In(),o1=Yt("generator::advanced-expanded",!1);function i1(){const[t,s]=Oe(o1,{store:a1}),n=t?e.jsx("div",{className:"flex flex-col gap-6 mt-4",children:n1.map((a,o)=>e.jsx(a,{},o))}):null;return e.jsx(ve,{title:e.jsx(R,{i18nKey:"generation:advanced.label"}),titleSlot:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"size-5 ml-auto flex items-center",children:t?e.jsx(Bd,{}):e.jsx(Hd,{})}),e.jsx("button",{onClick:()=>s(a=>!a),className:"absolute -inset-4"})]}),children:n})}const r1=Bo.debug("pixai:OPEditor"),yt=class yt extends H.fabric.Circle{constructor(n,a,o,i,r,l=4){super({left:n-l,top:a-l,radius:l,fill:o,stroke:o,strokeWidth:1,hasControls:!1,hasBorders:!1,hasRotatingPoint:!1});N(this,"name");N(this,"confidence");N(this,"constRadius");N(this,"id");N(this,"rc");N(this,"keepConstant");N(this,"connections");this.name=i,this.confidence=r,this.constRadius=l,this.id=yt.ids++,this.rc=0,this.connections=[],this.keepConstant={radius:l,scaleX:1,scaleY:1,angle:0,skewX:0,skewY:0,flipX:!1,flipY:!1},this.on("removed",this.disconnectAll.bind(this))}incRef(){this.rc++}dispose(n=!1){var a;--this.rc>0&&!n||(this.disconnectAll(),(a=this.canvas)==null||a.remove(this))}serialize(){if(!this.get("visible"))return[0,0,0];const n=this.getAbsPoint();return[Math.round(n.x+this.constRadius),Math.round(n.y+this.constRadius),this.confidence]}setRawCoords({x:n,y:a}){var o;n!=null&&this.set("left",n-this.constRadius),a!=null&&this.set("top",a-this.constRadius),this.setCoords(),(o=this.canvas)==null||o.requestRenderAll()}connect(n,a){if(!this.canvas)throw new Error("Keypoint is not added to canvas");if(this.connections.some(([i])=>i===n))return!1;const o=new l1(this,n,a);return this.canvas.add(o),this.canvas.sendToBack(o),this.connections.push([n,o]),n.connections.push([this,o]),!0}disconnect(n){var o;const a=this.connections.find(([i])=>i===n);return a?((o=this.canvas)==null||o.remove(a[1]),this.connections=this.connections.filter(([i])=>i!==n),n.connections=n.connections.filter(([i])=>i!==this),!0):!1}disconnectAll(){for(const[n]of this.connections)n.disconnect(this);this.connections=[]}takeConnections(n){const a=[];for(const[o,i]of this.connections)n(o)&&(this.disconnect(o),a.push([o,i]));return a}mergeConnections(n){if(n!==this)for(const[a,o]of n.takeConnections(()=>!0))a===this||this.connections.some(([i])=>i===a)||this.connect(a,o.color)}resolveRotation(n){const a=H.fabric.util.degreesToRadians(n);return[this.constRadius*(1-Math.cos(a)+Math.sin(a)),this.constRadius*(1-Math.sin(a)-Math.cos(a))]}_set(n,a){var o;if(a=((o=this.keepConstant)==null?void 0:o[n])??a,this.angle!=0&&queueMicrotask(()=>{const i=this.getPointByOrigin("left","top"),[r,l]=this.resolveRotation(this.angle||0);super._set("angle",0),super._set("left",i.x-r),super._set("top",i.y-l),this.setCoords()}),n==="visible")if(a)for(const[i,r]of this.connections)i.get("visible")&&r.set("visible",!0);else for(const[,i]of this.connections)i.set("visible",!1);return super._set(n,a)}getAbsAngle(){let n=this.angle||0,a=this.group;for(;a;)n+=a.angle||0,a=a.group;return n}getAbsPoint(n=!0){const a=this.getPointByOrigin("left","top");if(n){const[o,i]=this.resolveRotation(-this.getAbsAngle());a.x+=o,a.y+=i}return this.group?H.fabric.util.transformPoint(a,this.group.calcTransformMatrix()):a}refreshConnections(){const n=this.getAbsPoint();for(const[a,o]of this.connections){const i=a.getAbsPoint();let r,l;if(o.group){const d=H.fabric.util.invertTransform(o.group.calcTransformMatrix());r=H.fabric.util.transformPoint(n,d),l=H.fabric.util.transformPoint(i,d)}else r=n,l=i;o.set({x1:r.x+this.constRadius-1.5,y1:r.y+this.constRadius-1.5,x2:l.x+a.constRadius-1.5,y2:l.y+a.constRadius-1.5}),o.setCoords()}}setCoords(n){const a=super.setCoords(n);return this.refreshConnections(),a}};N(yt,"ids",0);let Ct=yt;class l1 extends H.fabric.Line{constructor(n,a,o){const i=n.getAbsPoint(),r=a.getAbsPoint();super([i.x+n.constRadius-1.5,i.y+n.constRadius-1.5,r.x+a.constRadius-1.5,r.y+a.constRadius-1.5],{stroke:o,strokeWidth:3,opacity:.6,visible:n.get("visible")&&a.get("visible"),selectable:!1,originX:"left",originY:"top"});N(this,"keypoint1");N(this,"keypoint2");N(this,"color");this.keypoint1=n,this.keypoint2=a,this.color=o}}const ae=class ae{constructor(s,n){N(this,"keypoints");N(this,"canvas");N(this,"visible");N(this,"_group");N(this,"_locked");this.keypoints=s,this.canvas=n,this.visible=!0,this._locked=!1;for(const a of s)a.incRef()}static groupLockTrack(s){!this.groupLockScope||this.groupLockScope.map.has(s)||this.groupLockScope.map.set(s,[!!s._group,s._locked])}static groupLockUntrack(s){if(!this.groupLockScope)return;let n=this.groupLockScope;for(;n;)n.map.delete(s),n=n.parent}static groupLockScoped(s){const n=this.groupLockScope;this.groupLockScope={parent:n,map:new Map};try{return s()}finally{for(const[a,[o,i]]of this.groupLockScope.map)o?a.group(!1):a.ungroup(!1),i?a.lock(!1):a.unlock(!1);this.groupLockScope=n}}dispose(){this.ungroup(!1),ae.groupLockUntrack(this);for(const s of this.keypoints)s.dispose();this.keypoints=[]}serialize(){return this.keypoints.flatMap(s=>s.serialize())}group(s=!0){if(this._group)return;s&&ae.groupLockTrack(this),this.canvas.discardActiveObject();const n=new H.fabric.Group(this.keypoints,{canvas:this.canvas,visible:this.visible});this._group=n,this.canvas.setActiveObject(n)}ungroup(s=!0){if(this._group){if(this._locked)return this.unlock(s);s&&ae.groupLockUntrack(this),this.canvas.discardActiveObject(),this._group.destroy(),this._group=void 0}}lock(s=!0){this._locked||(s&&ae.groupLockTrack(this),this.group(),this._group.set({selectable:!1,evented:!1,hasControls:!1,hasBorders:!1}),this._locked=!0)}unlock(s=!0){this._locked&&(s&&ae.groupLockUntrack(this),this._group.set({selectable:!0,evented:!0,hasControls:!0,hasBorders:!0}),this._locked=!1)}setVisibility(s){this.visible=s,this._group&&this._group.set("visible",s);for(const n of this.keypoints)n.set("visible",s)}moveBy(s,n,a=!0){this.group(a),this._group.set({left:this._group.left+s,top:this._group.top+n}),this._group.setCoords()}rotate(s,n=this.keypoints[0],a=!0){this.ungroup(a);const o=new H.fabric.Point(n.left,n.top);for(const i of this.keypoints){const r=new H.fabric.Point(i.left,i.top),l=H.fabric.util.rotatePoint(r,o,s);i.set({left:l.x,top:l.y}),i.setCoords()}}scale(s,n=!0){this.group(n),this._group.scale(s),this._group.setCoords()}};N(ae,"keypointRadius",4),N(ae,"groupLockScope");let je=ae;function he(t,s,n){if(s.length!==3*t.keypoints.length)throw new Error("Invalid data length");const a=[];for(let o=0;o<s.length;o+=3){const[i,r,l]=s.slice(o,o+3),d=new Ct(i,r,t.keypointColors[o/3],t.keypoints[o/3],l,t.keypointRadius);(i===-1||r===-1||l<=1e-6)&&d.set("visible",!1),a.push(d)}n.add(...a);for(const[o,[i,r]]of t.connections.entries())a[i].connect(a[r],t.connectionColors[o]);return new t(a,n)}const ee=class ee extends je{static default(s){return he(ee,this.defaultJson,s)}getKeypointByName(s){return this.keypoints[ee.keypoints.indexOf(s)]}};N(ee,"keypoints",["nose","neck","right_shoulder","right_elbow","right_wrist","left_shoulder","left_elbow","left_wrist","right_hip","right_knee","right_ankle","left_hip","left_knee","left_ankle","right_eye","left_eye","right_ear","left_ear"]),N(ee,"connections",[[0,1],[1,2],[2,3],[3,4],[1,5],[5,6],[6,7],[1,8],[8,9],[9,10],[1,11],[11,12],[12,13],[0,14],[14,16],[0,15],[15,17]]),N(ee,"keypointColors",["#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ff00","#00ff55","#00ffaa","#00ffff","#00aaff","#0055ff","#0000ff","#5500ff","#aa00ff","#ff00ff","#ff00aa","#ff0055"]),N(ee,"connectionColors",ee.keypointColors),N(ee,"defaultJson",[[241,77],[241,120],[191,118],[177,183],[163,252],[298,118],[317,182],[332,245],[225,241],[213,359],[215,454],[270,240],[282,360],[286,456],[232,59],[253,60],[225,70],[260,72]].flatMap(s=>[s[0],s[1],1]));let Ze=ee;const G=class G extends je{static default(s,n){return he(G,n==="left"?this.defaultJsonLeft:this.defaultJsonRight,s)}getKeypointByName(s){return this.keypoints[G.keypoints.indexOf(s)]}meanConnectionLength(){return G.connections.reduce((s,[n,a])=>{const o=this.keypoints[n],i=this.keypoints[a];return s+Math.hypot(o.left-i.left,o.top-i.top)},0)/G.connections.length||0}};N(G,"keypointRadius",2),N(G,"keypoints",["wrist",...["thumb","index","middle","ring","pinky"].flatMap(s=>Array.from({length:4},(n,a)=>s+"_"+(a+1)))]),N(G,"connections",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],[0,17],[17,18],[18,19],[19,20]]),N(G,"keypointColors",new Array(G.keypoints.length).fill("#0000ff")),N(G,"connectionColors",G.connections.map((s,n)=>or({h:n/G.connections.length*360,s:100,v:100,a:1}))),N(G,"defaultJsonLeft",[[72,139],[50,127],[26,110],[15,90],[0,75],[47,68],[45,41],[43,23],[42,7],[67,63],[65,41],[66,22],[65,0],[82,68],[85,46],[85,28],[85,9],[98,76],[103,60],[107,47],[111,32]].flatMap(s=>[s[0],s[1],1])),N(G,"defaultJsonRight",[[37,140],[59,132],[83,117],[100,99],[118,88],[69,70],[72,51],[76,34],[80,17],[48,67],[49,45],[51,21],[54,0],[30,71],[30,45],[31,26],[35,7],[11,79],[8,61],[4,48],[0,34]].flatMap(s=>[s[0],s[1],1]));let fe=G;const ge=class ge extends je{static default(s){return new this([],s)}getKeypointByName(s){return this.keypoints[ge.keypoints.indexOf(s)]}};N(ge,"keypoints",[...[["face_outline",17],["left_eyebrow",5],["right_eyebrow",5],["nose_bridge",4],["nose_bottom",5],["left_eye_outline",6],["right_eye_outline",6],["mouth_outer_bound",12],["mouth_inner_bound",8]].flatMap(([s,n])=>Array.from({length:n},(a,o)=>s+"_"+(o+1))),"left_eyeball","right_eyeball"]),N(ge,"connections",[]),N(ge,"keypointColors",new Array(ge.keypoints.length).fill("#ffffff")),N(ge,"connectionColors",[]);let Ie=ge;const c1=Vn({pose_keypoints_2d:rt(Le(Ne()),lt(Ze.keypoints.length*3)),hand_left_keypoints_2d:Rt(Dt(rt(Le(Ne()),lt(fe.keypoints.length*3)))),hand_right_keypoints_2d:Rt(Dt(rt(Le(Ne()),lt(fe.keypoints.length*3)))),face_keypoints_2d:Rt(Dt(rt(Le(Ne()),lt(Ie.keypoints.length*3))))}),Bs=Vn({canvas_width:Ne(),canvas_height:Ne(),people:Ho(Le(c1))}),d1={canvas_width:512,canvas_height:512,people:[{pose_keypoints_2d:Ze.defaultJson}]},$e=class $e{constructor(s,n,a,o,i,r){N(this,"name");N(this,"canvas");N(this,"body");N(this,"leftHand");N(this,"rightHand");N(this,"face");N(this,"id");N(this,"visible");this.name=s,this.canvas=n,this.body=a,this.leftHand=o,this.rightHand=i,this.face=r,this.id=$e.ids++,this.visible=!0;const l=(d,u)=>(d.incRef(),d.mergeConnections(u),u.dispose(),d);o&&(o.keypoints[0]=l(a.getKeypointByName("left_wrist"),o.keypoints[0])),i&&(i.keypoints[0]=l(a.getKeypointByName("right_wrist"),i.keypoints[0])),r&&(r.keypoints[68]=l(a.getKeypointByName("left_eye"),r.keypoints[68]),r.keypoints[69]=l(a.getKeypointByName("right_eye"),r.keypoints[69]))}dispose(){var s,n,a;this.body.dispose(),(s=this.leftHand)==null||s.dispose(),(n=this.rightHand)==null||n.dispose(),(a=this.face)==null||a.dispose()}serialize(){var s,n,a;return{pose_keypoints_2d:this.body.serialize(),hand_left_keypoints_2d:(s=this.leftHand)==null?void 0:s.serialize(),hand_right_keypoints_2d:(n=this.rightHand)==null?void 0:n.serialize(),face_keypoints_2d:(a=this.face)==null?void 0:a.serialize()}}static deserialize(s,n,a){const o=he(Ze,n.pose_keypoints_2d,a),i=n.hand_left_keypoints_2d?he(fe,n.hand_left_keypoints_2d,a):void 0,r=n.hand_right_keypoints_2d?he(fe,n.hand_right_keypoints_2d,a):void 0,l=n.face_keypoints_2d?he(Ie,n.face_keypoints_2d,a):void 0;return new $e(s,a,o,i,r,l)}keypoints(){return[this.body,this.leftHand,this.rightHand,this.face].filter(n=>!!n).flatMap(n=>n.keypoints)}isKeypointsInvisible(){return this.keypoints().every(s=>!s.visible)}attachHand(s,n){je.groupLockScoped(()=>{const o=this.body.getKeypointByName(`${n}_wrist`),i=this.body.getKeypointByName(`${n}_elbow`),r=s.getKeypointByName("middle_1"),l=s.getKeypointByName("wrist");this.body.ungroup(),s.ungroup();const d=Math.atan2(r.top-l.top,r.left-l.left),m=Math.atan2(o.top-i.top,o.left-i.left)-d;s.rotate(m,l),s.ungroup();const g=Math.hypot(o.left-i.left,o.top-i.top),h=s.meanConnectionLength()*4,x=g*.7/h;s.scale(x),s.ungroup();const f=o.left-l.left,b=o.top-l.top;s.moveBy(f,b);for(const[p,j]of l.takeConnections(v=>s.keypoints.includes(v)))p.connect(o,j.color);o.incRef(),l.dispose()});const a=this[`${n}Hand`];return a&&a.dispose(),this[`${n}Hand`]=s,this.canvas.requestRenderAll(),s}attachDefaultHand(s){const n=fe.default(this.canvas,s);return this.attachHand(n,s)}importHand(s,n){var r;const a=(r=n.people)==null?void 0:r[0];if(!a)return;const o=s==="left"?a.hand_left_keypoints_2d:a.hand_right_keypoints_2d;if(!o)return;const i=he(fe,o,this.canvas);return this.attachHand(i,s)}attachFace(s){je.groupLockScoped(()=>{const a=this.body.getKeypointByName("left_eye"),o=this.body.getKeypointByName("right_eye"),i=s.getKeypointByName("left_eyeball"),r=s.getKeypointByName("right_eyeball");this.body.ungroup(),s.ungroup();const l=Math.atan2(i.top-r.top,i.left-r.left),u=Math.atan2(a.top-o.top,a.left-o.left)-l;s.rotate(u,a),s.ungroup();const m=Math.hypot(a.left-o.left,a.top-o.top),g=Math.hypot(i.left-r.left,i.top-r.top),h=m/g;s.scale(h),s.ungroup();const x=a.left-i.left,f=a.top-i.top;s.moveBy(x,f);for(const[b,p]of i.takeConnections(j=>s.keypoints.includes(j)))b.connect(a,p.color);a.incRef(),i.dispose();for(const[b,p]of r.takeConnections(j=>s.keypoints.includes(j)))b.connect(o,p.color);o.incRef(),r.dispose()});const n=this.face;return n&&n.dispose(),this.face=s,this.canvas.requestRenderAll(),s}attachDefaultFace(){const s=Ie.default(this.canvas);return this.attachFace(s)}importFace(s){var o;const n=(o=s.people)==null?void 0:o[0].face_keypoints_2d;if(!n)return;const a=he(Ie,n,this.canvas);return this.attachFace(a)}};N($e,"ids",0);let Ut=$e;class Oa extends tl(sl){constructor(n,a){super();N(this,"canvasEl");N(this,"containerEl");N(this,"width");N(this,"height");N(this,"people");this.canvasEl=n,this.containerEl=a,this.width=0,this.height=0,this.people=[]}init(n){const a=new H.fabric.Canvas(this.canvasEl);a.preserveObjectStacking=!0,this._canvas=a,n.width&&n.height&&this.setSize(n.width,n.height),a.backgroundColor="#000";const o=i=>{const r=i.target;if(!r)return;const l=new Set([r]);for(const d of l)d instanceof Ct?d.refreshConnections():(d instanceof H.fabric.Group||d instanceof H.fabric.ActiveSelection)&&d.forEachObject(u=>l.add(u))};a.on("object:moving",o),a.on("object:scaling",o),a.on("object:rotating",o),a.on("object:modified",i=>{r1("object:modified %o",i),this.recordHistory()})}dispose(){this._canvas&&(this._canvas.dispose(),this._canvas=void 0)}setSize(n,a){const o=this.containerEl.getBoundingClientRect(),i=o.width/n,r=o.height/a,l=Math.min(i,r),d=l;this.canvas.setDimensions({width:n*l,height:a*l}),this.canvas.setViewportTransform([d,0,0,d,0,0]),this.width=n,this.height=a}serialize(){return{canvas_width:this.width,canvas_height:this.height,people:this.people.map(n=>n.serialize())}}deserialize(n,a=!0){return this.canvas.discardActiveObject(),this.restoreOnError(()=>{this.setSize(n.canvas_width,n.canvas_height);for(const o of this.people)o.dispose();this.people=[],n.people&&(this.people=n.people.map((o,i)=>Ut.deserialize(`Person ${i+1}`,o,this.canvas)))},{save:a})}_saveState(){return this.serialize()}async _restoreState(n){this.deserialize(n,!1),this.afterRestoreState()}async toImageFile(){const n=this.canvas.backgroundImage;this.canvas.backgroundImage=void 0,this.canvas.backgroundColor="#000";const a=this.canvas.toCanvasElement(1/this.canvas.getZoom());n&&await new Promise(i=>this.canvas.setBackgroundImage(n,i)),this.canvas.renderAll();const o=await pa(a,"image/png");return o&&be.fromFile(o)}}async function Hs(t){const s=document.createElement("canvas"),n=document.createElement("div");n.appendChild(s),n.style.position="absolute",n.style.visibility="hidden",n.style.width=t.canvas_width+"px",n.style.height=t.canvas_height+"px",document.body.appendChild(n);const a=new Oa(s,n);a.init({width:t.canvas_width,height:t.canvas_height}),await a.deserialize(t);const o=await a.toImageFile();return a.dispose(),n.remove(),o}const u1=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M18 13v7H4V6h5.02c.05-.71.22-1.38.48-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-5l-2-2zm-1.5 5h-11l2.75-3.53l1.96 2.36l2.75-3.54zm2.8-9.11c.44-.7.7-1.51.7-2.39C20 4.01 17.99 2 15.5 2S11 4.01 11 6.5s2.01 4.5 4.49 4.5c.88 0 1.7-.26 2.39-.7L21 13.42L22.42 12L19.3 8.89zM15.5 9a2.5 2.5 0 0 1 0-5a2.5 2.5 0 0 1 0 5z"})}),m1=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 14h-3v3h-2v-3H8v-2h3v-3h2v3h3v2zm-3-7V3.5L18.5 9H13z"})}),h1=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 5V2L8 6l4 4V7c3.31 0 6 2.69 6 6c0 2.97-2.17 5.43-5 5.91v2.02c3.95-.49 7-3.85 7-7.93c0-4.42-3.58-8-8-8zm-6 8c0-1.65.67-3.15 1.76-4.24L6.34 7.34A8.014 8.014 0 0 0 4 13c0 4.08 3.05 7.44 7 7.93v-2.02c-2.83-.48-5-2.94-5-5.91z"})}),g1=t=>e.jsxs("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:[e.jsx("path",{fill:"currentColor",d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"}),e.jsx("path",{fill:"currentColor",d:"M9.03 11.03a3.495 3.495 0 0 0 0 4.95a3.48 3.48 0 0 0 4.13.59l1.88 1.88l1.41-1.41l-1.88-1.88c.71-1.33.53-3.01-.59-4.13a3.495 3.495 0 0 0-4.95 0zm3.53 3.53c-.59.59-1.54.59-2.12 0a1.49 1.49 0 0 1 0-2.12a1.49 1.49 0 0 1 2.12 0c.59.59.59 1.53 0 2.12z"})]});function Us(t){return{id:Ls(),weight:1,thresholdA:.5,...t}}const[de,f1]=Ps({methods:[],controls:[]});function Gs({left:t,right:s}){return e.jsxs("div",{className:"flex flex-col mlg:flex-row w-full h-full overflow-y-scroll mlg:overflow-auto",children:[e.jsx("div",{className:"flex flex-col gap-4 py-5 w-full mlg:w-80 mlg:h-full mlg:overflow-y-scroll mlg:px-2",children:t}),e.jsx("div",{className:"flex-1 flex flex-col mlg:pl-6 pt-5 pb-3 mlg:h-full gap-2",children:s})]})}function gn(t){return Uo.post("/annotate",t)}function Bt({children:t,control:s,skipAnnotate:n,selectType:a,...o}){const[i,r]=c.useState(!1),l=c.useRef(null),{t:d}=C(["generation"]),[{methods:u},m]=c.useContext(de),{data:g}=ne(),h=u.find(b=>b.method===s.type),[x,f]=et(async b=>{var p,j,v;try{const k=E=>m(M=>({...M,controls:[...M.controls.map(S=>S.id===s.id?{...S,...E}:S)]})),_=b.mediaId?(await gt.getMedia({id:b.mediaId})).media:void 0;let y=b.file?be.fromFile(b.file):_?be.fromMedia(_):void 0;if(!y)throw new Error("Source media does not exist");if(n){k({hint:y});return}if(h.annotateFormats.includes("openpose_json")){const E=await D.promise(y.toMedia({onCompressed(S){y=S}}),{pending:`${d("generation:submit.notice.uploading-image")}`});if(!E)throw new Error("media does not exist");const M=await D.promise(gn({format:"openpose_json",method:h.method,mediaId:E.id,resolution:512}),{pending:`${d("generation:control-net.notice.annotating-image")}`});if(M.data.data){const S=Go(Bs,M.data.data);if(S.success){const A=await Hs(S.output);k({source:y,hint:A,openposeJson:S.output})}else throw new Error(d("generation:control-net.error.annotate-openpose-invalid-json"))}}else if(h.annotateFormats.includes("hint_image")){const E=await D.promise(y.toMedia({onCompressed(A){y=A}}),{pending:`${d("generation:submit.notice.uploading-image")}`});if(!E)throw new Error("media does not exist");const S=(await D.promise(gn({format:"hint_image",method:h.method,mediaId:E.id,resolution:512}),{pending:`${d("generation:control-net.notice.annotating-image")}`})).data.data.media;S&&k({source:y,hint:be.fromMedia(S)})}else k({hint:y})}catch(k){if(T("add_control_failed",{error:k.message}),Zo.isAxiosError(k)&&((p=k.response)==null?void 0:p.status)===422&&(v=(j=k.response)==null?void 0:j.data)!=null&&v.is_black)return D.error(d("generation:control-net.error.image-is-black"));D.error(d("generation:control-net.error.generic",{err:k.message}))}},[s,h,n]);return e.jsxs(e.Fragment,{children:[e.jsx($,{...o,variant:"outlined",busy:x,onPress:b=>{!g&&h.annotateFormats.length?se(null,{fromPath:"gen-cnet-annotate"}):a==="file-input"?l.current.click():r(!0)},children:t}),e.jsx("input",{ref:l,type:"file",accept:"image/*",hidden:!0,onChange:async b=>{try{const[p]=b.target.files||[];if(!p)return;await f({file:p})}finally{b.target.value=""}}}),e.jsx(Br,{open:i,onClose:()=>r(!1),onSubmit:b=>f({mediaId:b})})]})}const fn={};function za(t){const s=c.useRef(fn);return s.current===fn&&(s.current=t()),s}const x1=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M20 11H7.83l5.59-5.59L12 4l-8 8l8 8l1.41-1.41L7.83 13H20v-2z"})}),p1=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5s5 2.24 5 5s-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3s3-1.34 3-3s-1.34-3-3-3z"})}),b1=t=>e.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t,children:e.jsx("path",{fill:"currentColor",d:"M12 7c2.76 0 5 2.24 5 5c0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75c-1.73-4.39-6-7.5-11-7.5c-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28l.46.46A11.804 11.804 0 0 0 1 12c1.73 4.39 6 7.5 11 7.5c1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22L21 20.73L3.27 3L2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65c0 1.66 1.34 3 3 3c.22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53c-2.76 0-5-2.24-5-5c0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15l.02-.16c0-1.66-1.34-3-3-3l-.17.01z"})}),j1=["dwpose","openpose_full","openpose"];function v1({control:t,onOpenposeEditorClose:s}){var S;const{t:n}=C(["generation"]),[,a]=c.useContext(de),o=t.openposeJson,i=c.useCallback((A,W)=>{a(I=>({...I,controls:I.controls.map(U=>U.id===t.id?{...U,hint:W,openposeJson:A}:U)}))},[t]),r=c.useRef(null),l=c.useRef(null),d=za(()=>new WeakSet),u=c.useRef(0);d.current.has(o)||(d.current=new WeakSet,d.current.add(o),u.current++);const[m,g]=c.useState(),h=c.useRef();h.current=m;const[x,f]=c.useState(null),[b,p]=c.useState(!1),[j,v]=c.useState(!1),k=c.useRef(),[_,y]=c.useState(0);c.useEffect(()=>{const A=r.current;if(!A)return;const W=l.current;if(!W)return;const I=new Oa(A,W);return g(I),I.init({width:o.canvas_width,height:o.canvas_height}),I.on("stateChange",async()=>{p(I.canUndo()),v(I.canRedo()),k.current=I.people,y(q=>q+1);const U=I.serialize();d.current.add(U),i(U,await I.toImageFile())}),I.canvas.on("selection:created",()=>f(I==null?void 0:I.canvas.getActiveObject())),I.canvas.on("selection:updated",()=>f(I==null?void 0:I.canvas.getActiveObject())),I.canvas.on("selection:cleared",()=>f(null)),f(I==null?void 0:I.canvas.getActiveObject()),I.deserialize(o),()=>{g(void 0),h.current=void 0,I==null||I.dispose()}},[u.current]);const[E,M]=c.useState(!1);return e.jsx(Gs,{left:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(z,{className:"px-4 rounded-full",variant:"outlined",size:"small",startIcon:e.jsx(x1,{className:"size-3"}),onClick:s,children:n("generation:control-net.openpose.close")}),e.jsxs("div",{className:"flex",children:[e.jsx(Y,{size:"small",disabled:!b,onClick:()=>{m==null||m.undo()},children:e.jsx(na,{})}),e.jsx(Y,{size:"small",disabled:!j,onClick:()=>{m==null||m.redo()},children:e.jsx(aa,{})})]})]}),e.jsxs("div",{className:"flex flex-col gap-4 py-4",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("div",{children:e.jsx(Wo,{className:"m-0 gap-4",labelPlacement:"start",label:"Live Preview",control:e.jsx(Ko,{size:"small",checked:E,onChange:A=>M(A.target.checked)})})})}),m&&((S=k.current)==null?void 0:S.map(A=>e.jsx(C1,{person:A,editor:m,editorTrigger:_},A.id)))]})]}),right:e.jsxs("div",{className:"relative w-full h-full rounded-lg border border-gray-300",children:[e.jsx("div",{className:"focus:outline-none relative flex w-full h-full justify-center items-center",ref:l,tabIndex:1e3,children:e.jsx("canvas",{ref:r})}),m&&E&&e.jsx(k1,{hint:t.hint,editor:m})]})})}function C1({person:t,editor:s,editorTrigger:n}){const{t:a}=C(["generation"]);return e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h3",{children:t.name}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(xn,{title:e.jsx("h4",{children:a("generation:control-net.openpose.part.body")}),children:e.jsx(pn,{keypoints:t.body.keypoints,editor:s,editorTrigger:n})}),[["hand-left",e.jsx("h4",{children:a("generation:control-net.openpose.part.left-hand")}),t.leftHand,()=>t.attachDefaultHand("left"),o=>t.importHand("left",o),()=>{t.leftHand.dispose(),t.leftHand=void 0}],["hand-right",e.jsx("h4",{children:a("generation:control-net.openpose.part.right-hand")}),t.rightHand,()=>t.attachDefaultHand("right"),o=>t.importHand("right",o),()=>{t.rightHand.dispose(),t.rightHand=void 0}],["face",e.jsx("h4",{children:a("generation:control-net.openpose.part.face")}),t.face,!1,o=>t.importFace(o),()=>{t.face.dispose(),t.face=void 0}]].map(([o,i,r,l,d,u])=>e.jsx(xn,{title:i,children:r?e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outlined",onClick:()=>{u(),s.recordHistory()},children:a("action:delete.label")}),e.jsx(pn,{keypoints:r.keypoints,editor:s,editorTrigger:n})]}):e.jsxs("div",{className:"flex gap-2",children:[l&&e.jsx(z,{variant:"outlined",onClick:()=>{l(),s.recordHistory()},children:a("generation:control-net.openpose.part-default")}),e.jsx(z,{variant:"outlined",component:"label",htmlFor:"openpose-json-import-"+o+"-"+t.id,children:a("generation:control-net.openpose.part-import")}),e.jsx("input",{id:"openpose-json-import-"+o+"-"+t.id,type:"file",accept:".json",hidden:!0,onChange:async m=>{try{const[g]=m.target.files||[];if(!g)return;const h=JSON.parse(await g.text()),x=is(Bs,h);d(x),s.recordHistory()}catch(g){console.log(g),D.error("Invalid OpenPose JSON file")}finally{m.target.value=""}}})]})}))]})]})}function xn({title:t,children:s}){const[n,a]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex px-1 gap-1",children:[e.jsx(Y,{size:"small",onClick:()=>a(o=>!o),className:"-m-1 p-1",children:e.jsx(An,{className:w("transition-transform",!n&&"-rotate-90")})}),t]}),e.jsx(dl,{in:n,timeout:"auto",unmountOnExit:!0,children:s})]})}function pn({keypoints:t,editor:s}){return e.jsx("div",{className:"flex flex-col gap-1",children:t.map(n=>{const[a,o,i]=n.serialize();return e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h5",{children:n.name}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Y,{size:"small",onClick:()=>{n.set("visible",!n.visible),s.recordHistory()},children:n.visible?e.jsx(p1,{}):e.jsx(b1,{})}),e.jsx(ze,{className:"w-[5ch] px-1",value:a,onChange:r=>{n.setRawCoords({x:+r.target.value}),s.recordHistory()},onBlur:r=>{n.setRawCoords({x:Ve(+r.target.value,1,s.width)}),s.recordHistory()}}),e.jsx(ze,{className:"w-[5ch] px-1",value:o,onChange:r=>{n.setRawCoords({y:+r.target.value}),s.recordHistory()},onBlur:r=>{n.setRawCoords({y:Ve(+r.target.value,1,s.height)}),s.recordHistory()}})]})]},n.id)})})}const y1="worst quality, low quality, jpeg artifacts, blurry, monochrome, extra digits, bad anatomy",w1="masterpiece, best quality, 1girl";function k1({hint:t,editor:s}){C(["generation"]);const{values:n}=P(),{data:a}=ne(),o=c.useRef();o.current=s,on(()=>{var g;(g=o.current)!=null&&g._canvas&&(o.current.canvas.backgroundImage=void 0,o.current.canvas.renderAll()),o.current=void 0});const i=n.prompts||w1,r=n.negativePrompts||y1,l=Number(n.seed),d=c.useRef(null),[u,m]=c.useState("idle");return qo(async()=>{var g;if(!i||!t){m("idle");return}try{const h=await t.toCompressed({maxWidthOrHeight:512,divisibleBy:64}),x=await h.toFile(),{width:f,height:b}=await h.getDimensions();d.current&&((g=d.current)==null||g.abort());const p=new AbortController;d.current=p,m("rendering"),T("lcm_pose_to_image_start",{prompts:i,negativePrompts:r,seed:l,width:f,height:b},{destinations:["getway"]});const{data:j}=await ir({prompts:i,image:x,negativePrompts:r,seed:l||rr(),width:f,height:b,numOutputs:1,userId:a==null?void 0:a.id},{signal:p.signal});o.current&&o.current.canvas.setBackgroundImage("data:image/webp;base64,"+j.data[0].b64_image,()=>{var v;return(v=o.current)==null?void 0:v.canvas.renderAll()},{scaleX:o.current.width/f,scaleY:o.current.height/b})}catch(h){if(h.name==="CanceledError")return;D.error("Something went wrong: "+h);return}finally{m("idle"),d.current=null}},2e3,[i,r,t,l,a==null?void 0:a.id]),c.useEffect(()=>{!i||!t||m("debouncing")},[i,r,t,l]),on(()=>{var g;d.current&&((g=d.current)==null||g.abort())}),e.jsx(lr,{status:u})}const N1=[{method:"reference_only",hintType:"reference_only",demo:"https://images-ng.pixai.art/images/orig/d3a07e09-cce2-4d32-8655-50eb0d7a3436",annotateFormats:[]}],S1=["inpaint"];function I1(){const[t,s]=c.useState(!1),n=c.useContext(ea),a=c.useCallback(()=>{s(!0)},[]);return c.useEffect(()=>{n.current={...n.current,openControlNet:a}},[a]),e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs(f1,{defaultValue:{methods:[],controls:[]},children:[e.jsx(_1,{}),e.jsx(M1,{openDialog:a}),e.jsx($1,{open:t,onClose:()=>s(!1)})]})})}function Va(t){const s=X(t);return!Bn(s==null?void 0:s.extra)}function _1(){const{t}=C(["generation"]),{values:{modelId:s,controlNets:n,ipAdapter:a}}=P(),o=X(s),i=o==null?void 0:o.modelType,r=ts(o==null?void 0:o.modelType),l=us(o==null?void 0:o.modelType),[,d]=c.useContext(de),{data:{controlnetMethods:u=[]}={}}=ns(),m=u.length>0,g=a==null?void 0:a.enabled,h=c.useMemo(()=>{const f=[...u,...N1],b=p=>g?Xo.includes(p.method):r?Yo.includes(p.method):l?ei.includes(p.method):!0;return f.filter(b)},[m,r,l,g]);return c.useEffect(()=>{d(f=>({...f,methods:h}))},[h,g]),Va(s)?g&&!Qo(n??[])?e.jsx(ie,{type:re.Warning,children:t("generation:control-net.incompatible-ipadapter-used-hint")}):n&&!Jo(n,i)?e.jsx(ie,{type:re.Warning,children:t("generation:control-net.incompatible-model-used-hint")}):null:e.jsx(ie,{type:re.Warning,children:t("generation:control-net.disabled-by-model-hint")})}function M1(t){const{values:s}=P(),n=c.useMemo(()=>s.controlNets??[],[s.controlNets]);return n.length>0?e.jsx("div",{className:"flex gap-4",children:n.map(a=>e.jsx(P1,{control:a,openDialog:t.openDialog},a.mediaId))}):e.jsx(T1,{openDialog:t.openDialog})}function T1(t){const{values:{modelId:s}}=P(),n=X(s),{t:a}=C(["generation"]);return e.jsx($,{variant:"filled",color:"grayish-sidebar",className:"w-full",disabled:Bn(n==null?void 0:n.extra),onPress:()=>{T("add_control_click"),t.openDialog()},children:a("generation:control-net.add-control")})}function P1(t){const{mediaId:s,type:n,weight:a}=t.control,{t:o}=C(["generation"]),{setValues:i}=P(),{data:r}=J(s),l=Kt(r),d=m=>{m.stopPropagation(),i(g=>{var h;return{...g,controlNets:(h=g.controlNets)==null?void 0:h.filter(x=>x.mediaId!==t.control.mediaId)}})},u=S1.includes(n);return l?e.jsxs("div",{children:[n&&e.jsxs("h2",{className:w("font-semibold text-xs",u?"cursor-not-allowed":"cursor-pointer"),onClick:()=>{u||t.openDialog()},children:[e.jsxs("p",{className:"font-normal text-neutral-500 h-[2lh] leading-none mb-[2px]",children:[o(`generation:control-net.methods.${n}`),":"," "]}),e.jsx("p",{children:(a||0).toFixed(1)})]}),e.jsx("div",{className:"aspect-1 rounded-xl border border-neutral-300 mt-1 max-h-[150px]",children:e.jsxs("div",{className:"flex relative w-full h-full",style:{aspectRatio:ms(r)},children:[e.jsx(Te,{mediaId:r==null?void 0:r.id,imgClassName:"flex object-contain w-full h-full rounded-xl !object-center",originalUrl:l,fileName:`pixai-controlnet-hint_${s}.${st({media:r})}`,width:r==null?void 0:r.width,height:r==null?void 0:r.height}),e.jsx(Y,{className:"rounded-full bg-background shadow-sm absolute top-0 right-0 translate-x-3 -translate-y-3",onClick:d,children:e.jsx(xe,{className:"size-[14px]"})})]})})]}):e.jsx($,{variant:"filled",color:"grayish-sidebar",className:"w-full",onPress:()=>{T("add_control_click"),t.openDialog()},children:o("generation:control-net.add-control")})}function L1(){const{t}=C(["generation"]),[{methods:s},n]=c.useContext(de);return e.jsxs("div",{className:"flex flex-col gap-4 py-5 h-full",children:[e.jsx("h3",{className:"text-lg font-light",children:t("generation:control-net.method")}),(s??[]).length>0?e.jsx("div",{className:"flex-1 min-h-0 grid grid-cols-2 mlg:grid-cols-4 gap-4 overflow-scroll",children:s.map(({method:a,demo:o})=>e.jsxs(ti,{className:"flex flex-col",value:a,onClick:()=>{n(i=>({...i,controls:[...i.controls,Us({type:a})]}))},children:[e.jsx("img",{className:"w-full aspect-[577/290] rounded-lg",src:o,crossOrigin:"anonymous"}),t(`generation:control-net.methods.${a}`)]},a))}):e.jsx(fa,{description:t("generation:control-net.no-available-cnets-placeholder")})]})}function E1({control:t}){const[s,n]=c.useState(!1),a=c.useCallback(()=>{n(!0)},[]),o=c.useCallback(()=>{n(!1)},[]);return t.openposeJson&&s?e.jsx(v1,{control:t,onOpenposeEditorClose:o}):t.source||t.hint||t.mediaId?e.jsx(A1,{control:t,onOpenposeEditorOpen:a}):e.jsx(R1,{control:t})}function A1({control:t,onOpenposeEditorOpen:s}){const{t:n}=C(["generation"]),[,a]=c.useContext(de),o=c.useCallback(async()=>{try{await Hn({title:n("generation:control-net.item.reset-confirm.title"),description:n("generation:control-net.item.reset-confirm.desc")})}catch{return}a(d=>({...d,controls:d.controls.map(u=>u.id===t.id?Us({id:t.id,type:u.type}):u)}))},[t]),i=c.useCallback(d=>{a(u=>({...u,controls:u.controls.map(m=>m.id===t.id?{...m,weight:d}:m)}))},[t]),r=c.useCallback(d=>{a(u=>({...u,controls:u.controls.map(m=>m.id===t.id?{...m,thresholdA:d}:m)}))},[t]),l=c.useCallback(async()=>{const d=t.openposeJson;if(!d)return;const u=new Blob([JSON.stringify(d)],{type:"application/json"}),m=URL.createObjectURL(u),g=document.createElement("a");g.href=m,g.download=`pixai-openpose-${t.id}-${Date.now()}.json`,g.click(),URL.revokeObjectURL(m)},[t]);return e.jsx(Gs,{left:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(z,{className:"px-4 rounded-full",variant:"outlined",size:"small",startIcon:e.jsx(h1,{}),onClick:o,children:n("generation:control-net.item.reset")})}),t.source&&e.jsx(z1,{source:t.source}),t.openposeJson&&e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"hidden mlg:inline-flex",variant:"outlined",startIcon:e.jsx(Ss,{className:"size-5"}),onClick:s,children:n("generation:control-net.openpose.open")}),e.jsx(z,{variant:"outlined",startIcon:e.jsx(ia,{className:"size-5"}),onClick:l,children:n("generation:control-net.openpose.export-json")})]}),e.jsx(bn,{className:"w-full",type:"weight",value:t.weight,onChange:i}),t.type==="reference_only"&&e.jsx(bn,{className:"w-full",type:"threshold",value:t.thresholdA,onChange:r})]}),right:e.jsx(Ba,{control:t})})}function R1({control:t}){const{t:s}=C(["action","generation"]),[{methods:n},a]=c.useContext(de),o=n.find(l=>l.method===t.type),i=c.useCallback(()=>{a(l=>({...l,controls:l.controls.filter(d=>d.id!==t.id)}))},[t]),r=c.useCallback(async()=>{const l=JSON.parse(JSON.stringify(d1)),d=await Hs(l);a(u=>({...u,controls:[...u.controls.map(m=>m.id===t.id?{...m,openposeJson:l,hint:d}:m)]}))},[t]);return e.jsx(Gs,{left:e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"text-lg font-light",children:s("generation:control-net.init.label")}),e.jsx(z,{className:"mlg:hidden px-4 rounded-full",variant:"outlined",size:"small",startIcon:e.jsx(ll,{className:"size-5"}),onClick:i,children:s("action:delete.label")})]}),e.jsxs("div",{className:w(o.annotateFormats.length?"flex":"hidden","flex-col w-full"),children:[e.jsx(Bt,{selectType:"file-input",className:"text-theme-primary border-theme-primary",control:t,startIcon:e.jsx(u1,{className:"size-5"}),children:s("generation:control-net.init.annotate.label")}),e.jsx("div",{className:"mt-0.5 text-primary-light text-xs text-center text-balance",children:s("generation:control-net.init.annotate.desc")})]}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(Bt,{selectType:"task-select",className:"text-theme-primary border-theme-primary",control:t,startIcon:e.jsx(Pi,{className:"size-5"}),children:s("generation:enhance-image.image-select.select-from-task")}),e.jsx("div",{className:"mt-0.5 text-primary-light text-xs text-center text-balance",children:s("generation:control-net.init.select-from-task.desc")})]}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(Bt,{selectType:"file-input",className:w(!o.annotateFormats.length&&"text-theme-primary border-theme-primary"),control:t,startIcon:e.jsx(ba,{className:"size-5"}),skipAnnotate:!0,children:s("generation:control-net.init.upload.label")}),e.jsx("div",{className:"mt-0.5 text-primary-light text-xs text-center text-balance",children:s("generation:control-net.init.upload.desc")})]}),j1.includes(t.type)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden mlg:flex flex-col w-full",children:[e.jsx(z,{variant:"outlined",startIcon:e.jsx(m1,{className:"size-5"}),onClick:r,children:s("generation:control-net.init.openpose-default.label")}),e.jsx("div",{className:"mt-0.5 text-primary-light text-xs text-center text-balance",children:s("generation:control-net.init.openpose-default.desc")})]}),e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx(D1,{control:t}),e.jsx("div",{className:"mt-0.5 text-primary-light text-xs text-center text-balance",children:s("generation:control-net.init.openpose-import.desc")})]})]})]}),right:e.jsx(Ba,{className:"hidden mlg:flex",control:t})})}function D1({control:t}){const{data:s}=ne(),{t:n}=C(["generation"]),[,a]=c.useContext(de),o=c.useRef(null),[i,r]=et(async l=>{try{const[d]=l.target.files||[];if(!d)return;const u=JSON.parse(await d.text()),m=is(Bs,u),g=await Hs(m);a(h=>({...h,controls:[...h.controls.map(x=>x.id===t.id?{...x,openposeJson:m,hint:g}:x)]}))}catch(d){console.error(d),D.error(n("generation:control-net.openpose.error.invalid-json"))}finally{l.target.value=""}},[t]);return e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"outlined",busy:i,icon:e.jsx(g1,{className:"size-5"}),onPress:l=>{s?o.current.click():se()},children:n("generation:control-net.init.openpose-import.label")}),e.jsx("input",{ref:o,type:"file",accept:".json",hidden:!0,onChange:r})]})}function $1(t){return e.jsx(Sn,{open:t.open,onClose:t.onClose,dialogProps:{maxWidth:!1,style:{zIndex:20},PaperProps:{style:{maxWidth:"1000px",maxHeight:"min(calc(100vh - 64px), 800px)"}}},breakpoint:"lg",children:e.jsx(F1,{onClose:t.onClose})})}function F1(t){const{t:s}=C(["action","generation"]),[{controls:n,loading:a},o]=c.useContext(de),{values:{controlNets:i=[]},setValues:r}=P(),[l,d]=c.useState(0),u=c.useCallback((x,f)=>{d(f)},[]);c.useEffect(()=>{o(x=>({...x,controls:i.map(Us)}))},[]);const[m,g]=et(async()=>{try{const x=(await D.promise(Promise.all(n.map(async f=>{var j;const b=await((j=f.hint)==null?void 0:j.toMedia({onCompressed:void 0})),p=(b==null?void 0:b.id)??f.mediaId;if(p)return{type:f.type,mediaId:p,weight:f.weight,...f.type==="reference_only"?{thresholdA:f.thresholdA}:{}}})),{pending:`${s("generation:control-net.notice.saving")}`})).filter(f=>!!f);r(f=>({...f,controlNets:x})),T("add_control_success",{number:x.length}),t.onClose()}catch(x){T("add_control_failed",{error:x.message}),D.error(s("generation:control-net.error.generic",{err:x.message}))}},[n,t.onClose]),h=n??[];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:w("flex items-center gap-x-2 mlg:gap-x-6","px-1 mlg:pl-4 mlg:pr-2 h-12","border-b border-background-light"),children:[e.jsx("h2",{className:"pl-2 text-lg font-semibold",children:s("generation:control-net.control-net")}),e.jsxs(yr,{className:"flex-1 min-w-0",variant:"scrollable",scrollButtons:"auto",value:l,onChange:u,children:[h.map(x=>e.jsx(O1,{control:x},x.id)),e.jsx(ca,{className:w("min-w-0",h.length>=3&&"hidden"),label:e.jsx(rl,{className:"size-5"}),disabled:a,sx:{textTransform:"none"}})]}),e.jsx(Y,{className:"hidden mlg:inline-flex",color:"primary",onClick:t.onClose,children:e.jsx(xe,{className:"size-6"})})]}),e.jsx(pt,{className:w("py-0 h-[calc(100%-48px-52.5px-1px)]","mlg:h-[calc(min(100vh-64px,620px)-48px-52.5px)]"),children:l>=h.length?e.jsx(L1,{}):e.jsx(E1,{control:h[l]},h[l].id)}),e.jsxs(Nt,{children:[e.jsx($,{variant:"outlined",className:"capitalize",disabled:a||m,onPress:t.onClose,children:s("action:cancel")}),e.jsx($,{variant:"filled",busy:a||m,onPress:g,children:s("action:confirm")})]})]})}function O1({control:t,...s}){const{t:n}=C(["generation"]),[,a]=c.useContext(de),o=c.useCallback(async()=>{try{await Hn({title:n("generation:control-net.item.reset-confirm.title"),description:n("generation:control-net.item.reset-confirm.desc")})}catch{return}a(i=>({...i,controls:i.controls.filter(r=>r.id!==t.id)}))},[t]);return e.jsx(ca,{label:e.jsxs("span",{children:[n(`generation:control-net.methods.${t.type}`),e.jsx(Y,{component:"div",className:"hidden mlg:inline-flex ml-px -mr-3 -my-2 w-6 h-6",size:"small",onClick:o,children:e.jsx(xe,{className:"size-4"})})]}),sx:{textTransform:"none"},...s})}function Ba({children:t,control:s,placeholder:n="(Empty)",className:a,...o}){var g,h;const i=ks(s.hint),{data:r}=J(s.mediaId),l=i??Je(r),{value:d}=xs(async()=>{var x;return(x=s.hint)==null?void 0:x.getDimensions()},[s.hint]),u={width:r==null?void 0:r.width,height:r==null?void 0:r.height},m=d??u;return e.jsxs("div",{className:w("relative w-full h-full rounded-lg border border-gray-300",a),...o,children:[l?e.jsx(Te,{mediaId:(g=s.hint)==null?void 0:g.ifHas("media",x=>x.id),imgClassName:"w-full h-full rounded-lg object-contain !object-center",originalUrl:l,fileName:((h=s.hint)==null?void 0:h.name)??`${(r==null?void 0:r.id)??"media"}.${st({media:r})}`,width:m==null?void 0:m.width,height:m==null?void 0:m.height}):e.jsx("div",{className:"grid place-items-center px-4 w-full h-full text-gray-400 text-xs text-center",children:n}),t]})}function bn({className:t,type:s,value:n,onChange:a}){const{t:o}=C(["generation"]),i=c.useId();return e.jsxs(as,{className:t,children:[e.jsxs("div",{className:"inline-flex gap-2 items-center",children:[e.jsx("label",{htmlFor:"weight-select-"+i,className:"text-sm text-stone-500",children:o(`generation:control-net.${s}.label`)}),s==="threshold"&&e.jsx(Un,{iconClassname:"text-sm text-stone-500",children:e.jsx("p",{className:"p-4",children:o("generation:control-net.threshold.help-text")})})]}),e.jsxs("div",{className:"inline-flex gap-8",children:[e.jsx(nt,{id:"weight-select-"+i,value:n,onChange:(r,l)=>{typeof l=="number"&&a(l)},min:0,max:1,step:.1,valueLabelDisplay:"auto"}),e.jsx(ze,{type:"number",className:"w-[60px]",value:n,onChange:r=>{const l=Number(r.target.value);a==null||a(Ve(l,0,1))},inputProps:{min:0,max:1,step:.1}})]})]})}function z1({source:t}){const{t:s}=C(["generation"]),n=ks(t),{value:a}=xs(()=>t.getDimensions(),[t]);return e.jsx("div",{className:"w-full aspect-1 rounded-lg border border-gray-300 overflow-hidden",children:n?e.jsx(Te,{mediaId:t.ifHas("media",o=>o.id),originalUrl:n,fileName:t.name,imgClassName:"w-full h-full object-contain !object-center",width:a==null?void 0:a.width,height:a==null?void 0:a.height}):e.jsx("div",{className:"grid place-items-center px-4 w-full h-full text-gray-400 text-xs text-center",children:s("generation:control-net.preview-placeholder")})})}const V1=function(){const{t}=C(["generation"]),{values:s}=P(),n=c.useMemo(()=>{var o;return(((o=s.controlNets)==null?void 0:o.length)??0)>0},[s.controlNets]),a=Va(s.modelId);return n||a?e.jsx(ve,{title:t("generation:control-net.control-net"),help:e.jsx("img",{className:"w-[400px] min-h-[600px] rounded-lg",src:t("generation:control-net.help-image")}),children:e.jsx(I1,{})}):null},B1=function(){const{t}=C(["generation"]),[s,n]=wr(),{values:a}=P();return e.jsx(ve,{className:"flex flex-col gap-2",title:t("generation:model.label"),help:e.jsx("p",{className:"text-sm w-80 whitespace-pre-wrap",children:t("generation:model.help")}),helpIconProps:{variant:"normal"},titleSlot:e.jsx(kr,{mode:s,setMode:n,className:"ml-auto"}),children:e.jsx(Nr,{modelId:a.modelId})})},ut={draw:[e.jsx(Ss,{className:"size-6"}),t=>{t.setMode("draw")}],erase:[e.jsx(ai,{children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M15.14 3c-.51 0-1.02.2-1.41.59L2.59 14.73c-.78.77-.78 2.04 0 2.83L5.03 20h7.66l8.72-8.73c.79-.77.79-2.04 0-2.83l-4.85-4.85c-.39-.39-.91-.59-1.42-.59M17 18l-2 2h7v-2"})})}),t=>{t.setMode("erase")}],select:["select",t=>{t.setMode("select")}]},H1=({editorRef:t,baseImage:s,onCancel:n,onDone:a,onLoading:o,saving:i,tools:r,drawingType:l,colorPicker:d=!0,extraTools:u,overrideToolAction:m})=>{const{t:g}=C(["generation","action","common"]),h=c.useRef(null),x=c.useRef(null),f=c.useMemo(()=>r?si(ut,r):ut,[r]),[b,p]=c.useState(()=>Object.keys(f)[0]),[j,v]=c.useState(),[k,_]=c.useState("#7cafc27f"),[y,E]=c.useState(!1),[M,S]=c.useState(!1),[A,W]=c.useState(20),I=c.useRef(),[U,q]=et(async()=>{var Pe;I.current&&(I.current.dispose(),I.current=void 0,v(void 0));const V=h.current;if(!V)return;const K=x.current;if(!K)return;const L=new cr(V,K);v(L),I.current=L,await L.init({width:512,height:512,drawingType:l,baseImage:s}),L.setPencilColor(k),L.setBrushSize(A);const F=Object.keys(f)[0];p(F);const ue=(m==null?void 0:m[F])||((Pe=ut[F])==null?void 0:Pe[1]);ue==null||ue(L),L.on("stateChange",()=>{E(L.canUndo()),S(L.canRedo())})},[k,A,b,l,s]);c.useEffect(()=>{o==null||o(U)},[U]),c.useEffect(()=>(q(),()=>{I.current&&(I.current.dispose(),I.current=void 0,v(void 0))}),[l,s]),c.useImperativeHandle(t,()=>j,[j]);const Q=e.jsx(Un,{children:e.jsx("div",{className:"p-4 text-sm w-80 whitespace-pre-wrap",children:g("generation:image-edit.paint.help")})});return e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex justify-center items-center gap-2 pb-4 flex-wrap-reverse",children:[Q,u,e.jsx(fs,{size:"small",exclusive:!0,value:b,onChange:(V,K)=>{var F;p(K);const L=(m==null?void 0:m[K])||((F=ut[K])==null?void 0:F[1]);j&&(L==null||L(j))},children:Object.entries(f).map(([V,[K]])=>e.jsx(vt,{value:V,children:e.jsx(ke,{title:g("generation:image-edit."+V),children:e.jsx("div",{children:K})},V)},V))}),e.jsxs(rn,{variant:"outlined",children:[e.jsx(ke,{title:g("generation:image-edit.undo"),children:e.jsx(z,{className:"px-0",disabled:!y,onClick:()=>{j==null||j.undo()},children:e.jsx(na,{className:"size-6"})})}),e.jsx(ke,{title:g("generation:image-edit.redo"),children:e.jsx(z,{className:"px-0",disabled:!M,onClick:()=>{j==null||j.redo()},children:e.jsx(aa,{className:"size-6"})})}),e.jsx(ke,{title:g("generation:image-edit.clear"),children:e.jsx(z,{className:"px-0",onClick:()=>{j==null||j.clearDrawings(),j==null||j.resetHistory()},children:e.jsx(ml,{className:"size-6"})})})]}),e.jsx(rn,{variant:"outlined",children:e.jsx(ke,{title:g("generation:image-edit.brush-size"),children:e.jsx("div",{className:"flex items-stretch",children:e.jsx(dr,{value:A,onChange:V=>{W(V),j==null||j.setBrushSize(V)}})})})}),d&&e.jsx(ke,{title:g("generation:image-edit.brush-color"),children:e.jsx(ur,{className:"flex-shrink-0 min-w-0 w-10 h-10",hex:k,onChange:V=>{_(V),j==null||j.setPencilColor(V)}})}),e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsx(z,{disabled:i,variant:"outlined",onClick:()=>{n==null||n()},startIcon:e.jsx(xe,{}),children:g("action:cancel")}),e.jsx(z,{disabled:i,variant:"outlined",onClick:()=>{a==null||a()},startIcon:e.jsx(ul,{}),children:g("common:done")})]})]}),e.jsxs("div",{className:"w-full h-[600px] flex justify-center items-center relative",ref:x,children:[e.jsx("canvas",{ref:h,className:"border w-full"}),i&&e.jsx("div",{className:"bg-background absolute inset-0 flex justify-center items-center",children:e.jsx(ni,{})})]})]})};function U1(t){const{t:s}=C(["artwork"]),[,n]=c.useContext(Cs),{values:a,setValues:o}=P(),[i,r]=c.useState(),l=a.previewImage??a.baseImage,d=ks(l);c.useEffect(()=>{l==null||l.getDimensions().then(r).catch(m=>console.warn(m))},[l]);const u=()=>{var m;n(g=>({...g,isInpaintOn:!1})),o(g=>({...g,upscale:void 0,upscaleDenoisingSteps:void 0,upscaleDenoisingStrength:void 0,width:void 0,height:void 0,inpaintMaskImage:void 0,baseImage:void 0,previewImage:void 0})),(m=t.onCloseClick)==null||m.call(t)};return e.jsx("div",{className:w("flex-auto basis-[50%]",d&&"aspect-1 flex items-center justify-center max-w-[50%]"),children:d?e.jsxs("div",{className:"flex relative max-h-[400px] lg:max-w-[168px] lg:max-h-[168px] w-full h-full",style:{aspectRatio:ms(i)},children:[e.jsx(Te,{originalUrl:d,fileName:l.name,imgClassName:"flex object-contain w-full h-full rounded-xl !object-center",width:i==null?void 0:i.width,height:i==null?void 0:i.height}),e.jsx(Y,{onClick:u,className:"rounded-full bg-background shadow-md absolute top-0 right-0 translate-x-3 -translate-y-3",children:e.jsx(xe,{className:"size-[14px]"})})]}):e.jsxs(_e,{variant:"grayish-sidebar",className:w("flex gap-1 w-full"),onClick:d?void 0:t.onClick,children:[e.jsx(ba,{className:"size-6"}),s("generation:image-edit.upload-image")]})})}function G1(){const{data:t}=ne(),{t:s}=C(["artwork","generation"]),[{showEditor:n,isInpaintOn:a,dirty:o},i]=c.useContext(Cs),r=y=>i(E=>({...E,showEditor:y})),l=y=>i(E=>({...E,isInpaintOn:y})),d=c.useRef(null),u=c.useRef(null),[m,g]=c.useState(!1),{values:h,setValues:x}=P(),[f,b]=c.useState(),[p,j]=c.useState(),v=qe();c.useEffect(()=>{h.baseImage&&o&&(b(h.baseImage),i(y=>({...y,dirty:!1})))},[o]),c.useEffect(()=>{h.baseImage?(h.baseImage.getDimensions().then(j).catch(y=>{console.warn(y),j(void 0)}),b(h.baseImage)):(b(void 0),j(void 0))},[h.baseImage]);const[k,_]=et(async()=>{const y=u.current;if(!y)return;const E=await y.getImage();if(y.drawingType==="inpaint"){const M=await y.getInpaintMaskImage().then(S=>S&&pa(S,"inpaintMask.png")).then(S=>S&&be.fromFile(S));x(S=>({...S,inpaintMaskImage:M,baseImage:y.baseFile,previewImage:E,upscale:void 0}));return}x(M=>({...M,inpaintMaskImage:void 0,baseImage:E,previewImage:E,upscale:void 0}))});return c.useEffect(()=>{const y=u.current;y&&y.resetHistory()},[a,n]),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex gap-4 w-full items-center",children:[e.jsx(U1,{onClick:()=>{var y;if(!t)return se();(y=d.current)==null||y.click(),T("base_image_upload_click",{label:"left"})},showEditor:n,onCloseClick:()=>{j(void 0),b(void 0)}}),e.jsx("input",{ref:d,type:"file",accept:"image/*",hidden:!0,onClick:y=>{y.currentTarget.value=""},onChange:async y=>{const[E]=y.target.files||[];if(!E)return;y.target.files=null;const M=be.fromFile(E),S=await M.getDimensions();x(A=>({...A,upscale:void 0,upscaleDenoisingSteps:void 0,upscaleDenoisingStrength:void 0,baseImage:M,...il(S),inpaintMaskImage:void 0,previewImage:void 0}))}}),e.jsxs("div",{className:w("flex-auto basis-[50%] flex flex-col gap-4 justify-end",p&&"justify-between"),children:[p&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:s("artwork:generation.size")}),e.jsxs("p",{children:[p.width," x ",p.height]})]}),e.jsxs(_e,{variant:"grayish-sidebar",disabled:m,className:"flex gap-1",onClick:async()=>{if(T("base_image_paint_click"),!t)return se();r(!0)},children:[e.jsx(sa,{className:"size-5 flex-grow-0"}),s("generation:image-edit.paint.label")]})]})]}),e.jsx(ss,{open:n,onClose:()=>{var y;r(!1),(y=u.current)==null||y.clearChanges()},PaperProps:v?{}:{className:"rounded-lg"},maxWidth:!1,keepMounted:!0,fullScreen:v,children:e.jsx("div",{className:w("p-4",v?"w-full":"min-w-[800px]"),children:e.jsx(H1,{editorRef:u,saving:k,onCancel:()=>{var y;r(!1),(y=u.current)==null||y.clearChanges()},onDone:async()=>{var y;await _(),r(!1),(y=u.current)==null||y.resetHistory()},onLoading:g,drawingType:a?"inpaint":void 0,baseImage:f,tools:["draw","erase"],extraTools:e.jsx(fs,{size:"small",value:a?["inpaint"]:[],onChange:(y,E)=>{l(E.includes("inpaint"))},children:e.jsx(vt,{value:"inpaint",children:e.jsxs("span",{className:"px-2 flex items-center",children:[e.jsx(cl,{className:"size-6"}),e.jsx("span",{className:"pl-2 normal-case",children:s("generation:image-operation.inpaint")})]})})})})})})]})}const Z1=function(){const{values:t,handleChange:s}=P();return e.jsxs(ve,{help:e.jsx("p",{className:"text-sm w-80 whitespace-pre-wrap",children:e.jsx(R,{i18nKey:"generation:reference-image.help"})}),helpIconProps:{variant:"normal"},title:e.jsx(R,{i18nKey:"generation:reference-image.label"}),children:[e.jsx(G1,{}),Gt(t)==="i2i"&&e.jsx(W1,{values:t,handleChange:s})]})},W1=({values:t,handleChange:s})=>{const{t:n}=C(["generation"]),{strength:a}=t;return e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-primary-light",children:n("generation:strength.label")}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx(nt,{className:"max-w-[400px]",value:a,onChange:(o,i)=>{s("strength")(i)},min:0,max:1,step:.01,valueLabelDisplay:"auto"}),e.jsx(ze,{type:"number",className:"w-[60px]",value:a,onChange:o=>{const i=+o.target.value;s("strength")(Ve(i,0,1))},inputProps:{min:0,max:1,step:.01}})]})]})},K1=[{condition:({task:t})=>!Q1(t),element:Z1},{condition:({task:t})=>Gt(t)==="t2i",element:xd},{element:B1},{element:qr},{condition:({task:t})=>Gt(t)==="t2i",element:Sr},{element:Vd},{element:V1},{element:Td},{element:i1}],q1=K1.map((t,s)=>({...t,id:s}));function Gt(t){return t.baseImage!=null?"i2i":"t2i"}function Q1(t){var s;return((s=t.ipAdapter)==null?void 0:s.enabled)??!1}const J1=function({className:t,style:s}){const{values:n}=P(),a={task:n},o={tab:w("flex-none p-2.5 bg-neutral-200 dark:bg-transparent hover:bg-black/20 dark:hover:bg-black/20 border border-t-0 group-data-[orientation=vertical]:border-b-0 border-x-transparent border-b-neutral-300 dark:border-b-neutral-700 relative -mx-px transition","aria-selected:bg-[rgb(var(--bg-color))] dark:aria-selected:bg-white/20 aria-selected:border-neutral-300 dark:aria-selected:border-neutral-700 aria-selected:border-b-transparent aria-selected:relative"),tooltip:"px-2 py-1 bg-[rgb(var(--bg-color))] text-[rgb(var(--fg-color))] ring-1 ring-neutral-300 dark:ring-neutral-700 rounded shadow-md mr-1",content:"flex-1 min-w-0 data-[state=active]:flex flex-col divide-y divide-neutral-300 dark:divide-neutral-700 z-[1]"};return e.jsx(Li,{value:"Settings",className:w("flex flex-col data-[orientation=vertical]:flex-row-reverse group",t),style:s,children:e.jsxs(Ei,{value:"Settings",className:o.content,children:[q1.map(i=>{var r;if(((r=i.condition)==null?void 0:r.call(i,a))??!0)return e.jsx(i.element,{},i.id)}),e.jsx(X1,{className:"flex-none bg-[rgb(var(--bg-color))] border-t border-neutral-300 dark:border-neutral-700 mt-auto sticky bottom-0 z-10"})]})})};function X1(t){const{data:s}=ne(),n={footerButton:"flex-1 p-5 flex justify-center items-center gap-1 hover:bg-black/10 dark:hover:bg-black/20 transition",footerButtonIcon:"w-5 h-5"};return e.jsxs("div",{className:w("flex",t.className),style:t.style,children:[s&&e.jsx(Ir,{className:n.footerButton,iconProps:{className:n.footerButtonIcon}}),e.jsx(ld,{classes:{button:n.footerButton,icon:n.footerButtonIcon}})]})}const jn={workflowLink:"ml-px px-2 py-1 text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-500/30 rounded-r"};function Y1(t){var n;const{data:s}=oi((n=t.task)==null?void 0:n.parameters.workflowId);return e.jsxs("p",{className:w("px-2 msm:px-4 pb-2 text-sm text-center",t.className),style:t.style,children:[e.jsx("span",{className:"px-2 py-1 bg-zinc-200 dark:bg-zinc-700 rounded-l last:rounded-r",children:e.jsx(R,{i18nKey:"generation:workflow.workflow-task-hint.message"})}),Qt(t.task).returnType().with({parameters:{inputs:{}}},()=>Object.keys(t.task.parameters.inputs??{}).length>0,()=>(s==null?void 0:s.artworkId)&&e.jsx(Ys,{href:_r(s.artworkId),className:jn.workflowLink,children:e.jsx(R,{i18nKey:"generation:workflow.workflow-task-hint.button-label"})})).with({parameters:{workflowId:oe.select(oe.string)}},a=>e.jsx(Ys,{href:Mr(a,!0),className:jn.workflowLink,children:e.jsx(R,{i18nKey:"generation:workflow.workflow-task-hint.button-label",context:"editor"})})).otherwise(()=>null)]})}const eu=c.lazy(()=>ii(()=>import("./index-C3uFo3B7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106]),import.meta.url));function tu(){return e.jsxs("div",{className:"isolate relative flex flex-col w-full min-h-[80svh] flex-1 @container",children:[e.jsx("div",{className:"px-4 py-1",children:e.jsx(Ue,{alwaysShowFillTab:!0})}),e.jsx("div",{className:"flex-1 w-full",children:e.jsx(c.Suspense,{fallback:e.jsx("div",{className:"grid place-items-center h-full",children:e.jsx(Wt,{})}),children:e.jsx(eu,{})})})]})}function su(){return e.jsx(zi,{children:e.jsx(tu,{})})}const nu=t=>{const s=za(Vi);return e.jsx(ys.Provider,{value:s,children:t.children})};function au(t){var g;const{task:s,trackingArgs:n}=t,a=Nn(s)>0,o=Gn(s),i=(g=s==null?void 0:s.artworkIds)==null?void 0:g[0],{data:r}=J(o?Zn(s):void 0),l=r??(s==null?void 0:s.media),d=r?ri(r):Je(s==null?void 0:s.media),[u,m]=kt(async()=>{var h;s&&(T("image_dl",{scene:n.scene,authorId:s==null?void 0:s.userId,artworkId:(h=s==null?void 0:s.artworkIds)==null?void 0:h[0],mediaId:l==null?void 0:l.id}),li({type:"download",action:"confirm",taskId:s.id,taskParams:s.parameters,otherParams:{scene:n.scene,mediaId:l==null?void 0:l.id}}),d?await oa(d,`${Is({task:s})}.${st({task:s})}`,{skipConversion:!0}):D.error("Cannot download image"))},[s,l,d]);return e.jsx("div",{className:"flex items-center justify-between",children:a&&i?e.jsx("div",{className:"flex items-center gap-2 ml-auto",children:e.jsx(Tr,{artworkId:i,scene:n.scene})}):e.jsxs(e.Fragment,{children:[e.jsx(Ai,{task:s,scene:"i2vPro",icon:e.jsx(Kn,{className:"size-5"})}),e.jsx($,{busy:u.loading,variant:"outlined",onPress:m,children:e.jsx(ia,{className:"size-5"})})]})})}function ou(){var r;const{lastResultTaskId:t}=Pr(),{data:s}=wt(t),{data:n}=J(Zn(s)),a=s==null?void 0:s.outputs.detailParameters,o=a!=null&&a.width&&a.height?{width:a.width,height:a.height}:void 0,{beingAdmin:i}=Xt();return e.jsxs("div",{className:"px-20 mlg:px-4 flex flex-col w-full justify-center bg-background dark:border-neutral-700",children:[!t&&e.jsx("p",{className:"text-center w-full py-8 text-2xl text-neutral-400 my-auto",children:e.jsx(R,{i18nKey:"generation:enhance-image.result.display-placeholder"})}),t&&!s&&e.jsx(Wt,{}),((s==null?void 0:s.status)==="waiting"||(s==null?void 0:s.status)==="running"||(s==null?void 0:s.status)==="failed")&&e.jsx(e.Fragment,{children:e.jsxs(Wn,{className:w("rounded-lg max-mlg:h-[calc(100dvh-554px)] mlg:my-8",!o&&"w-full h-full"),id:s==null?void 0:s.id,status:s.status,contentStyleProps:{className:w("rounded-lg",!o&&"py-8"),style:o?{aspectRatio:(o.width??1)/(o.height??1)}:void 0},children:[(r=s.outputs)==null?void 0:r.task_status_msg,i&&e.jsx($,{variant:"filled",color:"admin",onPress:()=>{hl(s)},children:"Inspect"})]})}),e.jsx("div",{id:"i2v-task-result-scroll-into-view"}),n&&e.jsxs("div",{className:"w-full flex flex-col mlg:justify-between mlg:h-full gap-2 py-4",children:[e.jsx(au,{task:s,trackingArgs:{scene:"i2vpro-result"}}),e.jsx(ci,{media:n,autoPlay:!0,controls:!0,className:"rounded-lg"}),e.jsx("div",{className:"hidden mlg:block h-8"})]})]})}const iu=c.memo(js);function Ha(){const t=It(),s=Ts(),[,n]=c.useContext(ce);return c.useCallback(o=>{if(di(o.task)){const i=o.task.parameters.i2vPro.mediaId;i&&(t([i]),s(r=>{var l;return{...r,lastResultTaskId:(l=o.task)==null?void 0:l.id,lastResultTask:o.task}}))}else o.media&&(t([o.media.id]),s(()=>({})));o.task&&n(tt(o.task)??[])},[])}function ru(){const t=Ts(),s=Ns();c.useEffect(()=>{s.length===0&&t(()=>({}))},[s]);const n=Ha();return e.jsx(iu,{className:"flex-1",onSelectItem:n,enableBatchMediaSelect:!0})}function lu(){const[{mediaId:t,task:s},n]=Xe(),a=Ts(),o=It();return c.useEffect(()=>{t&&o([t]);const i=da(s);i?(o([i.parameters.i2vPro.mediaId]),a(()=>({lastResultTaskId:i.id,lastResultTask:i}))):a(()=>({lastResultTaskId:void 0,lastResultTask:void 0})),n(r=>({...r,mediaId:null,task:null}))},[t,s]),null}function cu(){const t=Ha();return du(),e.jsxs(Lr,{children:[e.jsx("div",{className:"hidden mlg:flex flex-col mlg:overflow-hidden",style:{gridArea:"left"},children:e.jsx(ru,{})}),e.jsx(lu,{}),e.jsx(Me,{id:B.ImageToVideo,className:"contents",children:e.jsxs("main",{className:w("relative flex flex-col bg-dot-pattern min-h-0 mlg:[grid-area:main/2/main/-1] max-mlg:row-end-[-1]"),children:[e.jsx(St,{className:w("m-3 mlg:hidden","[&>div]:flex [&>div]:flex-col [&>div]:items-center [&>div>p]:text-center","[&>div>a]:mx-auto [&>div>a]:py-1")}),e.jsx("div",{className:"px-4 py-1",children:e.jsx(Ue,{className:"flex-wrap"})}),e.jsxs("div",{className:"grid grid-rows-[auto_1fr_auto] mlg:grid-rows-none mlg:grid-cols-[2fr_1fr] flex-1 gap-x-4 min-h-0 relative",children:[e.jsxs("div",{className:"flex flex-col mlg:grid mlg:grid-cols-2 border-x border-t dark:border-neutral-700 relative mlg:overflow-y-auto",children:[e.jsx(ja,{onImageSelect:t,trackingScene:"image-to-video"}),e.jsx(Es,{className:"hidden mlg:block absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 size-8 text-gray-300 dark:text-gray-700 mlg:rotate-0 rotate-90"}),e.jsx(ou,{})]}),e.jsx(Er,{className:" bg-background mlg:border-l mlg:border-t p-4 pb-0 max-mlg:sticky max-mlg:bottom-0 dark:border-neutral-700 overflow-y-auto max-mlg:max-h-[min(50vh,calc(100vh-336px))] max-mlg:border-t"})]})]})})]})}function du(){const{models:t,defaultModel:s,isLoading:n}=Ar(),[a,o]=Rn("generator::image-to-video-demo-shown",!1),i=c.useMemo(()=>{var r;return(r=t.find(l=>l.model===s))==null?void 0:r.demoVideoId},[t,s]);c.useEffect(()=>{!a&&i&&(o(!0),Rr(i))},[a,i])}function uu(t){const{state:s,dispatch:n}=c.useContext(pe);return c.useEffect(()=>{t.type&&s.type!==t.type&&n({type:"set-type",value:t.type})},[t.type,s.type]),e.jsx(Bi,{scene:"image",headerSlot:e.jsxs(e.Fragment,{children:[e.jsx($i,{value:ta.Image}),e.jsx("span",{className:"ml-auto"})]}),children:e.jsx(mu,{})})}function mu(){const{state:t}=c.useContext(pe);return e.jsxs(ps,{selectedKey:t.mode,className:"contents",children:[e.jsxs(bs,{className:"hidden",children:[e.jsx(Be,{id:B.Generate}),e.jsx(Be,{id:B.Fill})]}),(t.mode===B.Fill||t.mode===B.Generate)&&e.jsx(hu,{}),t.mode===B.EnhanceImage&&e.jsx(bu,{}),t.mode===B.ImageToVideo&&e.jsx(ju,{})]})}function hu(){const t=e.jsx("div",{className:"hidden mlg:flex flex-col mlg:overflow-hidden",style:{gridArea:"left"},children:e.jsx(gu,{className:"flex-1"})});return e.jsx(Hi,{children:e.jsx(ws,{children:e.jsx(Ui,{children:e.jsx(Gi,{children:e.jsxs(Zi,{children:[e.jsx(yu,{}),e.jsxs(nu,{children:[e.jsx(fu,{children:t}),e.jsx(xu,{children:t})]})]})})})})})}const gu=c.memo(function(s){return e.jsx(js,{...s,enableClickToImportTask:!0})});function fu(t){return e.jsxs(Me,{id:B.Generate,className:"contents",children:[t.children,e.jsxs("main",{className:"relative flex flex-col grow",style:{gridArea:"main",gridColumnStart:2,gridColumnEnd:-2},children:[e.jsx(St,{className:w("m-3 mlg:hidden","[&>div]:flex [&>div]:flex-col [&>div]:items-center [&>div>p]:text-center","[&>div>a]:mx-auto [&>div>a]:py-1")}),e.jsx(Ac,{className:"flex-none bg-background"}),e.jsx(vu,{}),e.jsx(Ua,{})]}),e.jsxs("div",{className:"relative flex flex-col mlg:border-l border-neutral-300 dark:border-neutral-700 mlg:overflow-hidden",style:{gridArea:"right"},children:[e.jsx(Nu,{}),e.jsx(pu,{})]})]})}function xu(t){return e.jsxs(Me,{id:B.Fill,className:"contents",children:[t.children,e.jsxs("main",{className:"relative flex flex-col grow",style:{gridArea:"main",gridColumnStart:2,gridColumnEnd:-1},children:[e.jsx(St,{className:w("m-3 mlg:hidden","[&>div]:flex [&>div]:flex-col [&>div]:items-center [&>div>p]:text-center","[&>div>a]:mx-auto [&>div>a]:py-1")}),e.jsx(su,{}),e.jsx(wu,{}),e.jsx(Ua,{})]})]})}function Ua(){const{t}=C(["generation"]),{dispatch:s}=c.useContext(pe),n=c.useContext(ys),a=["image/png","image/jpeg"],[o,i]=c.useState(!1);Se("dragenter",d=>{d.dataTransfer&&[...d.dataTransfer.items].some(u=>a.includes(u.type))&&i(!0)}),Se("dragleave",d=>d.relatedTarget||i(!1)),Se("drop",()=>i(!1));const r=c.useCallback(d=>d.preventDefault(),[]),l=c.useCallback(d=>{if(d.dataTransfer){d.preventDefault();for(const u of d.dataTransfer.files)if(a.includes(u.type)){n.current.setBaseImageFromFile(u,{cate:"drop"}),s({type:"set-mode",value:B.Fill});break}}},[]);return e.jsx(ds,{children:o&&e.jsx(bt.div,{className:"z-50 absolute inset-0 p-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onDragEnter:r,onDragOver:r,onDragLeave:r,onDrop:l,children:e.jsx("div",{className:"grid place-items-center size-full p-4 text-4xl bg-white/80 dark:bg-black/80 rounded-3xl",children:t("generation:drop.fill-editor")})},"fill-drop-overlay")})}function pu(){const{t}=C(["generation"]),{dispatch:s}=c.useContext(pe),[,n]=c.useContext(Cs),{setValues:a}=P(),o=["image/png","image/jpeg"],[i,r]=c.useState(!1);Se("dragenter",u=>{u.dataTransfer&&[...u.dataTransfer.items].some(m=>o.includes(m.type))&&r(!0)}),Se("dragleave",u=>u.relatedTarget||r(!1)),Se("drop",()=>r(!1));const l=c.useCallback(u=>u.preventDefault(),[]),d=c.useCallback(u=>{if(u.dataTransfer){u.preventDefault();for(const m of u.dataTransfer.files)if(o.includes(m.type)){a(g=>({...g,baseImage:be.fromFile(m),inpaintMaskImage:void 0,previewImage:void 0})),n(g=>({...g,dirty:!0})),s({type:"set-mode",value:B.Generate});break}}},[]);return e.jsx(ds,{children:i&&e.jsx(bt.div,{className:"z-50 absolute inset-0 p-2",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onDragEnter:l,onDragOver:l,onDragLeave:l,onDrop:d,children:e.jsx("div",{className:"grid place-items-center size-full p-4 text-4xl bg-white/80 dark:bg-black/80 rounded-3xl",children:t("generation:drop.base-image")})},"base-image-drop-overlay")})}function bu(){return e.jsx(ws,{children:e.jsx(Ll,{})})}function ju(){return e.jsx(ws,{children:e.jsx(cu,{})})}const vu=()=>{var n;const[t]=c.useContext(ce),{data:s}=wt((n=t[0])==null?void 0:n.taskId);return e.jsx(Wi,{children:e.jsx(Ki,{children:e.jsx(Ri,{className:"flex-1",toolbar:s&&e.jsx(Cu,{task:s}),action:s&&e.jsx(Bc,{className:"pb-2",task:s})})})})};function Cu(t){return Qt(t.task).with({status:oe.union("waiting","running")},()=>null).with(oe.when(Gn),s=>e.jsx(Dl,{task:s,className:"px-2 msm:px-4 pb-2"})).with(oe.when(ui),s=>e.jsx(Y1,{task:s})).otherwise(()=>null)}function yu(){const[,t]=c.useContext(ce),[,s]=c.useContext(vs),[,n]=c.useContext(Yn),{setValues:a,setInitialValues:o}=P(),{data:{samplingMethods:i}={},isLoading:r}=ns(),l=c.useRef(!1),[{task:d,artwork:u,importType:m,showOnStage:g,initialValues:h},x]=Xe();c.useEffect(()=>{d&&(l.current=!1)},[d]);const f=da(d),b=Dr(u),p=$r(h),{data:j,isLoading:v}=J(mi(f)),k=Object.keys((p==null?void 0:p.lora)??{})[0],_=p==null?void 0:p.modelId,{data:y,isLoading:E}=en(k),{data:M,isLoading:S}=en(_),{modelList:A,isLoading:W}=Ji();return c.useEffect(()=>{if(v||E||S||r||W)return;if(l.current){n(!0);return}const I=j??(b==null?void 0:b.media),q=Di({artwork:b,task:f,allowedSamplingMethods:i,baseImageMedia:I,extraInitialValues:p,loraVersion:y,modelVersion:M,presetModelList:A,options:{isUseAsReference:m==="use_as_reference"}});a(q),o(q),s((b==null?void 0:b.id)??(f==null?void 0:f.id)),l.current=!0,n(!0),g&&(f!=null&&f.id)&&t(tt(f)??[]),x(Q=>({...Q,task:null,artwork:null,importType:null,showOnStage:null,initialValues:null}))},[r,v,E,S,W,d]),null}function wu(){const[{media:t},s]=Xe(),{data:n}=J(Number.isInteger(Number(t))?t:void 0),[,a]=c.useContext(ce),{dispatch:o}=c.useContext(pe),i=c.useContext(ys),r=c.useRef(!1),l=async d=>{i.current.setBaseImageFromMedia(d,{cate:"qs"}),o({type:"set-mode",value:B.Fill}),a([]),s(u=>({...u,media:null}))};return c.useEffect(()=>{r.current||(n!=null&&n.id&&l(n),r.current=!0)},[n==null?void 0:n.id]),null}function ku(){const{state:t}=c.useContext(pe);return e.jsxs(e.Fragment,{children:[e.jsx(ka,{showPriorityCheckbox:!0,className:w("flex-none max-mlg:order-2 max-mlg:sticky top-[44px] bottom-0 bg-[rgb(var(--bg-color))] p-4 z-10 mlg:hidden",t.mode!==B.Generate&&"hidden"),id:"workbench-generate-button-intersector"}),e.jsx(J1,{className:"flex-1 max-mlg:order-1 mlg:overflow-auto"})]})}const Nu=c.memo(ku);function vh(){const t=hi("/generator/:type"),s=vn(),{t:n}=C(["common"]);gi({trackingProps:{location:"generator"}});const{data:a,isLoading:o}=ne(),i=c.useCallback(()=>{$t("generate_source"),$t("generate_id"),$t("generate_task_id")},[]);c.useRef(!0),c.useEffect(()=>(tn("generate_id",fi()),tn("generate_task_id",1),window.addEventListener("close",i),()=>{i(),window.removeEventListener("close",i)}),[]);const[{showSignUpModal:r,signupModalRedirect:l},d]=Xe(),u=Cn(),m=c.useRef(Qn(u.tab));c.useEffect(()=>{d(h=>({...h,challenge:null,tag:null,mode:null}))},[]);const g=ha(async()=>{se({oauthRedirectUrl:l})});return c.useEffect(()=>{Number(r)&&(o||a||(d(h=>({...h,showSignUpModal:null,signupModalRedirect:null})),g()))},[a==null?void 0:a.id,o,r]),e.jsxs(xi,{children:[e.jsx(pi,{title:n("common:meta.title.submit-gen"),description:n("common:meta.description.submit-gen")}),e.jsx(qi,{defaultValue:{navigate:s,mode:m.current,type:ta.Image},children:e.jsx(uu,{type:t==null?void 0:t.params.type})})]})}export{vh as Component};
//# sourceMappingURL=MultiColumnSubmitPage-CjqNbxmr.js.map
