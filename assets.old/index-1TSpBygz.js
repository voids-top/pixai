import{j as t,e as u,u as z,t as E,K as L,bv as F,bw as H,$ as T,b8 as $,j$ as B}from"./index-BTMYyhc6.js";import{e as V}from"./async-DCNJOliF.js";import{u as K}from"./index-C-ypkS9u.js";import{b as A,d as W,g as D,M as S,i as X}from"./baseline-cancel-RNUwgBax.js";import{i as q}from"./round-plus-RCIMN6sR.js";import{C as J}from"./index-D334VmL8.js";import{g as Q}from"./rand-CWZpxDtu.js";import{u as Y}from"./upload-DDvru8Za.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="52e1203e-a41c-46a6-bd8e-613509862a8e",e._sentryDebugIdIdentifier="sentry-dbid-52e1203e-a41c-46a6-bd8e-613509862a8e")}catch{}})();{var U=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};U._sentryModuleMetadata=U._sentryModuleMetadata||{},U._sentryModuleMetadata[new Error().stack]=Object.assign({},U._sentryModuleMetadata[new Error().stack],{"_sentryBundlerPluginAppKey:pixai-web-app-key":!0})}const Z=e=>t.jsx("svg",{viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...e,children:t.jsx("path",{fill:"currentColor",d:"M20 4v12H8V4h12m0-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 9.67l1.69 2.26l2.48-3.1L19 15H9zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6H2z"})});function G(e){const[a,r]=u.useState(null);return u.useEffect(()=>{if(!e){r(null);return}const s=URL.createObjectURL(e);return r(s),()=>URL.revokeObjectURL(s)},[e]),a}const ee={"image/png":[],"image/jpeg":[],"image/webp":[]},O=100;function de(e){var j;const{t:a}=z(["common"]),[,r]=u.useContext(A),s=W(),[o,m]=D(),n=u.useContext(S),h=async i=>{var f;const g=Object.entries(i);g.forEach(x=>{var p;const[M,{file:C,controller:k}]=x,d=`upload-${M}`;(p=n.current)==null||p.set(d,{file:C,controller:k}),m(P=>[...P,d])}),await V(g,3,async x=>{var p,P,R;const[M,{file:C,controller:k}]=x,d=`upload-${M}`;try{const l=await Y(C,{signal:k.signal,onProgress:b=>{r(y=>({...y,[d]:b}))}});l.media&&(B(l.media.id,l.media),m(b=>{const y=[...b],N=y.findIndex(_=>_===d);return N>-1&&y.splice(N,1,l.media.id),y}),(p=n.current)==null||p.delete(d),(P=e.onItemUploadSuccess)==null||P.call(e,l.media.id))}catch(l){l instanceof J||E.error(l.message),(R=n.current)==null||R.delete(d)}finally{r(l=>{const b={...l};return delete b[d],b})}}),(f=e.onUploadSuccess)==null||f.call(e)},c=u.useCallback(i=>{if(o.length+i.length>(e.maxAllowedMedia??O))return E.error(a("common:media-upload.max-number-exceeded",{number:e.maxAllowedMedia??O}));const g=Object.fromEntries(i.map(f=>[Q(),{file:f,controller:new AbortController}]));h(g)},[o.length]),{getRootProps:w,getInputProps:I,open:v}=K({onDrop:c,onFileDialogOpen:()=>{var i;(i=e.onFileDialogOpen)==null||i.call(e)},accept:ee,multiple:e.maxAllowedMedia!==1,...e.dropzoneOpts});return t.jsxs("div",{className:L("font-medium cursor-pointer flex flex-col gap-3 items-center justify-center text-xs",(j=e.wrapperProps)==null?void 0:j.className),...w(),children:[t.jsx("input",{...I()}),s?t.jsxs(t.Fragment,{children:[t.jsx(q,{className:"size-6"}),t.jsx("p",{className:"mt-1",children:a("market:train-lora.add-image.label")})]}):t.jsxs(t.Fragment,{children:[t.jsx(Z,{className:"size-[104px] text-neutral-400"}),e.uploadTrigger({open:v})]})]})}function ue(e){const{onRemove:a,...r}=e,[s,o]=D(),m=u.useCallback(n=>{o(h=>[...h].filter(w=>w!==n)),a==null||a(n)},[]);return s.length?t.jsx(t.Fragment,{children:s.map(n=>t.jsx(te,{isUploading:n.startsWith("upload"),itemId:n,onRemove:m,...r},n))}):null}function te(e){var j,i,g,f,x;const a=u.useContext(S),[r]=u.useContext(A),{itemId:s,isUploading:o}=e,{data:m}=F(o?void 0:s),n=H(m),h=T(m),c=o?(j=a.current)==null?void 0:j.get(s):void 0,w=G(c==null?void 0:c.file),I=(e.usePublicUrl?h:n)??w,v=(r[s]??0)*100;return t.jsxs("div",{className:L("relative group",(i=e.wrapperProps)==null?void 0:i.className),style:(g=e.wrapperProps)==null?void 0:g.style,children:[I&&t.jsx("img",{className:(f=e.imgProps)==null?void 0:f.className,style:(x=e.imgProps)==null?void 0:x.style,src:I,loading:"lazy",decoding:"async"}),o&&t.jsx("div",{className:"absolute top-0 left-0 w-full h-full backdrop-blur bg-white/40 dark:bg-black/40 flex items-center justify-center rounded-lg",children:t.jsx($,{variant:v>15?"determinate":void 0,value:v})}),t.jsx("button",{title:"Remove",className:L("absolute right-1 top-1 bg-white text-black p-0 rounded-full","[@media((hover:hover)_and_(pointer:fine))]:hidden group-hover:block"),onClick:()=>{o&&(c==null||c.controller.abort()),e.onRemove(e.itemId)},children:t.jsx(X,{className:"size-5"})})]})}export{de as M,ue as a,G as u};
//# sourceMappingURL=index-1TSpBygz.js.map
